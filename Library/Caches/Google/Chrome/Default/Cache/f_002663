define("commons/base_object/document/group_opers_document_controller",["jquery","underscore","bifit","app","dialogUtils","thesaurusUtils","libs/multi_client_utils","actionUtils","collections/thesaurus","commons/base_object/document/document_controller","commons/base_object/document/confirm_reason_view","i18n!nls/document"],function(a,b,c,d,e,f,g,h,i,j,k,l){return j.extend({getListViewOptions:function(){return j.prototype.getListViewOptions.call(this)},addListViewListeners:function(a){j.prototype.addListViewListeners.call(this,a),this.listenTo(a,"update-actions",this.updateActions)},updateActions:function(a){d.mainLayout.actionBar.show(this.createActionBar(a))},COPY_GROUP:function(){var e=new this.Model({type:this.docType}),f=b.groupBy(this.collection.selected,function(a){return a.get("owner_id")}),h=0,j=this,k=b.size(f),m=b.keys(f),n=!1,o=this.showGroupList(l.group_view_copy_h1,{stopOperation:function(){n=!0},entityType:"documents",operationType:"copying"}),p=function(){if(k>h&&!n){var q=m[h++],r=f[q],s=d.isMultiClient()?g.loadTemplate(!1,q,e):e.loadTemplate();s.done(function(e){var f,h=[],k=function(a,b){var d,e=j.getWorkContent(a).NUM_DOC,f=b||e+"/C",g=j.getCurrencyName(a.getCurrency());return d=a.getFAmount()?c.sprintf(l.group_view_copy,e,a.getFAmount(),g,f):c.sprintf(l.group_view_copy_2,e,f)},m=0,s=function(){if(!n)if(m<h.length){var a=h[m++];a.on("model:completeSync",s),a.save({},{silent:!0,emulateClientRequest:d.isMultiClient()})}else p()},t=b.size(r);if(d.isMultiClient()){var u=b.findWhere(i.getThesaurus("sub_clients").array,{client_id:q}),v=r[0].attributes,w=(u||{}).name_cln||v.CLN_NAME||v.PAYER_NAME||v.SENDER,x={statusHandlers:{403:function(a){b.each(r,function(b){var c=k(b);o.add(b,c),b.trigger("model:completeSync",b,l.error,a,403)})}}};f=g.loadSubClientData(q,w,x)}else f=a.Deferred().resolve();f.then(function(){var a=function(b){var c=r[b],d=j.getWorkContent(c),f=d.NUM_DOC;j.prepareContent4Save(j.prepareContent4Create(d)).then(function(d){d.NUM_DOC=""+(e.N?e.N++:f+"/C");var g=new j.Model(d,{silent:!0}),i=k(c,d.NUM_DOC);return j.isAccountsForCreateAction()?(o.add(g,i),h.push(g),void(b===t-1?s():b%100===0?setTimeout(a.bind(this,++b),0):a(++b))):(o.add(g,i),void g.trigger("model:completeSync",g,j.getNoAccErrorText()))})};a(0)})})}};p()},DELETE_GROUP:function(){var a=this.collection.selected,c=function(){var c=!1,e=this.group(function(a,b){this.addModelToGroupView(a,b,"delete")}.bind(this),l.group_view_delete_h1,a,{stopOperation:function(){c=!0},entityType:"documents",operationType:"deleting"}),f=b.pluck(e.children,"model"),g=0,h=function(){if(g<f.length&&!c){var a=f[g++];d.isMultiClient()&&(d.multiClient.currentSubClientId=a.get("owner_id"));var e={statusHandlers:{403:function(a){h()}}};a.destroy(b.extend(e,{silent:!0,wait:!0,emulateClientRequest:d.isMultiClient(),success:function(){a.trigger("model:completeSync",a,"Ok"),h()},error:function(){h()}}))}};h()},f=1===b.keys(a).length?l.confirm_delete_doc:l.confirm_delete_many_doc;e.confirm(f,c,!1,this)},SIGN_GROUP:function(){var e=this.collection.urlRoot+this.docType+"/sign/",i=";jsessionid="+c.getStoredItem("JSESSIONID"),j=b.values(this.collection.selected),k=0,m=!1,n=function(){if(k<j.length&&!m){var o=j[k++],p=o.get("attaches");if(!b.isEmpty(p))for(var q=f.getClientProp("documents.attachments.extensions"),r=0;r<p.length;r++)if(!c.checkAttachExtension(p[r].name,q))return o.trigger("model:completeSync",o,l.error,c.sprintf(l.attach_has_not_allowed_extension,q)),void n();var s=b.isEmpty(p)?a.when():this.loadAndSetAttachesContent(o),t=s.then(function(){var a=this.signData(o);return{content:this.prepare4Sign(a),id:o.get("id")}}.bind(this),function(a){o.trigger("model:completeSync",o,l.error,c.sprintf(l.attach_load_error,a.name)),n()}),u=function(b){SignPluginServices.signData(b.content).then(function(c){a.ajax({type:"POST",dataType:"json",url:e+b.id+i,data:JSON.stringify({id:b.id,sign:c.sign,timestamp:c.timestamp}),success:function(a){o.set(a,{silent:!0}),o.trigger("model:completeSync",o,"Ok","",200),n()},error:function(a){o.trigger("model:completeSync",o,l.error,a.responseText,a.status),n()}})})},v=function(a,c){var d=b.contains(["2","2002","3004"],o.get("status"));if(d||a===w.length)return o.trigger("model:completeSync",o,"Ok","",200),void n();var f=parseInt(o.get("sign_groups_mask"));return h.hasSignOfGroup(f,w[a].GR)?void v(a+1,c):void g.useKey(w[a].ID).then(function(){SignPluginServices.signData(c.content).then(function(b){g.ajax({type:"POST",dataType:"json",url:e+c.id,data:JSON.stringify({id:c.id,sign:b.sign,timestamp:b.timestamp}),currentSubClientKeyId:w[a].ID,success:function(b){return o.set(b,{silent:!0}),b.error&&a<w.length-1?(o.trigger("model:completeSync",o,l.error,b.error,200),void n()):void v(a+1,c)},error:function(a){o.trigger("model:completeSync",o,l.error,a.responseText,a.status),n()}})})})};if(d.isMultiClient())if(-1===this.docType.indexOf("budget")){var w=g.getKeysListLocatedMultiClient(o.get("owner_id"));t.then(v.bind(this,0))}else g.useMultiClientKey().then(function(){t.then(u)});else t.then(u)}}.bind(this);this.group(function(a,b){this.addModelToGroupView(a,b,"sign"),j.length===b.children.length&&n()}.bind(this),l.group_view_sign_h1,j,{stopOperation:function(){m=!0},entityType:"documents",operationType:"signing"})},addModelToGroupView:function(a,b,d){var e,f=a.get("NUM_DOC"),g=a.getFAmount(),h="";g?(e="sign"===d?l.group_view_sign:l.group_view_delete,h=c.sprintf(e,f,g,this.getCurrencyName(a.getCurrency()))):(e="sign"===d?l.group_view_sign_2:l.group_view_delete_2,h=c.sprintf(e,f)),b.add(a,h)},REJECT_GROUP:function(){var a=new k({el:e.wrapper(),templateHelpers:{maxLength:200,title:l[1===this.collection.selectedLength?"reject_doc_title":"reject_docs_title"],ok_button_name:l.reject_link_btn,cancel_button_name:l.close_link_btn}}).render();a.on("confirm",this.groupRejectRequest,this)},groupRejectRequest:function(d){var e=b.values(this.collection.selected),f=0,g=!1,h=function(){if(f<e.length&&!g){var b=e[f++];a.ajax({type:"PUT",contentType:"application/json",data:d||"",url:this.collection.urlRoot+this.docType+"/"+b.get("id")+"/reject"+b._session(),success:function(a){b.set(a,{silent:!0}),a.error?b.trigger("model:completeSync",b,l.error,a.error,200):b.trigger("model:completeSync",b,"Ok","",200),h()}.bind(this),error:function(a){b.trigger("model:completeSync",b,"documentNls.error",a.responseText,a.status),h()}.bind(this)})}}.bind(this);this.group(function(a,b){var d=a.get("NUM_DOC");b.add(a,c.sprintf(l.group_view_reject,d)),e.length===b.children.length&&h()},l.group_view_reject_h1,e,{stopOperation:function(){g=!0},entityType:"documents",operationType:"rejecting"})},prepareDeferredForModelsFetch:function(c){var d=a.Deferred(),e=b.values(this.collection.selected),f=0,g=function(){if(f<this.collection.selectedLength){var a=e[f++];!c||c(a)?(this.listenToOnce(a,"model:completeSync",function(){g()}),a.fetch()):g()}else d.resolve()}.bind(this);return g(),d},PRINT_GROUP:function(a){a.stopPropagation(),this.printDocs(b.values(this.collection.selected))},printDocs:function(){}})}),define("apps/ua_currency_purchase/nls/base_ua_currency_purchase",{root:{no_cur_accs:"Невозможно создать документ. Отсутствует текущий счет в иностранной валюте",no_uah_accs:"Невозможно создать документ. Отсутствует текущий счет в национальной валюте.",number:"Номер",date:"Дата",purchase_account:"Счет зачисления",amount:"Сумма",currency:"Валюта",status:"Статус",payer:"Плательщик",purch_account:"и зачислить на счет",transfer_kind:"Необходимую сумму в гривне",sale_sum:"Сумму в гривне",sale_account:"на счет банка",return_bnk:"Неиспользованные средства в гривне перечислить в банк",value_date:"Дата валютир.",date_doc:"Дата документа",unrequired:"необяз.",current:"текущая",autonum:"автонумер.",fund_account:"Сбор ПФ списать со счета",rate0:"по курсу",rate1:"по курсу уполномоченного банка",rate0_label:"по курсу",rate1_label:"по курсу банка",transf_kind_0:"Обязуемся перечислить самостоятельно",transf_kind_1:"Поручаем уполномоченному банку списать",transf_kind_0_label:"обязуюсь перечислить",transf_kind_1_label:"поручаю банку списать",cp:"Номер",currency_date:"Дата валютирования",name:"Наименование",mfo:"МФО",fio:"Уполномоченный сотрудник компании",phone:"Телефон",comission:"Комиссия, %",valid_till:"Срок действия",fio_placeholder:"ФИО (необяз.)",tel_placeholder:"тел. (необяз.)",rate:"Курс",no_accs_error:"Невозможно создать документ.<p>Отсутствуют счета следующих типов: текущий в иностранной валюте, текущий в гривне.<p>Необходимо, чтобы счета всех перечисленных типов были открыты в одном МФО.",field_NUM_DOC:"Номер документа",field_DATE_DOC:"Дата документа",field_CLN_NAME:"Наименование клиента",field_CLN_ADDR:"Адрес клиента",field_CLN_PHONES:"Контактный телефон клиента",field_CLN_EMPLOYEE_FIO:"Ф.И.О. ответственного сотрудника клиента",field_CLN_EMPLOYEE_PHONE:"Контактный телефон ответственного сотрудника клиента",field_PURCHASE_REASON:"Основание для купли иностранной валюты",field_BNK_NAME:"Наименование уполномоченного банка",field_BNK_MFO:"МФО уполномоченного банка",field_BNK_ADDR:"Адрес уполномоченного банка",field_SALE_SUM:"Сумма гривен для купли иностранной валюты",field_SALE_ACCOUNT:"Транзитный счет банка",field_SALE_BNK_NAME:"Наименование банка, где открыт транзитный счет клиента",field_SALE_BNK_MFO:"МФО банка, где открыт транзитный счет клиента",field_PURCHASE_SUM:"Сумма покупаемой иностранной валюты",field_PURCHASE_CURRENCY:"Код покупаемой иностранной валюты",field_PURCHASE_RATE_KIND:"Вариант выбора курса покупки иностранной валюты",field_PURCHASE_RATE:"Курс покупки иностранной валюты",field_PURCHASE_ACCOUNT:"Счет клиента для зачисления покупаемой иностранной валюты",field_PURCHASE_BNK_NAME:"Наименование банка, в котором открыт счет клиента для зачисления покупаемой иностранной валюты",field_PURCHASE_BNK_MFO:"МФО банка, в котором открыт счет клиента для зачисления покупаемой иностранной валюты",field_COMMISSION:"Комиссия уполномоченного банка",field_RETURN_ACCOUNT:"Счет клиента для возврата гривны",field_RETURN_BNK_NAME:"Наименование банка, в котором открыт счет клиента для возврата гривны",field_RETURN_BNK_MFO:"МФО банка, в котором открыт счет клиента для возврата гривны",field_PENSOIN_TAX_KIND:"Вариант выбора оплаты сбора на обязательное государственное пенсионное страхование",field_PENSOIN_CLN_NUMBER:"Регистрационный номер клиента в государственном Пенсионном Фонде",field_FUND_NAME:"Наименование отделения Пенсионного Фонда",field_FUND_EDRPOU:"Код ЕДРПОУ отделения Пенсионного Фонда",field_FUND_ACCOUNT:"Расчетный счет отделения Пенсионного Фонда",field_FUND_BNK_NAME:"Наименование банка отделения Пенсионного Фонда",field_FUND_BNK_MFO:"МФО банка отделения Пенсионного Фонда",field_EXPERIENCE_DATE:"Срок действия Заявления",field_CURRENCY_DATE:"Дата валютирования",field_PENSION_TAX:"Процент сбора на пенсионное страхование",field_CURRENT_ACCOUNT:"Текущий гривневый счёт клиента",field_TRANSFER_KIND:"Вариант перечисления суммы в гривне для покупки валюты",footer_s_template:"{1} {2} {3} из {4}",footer_selected_sin:"Выбрано",footer_selected_pl:"Выбрано",footer_1_doc:"заявление",footer_1_doc_pl:"заявление",footer_2_4_docs:"заявления",footer_5_0_docs:"заявлений"},uk:!0,en:!0}),define("apps/ua_currency_purchase/nls/ua_currency_purchase",["underscore","apps/ua_currency_purchase/nls/base_ua_currency_purchase"],function(a,b){return{root:a.extend({},b.root,{ua_currency_purchase:"Заявление о купле валюты",ua_currency_purchase_list:"Заявление о купле валюты",purch_sum:"Просим купить",current_account:"Необходимую сумму поручаем Банку списать со счета",reason:"Основание для покупки",return_account:"Неиспользуемые средства просим вернуть на счет",return_bank:"Банк",account:"Счет",rate1_label:"по курсу уполномоченного банка",ref1:'В случае увеличения курса покупки иностранной валюты, а также указания в Заявлении курса покупки "по курсу уполномоченного банка", поручаем выполнить договорное списание средств в гривнах в сумме, необходимой для выполнения Заявления в полном объеме. При отсутствии достаточной суммы средств в гривнах, даем согласие на покупку иностранной валюты в сумме меньше указанной в Заявлении.',ref2:"Поручаем выполнить договорное списание суммы в гривнах с целью списания комиссии и суммы сбора в Пенсионный фонд Украины на обязательное государственное пенсионное страхование в размере {1}% от суммы в гривнах, которая использована на покупку иностранной валюты (без учета комиссионного вознаграждения за выполнение этой операции).",ref3:"В случае выполнения покупки по курсу ниже указанного, а также в случае невозможности выполнить Заявление.",not_ua_acount_for_mfo:"Отсутствуют права на работу с гривневыми счетами в МФО {1}",not_acount_for_cur:"Отсутствуют права на работу со счетами в выбранной валюте"}),uk:!0,en:!0}}),define("apps/ua_currency_purchase/nls/uk/base_ua_currency_purchase",{no_cur_accs:"Неможливо створити документ. Вiдсутнiй поточний рахунок в iноземнiй валютi.",no_uah_accs:"Неможливо створити документ. Вiдсутнiй поточний рахунок в нацiональнiй валютi.",number:"Номер",date:"Дата",purchase_account:"Рахунок зарахування",amount:"Сума",currency:"Валюта",status:"Статус",payer:"Платник",purch_account:"та зарахувати на рахунок",transfer_kind:"Необхідну суму у гривні",sale_sum:"Суму у гривні",sale_account:"на рахунок банку",return_bnk:"Невикористані кошти у гривні перерахувати до банку",value_date:"Дата валютув.",date_doc:"Дата документа",unrequired:"не обов'яз.",current:"поточна",autonum:"автонумер.",fund_account:"Збір ПФ списати з рахунку",rate0:"за курсом",rate1:"за курсом уповноваженого банку",rate0_label:"за курсом",rate1_label:"за курсом банку",transf_kind_0:"Зобов’язуємося перерахувати самостійно",transf_kind_1:"Доручаємо уповноваженому банку списати",transf_kind_0_label:"зобов’язуюсь перерахувати",transf_kind_1_label:"доручаю банку списати",cp:"Номер",currency_date:"Дата валютув.",name:"Найменування",mfo:"МФО",valid_till:"Термін дії",fio_placeholder:"ПІБ (не обов'яз.)",tel_placeholder:"тел. (не обов'яз.)",fio:"Уповноважений співробітник компанії",phone:"Телефон",comission:"Комісія, %",no_accs_error:"Неможливо створити документ.<p>Відсутні рахунки наступних типів: поточний в іноземній валюті, поточний у гривні.<p>Необхідно, щоб рахунки всіх перерахованих типів були відкриті в одному МФО.",field_NUM_DOC:"Номер документа",field_DATE_DOC:"Дата документа",field_CLN_NAME:"Найменування клієнта",field_CLN_ADDR:"Адреса клієнта",field_CLN_PHONES:"Контактний телефон клієнта",field_CLN_EMPLOYEE_FIO:"П.І.Б. уповноваженого працівника",field_CLN_EMPLOYEE_PHONE:"Контактний телефон уповноваженого працівника",field_PURCHASE_REASON:"Підстава для купівлі іноземної валюти",field_BNK_NAME:"Найменування уповноваженого банку",field_BNK_MFO:"МФО уповноваженого банку",field_BNK_ADDR:"Адреса уповноваженого банку",field_SALE_SUM:"Сума гривень для купівлі іноземної валюти",field_SALE_ACCOUNT:"Транзитний рахунок банку",field_SALE_BNK_NAME:"Найменування банку, в якому відкритий транзитний рахунок клієнта",field_SALE_BNK_MFO:"МФО банку, в якому відкритий транзитний рахунок клієнта",field_PURCHASE_SUM:"Сума іноземної валюти, що купується",field_PURCHASE_CURRENCY:"Код іноземної валюти, що купується",field_PURCHASE_RATE_KIND:"Варіант вибору курсу купівлі іноземної валюти",field_PURCHASE_RATE:"Курс іноземної валюти",field_PURCHASE_ACCOUNT:"Рахунок клієнта для зарахування  іноземної валюти, що купується",field_PURCHASE_BNK_NAME:"Найменування банку, у якому відкритий рахунок клієнта для зарахування іноземної валюти, що купується",field_PURCHASE_BNK_MFO:"МФО банку, у якому відкритий рахунок клієнта для зарахування іноземної валюти, що купується",field_COMMISSION:"Комісія уповноваженого банку",field_RETURN_ACCOUNT:"Рахунок клієнта для повернення гривні",field_RETURN_BNK_NAME:"Найменування банку, у якому відкритий рахунок клієнта для повернення гривні",field_RETURN_BNK_MFO:"МФО банку, у якому відкритий рахунок клієнта для повернення гривні",field_PENSOIN_TAX_KIND:"Варіант вибору оплати збору на обов'язкове державне пенсійне страхування",field_PENSOIN_CLN_NUMBER:"Реєстраційний номер клієнта в державному Пенсійному Фонді",field_FUND_NAME:"Найменування відділення Пенсійного Фонду",field_FUND_EDRPOU:"Код ЄДРПОУ відділення Пенсійного Фонду",field_FUND_ACCOUNT:"Розрахунковий рахунок відділення Пенсійного Фонду",field_FUND_BNK_NAME:"Найменування банку відділення Пенсійного Фонду",field_FUND_BNK_MFO:"МФО банку відділення Пенсійного Фонду",field_EXPERIENCE_DATE:"Термін дії Заяви",field_CURRENCY_DATE:"Дата валютування",field_PENSION_TAX:"Вiдсоток збору на пенсiйне страхування",field_CURRENT_ACCOUNT:"Поточний гривневий рахунок клiєнта",field_TRANSFER_KIND:"Варіант перерахування суми в гривні для купівлі валюти",footer_s_template:"{1} {2} {3} з {4}",footer_selected_sin:"Обрана",footer_selected_pl:"Обрано",footer_1_doc:"заява",footer_1_doc_pl:"заява",footer_2_4_docs:"заяви",footer_5_0_docs:"заяв"}),define("apps/ua_currency_purchase/nls/uk/ua_currency_purchase",["underscore","apps/ua_currency_purchase/nls/uk/base_ua_currency_purchase"],function(a,b){return a.extend({},b,{ua_currency_purchase:"Заява про купівлю валюти",ua_currency_purchase_list:"Заява про купівлю валюти",purch_sum:"Просимо купити",current_account:"Необхідну суму доручаємо Банку списати з рахунку",reason:"Підстава для купівлі",return_account:"Невикористані кошти просимо повернути на рахунок",return_bank:"Банк",account:"Рахунок",rate1_label:"за курсом уповноваженого банку",ref1:'У випадку підвищення курсу купівлі іноземної валюти та у разі вказання в Заяві курсу купівлі "за курсом уповноваженого банку", доручаємо здійснити договірне списання коштів у гривнях у сумі, необхідній для виконання Заяви в повному обсязі. За відсутності достатньої суми коштів у гривнях, надаємо згоду на придбання іноземної валюти у сумі меншій, ніж зазначена в Заяві.',ref2:"Доручаємо здійснити договірне списання суми в гривнях для сплати комісії та суми збору до Пенсійного фонду України на обов'язкове державне пенсійне страхування у розмірі {1}% від суми в гривнях, що витрачена на купівлю іноземної валюти (без урахування комісійної винагороди за цією операцією).",ref3:"У випадку здійснення купівлі за курсом нижче зазначеного, а також при неможливості виконати Заяву.",not_ua_acount_for_mfo:"Відсутні права на роботу з гривневими рахунками в МФО {1}",not_acount_for_cur:"Відсутні права на роботу з рахунками в обраній валюті"})}),define("apps/ua_currency_purchase/nls/en/base_ua_currency_purchase",{no_cur_accs:"Unable to create a document. Current account in foreign currency is missing.",no_uah_accs:"Unable to create a document. Current account in national currency is missing.",number:"Number",date:"Date",purchase_account:"Account for crediting",amount:"Amount",currency:"Currency",status:"Status",payer:"Payer",purch_account:"and transfer to account",transfer_kind:"Required amount in hryvna",sale_sum:"Required amount in hryvna",sale_account:"on bank account",return_bnk:"Transfer an unused funds in hryvna to the bank",value_date:"Value date",date_doc:"Document date",unrequired:"optional",current:"current",autonum:"autonum.",fund_account:"PF tax write-off from the account",rate0:"за курсом",rate1:"за курсом уповноваженого банку",rate0_label:"за курсом",rate1_label:"за курсом банку",transf_kind_0:"Зобов’язуємося перерахувати самостійно",transf_kind_1:"Доручаємо уповноваженому банку списати",transf_kind_0_label:"зобов’язуюсь перерахувати",transf_kind_1_label:"доручаю банку списати",cp:"Number",currency_date:"Value date",name:"Name",mfo:"MFO",fio:"Authorized employee of the company",phone:"Phone",comission:"Comission, %",valid_till:"Validity",fio_placeholder:"Full name (optional)",tel_placeholder:"phone (optional)",rate:"Rate",no_accs_error:"Unable to create a document.<p>Accounts of the following types are missing: current account in foreign currency, current account in hryvna.<p>It is necessary that all of these types of accounts were opened in one MFO.",field_NUM_DOC:"Document number",field_DATE_DOC:"Date document",field_CLN_NAME:"Client's name",field_CLN_ADDR:"Client address",field_CLN_PHONES:"Client's phone number",field_CLN_EMPLOYEE_FIO:"Responsible employee's full name",field_CLN_EMPLOYEE_PHONE:"Employee's phone number",field_PURCHASE_REASON:"Basis for foreign currency purchase",field_BNK_NAME:"Authorized bank name",field_BNK_MFO:"MFO of authorized bank",field_BNK_ADDR:"Address of authorized bank",field_SALE_SUM:"Amount in hryvnia for foreign currency purchase",field_SALE_ACCOUNT:"Bank transit account",field_SALE_BNK_NAME:"Bank name where client's transit account is opened",field_SALE_BNK_MFO:"Bank MFO where client's transit account is opened",field_PURCHASE_SUM:"Amount of foreign currency that is purchased",field_PURCHASE_CURRENCY:"Code of foreign currency that is purchased",field_PURCHASE_RATE_KIND:"Foreign currency purchase rate option",field_PURCHASE_RATE:"Foreign currency purchase rate",field_PURCHASE_ACCOUNT:"Client's account for transfer foreign currency that is purchased",field_PURCHASE_BNK_NAME:"Bank name where client's account for foreign currency (that is purchased) transfer is opened",field_PURCHASE_BNK_MFO:"Bank MFO where client's account for hryvnia transfer is opened",field_COMMISSION:"Authorized bank commission",field_RETURN_ACCOUNT:"Client's account for hryvnia return",field_RETURN_BNK_NAME:"Bank name where client's account for hryvnia return is opened",field_RETURN_BNK_MFO:"Bank MFO where client's account for hryvnia return is opened",field_PENSOIN_TAX_KIND:"Obligatory state pension insurance payment option",field_PENSOIN_CLN_NUMBER:"Registration number of the client in the Government Pension Fund",field_FUND_NAME:"Pension Fund Department name",field_FUND_EDRPOU:"EDRPOU code of the Pension Fund department",field_FUND_ACCOUNT:"Current account of the Pension Fund department",field_FUND_BNK_NAME:"Bank name of Pension Fund department",field_FUND_BNK_MFO:"Bank MFO of Pension Fund department",field_EXPERIENCE_DATE:"Order validity period",field_CURRENCY_DATE:"Value date",field_PENSION_TAX:"Retirement insurance charge rate",field_CURRENT_ACCOUNT:"Client's current account in hryvnia",field_TRANSFER_KIND:"Transfer kind of amount in national currency for currency purchase",footer_s_template:"{1} {2} {3} of {4}",footer_selected_sin:"Selected",footer_selected_pl:"Selected",footer_1_doc:"order",footer_1_doc_pl:"orders",footer_2_4_docs:"orders",footer_5_0_docs:"orders"}),define("apps/ua_currency_purchase/nls/en/ua_currency_purchase",["underscore","apps/ua_currency_purchase/nls/en/base_ua_currency_purchase"],function(a,b){return a.extend({},b,{ua_currency_purchase:"Purchase order",ua_currency_purchase_list:"Purchase orders",purch_sum:"Ask to buy",current_account:"We authorize to write off the required amount from the account",reason:"Base for purchase",return_account:"We order the unused funds to return to the account",return_bank:"Bank",account:"Account",rate1_label:"according to the exchange rate of the bank",rate0_label:"according to the exchange rate",ref1:'In case foreign currency purchase exchange rate increases and if the Client specifies the option "according to the exchange rate of the Bank" in the Purchase order, the Client authorizes the Bank to perform direct debiting of additional funds in the amount needed to fulfill the Purchase order in full. If there is not enough funds in UAH, the Client authorizes to purchase the foreign currency in the amount smaller than pointed out in the Purchase order.',ref2:"The Client authorizes the Bank to perform direct debiting of funds in UAH in the amount necessary to pay the commission fee and state mandatory pension insurance fee to the Pension Fund of Ukraine in the amount {1}% of the amount in UAH, which is used to purchase foreign currency (excluding commission for this operation).",ref3:"In the case of purchase exchange rate less than specified, and if the Bank is unable to execute the Purchase order.",not_ua_acount_for_mfo:"There are no rights for working with hryvnia accounts in MFO {1}",not_acount_for_cur:"There are no rights for working with accounts in selected currency"})}),define("apps/ua_currency_purchase/ua_currency_purchase_model",["jquery","underscore","backbone","collections/thesaurus","thesaurusUtils","bifit","appsPieces","models/base_document","i18n!apps/ua_currency_purchase/nls/ua_currency_purchase","i18n!nls/validation","backboneValidation"],function(a,b,c,d,e,f,g,h,i,j){"use strict";return h.extend({type:"ua_currency_purchase",nls:i,defaults:{status:"",status_desc:"",status_color:"000000",NUM_DOC:"",DATE_DOC:"",CLN_NAME:"",CLN_ADDR:"",CLN_PHONES:"",CLN_EMPLOYEE_FIO:"",CLN_EMPLOYEE_PHONE:"",PURCHASE_REASON:"",BNK_NAME:"",BNK_MFO:"",BNK_ADDR:"",SALE_SUM:"",SALE_ACCOUNT:"",SALE_BNK_NAME:"",SALE_BNK_MFO:"",PURCHASE_SUM:"",PURCHASE_CURRENCY:"",PURCHASE_RATE_KIND:"",PURCHASE_RATE:"",PURCHASE_ACCOUNT:"",PURCHASE_BNK_NAME:"",PURCHASE_BNK_MFO:"",COMMISSION:"",RETURN_ACCOUNT:"",RETURN_BNK_NAME:"",RETURN_BNK_MFO:"",EXPERIENCE_DATE:"",CURRENCY_DATE:"",PENSOIN_TAX_KIND:"",PENSOIN_CLN_NUMBER:"",FUND_NAME:"",FUND_EDRPOU:"",FUND_ACCOUNT:"",FUND_BNK_NAME:"",FUND_BNK_MFO:"",PENSION_TAX:"",SALE_ACCOUNT_FROM:"",TRANSFER_BNK_ADDR:"",CLN_OKPO:"",ATT_CNT:"0"},meta:b.extend({},h.prototype.meta,{relatively:b.extend({PURCHASE_SUM:function(a){return parseFloat(a)},PURCHASE_CURRENCY:function(a){return a}},h.prototype.meta.relatively),amount:"PURCHASE_SUM",currency:"PURCHASE_CURRENCY",formattedFields:{PURCHASE_SUM:function(){return this._amountFormatter(this.get("PURCHASE_SUM"),this.get("PURCHASE_CURRENCY"),2)},PURCHASE_RATE:function(){return this._amountFormatter(this.get("PURCHASE_RATE"),4)}}}),order:["DATE_DOC","NUM_DOC","CLN_NAME","CLN_ADDR","CLN_PHONES","CLN_EMPLOYEE_FIO","CLN_EMPLOYEE_PHONE","PURCHASE_REASON","BNK_NAME","BNK_MFO","BNK_ADDR","SALE_SUM","SALE_ACCOUNT","SALE_BNK_NAME","SALE_BNK_MFO","PURCHASE_SUM","PURCHASE_CURRENCY","PURCHASE_RATE_KIND","PURCHASE_RATE","PURCHASE_ACCOUNT","PURCHASE_BNK_NAME","PURCHASE_BNK_MFO","COMMISSION","RETURN_ACCOUNT","RETURN_BNK_NAME","RETURN_BNK_MFO","PENSOIN_TAX_KIND","PENSOIN_CLN_NUMBER","FUND_NAME","FUND_EDRPOU","FUND_ACCOUNT","FUND_BNK_NAME","FUND_BNK_MFO","EXPERIENCE_DATE","CURRENCY_DATE","SALE_ACCOUNT_FROM","TRANSFER_BNK_ADDR","CLN_OKPO"],validation:{NUM_DOC:{numDocRequired:!0,maxLength:10},DATE_DOC:{dateDoc:!0},CLN_NAME:{required:!0,maxLength:40,clientInfo:"name_cln"},SALE_ACCOUNT:{required:!1,digits:!0,maxLength:14,minLength:5,calcAcc:"BNK_MFO"},PURCHASE_CURRENCY:{required:!0,length:3},BNK_NAME:{required:!1,maxLength:45},BNK_MFO:{required:!0,digits:!0,length:6,fn:function(a,b,c){var d,e=c.BNK_NAME;return e&&""!==e?a!==c.PURCHASE_BNK_MFO&&(d=j.purch_bik_err):d=j.mfo_not_found,d}},BNK_ADDR:{required:!0,maxLength:80},PURCHASE_ACCOUNT:[{required:!0,digits:!0,maxLength:14,minLength:5,calcAcc:"PURCHASE_BNK_MFO"},{fn:function(a,c,d){var e,f=b.any(g.getAccounts()[d.PURCHASE_CURRENCY],function(b){return b.account===a});return f||(e=j.account_not_permission),e}}],PURCHASE_BNK_NAME:{required:!1,maxLength:45},PURCHASE_BNK_MFO:{required:!0,digits:!0,length:6,fn:function(a,b,c){var d,e=c.PURCHASE_BNK_NAME;return e&&""!==e?a!==c.BNK_MFO&&(d=j.purch_bik_err):d=j.mfo_not_found,d}},SALE_BNK_NAME:{required:!1,maxLength:45},SALE_BNK_MFO:[{required:!1,digits:!0,length:6,fn:function(a,b,c){var d,e=c.SALE_BNK_NAME;return e&&""!==e||(d=j.mfo_not_found),d}}],RETURN_ACCOUNT:[{required:!0,digits:!0,maxLength:14,minLength:5,calcAcc:"RETURN_BNK_MFO"},{fn:function(a,c,e){var f,g=e.RETURN_BNK_MFO;if(b.findWhere(d.getThesaurus("cln_accounts").array,{account:a,mfo:g,currency:"UAH"})){var h=b.findWhere(d.getThesaurus("accs_info").array,{account:a,mfo:g,status:"2",currency:"UAH"});(!h||h.permissions<1)&&(f=j.account_not_permission)}return f}}],RETURN_BNK_NAME:{required:!1,maxLength:45},RETURN_BNK_MFO:{required:!0,digits:!0,length:6,fn:function(a,b,c){var d,e=c.RETURN_BNK_NAME;return e&&""!==e||(d=j.mfo_not_found),d}},CURRENCY_DATE:{fn:function(a,b,c){var d,e=c.DATE_DOC,g=c.EXPERIENCE_DATE;if(e&&a)if(f.checkDateMatch(a)){e=f.str2date(e),a=f.str2date(a);var h=a.getTime()-e.getTime();0>h?d=j.value_date_01:g&&g.length>0&&f.str2date(g).getTime()<a.getTime()?d=j.value_date_02:Math.floor(h/1e3/60/60/24)>=90&&(d=this._valueDateErrorWrapper(90))}else d=j.incorrect_date;return d}},EXPERIENCE_DATE:{fn:function(a,b,c){var d,e=c.DATE_DOC;if(e&&a)if(f.checkDateMatch(a)){e=f.str2date(e),a=f.str2date(a);var g=a.getTime()-e.getTime();0>g?d=j.expire_date_01:Math.floor(g/1e3/60/60/24)>30&&(d=j.expire_date_02)}else d=j.incorrect_date;return d}},CLN_ADDR:{required:!0,maxLength:80},CLN_PHONES:{required:!0,maxLength:20},CLN_EMPLOYEE_FIO:{required:!1,maxLength:40},CLN_EMPLOYEE_PHONE:{required:!1,maxLength:20},SALE_SUM:[{fn:function(a){var b;return a&&0!==a.length&&!a.match(/^\d{1,10}\.\d{0,4}$/)&&(b=j.incorrect_amount),b}},{checkPositive:!0}],PURCHASE_SUM:[{required:!0},{max:9999999999.9999,pattern:/^\d+\.\d{4}$/,msg:j.incorrect_amount},{min:.01,msg:j.positive_amount}],PURCHASE_RATE_KIND:[{required:!0},{oneOf:["по курсу","за курсом","по курсу уполномоченного банка","за курсом уповноваженого банку"],msg:j.invalid_field}],PURCHASE_RATE:{fn:function(a,b,c){var d,e=c.PURCHASE_RATE_KIND;return"по курсу"!==e&&"за курсом"!==e?0!==a.length&&(d=j.empty_field):a&&0!==a.length?a&&!a.match(/^\d{1,4}\.\d{0,4}$/)&&(d=j.incorrect_amount):d=j.required,d},checkPositive:!0},COMMISSION:{fn:function(a){var b;return a&&0!==a.length&&!a.match(/^\d{1,2}\.\d{0,2}$/)&&(b=j.incorrect_amount),b}},PURCHASE_REASON:{required:!0,maxLength:255},FUND_ACCOUNT:{required:!1,digits:!0,maxLength:14,minLength:5,calcAcc:"FUND_BNK_MFO"},SALE_ACCOUNT_FROM:[{required:!1,digits:!0,maxLength:14,minLength:5,calcAcc:"PURCHASE_BNK_MFO"},{fn:function(a,c,d){var e,f=b.any(g.getAccounts().UAH,function(b){return b.account===a});return f||(e=j.account_not_permission),e}}],TRANSFER_BNK_ADDR:{required:!1,maxLength:80},CLN_OKPO:{required:!0,digits:!0,maxLength:10}}})}),define("text!templates/views/document/group-filter.tmpl",[],function(){return'<div class="group-checkbox" onmousedown="return false" onselectstart="return false">\n    <div class="popup-wrapper bottom sub-menu">\n        <ul class="popup filter">\n        </ul>\n    </div>\n</div>\n\n'}),define("commons/base_object/document/group_opers_doc_list_view",["jquery","underscore","app","bifit","services/doc_statuses","actionUtils","commons/base_object/base_list_view","text!templates/views/document/group-filter.tmpl","i18n!nls/document","libs/group_opers_utils"],function(a,b,c,d,e,f,g,h,i,j){"use strict";return g.extend({events:b.extend(g.prototype.events,{"click th.check input":"markAll","click div.group-checkbox a":"markByStatus","click div.group-checkbox":"toggleFilter"}),childEvents:b.extend(g.prototype.childEvents,{markOne:"markOne"}),footerNls:null,isAccountsForCreateAction:null,initialize:function(a){g.prototype.initialize.apply(this,arguments),this.isAccountsForCreateAction=a.isAccountsForCreateAction,"false"!==d.getStorageData("is_need_deselect_selected_items")&&b.each(this.collection.selected,function(a){this.collection.deselect(a)}.bind(this)),d.setStorageData("is_need_deselect_selected_items","true")},selectItem:function(a,b){g.prototype.selectItem.call(this,a,b),d.setStorageData("is_need_deselect_selected_items","false")},onRender:function(){g.prototype.onRender.call(this),this.prepareTable()},prepareTable:function(){j.prepareTable.call(this),this.initStatusSelector(),this.postModelMark()},initStatusSelector:function(){var c=b.uniq(b.map(this.collection.models,function(a){return a.get("status")})),f=b.intersection(c,["0","1","3004"]);if(f){if(f.length>1){var g=d.getLocale(),j=a(b.template(h,i)),k=j.find("ul");b.each(f,function(b){var c=parseInt(b,10),f=d.sprintf(i.flt_st,e.getLocalizedNameById(c,g)),h="st"+b;a("<li><a data-action='"+h+"' href='#'>"+f+"</a></li>").appendTo(k)}.bind(this)),this.$("table.list").find("th.check").append(j)}}else this.$("table.list").find("th.check, td.check").hide()},toggleFilter:function(b){b.stopPropagation();
var c=a(b.target).find(".sub-menu"),d=function(){c.hide(),a("div.group-checkbox").removeClass("shadow"),a(document).unbind("click.filter-sub-menu")};return"block"===c.css("display")?d():(c.show(),this.$("div.group-checkbox").addClass("shadow"),a(document).bind("click.filter-sub-menu",d)),!0},markOne:j.markOne,markAll:j.markAll,markByStatus:function(c){c.preventDefault(),this.$(".group-checkbox .sub-menu").hide(),this.$("tbody tr").removeClass("selected"),this.$("tbody tr").find("input").prop("checked",!1),this.collection.selectNone();var d=a(c.target).attr("data-action");this.$("tbody tr."+d).addClass("selected"),this.$("tbody tr.selected input").prop("checked",!0);var e=this.collection.where({status:d.substr("st".length)});b.each(e,function(a){a.select()}),this.postModelMark()},postModelMark:function(){var a=this.collection.selectedLength>0,c=this.getAvailableActions(a),d=0;a&&b.each(this.collection.selected,function(a){c=b.intersection(c,f.getPossibleActions(a)),d+=parseFloat(a.getAmount())});var e=this.collection.length===this.collection.selectedLength;this.$("th.check input")[e?"removeClass":"addClass"]("some"),this.$("th.check input").prop("checked",a),this.trigger("update-actions",this.getPermittedActions(c)),this.changeFooter(d.toFixed(2))},getAvailableActions:function(a){var b;return a?(b=[f.DocumentAction.PRINT],(c.isMultiClient()||this.isAccountsForCreateAction)&&(b=b.concat([f.DocumentAction.SIGN,f.DocumentAction.COPY,f.DocumentAction.DELETE]))):(c.isMultiClient()||this.isAccountsForCreateAction)&&(b=[f.DocumentAction.CREATE,f.DocumentAction.IMPORT]),b},getPermittedActions:function(a){for(var c=["CREATE","IMPORT","PRINT","SIGN","COPY","DELETE","CONFIRM","TOGGLE","CFC_CONFIRM","CFC_REJECT","CFC_SIGN"],d=this.getDocumentTypeForActions(),e=[],g=0;g<c.length;g++){var h=c[g],i=b.contains(a,f.DocumentAction[h])&&f.isActionPermitted(h,d);i&&e.push(h+(b.contains(["CREATE","IMPORT"],h)?"":"_GROUP"))}return e},getDocumentTypeForActions:function(){return this.collection.options.document_type},changeFooter:function(a){if(this.footerNls){var b=this.$("tfoot.summary"),c=this.collection.selectedLength;if(b.length){b[c?"show":"hide"]();var e=c%100,f="footer_5_0_docs",g="footer_selected_pl";if(11>e||e>19){var h=c%10;1===h?(f=1===c?"footer_1_doc":"footer_1_doc_pl",g="footer_selected_sin"):h>1&&5>h&&(f="footer_2_4_docs")}var i=this.footerNls,j=d.sprintf(i.footer_s_template,i[g],c,i[f],this.collection.length,a);b.find("td").html(j).trigger("footer:change",c)}}}})}),define("commons/base_object/group_opers_list_item_view",["commons/base_object/base_list_item_view"],function(a){"use strict";return a.extend({triggers:{"click td:not(.check)":"selectItem"},events:{"click td.check input":function(a){this.trigger("markOne",a)}}})}),define("text!apps/ua_currency_purchase/templates/ua_currency_purchase_list.tmpl",[],function(){return'<table class="list ua_currency_purchase" style="display: table;">\n    <thead class="widescreen">\n    <tr>\n        <th class="attach">&nbsp;</th>\n        <th class="check">\n            <input type="checkbox"/>\n            <span class="checkbox"/>\n        </th>\n        <th class="number">\n            <span class="sortable" data-field="NUM_DOC"><%- number %></span>\n        </th>\n        <th class="date">\n            <span class="sortable" data-field="DATE_DOC"><%- date %></span>\n        </th>\n        <% if (isMultiClient()) { %>\n            <th class="payer ellipsis">\n                <span class="sortable" data-field="CLN_NAME"><%= payer %></span>\n            </th>\n        <% } %>\n        <th>\n            <span class="sortable" data-field="PURCHASE_ACCOUNT"><%- account %></span>\n        </th>\n        <th class="amount">\n            <span class="sortable" data-field="PURCHASE_SUM"><%- amount %></span>\n        </th>\n        <th class="currency">\n            <span class="sortable" data-field="PURCHASE_CURRENCY"><%- currency %></span>\n        </th>\n        <th class="status">\n            <span class="sortable" data-field="status_desc"><%- status %></span>\n        </th>\n        <th class="empty">&nbsp;</th>\n        <th class=\'mobile\' colspan=\'2\'>&nbsp;</th>\n    </tr>\n    </thead>\n    <tbody></tbody>\n    <tfoot class=\'summary\'>\n    <tr>\n        <td colspan="8"></td>\n    </tr>\n    </tfoot>\n</table>\n'}),define("text!apps/ua_currency_purchase/templates/ua_currency_purchase_list_item.tmpl",[],function(){return'<td class="attach widescreen">\n    <% if (ATT_CNT != \'0\') { %>\n    <span class=\'att-cnt\'>&nbsp;</span>\n    <% } %>\n</td>\n<td class="check widescreen"><input type=\'checkbox\'/><span class="checkbox"></span></td>\n<td class="number widescreen"><%- NUM_DOC %></td>\n<td class="date widescreen"><%- DATE_DOC %></td>\n<% if (isMultiClient()) { %>\n    <td class="payer ellipsis widescreen"><%- CLN_NAME %></td>\n<% } %>\n<td class="purchase-account widescreen"><%- PURCHASE_ACCOUNT %></td>\n<td class="amount widescreen"><%- formatAmount(PURCHASE_SUM) %></td>\n<td class="currency widescreen"><%- PURCHASE_CURRENCY %></td>\n<td class="status widescreen"><%- status_desc %></td>\n<td class="empty widescreen">&nbsp;</td>\n<td class=\'mobile\'>\n    <span class=\'attaches<% if (ATT_CNT != \'0\') { %> att-cnt <% } %>\'>&nbsp;</span>\n    <span class=\'date\'><%- DATE_DOC %></span>\n    <span class=\'amount\'><%- formatAmount(PURCHASE_SUM) %>&nbsp;<%- PURCHASE_CURRENCY %></span>\n    <span class=\'rcpt ellipsis\'><%- PURCHASE_ACCOUNT %></span>\n    <span class=\'status\'><%- status_desc %></span>\n</td>\n'}),define("apps/ua_currency_purchase/ua_currency_purchase_list_view",["underscore","commons/base_object/document/group_opers_doc_list_view","commons/base_object/group_opers_list_item_view","text!apps/ua_currency_purchase/templates/ua_currency_purchase_list.tmpl","text!apps/ua_currency_purchase/templates/ua_currency_purchase_list_item.tmpl","i18n!apps/ua_currency_purchase/nls/ua_currency_purchase"],function(a,b,c,d,e,f){"use strict";return b.extend({template:a.template(d),templateHelpers:a.extend({},b.prototype.templateHelpers,f),footerNls:f,childView:c.extend({template:a.template(e)})})}),define("nls/states_types",{root:{any:"любые","new":"новые",in_bank:"в банке",rejected:"отвергнутые",signed:"подписаные",executed:"исполненные",partly_executed:"исп. частично",sent_to_client:"отправленные клиенту",not_confirmed:"не подтвержденные",requires_confirmation:"требуют подтверждения",formed:"сформированные",approved:"одобренные"},uk:!0,en:!0}),define("nls/uk/states_types",{any:"будь-які","new":"нові",in_bank:"у банку",rejected:"відхилені",signed:"підписані",executed:"виконані",partly_executed:"виконані частково",sent_to_client:"відправлені клієнту",not_confirmed:"не підтверджені",requires_confirmation:"вимагають підтвердження",formed:"сформовані",approved:"узгоджені"}),define("nls/en/states_types",{any:"any","new":"new",in_bank:"in bank",rejected:"rejected",signed:"signed",executed:"executed",partly_executed:"partly executed",sent_to_client:"sent to the client",not_confirmed:"not confirmed",requires_confirmation:"requires confirmation",formed:"formed",approved:"approved"}),define("commons/base_object/document/document_state_filter_view",["underscore","commons/base_object/document/document_filter_view","i18n!nls/states_types"],function(a,b,c){"use strict";return b.extend({ui:a.extend({statesChosen:"#state_chosen_filter",statesChosenContainer:"div.state-chosen-filter"},b.prototype.ui),events:a.extend({"chosen:select @ui.statesChosen":"onStateFilterChanged"},b.prototype.events),states:{work:[{id:"any",name:c.any},{id:"new",name:c["new"],filter:"0,1,3004"},{id:"in_bank",name:c.in_bank,filter:"2,3,4,11,12,13,17,2001,2002"},{id:"rejected",name:c.rejected,filter:"6"}]},cache:{},onShow:function(){this.createStateFilter(),b.prototype.onShow.call(this)},createStateFilter:function(){this.ui.statesChosenContainer.show(),this.ui.statesChosen.chosen({searchable:!1,data:{array:[],id:"id",text:"name"}}),this.configureStateFilterForStatusTab()},onStateFilterChanged:function(a,b){b.id!==this.getSelectedState()&&(this.setSelectedState(b.id),this.reload())},changeStatus:function(a){b.prototype.changeStatus.call(this,a),this.configureStateFilterForStatusTab()},configureStateFilterForStatusTab:function(){return this.isStateFilterRequired()?(this.ui.statesChosenContainer.show(),this.ui.statesChosen.trigger("refresh",{array:this.getStatesRef()}),void this.ui.statesChosen.trigger("chooseById",this.getSelectedState())):void this.ui.statesChosenContainer.hide()},reload:function(a){a=this.addStateFilterData(a),b.prototype.reload.call(this,a)},addStateFilterData:function(b){if(this.isStateFilterRequired()){var c=a.findWhere(this.getStatesRef(),{id:this.getSelectedState()});b=c&&c.filter?a.extend({},b,{status:c.filter}):b}return b},getStatesRef:function(){return this.states[this.tabsStatuses.selectedTab]},getSelectedState:function(){return this.cache[this.docType+this.tabsStatuses.selectedTab]||"any"},setSelectedState:function(a){return this.cache[this.docType+this.tabsStatuses.selectedTab]=a},isStateFilterRequired:function(){return this.getStatesRef()&&this.getStatesRef().length>1},onBeforeDestroy:function(){this.ui.statesChosen.disposeChosen()}})}),define("text!commons/base_object/document/templates/document_ext_filter_minimized_item.tmpl",[],function(){return"<label><%- (label ? label + ': ' : '') %></label>\n<span class=\"value <%- id %>\"><%- displayValue %></span>\n<span class=\"delete-filter-item\">&#10005;</span>"}),define("nls/document-filter",{root:{status_all:"Все",period_from:"Период с",period_to:"по",getdocs:"Получить",loading_docs:"Получение",incorrect_filter_date:"Дата окончания интервала для получения документов ранее даты начала интервала",ua_payment:"Гривневые поручения",bank_ua_payment_request:"Гривневые требования",ua_payment_request:"Гривневые требования",ua_currency_purchase:"Покупка валюты",ua_currency_sale:"Продажа валюты",ua_currency_convert:"Конвертация валюты",ua_currency_payment:"Валютные поручения",pay_sheet:"Зарплатные ведомости",letter:"Письма",inStatus:"В статусе",any:"Все",several:"Выбрано статусов: {1}",num_doc:"Номер документа",currency:"Валюта",amount:"Сумма",from:"от",to:"до",amount_from:"Сумма от",amount_to:"Сумма до",payer:"Плательщик",recipient:"Получатель",account:"Счет",start_entering:"Начинайте вводить",start_entering_acc:"Начинайте вводить номер счета",start_entering_name:"Начинайте вводить наименование",all:"Все",amountError:"Максимальная сумма должна быть больше минимальной"},uk:!0,en:!0}),define("nls/uk/document-filter",{status_all:"Всі",period_from:"Перiод від",period_to:"до",getdocs:"Отримати",loading_docs:"Отримання",incorrect_filter_date:"Дата завершення інтервалу для отримання документів раніше дати початку інтервалу",ua_payment:"Гривневі доручення",bank_ua_payment_request:"Гривневі вимоги",ua_payment_request:"Гривневі вимоги",ua_currency_purchase:"Купівля валюти",ua_currency_sale:"Продаж валюти",ua_currency_payment:"Валютні доручення",ua_currency_convert:"Конвертація валюти",pay_sheet:"Зарплатні відомості",letter:"Листи",inStatus:"У статусі",any:"Всі",several:"Обрано статусів: {1}",num_doc:"Номер документа",currency:"Валюта",amount:"Сума",from:"від",to:"до",amount_from:"Сума від",amount_to:"Сума до",payer:"Платник",recipient:"Отримувач",account:"Рахунок",start_entering:"Починайте вводити",start_entering_acc:"Починайте вводити номер рахунку",start_entering_name:"Починайте вводити найменування",all:"Всі",amountError:"Максимальна сума повинна бути більше ніж мінімальна"}),define("nls/en/document-filter",{status_all:"All",period_from:"Period from",period_to:"to",getdocs:"Receive",loading_docs:"Loading",incorrect_filter_date:"Interval final date for receiving the statement is earlier than its initial one",ua_payment:"Hryvnia Payment orders",bank_ua_payment_request:"Hryvnia Payment requests",ua_payment_request:"Hryvnia Outgoing Payment Request-Orders",ua_currency_purchase:"Currency purchase",ua_currency_sale:"Currency sale",ua_currency_convert:"Currency conversion",ua_currency_payment:"Currency payments",pay_sheet:"Salary sheets",letter:"Letters",inStatus:"In status",any:"Any",several:"Selected statuses: {1}",num_doc:"Document number",currency:"Currency",amount:"Amount",from:"from",to:"to",amount_from:"Amount from",amount_to:"Amount to",payer:"Payer",recipient:"Recipient",account:"Account",start_entering:"Start typing",start_entering_acc:"Start typing the account",start_entering_name:"Start typing the name",all:"All",amountError:"The maximum amount should be more than the minimum"}),define("commons/base_object/document/document_ext_filter_view",["underscore","backbone","marionette","app","bifit","collections/thesaurus","dialogUtils","text!commons/base_object/document/templates/document_ext_filter_minimized_item.tmpl","i18n!nls/document-filter"],function(a,b,c,d,e,f,g,h,i){"use strict";return c.CompositeView.extend({template:a.template('<div id="expanded-view"></div><div id="minimized-view"></div>'),templateHelpers:{isMultiClient:d.isMultiClient},ui:{expanded:"#expanded-view",minimized:"#minimized-view"},events:{"chosen:select #client":"onClientSelected"},fieldsMeta:{},childView:c.ItemView.extend({template:a.template(h),tagName:"span",id:function(){return this.model.id},triggers:{"click .delete-filter-item":"deleteFilterItem"}}),selectedClient:null,childViewContainer:"#minimized-view",childEvents:{deleteFilterItem:"deleteFilterItem"},isExpanded:!0,isFieldsOrder:!1,getExtFilterData:function(){if(this.isExpanded&&this.resetFilterCollection(),this.isValidFilterData()){var b={};return a.extend(b,this.getQueryFilter()),a.extend(b,this.getAdditionalFilter()),a.extend(b,this.getClientIdFilter()),b}},toggleMode:function(){this.isExpanded?this.isValidFilterData()&&(this.ui.expanded.hide(),this.ui.minimized.show(),this.resetFilterCollection()):(this.ui.expanded.show(),this.ui.minimized.hide(),this.restoreFilter()),this.isExpanded=!this.isExpanded,this.trigger("filter:resized")},resetFilter:function(){this.clearForm(),this.setDefaults(),!this.isExpanded&&this.collection.length&&(this.collection.reset(),this.trigger("filter:changed"),this.trigger("filter:resized"))},clearForm:function(){this.ui.expanded.find("input:text:not([readonly])").val("").change().trigger("empty")},setDefaults:function(){},initialize:function(){},onShow:function(){this.initForm(),this.ui.client&&this.ui.client.length&&this.initClientChosen(),this.collection.length&&this.restoreFilter()},initForm:function(){},restoreFilter:function(){this.restoreQueryFields(),this.restoreAdditionalFields()},restoreQueryFields:function(){a.each(this.fieldsMeta,function(a,b){var c=this.collection.get(b);if(0!==this.ui[b].length){var d=c?c.get("displayValue"):"";this.ui[b].val(d),d||this.ui[b].trigger("empty"),this.ui[b].change()}}.bind(this))},restoreAdditionalFields:function(){},resetFilterCollection:function(){var b=a.union(this.collectQueryData(),this.collectAdditionalData());this.isFieldsOrder&&b.sort(function(b,c){return a.has(b,"order")&&a.has(c,"order")?b.order-c.order:0}),this.collection.reset(b)},collectQueryData:function(){var b=[];return a.each(this.fieldsMeta,function(c,d){var e=this.getFilterValue(d);if(e){var f={id:d,idx:c.idx,order:c.order,value:e,type:c.type,operation:c.operation,displayValue:this.getDisplayValue(d),label:"<="===c.operation&&a.findWhere(b,{idx:c.idx})?c.shortLabel:c.label};"client"===c.type&&this.selectedClient&&this.selectedClient.name_cln===f.value&&(f.client_id=this.selectedClient.client_id),b.push(f)}}.bind(this)),b},collectAdditionalData:function(){return[]},getQueryFilter:function(){var b="";return a.each(this.fieldsMeta,function(a,c){var d=this.collection.get(c);if(d){var e=this.getQueryPart(d);e&&(b+=(b?" && ":"")+e)}}.bind(this)),b?{query:b}:{}},getQueryPart:function(a){var b=a.get("type");return"amount"===b?this.getAmountQuery(a):"client"===b?this.getClientQuery(a):"number"===b?this.getNumberQuery(a):this.getStringQuery(a)},getAdditionalFilter:function(){return{}},getClientIdFilter:function(){var a=this.collection.get("client");if(a){var b=a.get("client_id");if(b)return{clients:b}}},isValidFilterData:function(){return this.hasAmountFields()?this.isAmountValid():!0},hasAmountFields:function(){return!!a.findWhere(this.fieldsMeta,{type:"amount"})},isAmountValid:function(){var a=+this.ui.AMOUNT_MIN.getUnformattedValue(),b=+this.ui.AMOUNT_MAX.getUnformattedValue();return!(b>0&&a>b)},clearInvalidFields:function(){this.hasAmountFields()&&!this.isAmountValid()&&this.clearAmountFields()},clearAmountFields:function(){this.ui.AMOUNT_MIN.val(""),this.ui.AMOUNT_MAX.val(""),b.Validation.callbacks.valid(null,"AMOUNT_MIN")},validateFilterAmount:function(){this.isAmountValid()?b.Validation.callbacks.valid(null,"AMOUNT_MIN"):b.Validation.invalidField(this,"AMOUNT_MIN",i.amountError)},getFilterValue:function(a){var b=this.ui[a].getUnformattedValue();return this.fieldsMeta[a]&&("amount"===this.fieldsMeta[a].type||"number"===this.fieldsMeta[a].type)&&0>=b?null:b?b.trim():null},getDisplayValue:function(a){return this.ui[a].val().trim()},deleteFilterItem:function(b,c){var d=c.model.id,e=this.fieldsMeta[d];if(e&&">="===e.operation){var f;a.each(this.fieldsMeta,function(a,b){e.idx===a.idx&&b!==d&&"<="===a.operation&&(f=b)}),f&&this.collection.get(f)&&this.ui.minimized.find("#"+f).find("label").html(this.fieldsMeta[f].label+":")}this.collection.remove(c.model),this.ui[d].trigger("empty"),this.trigger("filter:changed"),this.trigger("filter:resized")},onClientSelected:function(a,b){this.selectedClient=b},initClientChosen:function(){this.ui.client.chosen({data:{array:f.getThesaurus("sub_clients").array,id:"client_id",text:"name_cln"}})},getStringQuery:function(a){return"["+a.get("idx")+"] hasi '"+e.escapeSpecialChars(a.get("value"))+"'"},getAmountQuery:function(a){return"["+a.get("idx")+"] "+a.get("operation")+" "+a.get("value")},getNumberQuery:function(a){return"["+a.get("idx")+"] has '"+a.get("value")+"'"},getClientQuery:function(a){return a.get("client_id")?"":this.getStringQuery(a)},onBeforeDestroy:function(){this.ui.client&&this.ui.client.length&&this.ui.client.disposeChosen()}})}),define("text!apps/ua_currency_purchase/templates/ua_currency_purchase_ext_filter.tmpl",[],function(){return'<div id="expanded-view">\n    <% if (isMultiClient()) { %>\n    <div class="data-row">\n        <div class="row">\n            <label class="col-xs-12"><%- payer %></label>\n        </div>\n        <div class="row">\n            <div class="col-xs-12"><input class="ellipsis" id="client" placeholder="<%- start_entering_name %>"></div>\n        </div>\n    </div>\n    <% } %>\n    <div class="data-row">\n        <div class="row">\n            <label class="col-xs-3"><%- num_doc %></label>\n            <label class="col-xs-6"><%- amount %></label>\n            <label class="col-xs-3"><%- currency %></label>\n        </div>\n        <div class="row">\n            <div class="col-xs-3">\n                <input id="NUM_DOC" maxlength="10">\n            </div>\n            <div class="col-xs-6 amount-filter">\n                <input id="AMOUNT_MIN" class="sum" autocomplete="off" placeholder="<%- from %>">\n                <label class="amount-to">-</label>\n                <input id="AMOUNT_MAX" class="sum" autocomplete="off" placeholder="<%- to %>">\n            </div>\n            <div class="col-xs-3">\n                <input id="PURCHASE_CURRENCY" autocomplete="off" placeholder="<%- all %>">\n            </div>\n        </div>\n    </div>\n    <div class="data-row">\n        <div class="row">\n            <label class="col-xs-3"><%- account %></label>\n        </div>\n        <div class="row">\n            <div class="col-xs-6">\n                <input class="ellipsis" id="PURCHASE_ACCOUNT" maxlength="14" placeholder="<%- start_entering %>">\n            </div>\n        </div>\n    </div>\n</div>\n<div id="minimized-view"></div>\n'}),define("apps/ua_currency_purchase/ua_currency_purchase_ext_filter_view",["jquery","underscore","backbone","app","bifit","customConstants","collections/thesaurus","appsPieces","commons/base_object/document/document_ext_filter_view","text!apps/ua_currency_purchase/templates/ua_currency_purchase_ext_filter.tmpl","i18n!nls/document-filter"],function(a,b,c,d,e,f,g,h,i,j,k){"use strict";var l=new c.Collection,m={},n=function(a){return"UAH"!==a.currency&&!b.contains(["2","9","10"],a.type)},o=function(c){return m[c]?a.when(m[c]):h.getClnAccounts(c).then(function(a){return a=b.filter(a,n),h.setAccountComments(a)}).then(function(a){return m[c]=a,a})};return i.extend({template:b.template(j),templateHelpers:b.extend({},i.prototype.templateHelpers,k),className:"ua_currency_purchase",ui:b.defaults({client:"#client",NUM_DOC:"#NUM_DOC",AMOUNT_MIN:"#AMOUNT_MIN",AMOUNT_MAX:"#AMOUNT_MAX",PURCHASE_CURRENCY:"#PURCHASE_CURRENCY",PURCHASE_ACCOUNT:"#PURCHASE_ACCOUNT"},i.prototype.ui),events:b.defaults({"blur @ui.AMOUNT_MIN":"validateFilterAmount","blur @ui.AMOUNT_MAX":"validateFilterAmount","change @ui.PURCHASE_CURRENCY":"onChangeCurrency","chosen:select @ui.PURCHASE_CURRENCY":"onChangeCurrency","chosen:select @ui.PURCHASE_ACCOUNT":"onChangeAccount","change @ui.client":"onClientNameChanged"},i.prototype.events),fieldsMeta:{client:{idx:"2",type:"client",label:k.payer},NUM_DOC:{idx:"1",label:k.num_doc},AMOUNT_MIN:{idx:"15",label:k.amount_from,type:"amount",operation:">="},AMOUNT_MAX:{idx:"15",label:k.amount_to,shortLabel:k.to,type:"amount",operation:"<="},PURCHASE_CURRENCY:{idx:"16",label:k.currency},PURCHASE_ACCOUNT:{idx:"19",label:k.account}},accounts:null,initialize:function(a){this.collection=l,this.accounts=[],i.prototype.initialize.call(this,a)},initForm:function(){this.addFormatters(),this.initCurrencyChosen(),this.initAccountsChosen(),this.listenTo(d.mainLayout.content,"content:reloaded",this.highlightFoundText)},addFormatters:function(){this.ui.AMOUNT_MIN.formatter("amount"),this.ui.AMOUNT_MAX.formatter("amount"),this.ui.PURCHASE_ACCOUNT.formatter("number")},initCurrencyChosen:function(){var a=[k.all];this.ui.PURCHASE_CURRENCY.chosen({searchable:!1,data:{array:a},value:k.all}),this.getClientCurrenciesPromise().done(function(b){a.push.apply(a,b),this.ui.PURCHASE_CURRENCY.trigger("refresh",{array:a,value:k.all})}.bind(this))},getClientCurrenciesPromise:function(){var c;return c=d.isMultiClient()?g.getThesaurus("accs_currency").fetch().then(b.partial(b.pluck,b,"currency")):a.when(b.keys(h.getAccounts(["1"],!0))),c.then(function(a){return b.chain(a).without("UAH").sort().value()}).promise()},initAccountsChosen:function(){if(this.ui.PURCHASE_ACCOUNT.chosen({accType:f.NEED_SHOW_ACC_TYPE,data:{id:d.isMultiClient()?"id":"account_id",array:this.accounts,text:["account","currency"]}}),!d.isMultiClient()){var a=b.chain(g.getThesaurus("accs_info").array).filter(n).sortBy("account").value();h.setAccountComments(a).done(function(a){this.accounts=h.addAccountTypeDescription(a),this.refreshAccounts()}.bind(this))}},onChangeCurrency:function(){h.getCurrencies().done(function(a){var c=b.findWhere(a,{currency:this.ui.PURCHASE_CURRENCY.val()}),d=c?c.decimals:2;this.updateAmountDecimals("AMOUNT_MIN",d),this.updateAmountDecimals("AMOUNT_MAX",d)}.bind(this)),this.refreshAccounts()},onChangeAccount:function(a,b){this.ui.PURCHASE_ACCOUNT.val(b.account)},restoreQueryFields:function(){i.prototype.restoreQueryFields.apply(this,arguments);var a=this.collection.get("PURCHASE_CURRENCY");this.ui.PURCHASE_CURRENCY.trigger("choose",a?a.get("value"):k.all)},getFilterValue:function(a){return"PURCHASE_CURRENCY"===a&&this.ui[a].val()===k.all?"":i.prototype.getFilterValue.apply(this,arguments)},onClientNameChanged:function(){var c=this.ui.client.val(),d=b.findWhere(g.getThesaurus("sub_clients").array,{name_cln:c});a.when(d?o(d.client_id):[]).done(function(a){this.accounts=h.addAccountTypeDescription(a),this.refreshAccounts()}.bind(this))},refreshAccounts:function(){var a=this.ui.PURCHASE_CURRENCY.val(),c=a&&a!==k.all?b.where(this.accounts,{currency:a}):this.accounts,d=this.ui.PURCHASE_ACCOUNT.val();if(this.ui.PURCHASE_ACCOUNT.trigger("refresh",{array:c}),d){var e=!c.length||b.any(c,function(a){return a.account.indexOf(d)>-1});this.ui.PURCHASE_ACCOUNT.val(e?d:"").change()}},setDefaults:function(){this.ui.PURCHASE_CURRENCY.trigger("choose",k.all)},highlightFoundText:function(){var a=this.collection.get("NUM_DOC");a&&h.highlightFoundText(a.get("value"),"td.number");var b=this.collection.get("client");b&&h.highlightFoundText(b.get("value"),"td.payer");var c=this.collection.get("PURCHASE_ACCOUNT");c&&h.highlightFoundText(c.get("value"),"td.purchase-account")},updateAmountDecimals:function(a,b){this.ui[a].formatter("amount",{decimallength:b});var c=this.ui[a].getUnformattedValue();this.ui[a].val(e.changeFloatScaleWithoutRounding(c,b)).blur()}})}),define("apps/ua_currency_purchase/ua_currency_purchase_filter_view",["commons/base_object/document/document_state_filter_view","apps/ua_currency_purchase/ua_currency_purchase_ext_filter_view","i18n!apps/ua_currency_purchase/nls/ua_currency_purchase"],function(a,b,c){"use strict";return a.extend({documentTypeTitle:c.ua_currency_purchase_list,ExtFilterComponent:b})}),define("text!apps/ua_currency_purchase/templates/ua_currency_purchase_edit.tmpl",[],function(){return'<form>\n    <div class="grey-container">\n        <h1><%- ua_currency_purchase %></h1>\n\n        <% if (isMultiClient) { %>\n            <div class="sub-client-info"></div>\n        <% } %>\n\n        <% if (viewMode) { %>\n            <span id="status_desc" class="status-code-<%- statusCode %>"><%- status_desc %></span>\n        <% } %>\n\n    </div>\n\n    <div class="grey-container">\n        <div class="row form-group">\n            <div class="col-xs-3">\n                <label for="NUM_DOC" class="num-doc"><%- cp %></label>\n                <input type="text" id="NUM_DOC" name="NUM_DOC" autocomplete="off" maxlength="10"\n                       tabindex="17" placeholder="<%- autonum %>"/>\n            </div>\n            <div class="col-xs-3 col-xs-offset-6">\n                <label for="DATE_DOC"><%- date_doc %></label>\n                <div class="datepicker-container">\n                    <input type="text" id="DATE_DOC" name="DATE_DOC" class="form-control date datepicker"\n                           maxlength="10" tabindex="18" placeholder="<%- current %>"/>\n                    <span class="datepicker"></span>\n                </div>\n            </div>\n        </div>\n\n        <div class="row form-group">\n            <div class="col-xs-5">\n                <label for="PURCHASE_SUM" class="purchase-sum"><%- purch_sum %><sup id="sup1"><a href="#ref1"> 1</a></sup></label>\n                <input type="text" name="PURCHASE_SUM" id="PURCHASE_SUM" autocomplete="off" class="purchase-sum"\n                       tabindex="1" placeholder="0.00"/>\n            </div>\n            <div class="col-xs-2 purchase-currency">\n                <input type="text" id="PURCHASE_CURRENCY" name="PURCHASE_CURRENCY" class="purchase-currency"\n                       tabindex="2"/>\n            </div>\n        </div>\n\n        <div class="row form-group">\n            <div class="col-xs-7">\n                <input id="PURCHASE_RATE_KIND" class="purchase-rate-kind" tabindex="4"/>\n            </div>\n            <div class="col-xs-3 rate">\n                <input type="text" name="PURCHASE_RATE" id="PURCHASE_RATE" autocomplete="off" class="purchase-rate"\n                       placeholder="0.0000" tabindex="5"/>\n            </div>\n        </div>\n\n        <div class="account form-group row">\n            <div class="col-xs-7">\n                <label for="PURCHASE_ACCOUNT"><%- purch_account %></label>\n                <input type="text" name="PURCHASE_ACCOUNT" id="PURCHASE_ACCOUNT" tabindex="3" class="account"/>\n            </div>\n        </div>\n        <div class="transit form-group row">\n            <div class="col-xs-7">\n                <label for="SALE_ACCOUNT_FROM"><%- current_account %><sup id="sup2"><a href="#ref2"> 2</a></sup></label>\n                <input type="text" name="SALE_ACCOUNT_FROM" id="SALE_ACCOUNT_FROM" tabindex="9" class="account"/>\n            </div>\n        </div>\n        <div class="reason form-group">\n            <label for="PURCHASE_REASON"><%- reason %></label>\n            <textarea id="PURCHASE_REASON" name="PURCHASE_REASON" rows="1" tabindex="10"></textarea>\n        </div>\n        <div class="return-account form-group">\n            <label for="RETURN_ACCOUNT"><%- return_account %><sup id="sup3"><a href="#ref3"> 3</a></sup></label>\n            <input type="text" name="RETURN_ACCOUNT" id="RETURN_ACCOUNT" autocomplete="off" maxlength="14"\n                   class="account" tabindex="12"/>\n            <input type="text" class="currency fright" readonly="readonly" value="UAH"/>\n        </div>\n        <div class="bank form-group">\n            <label for="RETURN_BNK_MFO"><%- return_bank %></label>\n            <input type="text" name="RETURN_BNK_MFO" id="RETURN_BNK_MFO" class="mfo" maxlength="6"\n                   placeholder="<%- mfo %>" tabindex="11"/>\n            <input type="text" name="RETURN_BNK_NAME" id="RETURN_BNK_NAME" readonly="readonly"\n                   placeholder="<%- name %>" class="name fright"/>\n        </div>\n        <div class="row form-group">\n            <div class="col-xs-8">\n                <label for="CLN_EMPLOYEE_FIO"><%- fio %></label>\n                <input id="CLN_EMPLOYEE_FIO" class="fio" type="text" maxlength="40" name="CLN_EMPLOYEE_FIO"\n                       placeholder="<%- fio_placeholder %>" tabindex="13"/>\n            </div>\n            <div class="col-xs-4">\n                <label for="CLN_EMPLOYEE_PHONE"><%- phone %></label>\n                <input id="CLN_EMPLOYEE_PHONE" class="phone" type="text" maxlength="20" name="CLN_EMPLOYEE_PHONE"\n                       placeholder="<%- tel_placeholder %>" tabindex="14"/>\n            </div>\n        </div>\n        <div class="row reference">\n            <ol>\n                <li id="ref1"><%- ref1 %></li>\n                <li id="ref2"><%- ref2 %></li>\n                <li id="ref3"><%- ref3 %></li>\n            </ol>\n        </div>\n\n        <div class="row form-group">\n            <div class="attach-container"></div>\n        </div>\n    </div>\n\n\n</form>\n<div class="document-status-bar"></div>\n<div class="comments-bar"></div>\n'}),define("styles!apps/ua_currency_purchase/css/ua_currency_purchase",[],function(){}),define("apps/ua_currency_purchase/base_ua_currency_purchase_item_view",["underscore","bifit","commons/base_object/document/document_item_view","text!apps/ua_currency_purchase/templates/ua_currency_purchase_edit.tmpl","i18n!apps/ua_currency_purchase/nls/ua_currency_purchase","styles!apps/ua_currency_purchase/css/ua_currency_purchase","formatter"],function(a,b,c,d,e){"use strict";return c.extend({className:"doc-wrapper ua_currency_purchase",template:a.template(d),templateHelpers:e,behaviors:{AttachBehavior:{viewType:"VIEW",docType:"ua_currency_purchase",checkPermissions:!0}},initialize:function(a){this.getRatePrecision=a.getRatePrecision,this.fillUiElements(this.getUiElementsTitles())},onShow:function(){c.prototype.onShow.call(this),b.translate("ua_currency_purchase",this.model.get("PURCHASE_RATE_KIND"),this.setRateKind,this),this.addFormatters()},addFormatters:function(){this.ui.PURCHASE_REASON.formatter("oneline_textarea",{maxlength:550}).change();var a=this.ui.PURCHASE_RATE,b=this.getRatePrecision(this.ui.PURCHASE_CURRENCY.val());a.formatter("amount",{maxlength:4,decimallength:b}),a.val()&&a.val(parseFloat(a.getUnformattedValue()).toFixed(b)).trigger("paste")},setRateKind:function(a){a===e.rate0?(this.ui.PURCHASE_RATE.show(),this.ui.PURCHASE_RATE_KIND.val(e.rate0_label)):(this.ui.PURCHASE_RATE.hide(),this.ui.PURCHASE_RATE_KIND.val(e.rate1_label))}})}),define("apps/ua_currency_purchase/ua_currency_purchase_item_view",["underscore","bifit","apps/ua_currency_purchase/base_ua_currency_purchase_item_view","i18n!apps/ua_currency_purchase/nls/ua_currency_purchase"],function(a,b,c,d){
return c.extend({initialize:function(e){c.prototype.initialize.call(this,e),a.extend(this.templateHelpers,{ref2:b.sprintf(d.ref2,this.model.get("PENSION_TAX").toString().replace(".",","))})},getUiElementsTitles:function(){return["PURCHASE_RATE","PURCHASE_RATE_KIND","PURCHASE_REASON","CLN_EMPLOYEE_PHONE","PURCHASE_CURRENCY","PURCHASE_ACCOUNT","SALE_ACCOUNT_FROM","RETURN_ACCOUNT"]},onShow:function(){c.prototype.onShow.call(this),this.appendCurrenciesToAccounts()},appendCurrenciesToAccounts:function(){var a=function(a,b){var c=this.ui[a];c.val(c.val()+" "+b)}.bind(this);a("PURCHASE_ACCOUNT",this.ui.PURCHASE_CURRENCY.val()),a("SALE_ACCOUNT_FROM","UAH")},setRateKind:function(a){a===d.rate1_label?this.ui.PURCHASE_RATE.hide():this.ui.PURCHASE_RATE.show(),this.ui.PURCHASE_RATE_KIND.val(a)}})}),define("apps/ua_currency_purchase/base_ua_currency_purchase_item_edit",["underscore","backbone","bifit","commons/base_object/document/document_item_edit","text!apps/ua_currency_purchase/templates/ua_currency_purchase_edit.tmpl","i18n!apps/ua_currency_purchase/nls/ua_currency_purchase","formatter","chosen"],function(a,b,c,d,e,f){"use strict";return d.extend({id:"edit",className:"doc-wrapper ua_currency_purchase",template:a.template(e),templateHelpers:f,behaviors:{AttachBehavior:{viewType:"EDIT",docType:"ua_currency_purchase",checkPermissions:!0}},initialize:function(a){this.rates=a.rates,this.banks=a.banks,this.accounts=a.accounts,this.currencies=a.currencies,this.docType=a.docType,this.getMfo=a.getMfo,this.getParam=a.getParam,this.getRatePrecision=a.getRatePrecision,this.getClientOrBankParam=a.getClientOrBankParam,this.fillUiElements(this.getUiElementsTitles())},onBeforeDestroy:function(){this.ui.selectBoxes.disposeChosen()},refreshField:function(a,b){this.model.set(a,b,{silent:!0}),this.$("#"+a).val(b)},initAccountsChosen:function(){var b={searchable:!1,width:160,data:{array:[],id:"account_id",text:"account"}};this.ui.CURRENT_ACCOUNT.chosen(b),this.ui.PURCHASE_ACCOUNT.chosen(b),this.ui.RETURN_ACCOUNT.chosen(a.extend({},b,{searchable:!0})),this.ui.FUND_ACCOUNT.chosen(b)},onSelectReturnAccount:function(a,c){b.Validation.callbacks.valid(null,a.target.id),this.selectAccount(a,c)},selectAccount:function(a,b){var d=this.docType+"_"+c.getKeyFromEvent(a.target);if(c.setStorageDocData(d,b.account_id),this.fillBanksInfo(b.mfo,a.target.id.split("ACCOUNT")[0]),this.onChangeField(a),this.ui.SALE_ACCOUNT&&this.ui.SALE_ACCOUNT.val()){var e=this.validateField("SALE_ACCOUNT",this.ui.SALE_ACCOUNT.val());this.ui.SALE_ACCOUNT.css("border-color",e?"#FF6666":"")}},fillBanksInfo:function(b,c){c=c===this.FILL_BANKS_INFO_ACCOUNT_PREFIX?"":c,this.refreshField(c+"BNK_MFO",b);var d=this.getMfo(b);d&&d.done(function(d){if(1===d.length){var e=d[0].name;if(this.refreshField(c+"BNK_NAME",e),!c){var f=a.findWhere(this.banks,{bik:b});this.refreshField("BNK_ADDR",((f||{}).address||"").substr(0,80))}}this.fillCustomBanksInfo(c)}.bind(this))},fillCurrentAccounts:function(b,d){var e=1===b.length?b[0]:a.findWhere(b,{account:this.model.get(d)});e=e||a.findWhere(b,{account_id:c.getStorageDocData(this.docType+"_current_account")}),e=e||(b.length>0?b[0]:{});var f=this.ui[d];f.trigger("refresh",{array:b}),f.trigger("chooseById",e.account_id||""),f.attr("disabled",1===b.length)},fillPurchaseCurrencies:function(){var b=a.without(a.keys(this.accounts),"UAH");if(0===b.length)throw f.no_cur_accs;this.ui.PURCHASE_CURRENCY.chosen({width:"",searchable:!1,"class":"currency",data:{array:b.sort()}})},onSelectPurchaseCurrency:function(b,d){var e=this.getRatePrecision(d),f=this.ui.PURCHASE_RATE;if(f.formatter("amount",{maxlength:4,decimallength:e}),f.val().length>0&&f.val(parseFloat(f.getUnformattedValue()).toFixed(e)).trigger("paste"),this.currencies.done(function(b){var c=a.findWhere(b,{currency:d});this.ui.PURCHASE_SUM.formatter("amount",{decimallength:c.decimals});var e=parseFloat(this.ui.PURCHASE_SUM.getUnformattedValue());isNaN(e)||this.ui.PURCHASE_SUM.val(e.toFixed(c.decimals)).trigger("paste")}.bind(this)),this.fillPurchaseAccounts(this.accounts[d]),c.setStorageDocData(this.docType+"_purchase_currency",d),this.model.set("PURCHASE_CURRENCY",d,{silent:!0}),this.ui.SALE_ACCOUNT&&this.ui.SALE_ACCOUNT.val()){var g=this.validateField("SALE_ACCOUNT",this.ui.SALE_ACCOUNT.val());this.ui.SALE_ACCOUNT.css("border-color",g?"#FF6666":"")}},fillPurchaseAccounts:function(b){var c=1===b.length?b[0]:a.findWhere(b,{account:this.model.get("PURCHASE_ACCOUNT")});c=c||(b.length>0?b[0]:{}),this.ui.PURCHASE_ACCOUNT.trigger("refresh",{array:b}),this.ui.PURCHASE_ACCOUNT.trigger("chooseById",c.account_id||""),this.ui.PURCHASE_ACCOUNT.attr("disabled",1===b.length)},initBanks:function(){var b={};a.each(this.accounts.UAH,function(a){b[a.mfo]=!0});var c=a.filter(this.banks,function(a){return b[a.bik]});this.ui.RETURN_BNK_MFO.chosen({width:"4em",searchable:!0,data:{array:c,id:"bik",text:"bik"}})},initRateKind:function(){this.ui.PURCHASE_RATE_KIND.chosen({searchable:!1,width:"13em",data:{id:"id",text:"label",array:this.rates}});var b=a.findWhere(this.rates,{value:this.model.get("PURCHASE_RATE_KIND")});this.ui.PURCHASE_RATE_KIND.trigger("chooseById",(b||a.last(this.rates)).id)},onSelectRateKind:function(a,c){this.model.get("PURCHASE_RATE_KIND")!==c.value&&this.refreshField("SALE_SUM",""),b.Validation.callbacks.valid(null,"PURCHASE_RATE"),"1"===c.id?(this.ui.PURCHASE_RATE.show(),this.ui.SALE_SUM.css("display","block"),this.ui.SALE_SUM_LABEL.html(f.sale_sum),this.$("div.transf-kind div.chosen").removeClass("first")):(this.refreshField("PURCHASE_RATE",""),this.ui.PURCHASE_RATE.hide(),this.ui.SALE_SUM.hide(),this.ui.SALE_SUM_LABEL.html(f.transfer_kind),this.$("div.transf-kind div.chosen").addClass("first")),this.model.set("PURCHASE_RATE_KIND",c.value)}})}),define("apps/ua_currency_purchase/ua_currency_purchase_item_edit",["jquery","underscore","backbone","bifit","appsPieces","apps/ua_currency_purchase/base_ua_currency_purchase_item_edit","i18n!apps/ua_currency_purchase/nls/ua_currency_purchase","chosen"],function(a,b,c,d,e,f,g){return f.extend({FILL_BANKS_INFO_ACCOUNT_PREFIX:"SALE_",ui:{dateFields:"input.date",selectBoxes:"input.select-box"},events:{"chosen:select #SALE_ACCOUNT_FROM":"onSelectSaleAccountFrom","chosen:select #PURCHASE_ACCOUNT":"onSelectPurchaseAccount","chosen:select #RETURN_ACCOUNT":"onSelectReturnAccount","chosen:select #PURCHASE_CURRENCY":"onSelectPurchaseCurrency","chosen:select #PURCHASE_RATE_KIND":"onSelectRateKind","input  #RETURN_BNK_MFO":"onChangedReturnMfo","change #RETURN_BNK_MFO":"onChangedReturnMfo","change input[type=text]:not([readonly].account)":"onChangeField","change textarea":"onChangeField","hide #DATE_DOC":"onBlurDate","blur #DATE_DOC":"onBlurDate","change #RETURN_ACCOUNT":"onSelectReturnAccount"},initialize:function(a){f.prototype.initialize.call(this,a),b.extend(this.templateHelpers,{ref2:d.sprintf(g.ref2,this.model.get("PENSION_TAX").toString().replace(".",","))}),this.accounts=e.addAccountTypeDescription(this.accounts)},getUiElementsTitles:function(){return["PURCHASE_SUM","PURCHASE_CURRENCY","PURCHASE_RATE_KIND","PURCHASE_RATE","PURCHASE_ACCOUNT","SALE_ACCOUNT_FROM","PURCHASE_REASON","RETURN_ACCOUNT","CLN_EMPLOYEE_PHONE","RETURN_BNK_MFO","DATE_DOC"]},onShow:function(){f.prototype.onShow.call(this,arguments),this.addDatePickers(),this.addFormatters(),this.initAccountsChosen(),this.initBanks(),this.fillAccounts(),this.initRateKind()},addDatePickers:function(){this.ui.dateFields.formatter("date"),d.datePicker(a("input.datepicker"),{orientation:"bottom auto"})},initAccountsChosen:function(){var a={searchable:!1,width:160,accType:!0,data:{array:[],id:"account_id",text:["account","currency"]}};this.ui.PURCHASE_ACCOUNT.chosen(a),this.ui.SALE_ACCOUNT_FROM.chosen(a),a={searchable:!0,width:160,accType:!0,data:{array:[],id:"account_id",text:["account"]}},this.ui.RETURN_ACCOUNT.chosen(a)},initRateKind:function(){this.ui.PURCHASE_RATE_KIND.chosen({searchable:!1,width:"13em",data:{id:"id",text:"label",array:this.rates}});var a=this.model.get("PURCHASE_RATE_KIND"),c=b.find(this.rates,function(b){return b.value===a||b.label===a});this.ui.PURCHASE_RATE_KIND.trigger("chooseById",(c||b.last(this.rates)).id)},addFormatters:function(){this.ui.CLN_EMPLOYEE_PHONE.formatter("phone"),this.ui.PURCHASE_REASON.formatter("oneline_textarea",{maxlength:255}).change(),this.ui.RETURN_ACCOUNT.formatter("number"),this.ui.RETURN_BNK_MFO.formatter("number")},onSelectReturnAccount:function(){var a=this.ui.RETURN_ACCOUNT.val();if(a.length>0){var c=b.findWhere(this.accounts.UAH,{account:a});if(c)this.ui.RETURN_BNK_MFO.val(c.mfo).change();else{var e=d.getStorageDocData(this.docType+"_return_bnk_mfo");this.ui.RETURN_BNK_MFO.val(this.model.get("RETURN_BNK_MFO")||e).change()}}d.setStorageDocData(this.docType+"_return_account",a),this.validateField("RETURN_ACCOUNT",a)},onChangeField:function(a){var b=a.target.id;if(-1===b.indexOf("BNK_MFO")&&-1===b.indexOf("DATE")&&b.indexOf("RETURN_ACCOUNT")){var c=function(a){return a.substr(0,a.length-4)},e={PURCHASE_SUM:d.getAmountConverterRule(4),PURCHASE_RATE:d.getAmountConverterRule(4),PURCHASE_ACCOUNT:c,SALE_ACCOUNT_FROM:c},g=["PURCHASE_RATE_KIND"],h=d.convertByRules(a,e,g,this.model);return f.prototype.onChangeField.call(this,a,h)}},onBlurDate:function(a){var b=a.target.id;""===this.ui[b].val().replace(/\s+/g,"").replace(/\./g,"")&&this.ui[b].val(""),this.validateField(b,this.ui[b].val())},onChangedReturnMfo:function(a){this.refreshField("RETURN_BNK_NAME","");var b=a.target.value;d.setStorageDocData(this.docType+"_return_bnk_mfo",this.ui.RETURN_BNK_MFO.val()),6===b.length?(this.fillBanksInfo(b,"RETURN_"),this.validateField("RETURN_ACCOUNT",this.ui.RETURN_ACCOUNT.val())):"change"===a.type&&this.validateField("RETURN_BNK_MFO",b)},onSelectPurchaseAccount:function(a,b){this.selectAccount(a,b),this.onChangePurchaseAccount(b)},onChangePurchaseAccount:function(a){var e=b.where(this.accounts.UAH,{mfo:a.mfo});this.fillCurrentAccounts(e,"SALE_ACCOUNT_FROM"),b.isEmpty(e)?c.Validation.invalidField(null,"SALE_ACCOUNT_FROM",d.sprintf(g.not_ua_acount_for_mfo,a.mfo)):c.Validation.callbacks.valid(null,"SALE_ACCOUNT_FROM")},onSelectRateKind:function(a,b){c.Validation.callbacks.valid(null,"PURCHASE_RATE"),"1"===b.id?this.ui.PURCHASE_RATE.show():(this.refreshField("PURCHASE_RATE",""),this.ui.PURCHASE_RATE.hide()),this.model.set("PURCHASE_RATE_KIND",b.value)},fillCustomBanksInfo:function(a){if("RETURN_"===a){this.model.set("RETURN_BNK_MFO","",{silent:!0});var b=this.ui.RETURN_BNK_MFO.val()||" ",c={target:{id:"RETURN_BNK_MFO"}};f.prototype.onChangeField.call(this,c,b)}},fillAccounts:function(){this.fillPurchaseCurrencies(),this.accounts[this.model.get("PURCHASE_CURRENCY")]?this.ui.PURCHASE_CURRENCY.trigger("chooseById",this.model.get("PURCHASE_CURRENCY")):(this.ui.PURCHASE_ACCOUNT.trigger("refresh",{array:[]}),c.Validation.invalidField(null,"PURCHASE_ACCOUNT",g.not_acount_for_cur)),this.fillCurrentAccounts(b.where(this.accounts.UAH),"RETURN_ACCOUNT")},fillCurrentAccounts:function(a,c){var e=1===a.length?a[0]:b.findWhere(a,{account:this.model.get(c)}),f=d.getStorageDocData(this.docType+"_"+c.toLowerCase()),g=this.ui[c];if("RETURN_ACCOUNT"===c){if(e=e?e.account:this.model.get("RETURN_ACCOUNT")||f,!e){var h=b.findWhere(a,{account:this.model.get("SALE_ACCOUNT_FROM")});e=h?h.account:""}g.trigger("refresh",{array:a}).attr("disabled",1===a.length),g.val(e).change()}else e||(e=b.findWhere(a,{account_id:f})||(a.length>0?a[0]:{})),g.trigger("refresh",{array:a}).attr("disabled",1===a.length),g.trigger("chooseById",e.account_id||"")},onSelectSaleAccountFrom:function(a,b){this.selectAccount(a,b)},onSelectPurchaseCurrency:function(a,c){f.prototype.onSelectPurchaseCurrency.call(this,a,c),this.currencies.done(function(a){var e=b.findWhere(a,{currency:c});this.ui.PURCHASE_SUM.attr("placeholder",d.formatAmount("0",{decimallength:e.decimals}))}.bind(this))}})}),define("commons/base_object/document/document_print_processor",["jquery","underscore","bifit","printUtils"],function(a,b,c,d){"use strict";function e(b,c,d,e,f){this.form=b,this.$mainElement=a(b[0].querySelector("section.main").querySelector("article.main")),this.$printButton=a(b[0].querySelector("button.print.to-printer")),this.$printPdfButton=a(b[0].querySelector("button.print.to-pdf")),this.printStyle=d,this.pdfTemplate=e,this.documentType=c,this.modelStatus=f,this.printPromises=[]}return e.prototype.run=function(c){a(this.form[0].querySelector("#doc-div")).remove(),this.$mainElement.append('<style type="text/css">'+this.printStyle+"</style>"),this.$printPdfButton.parent().show(),d.spinBtn(this.$printButton),d.spinBtn(this.$printPdfButton),d.createLeftMenu(c,this.form).then(function(){var e=this.form.find("input[type=checkbox]");e.prop("disabled",!0),this.renderDocument(c[0],this.$mainElement);var f=!b.contains(["pay_sheet","assign_card_order","fire_staff_order","card_prolongation"],this.documentType);setTimeout(function(){a.when.apply(a,this.printPromises).then(function(){for(var b=f?this.$mainElement.clone(!0):this.$mainElement,g=1;g<c.length;g++)this.renderDocument(c[g],b);a.when.apply(a,this.printPromises).always(function(){f&&(this.$mainElement[0].innerHTML=b[0].innerHTML),e.prop("disabled",!1),d.stopBtn(this.$printButton),d.stopBtn(this.$printPdfButton)}.bind(this))}.bind(this))}.bind(this),300),this.addPrintPdfButtonHandler()}.bind(this))},e.prototype.renderDocument=function(){throw new Error("renderDocument is not implemented")},e.prototype.addPrintPdfButtonHandler=function(){this.$printPdfButton.bind("click",function(){var b=this.documentType+".pdf",e=this.prepareDocumentForPdf(this.$mainElement.clone(!0));a.ajax({type:"POST",url:localStorage.getItem("addr")+"/print_to_pdf;jsessionid="+c.getStoredItem("JSESSIONID"),contentType:"application/x-www-form-urlencoded; charset=UTF-8",mimeType:"text/plain; charset=x-user-defined",data:{html:this.getHtmlForPdf(e),fileName:b,stampAbsolutePosition:!0},success:function(a){d.createPdfFile(a,b,this.form[0])}.bind(this)})}.bind(this))},e.prototype.getHtmlForPdf=function(a){var c={"<br>":"<br/>",'"':'"',"<hr>":"<hr/>"};return b.template(this.pdfTemplate,{content_for_pdf:a[0].outerHTML}).replace(/<br>|"|<hr>/gi,function(a){return c[a]})},e.prototype.prepareDocumentForPdf=function(c){c.find("style").remove(),c.find("h1.empty").remove(),c.find(".hidden").remove(),c.find("colgroup").remove(),this.form.find("#ecp_owner").is(":checked")||c.find(".sign1, .sign2").children().remove(),this.form.find("#service_info").is(":checked")||0===c.find(".serv-info-table")||c.find(".serv-info-table").remove(),b.contains(["ua_payment","ua_payment_request","bank_ua_payment_request"],this.documentType)&&(this.form.find("#two_copies").is(":checked")||0===c.find(".doc-div-copied")||c.find(".doc-div-copied").remove());var d=c.find(".for-img img").parent();return d.empty(),this.form.find("#bank_stamp").is(":checked")&&d.each(function(){var b=a(this);b.append("<"+b.attr("data-stamp-name")+"/>")}),c},e}),define("text!apps/ua_currency_purchase/templates/ua_currency_purchase_print.tmpl",[],function(){return'<div class="main">\n    <table>\n        <tbody class="centered">\n        <tr>\n            <td width="92%"></td>\n            <td width="8%" class="border doc_ident head">0408006</td>\n        </tr>\n        </tbody>\n    </table>\n    <div class="onright small">Примiрник ___</div>\n    <div class="head centered">ЗАЯВА ПРО КУПІВЛЮ ІНОЗЕМНОЇ ВАЛЮТИ /</div>\n    <div class="head centered">APPLICATION FOR FOREIGN CURRENCY PURCHASE</div>\n\n\n    <table>\n        <tbody>\n        <tr class="head">\n            <td width="31%"></td>\n            <td width="1%" class="bold-text">N</td>\n            <td width="14%" class="bbordered bold-text"> <%- NUM_DOC %></td>\n            <td width="8%" class="bold-text">ВІД/DATED</td>\n            <td width="15%" class="date-doc bold-text"></td>\n            <td width="31%"></td>\n        </tr>\n        </tbody>\n    </table>\n\n    <div class="head centered bank_info"></div>\n\n\n    <table class="thick_bordered">\n        <tbody>\n        <tr>\n            <td class="prop_name cln_info_label">Найменування (прізвище, ім’я, по батькові) Клієнта / Client name\n                (surname, name)\n            </td>\n            <td colspan="4"><%- CLN_NAME %></td>\n        </tr>\n        <tr>\n            <td class="prop_name cln_info_label">Місцезнаходження (місце проживання) Клієнта / Client address of\n                registered office (place of residence)\n            </td>\n            <td class="cln_addr_label" colspan="2"><%- CLN_ADDR %></td>\n            <td class="prop_name cln_edrpou_label">Код ЄДРПОУ (ідентифікаційний код) Клієнта /\n                Client ID code\n            </td>\n            <td class="centered cln_edrpou"><%- CLN_OKPO %></td>\n        </tr>\n        <tr>\n            <td class="prop_name empl_info_label" colspan="2">Прізвище, ініціали уповноваженого працівника Клієнта /\n                Surname,\n                initials of the Client’s responsible employee (hereinafter – the “Client’s responsible employee”)\n            </td>\n            <td class="empl_info" colspan="3"><%- CLN_EMPLOYEE_FIO %></td>\n        </tr>\n        <tr>\n            <td class="prop_name empl_info_label" colspan="2">Контактний телефон уповноваженого працівника Клієнта /\n                Contact\n                telephone of the Client’s responsible employee\n            </td>\n            <td colspan="3"><%- CLN_EMPLOYEE_PHONE %></td>\n        </tr>\n        </tbody>\n    </table>\n    <p>\n    <span class="small">Клієнт доручає Банку купити іноземну валюту на умовах, що зазначені\n        нижче:</span><span class="very_small">/ The Client authorizes the Bank to purchase the foreign currency (FCY) on\n        the following conditions:</span>\n    </p>\n\n\n    <table class="thick_bordered">\n        <tbody>\n        <tr>\n            <td class="prop_name sum_and_curr_labels">Сума та назва іноземної валюти, що підлягає купівлі (цифрами) /\n                Amount and name of FCY for purchase (in numbers)\n            </td>\n            <td class="curr_sum"></td>\n            <td class="prop_name currency_label">Код валюти / Currency code</td>\n            <td class="currency centered"><%- PURCHASE_CURRENCY %></td>\n        </tr>\n        <tr>\n            <td class="prop_name sum_and_curr_labels">Сума та назва іноземної валюти, що підлягає купівлі (прописом) /\n                Amount and name of FCY for purchase (in words)\n            </td>\n            <td colspan="3" class="curr_sum_in_words"></td>\n        </tr>\n        <tr>\n            <td class="prop_name sum_and_curr_labels">Курс купівлі в гривнях/Exchange rate in UAH</td>\n            <td class="purch_rate" colspan="3"></td>\n        </tr>\n        </tbody>\n    </table>\n\n\n    <table class="thick_bordered purchase_reason">\n        <tbody>\n        <tr>\n            <td class="prop_name">Підстава для купівлі іноземної валюти на МВРУ / Legal basis for purchase of FCY at the\n                Ukrainian Interbank Currency Market (UICM):\n            </td>\n        </tr>\n        <tr>\n            <td><%- PURCHASE_REASON %></td>\n        </tr>\n        </tbody>\n    </table>\n\n\n    <p class="small">\n        З дати Заяви Клієнт доручає Банку здійснити договірне списання з Рахунку Клієнта в гривнях грошових коштів в\n        розмірах, необхідних для:\n    </p>\n\n    <div class="small list">\n        <div>1) купівлі Банком іноземної валюти за курсом згідно Заяви;</div>\n        <div>2) сплати Клієнтом Банку комісійної винагороди у розмірі, визначеному Тарифами Банку, чинними станом на\n            дату\n            прийняття Банком Заяви до виконання;\n        </div>\n        <div>3) сплати до Пенсійного фонду України сум збору на обов\'язкове державне пенсійне страхування у випадках та\n            в\n            розмірі, визначених законодавством України.\n        </div>\n    </div>\n    <p class="small">Клієнт доручає Банку реалізувати зазначене право та здійснити договірне списання у випадку, якщо\n        Клієнт\n        самостійно не здійснить переказ зазначених коштів в дату подання Заяви.</p>\n\n    <p class="small">Банк має право здійснювати договірне списання необхідну кількість разів та спрямовувати списані\n        кошти\n        згідно з їх цільовим призначенням./</p>\n\n    <p class="very_small">From the date of this Application the Client authorizes the Bank to perform direct debiting of\n        funds from the Client’s account in UAH in the amount necessary for:</p>\n\n    <div class="very_small list">\n        <div>1) purchase by the Bank of the foreign currency according to the exchange rate in UAH indicated in this\n            Application;\n        </div>\n        <div>2) payment by the Client to the Bank of the commission fee in accordance with the Bank’s Tariffs effective\n            as of\n            the date of acceptance by the Bank of the Application;\n        </div>\n        <div>3) payment to the Pension Fund of Ukraine of the state mandatory pension insurance fee in cases and in the\n            amount stipulated by the Ukrainian law (if payment of such duty is required by the Ukrainian law).\n        </div>\n    </div>\n    <p class="very_small">The Client authorizes the Bank to realize mentioned right and to perform direct debiting of\n        funds\n        if the Client does not provide necessary amount of funds at the date of Application.</p>\n\n    <p class="very_small">The Bank is authorized to directly debit funds in UAH the necessary number of times and\n        allocate\n        the debited funds according to their intended purpose.</p>\n\n\n    <table class="thick_bordered">\n        <tbody>\n        <tr>\n            <td class="account_label">Рахунок Клієнта в гривнях / Client’s account in UAH</td>\n            <td class="account"><%- SALE_ACCOUNT_FROM %></td>\n            <td class="bank_code_label">Код банку / Bank code</td>\n            <td class="bank_code"><%- BNK_MFO %></td>\n        </tr>\n        </tbody>\n    </table>\n\n\n    <p class="small">Клієнт доручає Банку переказати придбану іноземну валюту на Рахунок Клієнта в іноземній валюті: /\n        The\n        Client authorizes the Bank to transfer the purchased FCY to the Client’s account in FCY:</p>\n\n\n    <table class="thick_bordered">\n        <tbody>\n        <tr>\n            <td class="account_label">Рахунок Клієнта в іноземній валюті / Client’s account in FCY</td>\n            <td class="account"><%- PURCHASE_ACCOUNT %></td>\n            <td class="bank_code_label">Код банку / Bank code</td>\n            <td class="bank_code"><%- BNK_MFO %></td>\n        </tr>\n        </tbody>\n    </table>\n\n\n    <p class="small indented" align="justify">Якщо курс, за яким Банк може здійснити операцію з купівлі іноземної\n        валюти, є нижчим, ніж\n        конкретне значення курсу, вказане Клієнтом в графі «Курс купівлі в гривнях», Клієнт надає Банку право купити\n        Суму\n        іноземної валюти, що підлягає купівлі, за більш низьким курсом. В такому випадку, Клієнт доручає Банку повернути\n        залишок коштів на нижченаведений Рахунок Клієнта для повернення коштів.</p>\n\n    <p class="small">У випадку підвищення курсу, за яким Банк може здійснити операцію з купівлі іноземної валюти:</p>\n\n    <div class="small" align="justify">\n        <div>1) Якщо Клієнт в графі «Курс купівлі в гривнях» вказав «за курсом уповноваженого банку», Клієнт доручає\n            Банку здійснити\n            договірне списання додаткових коштів з Рахунку Клієнта в гривнях у сумі, якої не вистачає для виконання\n            Заяви в\n            повному обсязі. За відсутності на Рахунку Клієнта в гривнях достатньої суми коштів, Клієнт надає згоду на\n            придбання Банком іноземної валюти в сумі, меншій ніж зазначена в Заяві, виходячи з фактичного розміру суми в\n            гривнях, що була перерахована ним та/або списана Банком за Заявою.\n        </div>\n        <div>2) Якщо Клієнт в графі «Курс купівлі в гривнях» вказав конкретне значення курсу та Клієнт своєчасно не\n            надав\n            Банку нову Заяву із зазначенням курсу, за яким Банк може здійснити купівлю іноземної валюти, Клієнт доручає\n            Банку повернути Заяву без виконання та кошти в національній валюті на нижченаведений Рахунок Клієнта для\n            повернення коштів. /\n        </div>\n    </div>\n    <p class="very_small indented" align="justify">If the Bank can purchase foreign currency at lower exchange rate than\n        specified in the\n        line “Exchange rate in UAH”, the Client authorizes the Bank to purchase the requested Amount of FCY at a lower\n        rate.\n        In such case, the Client authorizes the Bank to return the remaining funds to the Client’s account for refund of\n        funds specified below.</p>\n\n    <p class="very_small">In case foreign currency purchase exchange rate used by the Bank increases:</p>\n\n    <div class="very_small" align="justify">\n        <div align="justify">1) If the Client in the line “Exchange rate in UAH” specifies the option “According to the\n            exchange rate of the\n            Bank”, the Client authorizes the Bank to perform direct debiting of additional funds from the Client’s\n            account in\n            UAH in the amount needed to fulfill the Application in full. If there is not enough funds at the Client’s\n            account\n            in UAH, the Client authorizes the Bank to purchase the FCY in the amount smaller than pointed out in the\n            Application, out of actual amount of money in UAH transferred and/or debited by the Bank under the\n            Application.\n        </div>\n        <div align="justify">2) If the Client in the line “Exchange rate in UAH” specified the exchange rate without\n            promptly providing the\n            new Application with relevant rate, the Client authorizes the Bank to reject the Application and amount in\n            UAH\n            to the Client’s account for return of funds specified below.\n        </div>\n    </div>\n\n\n    <table class="thick_bordered">\n        <tbody>\n        <tr>\n            <td class="account_label prop_name">Рахунок Клієнта для повернення коштів /<br/> Client’s account for return\n                of\n                funds\n            </td>\n            <td class="account"><%- RETURN_ACCOUNT %></td>\n            <td class="bank_code_label prop_name">Код банку / Bank code</td>\n            <td class="bank_code"><%- RETURN_BNK_MFO %></td>\n        </tr>\n        </tbody>\n    </table>\n\n    <p class="indented line-height-small">\n    <span class="small" align="justify">Крім зазначеного та додатково до умов укладених між Банком та Клієнтом договорів, Клієнт доручає\n        Банку здійснювати з будь-яких рахунків Клієнта в Банку (в гривнях) договірне списання сум комісійної винагороди\n        Банку та сум збору на обов’язкове державне пенсійне страхування в розмірах, встановлених законодавством України\n        (якщо обов’язок сплати такого збору передбачено законодавством України), в разі наявності підстав для здійснення\n        Банком купівлі іноземної валюти у власність Клієнта без оформлення окремої Заяви, та/або утримувати суми\n        комісійної винагороди Банку та суми збору на обов’язкове державне пенсійне страхування (якщо обов’язок сплати\n        такого збору передбачено законодавством України) з суми в гривнях, призначеної для купівлі іноземної валюти у\n        власність Клієнта без оформлення окремої Заяви. В цій частині Заява залишається чинною протягом необмеженого\n        строку навіть після її виконання та є невід’ємною частиною договорів щодо відкриття та обслуговування Банком\n        рахунків Клієнта.</span><span class="very_small">/ In addition to the above-said and to the conditions of the\n        agreements between the Client and the Bank, the Client authorizes the Bank to perform direct debiting from any\n        Client’s accounts with the Bank (in UAH) of the commission fees of the Bank and of the compulsory state pension\n        insurance duty in the amounts required under the Ukrainian law (if payment of such duty is required by the\n        Ukrainian law) if there are grounds for purchase of the foreign currency by the Bank into the Client’s ownership\n        without a separate Application, and/or to withhold the amounts of the commission fee to the Bank and of the\n        compulsory state pension insurance duty (if payment of such duty is required by the Ukrainian law) from the UAH\n        amount designated for purchase of the foreign currency into the Client’s ownership without providing a separate\n        Application. In this regard the Application will remain effective for unlimited duration even after its\n        execution and shall constitute an inseparable part of the agreements of Client’s account closing and servicing\n        by the Bank.</span>\n    </p>\n\n    <p class="indented line-height-small">\n    <span class="small" align="justify">Якщо придбана на МВРУ іноземна валюта згідно з Заявою не буде перерахована Клієнтом за\n        призначенням у визначений законодавством України строк після зарахування на Рахунок Клієнта в іноземній валюті,\n        Клієнт доручає Банку продати цю іноземну валюту на МВРУ. </span><span class="very_small">/ If the foreign\n        currency purchased at the ICMU under this Application will not be transferred by the Client according to\n        intended purpose within the term defined by the Ukrainian law after crediting to the Client’s account in FCY,\n        the Client authorizes the Bank to sell this foreign currency at the ICMU.</span>\n    </p>\n\n    <p class="indented line-height-small">\n    <span class="small" align="justify">Підписанням цієї Заяви Клієнт підтверджує свою згоду з усіма положеннями, вказаними в цій Заяві,\n        в тому числі наведеними в примітці до цієї Заяви. </span><span class="very_small">/ By signing this Application\n        the Client confirms its consent will all provisions specified in this Application, including in the note to this\n        Application.</span>\n    </p>\n\n    <p class="indented">\n    <span class="small">Ця Заява є невід’ємною частиною договору банківського рахунку, укладеного між Клієнтом та\n        Банком.</span><span class="very_small">/ This Application shall be an inseparable part of the Bank account\n        agreement, concluded between the Client and the Bank.</span>\n    </p>\n\n    <table class="thick_bordered centered">\n        <tbody>\n        <tr>\n            <td class="prop_name sign_column_1">\n                Керівник Клієнта /<br/>General manager of the Client\n            </td>\n            <td rowspan="2" valign="middle" class="prop_name seal large">М.П./Seal</td>\n            <td class="prop_name sign_column_2">\n                Головний бухгалтер Клієнта (за наявності) /<br/>Chief accountant of the Client (if present)\n            </td>\n        </tr>\n        <tr>\n            <td class="sign">\n                <div>\n                    <div class="sign1"></div>\n                    <table class="sign">\n                        <tr>\n                            <td class="text italic-text">(Прізвище, ініціали/Surname, initials)</td>\n                        </tr>\n                    </table>\n                    <div class="text italic-text">(Підпис/Signature)</div>\n                </div>\n            </td>\n            <td class="sign">\n                <div>\n                    <div class="sign2"></div>\n                    <table class="sign">\n                        <tr>\n                            <td class="text italic-text">(Прізвище, ініціали/Surname, initials)</td>\n                        </tr>\n                    </table>\n                    <div class="text italic-text">(Підпис/Signature)</div>\n                </div>\n            </td>\n        </tr>\n        </tbody>\n    </table>\n\n\n    <p class="bold-text large">\n        Позначки Банку/Bank’s remarks:\n    </p>\n\n\n    <table class="thick_bordered centered">\n        <tbody>\n        <tr>\n            <td>Дата виконання /Trade date</td>\n            <td>Розмір комісії, % / Amount of commission fee, %</td>\n            <td>Сума комісії / Amount of commission fee</td>\n        </tr>\n        <tr>\n            <td class="empty_row"></td>\n            <td class="empty_row"></td>\n            <td class="empty_row"></td>\n        </tr>\n        </tbody>\n    </table>\n    <div class="for-service-info fleft"></div>\n</div>\n<div class="for-img" style="float: right"></div>\n<div class="note">\n    <p class="small" align="justify">\n        <span class="bold-text italic-text">Примітка:</span>Датою прийняття Заяви є дата отримання Банком Заяви, якщо\n        вона надійшла не пізніше 12:00 відповідного робочого дня. Банк приймає Заяву до виконання виключно за умови, що\n        Клієнт надав необхідні документи, що підтверджують наявність підстав для купівлі іноземної валюти відповідно до\n        законодавства України та вимог Банку. Банк має право відмовитися від прийняття Заяви до виконання та/або\n        відмовити у виконанні Заяви. Заява заповнюється українською мовою. Якщо Клієнт в графі «Курс купівлі в гривнях»\n        вказав «за курсом уповноваженого банку», підписанням цієї Заяви Клієнт підтверджує, що він ознайомлений з\n        поточним курсом Банку, оприлюдненим на веб-сторінці Банку в мережі Інтернет (http://www.aval.ua), та/або в\n        системі «Клієнт-Банк», та/або засобами телефонного зв’язку відповідальним співробітником Банку станом на дату\n        подання Заяви до Банку. Клієнт зобов’язується самостійно слідкувати за змінами курсу Банку до моменту виконання\n        Заяви та не має претензій до Банку стосовно значення курсу Банку. Якщо після подання Заяви до Банку Клієнт\n        не згоден зі змінами курсу Банку та/або бажає відкликати Заяву з інших причин, Клієнт повинен негайно, але до\n        моменту купівлі іноземної валюти на підставі цієї Заяви, відкликати Заяву. Банк повертає Заяву без виконання в\n        разі отримання від НБУ повідомлення про непідтвердження можливості здійснення відповідної операції з купівлі\n        іноземної валюти./\n    </p>\n    <p class="very_small" align="justify">\n        <span class="bold-text italic-text">Note:</span>The date of acceptance of the Application is the date of\n        receiving this Application by the Bank, provided that it was transferred not later than 12:00 of the relevant\n        business day. The Bank accepts the Application for execution only if the Client has provided the necessary\n        documents confirming the grounds for purchase of foreign currency in accordance with the Ukrainian law and the\n        Bank’s requirements. The Bank has the right to refuse accepting the Application for execution and/or to refuse\n        execution of the Application. The Application must be filled in the Ukrainian language. If the Client in the\n        line “Exchange rate in UAH” pointed out the option “According to the exchange rate of the Bank”, by signing\n        this Application the Client acknowledges that it is aware of the current rate of the Bank published on the\n        Bank’s web page on Internet (http: //www.aval.ua) and/or in the “Client-Bank” system, and/or by means of\n        telephone communication with the responsible employee of the Bank as of the date of submitting the Application\n        to the Bank. The Client agrees to independently monitor changes of the exchange rate of the Bank up to the\n        moment of execution of this Application and has no claims as to the value of the Bank’s exchange rate. If after\n        submitting the Application to the Bank the Client does not agree with changes of the exchange rate of the Bank\n        and/or intends to withdraw the Application from other reasons, the Client must immediately, but in any case by\n        the moment of purchase of the foreign currency on the basis of this Application, withdraw this Application.\n        The Bank rejects the Application in case of receiving the NBU’s letter about disconfirmation possibility to\n        purchase the foreign currency.\n    </p>\n</div>';
}),define("text!apps/ua_currency_purchase/templates/ua_currency_purchase_print_pdf.tmpl",[],function(){return"<html>\n<head>\n    <style type=\"text/css\">\n        article div, div td, div span, div p, div h3 {\n            font-family: 'Times Roman', 'Times New Roman', Georgia, serif;\n            font-size: 7pt;\n            word-wrap: break-word;\n            line-height: 1;\n        }\n        *.small, .small span {\n            font-size: 6pt;\n        }\n        *.very_small, .very_small span {\n            font-size: 4pt;\n        }\n        .onright {\n            text-align: right;\n        }\n        .border {\n            border: 1px solid black;\n        }\n        .centered, table.centered td {\n            text-align: center;\n        }\n        .bold-text {\n            font-weight: bold;\n        }\n        .italic-text {\n            font-style: italic;\n        }\n        .head, .head td {\n            font-size: 8pt;\n            font-weight: bold;\n        }\n        div.small div, div.very_small div {\n            font-size: 1em;\n            padding-left: 12px;\n        }\n\n        div.list div {\n            padding-left: 24px;\n        }\n        td.doc_ident {\n            padding: 2px;\n        }\n        div p {\n            padding-left: 12px;;\n        }\n        table {\n            width: 100%;\n            border-collapse: collapse;\n        }\n        table td {\n            padding: 2px;\n        }\n        .bbordered {\n            border-bottom: 1px solid black;\n        }\n        table.thick_bordered {\n            border-top: 2px solid black;\n            border-left: 2px solid black;\n        }\n        table.thick_bordered td {\n            border-right: 2px solid black;\n            border-bottom: 2px solid black;\n            font-size: 7pt;\n            valign: top;\n        }\n        td.prop_name {\n            font-weight: bold;\n        }\n        .cln_info_label {\n            width: 33%;\n        }\n        .cln_addr_label {\n            width: 35%;\n        }\n        .cln_edrpou_label {\n            width: 20%;\n        }\n        .cln_edrpou {\n            width: 12%;\n        }\n        .empl_info_label {\n            width: 40%;\n        }\n        .empl_info {\n            width: 60%;\n        }\n        .sum_and_curr_labels {\n            width: 45%;\n        }\n        .curr_sum {\n            width: 30%;\n        }\n        .currency_label {\n            width: 11%;\n        }\n        .currency {\n            width: 14%;\n        }\n        .purchase_reason {\n            margin-top: 3px;\n        }\n        .account_label {\n            width: 40.6%;\n        }\n        .account {\n            width: 23.3%;\n        }\n        .bank_code_label {\n            width: 22.2%;\n            text-align: left;\n            vertical-align: middle;\n        }\n        .bank_code {\n            width: 13.9%;\n            text-align: center;\n        }\n        div.small p, div.very_small p {\n            font-size: 1em;\n            padding-left: 12px;\n        }\n\n        div.list p {\n            padding-left: 12px;\n        }\n        .sign_column_1 {\n            width: 41.7%;\n        }\n        .seal {\n            width: 20.6%;\n            vertical-align: middle;\n        }\n        .sign_column_2 {\n            width: 37.7%;\n        }\n        table.sign td {\n            height: 20px;\n            border-width: 1px 0 1px 0;\n        }\n        td.sign {\n            text-align: center;\n            padding-top: 3px;\n        }\n        div.sign1, div.sign2 {\n            height: 18px;\n        }\n        td.sign div {\n            padding: 0 3px 0 3px;\n        }\n        div.for-service-info {\n            padding-top: 10px;\n            padding-left: 3px;\n        }\n        div table.serv-info-table {\n            border-top: 1px solid black;\n            border-left: 1px solid black;\n        }\n        div table.serv-info-table td {\n            border-right: 1px solid black;\n            border-bottom: 1px solid black;\n        }\n        div table.serv-info-table td {\n            font-size: 8pt;\n        }\n        div table.serv-info-table {\n            font-weight: 600;\n            width: 65%;\n        }\n        div.note p {\n            padding-left: 0px;\n        }\n        div.main {\n            height: 970px;\n        }\n        .empty_row {\n            height: 15px;\n        }\n    </style>\n</head>\n<body>\n<%= content_for_pdf %>\n</body>\n</html>"}),define("text!apps/ua_currency_purchase/css/ua_currency_purchase_print.css",[],function(){return"section.doc-print div.doc-div{\npadding:4mm 10mm 5mm 10mm;\nfont-size:10pt;\nposition:relative;\nline-height:1;\n}\nsection.doc-print div span{\nfont-size:1em;\n}\nsection.doc-print div p{\ntext-indent:12px;\nmargin-top:1px;\ntext-align:justify;\n}\nsection.doc-print div p.indented{\ntext-indent:0;\nmargin-left:12px;\n}\nsection.doc-print article .very_small{\nfont-size:0.45em;\n}\nsection.doc-print article *.small{\nfont-size:0.6em;\n}\nsection.doc-print article *.large{\nfont-size:0.8em;\n}\nsection.doc-print article div.head{\nfont-size:0.75em;\nfont-weight:bold;\n}\nsection.doc-print div.num_date_doc div.bbordered{\ndisplay:inline-block;\nfont-size:1em;\n}\nsection.doc-print div.num_date_doc div.bbordered:first-child{\nwidth:75px;\ntext-align:left;\n}\nsection.doc-print .thick_bordered,section.doc-print table.thick_bordered td{\nborder:2px solid black;\n}\nsection.doc-print table td{\nfont-size:0.7em;\nline-height:0.9em;\npadding:2px !important;\n}\nsection.doc-print table.thick_bordered td.prop_name{\nfont-weight:bold;\n}\n.cln_info_label{\nwidth:33%;\n}\n.cln_addr_label{\nwidth:35%;\n}\n.cln_edrpou_label{\nwidth:20%;\n}\n.cln_edrpou{\nwidth:12%;\n}\n.empl_info_label{\nwidth:40%;\n}\n.empl_info{\nwidth:60%;\n}\nsection.doc-print .empl_info,section.doc-print table.empl_info td{\nborder-top:none;\n}\n.sum_and_curr_labels{\nwidth:45%;\n}\n.curr_sum{\nwidth:30%;\n}\n.currency_label{\nwidth:11%;\n}\n.currency{\nwidth:14%;\n}\n.purchase_reason{\nmargin-top:3px;\n}\n.account_label{\nwidth:40.6%;\n}\n.account{\nwidth:23.3%;\n}\n.bank_code_label{\nwidth:22.2%;\ntext-align:left;\nvertical-align:middle;\n}\n.bank_code{\nwidth:13.9%;\ntext-align:center;\n}\n.sign_column_1{\nwidth:41.7%;\n}\n.seal{\nwidth:20.6%;\nvertical-align:middle;\n}\n.sign_column_2{\nwidth:37.7%;\n}\nsection.doc-print td.sign{\npadding:0 0.5em !important;\ntext-align:center;\nvertical-align:top;\n}\nsection.doc-print table.sign td{\nheight:20px;\nborder-right:none;\nborder-left:none;\nborder-top:1px solid black;\nborder-bottom:1px solid black;\n}\nsection.doc-print .text{\npadding:0 15px;\nfont-size:6pt;\n}\nsection.doc-print div.sign1,section.doc-print div.sign2{\nheight:1.5em;\nline-height:1.5em;\n}\nsection.doc-print div.sign1 span,section.doc-print div.sign2 span{\nfont-size:0.7em;\nline-height:1;\n}\ntd.fio_value{\nheight:24px;\nvertical-align:bottom;\n}\nsection.doc-print table.thick_bordered td.fio_value{\nborder-bottom:none;\n}\nsection.doc-print table div.fio_label{\nfont-style:italic;\nfont-size:0.6em;\nborder-bottom:1px solid black;\nmargin:0 7px;\nheight:22px;\n}\nsection.doc-print table.thick_bordered td.fio_label{\npadding-top:0 !important;\nborder-top:none;\nborder-bottom:none;\nheight:15px;\nfont-size:1em;\n}\nsection.doc-print table.thick_bordered td.sign_label{\nborder-top:none;\nfont-size:0.6em;\nfont-style:italic;\npadding:0 !important;\n}\n.empty_row{\nheight:15px;\n}\nsection.doc-print div.note p{\ntext-indent:0;\n}\nsection.doc-print div.note{\nposition:absolute;\nwidth:189mm;\nbottom:0;\npadding-bottom:6mm;\n}\ndiv.for-img{\ntop:145px;\n}\nsection.doc-print div.note .small{\nfont-size:0.55em;\n}\nsection.doc-print .border{\nborder:1px solid black;\n}\nsection.doc-print div.small div,section.doc-print div.very_small div{\nfont-size:1em;\npadding-left:12px;\n}\nsection.doc-print div.list div{\npadding-left:12px;\ntext-indent:12px;\n}\np.line-height-small{\nline-height:0.5;\n}\n"}),define("apps/ua_currency_purchase/ua_currency_purchase_print",["jquery","underscore","bifit","printUtils","appsPieces","commons/base_object/document/document_print_processor","text!apps/ua_currency_purchase/templates/ua_currency_purchase_print.tmpl","text!apps/ua_currency_purchase/templates/ua_currency_purchase_print_pdf.tmpl","text!apps/ua_currency_purchase/css/ua_currency_purchase_print.css"],function(a,b,c,d,e,f,g,h,i){"use strict";function j(a,b){f.call(this,a,b,i,h)}return j.prototype=Object.create(f.prototype),j.prototype.constructor=j,j.prototype.renderDocument=function(a,f){f.append('<div id="doc-div-'+a.id+'" class="doc-div"></div>');var h=f[0].querySelector("#doc-div-"+a.id);h.className=h.className+" "+a.type,h.innerHTML=b.template(g)(a.toJSON());var i=h.querySelector(".bank_info"),j=e.getMixedBankInfo(a.get("BNK_MFO")).then(function(b){i.innerHTML=a.get("BNK_NAME").trim()+", "+(b.addr||"")+" (далі - Банк)<br/>"+(b.nameLatin||"")+", "+(b.addrLatin||"")+' (hereinafter - the "Bank")'});this.printPromises.push(j);var k=d.dateToWords(a.get("DATE_DOC"));k=k.substring(0,k.length-3)+".",h.querySelector(".date-doc").innerHTML=k;var l=a.toFormattedJSON(),m=l.PURCHASE_RATE;if(m)h.querySelector(".purch_rate").innerText=m.replace(".",",");else{var n=c.translate("ua_currency_purchase",a.get("PURCHASE_RATE_KIND"),null,null,"uk").then(function(a){h.querySelector(".purch_rate").innerText=a});this.printPromises.push(n)}var o=e.getCurrencies().then(function(e){var f=a.get("PURCHASE_CURRENCY"),g=b.findWhere(e,{currency:f});g&&(h.querySelector("td.curr_sum").innerText=l.PURCHASE_SUM.replace(".",","),h.querySelector("td.curr_sum_in_words").innerText=d.amountToWords(c.removeThousandSeparator(l.PURCHASE_SUM),g))});this.printPromises.push(o),this.printPromises.push(d.addDocumentAdditionalInfo(h,a))},function(a){d.createPrintFormForPdf().then(function(b){var c=new j(b,a[0].type);c.run(a)})}}),define("apps/ua_currency_purchase/ua_currency_purchase_service",["thesaurusUtils"],function(a){"use strict";return{getPensionTax:function(){var b=a.getClientProp("documents.ua_currency_purchase.pension_tax"),c=parseFloat(+(b||"0"));return(isNaN(c)||0>c)&&(c=0),c.toFixed(2)}}}),define("apps/ua_currency_purchase/base_ua_currency_purchase_controller",["jquery","underscore","backbone","app","bifit","appsPieces","thesaurusUtils","collections/thesaurus","services/doc_permissions","commons/base_object/document/group_opers_document_controller","apps/ua_currency_purchase/ua_currency_purchase_model","apps/ua_currency_purchase/ua_currency_purchase_list_view","apps/ua_currency_purchase/ua_currency_purchase_filter_view","apps/ua_currency_purchase/ua_currency_purchase_item_view","apps/ua_currency_purchase/ua_currency_purchase_item_edit","apps/ua_currency_purchase/ua_currency_purchase_print","apps/ua_currency_purchase/ua_currency_purchase_service","text!apps/ua_currency_purchase/templates/ua_currency_purchase_list_item.tmpl","i18n!apps/ua_currency_purchase/nls/ua_currency_purchase"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){"use strict";var t=function(){return h.getThesaurus("cln_accounts").fetch()};return j.extend({tabsStatuses:{work:"0,1,2,3,4,6",executed:"5",selectedTab:"work"},Model:k,ListView:l,FilterView:m,View:n,Edit:o,docType:"ua_currency_purchase",nls:s,listItemTemplate:r,aliases:null,RATES:[{id:"1",label:s.rate0_label,value:s.rate0},{id:"2",label:s.rate1_label,value:s.rate1}],showDocumentEdit:function(a,b){h.getThesaurus("account_alias",!1).fetch().done(function(c){this.aliases=c,j.prototype.showDocumentEdit.call(this,a,b)}.bind(this))},viewDocumentOptions:function(){var a=j.prototype.viewDocumentOptions.call(this);return this.customViewDocumentOptions(a),a},customViewDocumentOptions:function(a){},editDocumentOptions:function(){var b=j.prototype.editDocumentOptions.call(this),c=a.Deferred();return f.setAccountComments(f.getAccounts()).done(function(a){b.accounts=a,b.rates=f.getAvailableRates(this.RATES),b.banks=f.getBanks(),b.accounts=f.getAccounts(),b.currencies=f.getCurrencies(),b.docType=this.docType,b.getMfo=f.getMfo,b.getParam=f.getParam,b.getClientOrBankParam=f.getClientOrBankParam,this.customEditDocumentOptions(b),c.resolve(b)}.bind(this)),c},customEditDocumentOptions:function(a){},reloadDocumentsList:function(a){d.mainLayout.actionBar.show(this.createActionBar(this.actionsList)),j.prototype.reloadDocumentsList.call(this,a)},prepareClientFields:function(a){var b=h.getThesaurus("clients").array[0];return a.CLN_NAME=b.name_cln,a.CLN_ADDR=b.addr_cln,a.CLN_PHONES=b.phone_cln,b},preparePurchaseRateKind:function(a){var c=a.PURCHASE_RATE_KIND||b.last(this.RATES).value;return e.translate("ua_currency_purchase",c)},prepareCommonFields:function(a){if(a.SALE_SUM=a.SALE_SUM?e.roundFloat(a.SALE_SUM,2):"",a.COMMISSION=a.COMMISSION?e.changeFloatScale(a.COMMISSION,3):"",a.PURCHASE_SUM=a.PURCHASE_SUM?e.roundFloat(a.PURCHASE_SUM,4):"",a.PENSION_TAX=q.getPensionTax(),a.BNK_MFO&&a.BNK_MFO.length>0){var c=b.findWhere(f.getBanks(),{bik:a.BNK_MFO});void 0!==c&&(a.BNK_ADDR=c.address.substr(0,80))}},preparePurchaseCurrency:function(a,c){var d=b.without(b.keys(c),"UAH").sort(),f=a.PURCHASE_CURRENCY||e.getStorageDocData(this.docType+"_purchase_currency");return f=b.contains(d,f)?f:d[0]},preparePurchaseAccountFields:function(a,c){a.PURCHASE_ACCOUNT=c.account,a.PURCHASE_BNK_MFO=c.mfo,a.PURCHASE_BNK_NAME=b.findWhere(f.getBanks(),{bik:c.mfo}).name},getContentFromForm:function(){return this.contentForSave=j.prototype.getContentFromForm.call(this),this.contentForSave.PURCHASE_SUM=e.removeThousandSeparator(this.contentForSave.PURCHASE_SUM),this.contentForSave.PURCHASE_SUM=e.changeFloatScale(this.contentForSave.PURCHASE_SUM,4),this.contentForSave.PURCHASE_RATE=e.removeThousandSeparator(this.contentForSave.PURCHASE_RATE),delete this.contentForSave.PURCHASE_RATE_KIND,this.contentForSave},PRINT:function(){this.printDocs([this.selectedModel])},SIGN:function(a){return t().then(function(){j.prototype.SIGN.call(this,a)}.bind(this))},prepareContent:function(c){var d=j.prototype.prepareContent.call(this,c);return a.when(d,t()).then(function(c){var d=a.Deferred(),e=this.mfoFieldsMap,f=[],g=b.keys(e);if(b.each(g,function(a){c[a]&&f.push(c[a])}),f.length>0){var i=b.unique(f),j="[0] IN ('"+i.join("', '")+"')";h.getThesaurus("ua_swift").fetch({data:{query:j,PAGE_NUMBER:0,PAGE_SIZE:i.length}}).done(function(a){var f={};b.each(a,function(a){f[a.code]=a.name}),b.each(e,function(a,b){c[a]=f[c[b]]||""}),d.resolve(c)})}else d.resolve(c);return d}.bind(this))},printDocs:function(a){var c=q.getPensionTax(),d=b.map(a,function(a){return a.clone().set("PENSION_TAX",c)});p(d,f.getCurrencies())},isAccountsForCreateAction:function(){var a,c,d,e=b.filter(h.getThesaurus("accs_info").array,function(a){return a.permissions>0&&"1"===a.type&&"2"===a.status}),f=b.groupBy(e,"mfo"),g=b.any(f,function(e){return a=b.groupBy(e,"currency"),c=a.UAH,d=b.without(b.keys(a),"UAH"),c&&c.length>0&&d&&d.length>0});return g},getWorkContent:function(a){var b=j.prototype.getWorkContent.call(this,a);return b.attaches=[],b.ATT_CNT="0",b},getNoAccErrorText:function(){return b.without(b.keys(f.getAccounts()),"UAH").length>0?s.no_uah_accs:s.no_cur_accs}})}),define("apps/ua_currency_purchase/ua_currency_purchase_controller",["underscore","jquery","bifit","app","appsPieces","apps/ua_currency_purchase/base_ua_currency_purchase_controller"],function(a,b,c,d,e,f){"use strict";var g=function(){return 4};return f.extend({mfoFieldsMap:{BNK_MFO:"BNK_NAME",RETURN_BNK_MFO:"RETURN_BNK_NAME",PURCHASE_BNK_MFO:"PURCHASE_BNK_NAME"},customViewDocumentOptions:function(a){a.getRatePrecision=g},customEditDocumentOptions:function(a){a.getRatePrecision=g},prepareContent:function(a){var d=f.prototype.prepareContent.call(this,a);return d.then(function(a){var d=b.Deferred();this.prepareClientFields(a);var e=this.preparePurchaseRateKind(a);return this.prepareCommonFields(a),a.PURCHASE_RATE=a.PURCHASE_RATE?c.changeFloatScale(a.PURCHASE_RATE,4):"",b.when(e).done(function(b){a.PURCHASE_RATE_KIND=b,d.resolve(a)}),d.promise()}.bind(this))},prepareContent4Create:function(a){var b=f.prototype.prepareContent4Create.call(this,a),c=this;return b.then(function(a){var b=e.getAccounts(),d=c.preparePurchaseCurrency.call(c,a,b),f=e.findAccount(b[d],a,"PURCHASE_ACCOUNT",c.docType+"_purchase_account");return!a.PURCHASE_ACCOUNT&&f?(a.PURCHASE_CURRENCY=d,c.preparePurchaseAccountFields(a,f)):f||(a.PURCHASE_CURRENCY=d),a.SALE_ACCOUNT_FROM||c.prepareAccountField(a,b,"SALE_ACCOUNT_FROM"),a.RETURN_ACCOUNT||c.prepareAccountField(a,b,"RETURN_ACCOUNT"),a})},prepareContent4Save:function(a){return"en"===localStorage.getItem("locale")?b.when(a).then(function(a){return a.PURCHASE_RATE_KIND=this.translatePurchaseRateKind(a),a}.bind(this)):a},prepareContent4Import:function(a){return"en"===localStorage.getItem("locale")?b.when(a).then(function(a){return a.PURCHASE_RATE_KIND=this.translatePurchaseRateKind(a),a}.bind(this)):a},translatePurchaseRateKind:function(b){var c=a.findWhere(this.RATES,{label:b.PURCHASE_RATE_KIND});return c?c.value:b.PURCHASE_RATE_KIND},prepareAccountField:function(a,b,c){var d=e.findAccount(b.UAH,a,c,this.docType+"_"+c.toLowerCase());d&&(a[c]=d.account)},prepareClientFields:function(a){var b=f.prototype.prepareClientFields.call(this,a);a.CLN_OKPO=b.okpo},getContentFromForm:function(){var a=f.prototype.getContentFromForm.call(this);return a.PURCHASE_RATE=c.changeFloatScale(a.PURCHASE_RATE,4),a.PURCHASE_ACCOUNT=this.model.get("PURCHASE_ACCOUNT"),a.SALE_ACCOUNT_FROM=this.model.get("SALE_ACCOUNT_FROM"),a.RETURN_ACCOUNT=this.model.get("RETURN_ACCOUNT"),a}})}),function(a){var b=document,c="appendChild",d="styleSheet",e=b.createElement("style");e.type="text/css",b.getElementsByTagName("head")[0][c](e),e[d]?e[d].cssText=a:e[c](b.createTextNode(a))}("#ext_filter .ua_currency_purchase #expanded-view{\nwidth:40.5em;\n}\n.ua_currency_purchase form > div.commission{\nclear:none;\n}\n.ua_currency_purchase div.amount .currency{\nwidth:4.7em;\n}\n.ua_currency_purchase div.amount,.ua_currency_purchase div.rate > label:not(:first-child),\n.ua_currency_purchase div.kind,.ua_currency_purchase .transf-kind > input.amount,\n.ua_currency_purchase div.account.return,.ua_currency_purchase div.account.funds{\nfloat:left;\n}\n.ua_currency_purchase div.account,.ua_currency_purchase div.additional div.exp-date,.ua_currency_purchase div.commission{\nfloat:right;\n}\n.ua_currency_purchase div.transf-kind div.chosen.first,.ua_currency_purchase #TRANSFER_KIND.first{\nmargin-left:0;\n}\n.ua_currency_purchase div.transit{\ndisplay:inline-block;\nwidth:9em;\nmargin-top:1.5em;\nmargin-bottom:0;\n}\n.ua_currency_purchase div.commission,\n.ua_currency_purchase #view #TRANSFER_KIND{\nmargin-top:1.5em;\nmargin-left:0.5em;\n}\n.ua_currency_purchase div.empl-info,.ua_currency_purchase .funds.container{\npadding-top:2.5em;\n}\n.ua_currency_purchase #PURCHASE_RATE_KIND{\nwidth:11em;\n}\n.purchase-rate-container{\ndisplay:inline-block;\nwidth:9em;\nmargin-left:4px;\nvertical-align:top;\n}\n.ua_currency_purchase #TRANSFER_KIND{\nwidth:16em;\n}\n.ua_currency_purchase input#SALE_SUM{\nmargin-right:1em;\n}\n.ua_currency_purchase div.transfer-kind-container{\ndisplay:inline-block;\nwidth:16em;\n}\n.ua_currency_purchase input#SALE_ACCOUNT.error{\nborder-color:#FF6666;\n}\n.ua_currency_purchase .rate .chosen{\nmargin-bottom:0;\n}\n.ua_currency_purchase div.additional div.date-doc{\nfloat:right;\nclear:none;\n}\n.main .ua_currency_purchase div.amount div.currency{\nfloat:none;\n}\n.main .ua_currency_purchase div.amount input.amount{\nwidth:11em;\n}\n.main .ua_currency_purchase div.amount{\nwidth:16em;\n}\n.ua_currency_purchase #FUND_ACCOUNT[disabled] + .drop-down{\ndisplay:none;\n}\n.ua_currency_purchase div.additional{\nmargin-bottom:0em;\n}\n.ua_currency_purchase div.additional + div.container{\nmargin-top:0em;\n}\n.ua_currency_purchase div.purchase div.chosen{\nfloat:right;\n}\ntable.ua_currency_purchase tr th.number{\nwidth:7%;\n}\ntable.ua_currency_purchase tr th.currency,\ntable.ua_currency_purchase tr th.status{\nwidth:9%;\n}\n.ua_currency_purchase div.datepicker-container{\nposition:relative;\n}\n.ua_currency_purchase div.datepicker-container > span.datepicker{\ntop:0.313em;\n}\n.ua_currency_purchase label{\nmargin-bottom:0.25em !important;\n}\n.ua_currency_purchase #status_desc{\nmargin-bottom:1em;\n}\n.ua_currency_purchase div.purchase-currency{\npadding-top:18px;\n}\n.ua_currency_purchase label.purchase-sum{\nwhite-space:nowrap;\n}\n.ua_currency_purchase input.purchase-rate-kind{\nwidth:100% !important;\n}\n.ua_currency_purchase .rate .chosen{\ndisplay:inline-block;\n}\n.ua_currency_purchase div.account{\nfloat:none;\n}\n.ua_currency_purchase div.transit{\ndisplay:block;\nmargin-top:0;\nmargin-bottom:0.75em;\nwidth:auto;\n}\n.ua_currency_purchase div.return-account > .account{\ndisplay:inline;\n}\n.ua_currency_purchase div.bank > .name{\nwidth:27.4em;\n}\n.ua_currency_purchase div.empl-info{\nmargin:0;\npadding-top:0;\n}\n.ua_currency_purchase .reference ol{\nlist-style-type:none;\ncounter-reset:item;\n}\n.ua_currency_purchase .reference ol li:before{\ncontent:counter(item) ' ';\ncounter-increment:item;\ncolor:#337ab7;\nposition:absolute;\nleft:-1em;\ntop:-0.4em;\n}\n.ua_currency_purchase .reference ol li{\nfont-size:0.7em;\nmargin-bottom:2em;\nmargin-left:2em;\nposition:relative;\n}\n.ua_currency_purchase #RETURN_ACCOUNT{\nwidth:18em;\n}\n");
define("commons/base_object/reference/reference_import_item_view",["underscore","rivets","marionette","text!templates/views/group-item.tmpl","i18n!nls/reference"],function(a,b,c,d,e){"use strict";return c.ItemView.extend({nls:null,itemName:null,message:null,tagName:"tr",template:a.template(d),templateHelpers:function(){return{text:this.importActionText}},initialize:function(){this.message={text:this.model.get("error")||"",status:""},this.model.on("model:completeSync",this.onModelSync,this),this.importActionText=this.nls.import_rcpt+' "'+this.model.get(this.itemName)+'"'},onShow:function(){b.bind(this.el,{message:this.message})},onModelSync:function(a,b,c){var d=a.has("error");this.message.text=d?a.get("error"):c,this.message.status=d?e.error_title:b},getViewInfo:function(){return{text:this.importActionText,code:this.message.status,error:this.message.text}}})}),define("text!templates/actionbar/reference/list.tmpl",[],function(){return'<li><button type="button" class="action create primary" data-action="create"\n            data-toggle="tooltip" data-trigger="hover" data-placement="bottom" title="<%- create %>"><%- create %></button></li>\n<li><button type="button" class="action export" data-action="doExport"\n            data-toggle="tooltip" data-trigger="hover" data-placement="bottom" title="<%- exportData %>"><%- exportData %></button></li>\n<li>\n    <button type="button" class="action import"\n            data-toggle="tooltip" data-trigger="hover" data-placement="bottom" title="<%- importData %>"><%- importData %></button>\n    <input type="file" class="file-dialog" data-action="doImport"/>\n</li>\n'}),define("text!commons/base_object/reference/templates/export_sub_menu.tmpl",[],function(){return'<div class="popup-wrapper bottom sub-menu">\n    <span class="popup-arrow"></span>\n    <span class="popup-arrow-border"></span>\n    <ul class="popup" style="white-space: nowrap">\n        <li class="popup-li"><a href="#" data-action="EXPORT_FILTER"><%- export_filter %></a></li>\n        <li class="popup-li"><a href="#" data-action="EXPORT_ALL"><%- export_all %></a></li>\n    </ul>\n</div>'}),define("commons/base_object/reference/reference_list_controller",["underscore","jquery","app","bifit","backbone","marionette","commons/base_object/base_list_controller","collections/editabled_thesaurus","models/reference","commons/base_object/reference/reference_import_item_view","dialogUtils","bifit","actionUtils","libs/multi_client_utils","views/document/aside-left","views/tree","views/group","commons/group_view","text!templates/actionbar/reference/list.tmpl","text!commons/base_object/reference/templates/export_sub_menu.tmpl","i18n!nls/reference","i18n!nls/common"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){"use strict";return g.extend({modelType:null,exchange:null,modelItemName:null,nls:null,supportsGroupOpers:!1,getGroupDeleteMessage:null,FilterView:null,itemFilterView:null,actionsList:[m.DocumentAction.CREATE.toString(),m.DocumentAction.IMPORT.toString(),"EXPORT_GROUP"],actionBarExportSubMenu:a.template(t,u),showListView:function(){this.collection=h.getThesaurus(this.modelType,this.supportsGroupOpers),this.itemFilterView=this.createFilterView(),c.mainLayout.showRegions({filter:this.itemFilterView,left:new p}),this.itemFilterView.loadButtonView.reload()},showGroupList:function(a){var b=new o,d=new q({title:a});return this.listenTo(b,"action:doAction",this.showListView),c.mainLayout.showRegions({left:b,content:d}),d},reloadReferenceList:function(b){this.canChooseItem!==!1&&(this.canChooseItem=!1,c.mainLayout.content.options.expectedType=this.modelType,this.collection.loaded=!1,this.collection.fetch(this.referenceReloadOptions(b)).then(function(){c.mainLayout.content.options.expectedType===this.modelType&&(c.mainLayout.content.show(this.createListView()),c.mainLayout.content.trigger("content:reloaded")),this.canChooseItem=!0;var b=this.actionsList;a.isEmpty(this.collection.models)&&(b=a.without(this.actionsList,"EXPORT_GROUP")),c.mainLayout.actionBar.show(this.createActionBar(b))}.bind(this)))},createFilterView:function(){if(this.FilterView){var a=new this.FilterView({collection:this.collection});return this.listenTo(a,"reload",this.reloadReferenceList),a}},referenceReloadOptions:function(a){return{data:a||{PAGE_NUMBER:0,PAGE_SIZE:100},reset:!0,silent:!0}},addListViewListeners:function(a){g.prototype.addListViewListeners.call(this,a),this.listenTo(a,"update-actions",this.updateActions)},updateActions:function(a){c.mainLayout.actionBar.show(this.createActionBar(a))},SAVE_IMPORT_RESULT:function(){g.prototype.SAVE_IMPORT_RESULT(u)},DO_IMPORT:function(a){var b=new FileReader,c=h.createThesaurus(this.modelType),d=function(a){a&&this.saveImportedValidModels(a)}.bind(this),e=a.target.files[0];b.onload=function(a){var b=[m.DocumentAction.SAVE_IMPORT_RESULT];this.importGroupViewInstance=this.importGroupView(c,b,e.name),this.exchange.doImport(a.target.result,c,d)||this.showListView()}.bind(this),b.readAsText(e,"Windows-1251")},saveImportedValidModels:function(a){var b=h.createThesaurus(this.modelType),c={silent:!0,success:function(a){a.has("error")||this.collection.add(a)}.bind(this),error:function(){k.alert(l.sprintf(u.import_error,u[this.modelType]||this.modelType))}.bind(this)};b.add(a.filter(function(a){return a._isValid}));var d=0,e=function(){if(!this.importGroupViewInstance.operationFinished)if(d<b.length){var a=b.at(d++);a.save(null,c),a.on("model:completeSync",e)}else this.importGroupViewInstance.addSummaryImportInfo(u),this.importGroupViewInstance.operationFinished=!0,this.toggleAllButtons(!1)}.bind(this);e()},importGroupView:function(a,b,d){var e=r.extend({title:this.nls.import_title,fileName:d}),f=new e({collection:a,operationType:"import",entityType:"directory_records",childView:j.extend({nls:this.nls,itemName:this.modelItemName})}),g=new o;return c.mainLayout.showRegions({actionBar:this.createActionBar(b||[]),content:f,left:g}),g.on("action:doAction",function(){var a=f.getRunningOperation();a?k.confirm(a.stopMsg,function(){a.stopOperation(),this.showListView()}.bind(this)):this.showListView()}.bind(this)),f},EXPORT_GROUP:function(a){d.showSubMenu(a)},doExport:function(a){this.exchange.doExport(a).done(function(a){var b=this.showGroupList(v["export"]+" "+u[this.modelType]),c=new e.Model;b.add(c,l.sprintf(this.exchange.nls.export_success,a)),c.trigger("model:completeSync",c,"ok")}.bind(this))},EXPORT_FILTER:function(){this.doExport(this.collection)},EXPORT_ALL:function(){this.getAllReference().done(function(a){this.doExport(a)}.bind(this))},getAllReference:function(a){var f=b.Deferred(),g=d.settings.server_addr+"/reference/"+this.modelType+";jsessionid="+d.getStoredItem("JSESSIONID"),h={url:g,type:"GET",data:{}},j=this.itemFilterView.getFilterQuery();j&&(h.data.query=j);var k=c.isMultiClient()&&!a?n.ajax(h):b.ajax(h);return k.done(function(a){var b=new(e.Collection.extend({model:i}))(a);b.comparator=this.collection.comparator,b.sortedInfo=this.collection.sortedInfo,f.resolve(b.sort())}.bind(this)),f},DELETE_GROUP:function(){var b=this.collection.selected,c=function(){var a=function(a,b){return b.add(a,this.getGroupDeleteMessage(a)),a.destroy({success:function(){a.trigger("model:completeSync",a,"Ok")},error:function(b){a.trigger("model:completeSync",a,"error",b.responseText)}},{silent:!0}),a};this.group(a,this.nls.group_view_delete_h1,b)},d=1===a.keys(b).length?this.nls.confirm_delete:this.nls.confirm_delete_many;k.confirm(d,c,!1,this)}})}),define("text!commons/base_object/reference/templates/filter.tmpl",[],function(){return'<div class="filter">\n    <h1 class="doc-type"><%- refTitle %></h1>\n<% if (clientName !== \'\') { %>\n    <div class="row form-group">\n        <div class="col-xs-12">\n            <a id="client-name" href="#"><%- clientName %></a>\n        </div>\n    </div>\n<% } %>\n    <div class="row form-group">\n        <div class="col-xs-9">\n            <div>\n            <input id="filter_value" type="text" placeholder="<%- value_placeholder %>">\n            </div>\n        </div>\n        <div class="col-xs-3">\n            <div>\n                <span id="load_button_component"></span>\n            </div>\n        </div>\n    </div>\n    <div class="row">\n        <div class="col-xs-6">\n            <div class="pagination" id="paginator">\n                <button id="first">&laquo;</button>\n                <button id="previous">&lsaquo;</button>\n                <input type="text" id="current_page" disabled="disabled"/>\n                <button id="next">&rsaquo;</button>\n                <button id="last">&raquo;</button>\n            </div>\n        </div>\n        <div class="col-xs-6">\n            <div class="items-amount">\n            <label><%- pageSize %></label>\n                <a href=\'#\' data-action="100" class="current">100</a>\n                <label>|</label>\n                <a href=\'#\' data-action="500">500</a>\n                <label>|</label>\n                <a href=\'#\' data-action="1000">1000</a>\n            </div>\n        </div>\n    </div>\n</div>'}),define("nls/paginator",{root:{showedPage:"Страница {1} из {2}",showedItemsAmount:"Записи с {1} по {2} из {3}",pageSize:"Количество на странице",net_error:"Ошибка подключения к банковскому серверу"},uk:!0,en:!0}),define("nls/uk/paginator",{showedPage:"Сторінка {1} з {2}",showedItemsAmount:"Записи з {1} по {2} з {3}",pageSize:"Кількість на сторінці",net_error:"Помилка підключення до банківського сервера"}),define("nls/en/paginator",{showedPage:"Page {1} of {2}",showedItemsAmount:"Records from {1} to {2} of {3}",pageSize:"Records per page",net_error:"Failed to connect to bank server"}),define("styles!css/paginator",[],function(){}),define("commons/base_object/reference/reference_filter_view",["jquery","app","underscore","marionette","dialogUtils","bifit","appsPieces","libs/multi_client_utils","components/load_button/load_button_view","text!commons/base_object/reference/templates/filter.tmpl","i18n!nls/paginator","styles!css/paginator"],function(a,b,c,d,e,f,g,h,i,j,k){"use strict";return d.LayoutView.extend({className:"reference-filter",template:c.template(j),currentPage:1,totalPages:-1,totalItems:-1,templateHelpers:function(){return c.extend({refTitle:this.refTitle,clientName:this.clientName,value_placeholder:this.value_placeholder},k)},queryTemplate:"",sortingFields:{},refTitle:"",value_placeholder:"",nls:{},filterValueLength:0,clientName:"",regions:{loadButton:"#load_button_component",paginator:"#paginator"},ui:{filterValue:"#filter_value"},events:{"click div.pagination button":"handlePagination","click div.items-amount a":"changePageSize"},cache:{},initialize:function(a){this.collection=a.collection},onShow:function(){this.ui.filterValue.prop("maxlength",this.filterValueLength),this.loadButtonView=new i,this.loadButton.show(this.loadButtonView),this.listenTo(this.loadButtonView,"reload",this.reloadList),this.listenTo(this.collection,"sync",this.onSyncEnd),this.listenTo(this.collection,"error",this.onSyncEnd),this.listenTo(b.mainLayout.content,"content:reloaded",function(){g.highlightFoundText(this.ui.filterValue.val(),"td, span.cell"),this.renderPaginationInfo()}.bind(this)),this.cache.filterValue&&this.ui.filterValue.val(this.cache.filterValue),this.toggleAmountItemsRef(this.cache.pageSize)},getFilterQuery:function(a){return a?this.ui.filterValue.val(this.cache.filterValue):this.cache.filterValue=this.ui.filterValue.val(),this.cache.filterValue?f.sprintf(this.queryTemplate,f.escapeSpecialChars(this.cache.filterValue)):""},reloadList:function(a){var b={PAGE_NUMBER:this.currentPage-1,PAGE_SIZE:this.cache.pageSize,sorting_fields:this.getSortingFields()},c=this.getFilterQuery(a===!1);c&&(b.query=c),a!==!1?(this.currentPage=1,this.loadThesaurusSize().then(function(){this.trigger("reload",b)}.bind(this))):this.trigger("reload",b)},onSyncEnd:function(){this.loadButtonView.onSyncEnd()},getSortingFields:function(){return this.sortingFields[this.collection.sortedInfo.field.toUpperCase()]+","},changePageSize:function(a){this.currentPage=1,a.preventDefault(),this.cache.pageSize=+a.target.getAttribute("data-action"),this.toggleAmountItemsRef(this.cache.pageSize),this.loadButtonView.animateButton(),this.reloadList(!1)},toggleAmountItemsRef:function(b){a(".items-amount a").removeClass("current"),a('.items-amount a[data-action="'+b+'"]').addClass("current")},handlePagination:function(a){var b=a.target.id;switch(b){case"first":if(1===this.currentPage)return;this.currentPage=1;break;case"last":if(this.currentPage>=this.totalPages)return;this.currentPage=this.totalPages;break;case"previous":if(1===this.currentPage)return;this.currentPage-=1;break;case"next":if(this.currentPage>=this.totalPages)return;this.currentPage+=1}this.loadButtonView.animateButton(),this.reloadList(!1)},loadThesaurusSize:function(b){var c={},d=this.getFilterQuery(!1);return d&&(c.query=d),((b||{}).emulateClientRequest?h:a).ajax({type:"GET",dataType:"json",url:f.settings.server_addr+"/reference/size/"+this.modelType+";jsessionid="+f.getStoredItem("JSESSIONID"),data:c,success:function(a){this.totalItems=a,this.renderPaginationInfo()}.bind(this),error:function(a){400!==a.status&&500!==a.status||e.alert(k.net_error)}.bind(this)})},renderPaginationInfo:function(){this.totalPages=Math.ceil(this.totalItems/this.cache.pageSize),this.renderFooter(),a("#current_page").val(f.sprintf(k.showedPage,this.currentPage,this.totalItems<this.cache.pageSize?1:this.totalPages))},renderFooter:function(){var b=0===this.totalItems?0:(this.currentPage-1)*this.cache.pageSize+1,c=this.totalItems<this.cache.pageSize||this.totalItems<b+this.cache.pageSize-1?this.totalItems:b+this.cache.pageSize-1;a("tfoot.summary tr td").html(f.sprintf(k.showedItemsAmount,b,c,this.totalItems)).trigger("footer:change",1)}})}),define("text!apps/recipients/templates/filter.tmpl",[],function(){return'<div class="filter">\n    <h1 class="doc-type"><%- RCPT_LIST_TITLE %></h1>\n    <% if (clientName !== \'\') { %>\n    <div class="row form-group">\n        <div class="col-xs-12">\n            <a id="client-name" href="#"><%- clientName %></a>\n        </div>\n    </div>\n    <% } %>\n    <div class="row form-group">\n        <div class="col-xs-6">\n            <div>\n                <input id="name-okpo-filter-value"\n                       type="text"\n                       placeholder="<%- name_okpo_filter_placeholder %>"\n                       maxlength="40">\n            </div>\n        </div>\n        <div class="col-xs-3">\n            <div>\n                <input id="account-filter-value"\n                       type="text"\n                       placeholder="<%- account_filter_placeholder %>"\n                       maxlength="14">\n            </div>\n        </div>\n        <div class="col-xs-2">\n            <div>\n                <span id="load_button_component" style="float: none"></span>\n            </div>\n        </div>\n        <div>\n            <div class="ext-filter-clear-button" data-toggle="tooltip" data-trigger="hover" data-placement="bottom"\n                 title="<%- reset_filter %>">&nbsp;</div>\n        </div>\n    </div>\n    <div class="row">\n        <div class="col-xs-6">\n            <div class="pagination" id="paginator">\n                <button id="first">&laquo;</button>\n                <button id="previous">&lsaquo;</button>\n                <input type="text" id="current_page" disabled="disabled"/>\n                <button id="next">&rsaquo;</button>\n                <button id="last">&raquo;</button>\n            </div>\n        </div>\n        <div class="col-xs-6">\n            <div class="items-amount">\n                <label><%- pageSize %></label>\n                <a href=\'#\' data-action="100" class="current">100</a>\n                <label>|</label>\n                <a href=\'#\' data-action="500">500</a>\n                <label>|</label>\n                <a href=\'#\' data-action="1000">1000</a>\n            </div>\n        </div>\n    </div>\n</div>'}),define("apps/recipients/nls/recipients",{root:{confirm_delete:"Вы действительно хотите удалить получателя?",confirm_delete_many:"Вы действительно хотите удалить выбранных получателей?",group_view_delete_h1:"Удаление получателей",delete_msg_template:"Удаление получателя {1}",name_okpo_filter_placeholder:"Введите наименование или ЕГРПОУ",account_filter_placeholder:"Введите счет",reset_filter:"Установить значения по умолчанию",incorrect_import_file:'Файл не является файлом импорта справочника "Получатели" в формате iBank2.',import_rcpt:"Импорт получателя ",error_title:"Ошибка",export_success:"Экспорт справочника получателей в файл <br/><b>{1}</b>",RCPT_TITLE:"Получатель",RCPT_LIST_TITLE:"Получатели",NAME:"Наименование",ACCOUNT:"Счет",PAYMENT_DETAILS:"Назначение платежа",EDRPOU:"ЕГРПОУ",MFO:"МФО",NOTE:"Примечание",ADD_REQUISITES:"Добавить реквизиты",SEVERAL_ACCOUNTS:"неск. счетов",ADD_COMMENT:"Новое назначение",DEL_COMMENT:"Удалить",to_bank:"Банк",field_name:"Наименование",field_bill:"Счет",field_comments:"Назначение",field_inn:"ЕГРПОУ",field_bic:"МФО",to_list:"Вернуться к списку",import_title:"Результат импорта получателей",empty_list:"Отсутствуют записи в справочнике получателей",dubl_rcpt:"Получатель с указанными реквизитами уже присутствует в справочнике получателей",optional:"необязательно"},uk:!0,en:!0}),define("apps/recipients/nls/uk/recipients",{confirm_delete:"Ви дiйсно бажаєте вилучити отримувача?",confirm_delete_many:"Ви дiйсно бажаєте вилучити обраних отримувачів?",group_view_delete_h1:"Видалення отримувачів",delete_msg_template:"Видалення отримувача {1}",name_okpo_filter_placeholder:"Введіть найменування або ЄДРПОУ",account_filter_placeholder:"Введіть рахунок",reset_filter:"Встановити значення за замовчуванням",incorrect_import_file:'Файл не є файлом iмпорту довідника "Отримувачі" у форматi iBank2.',import_rcpt:"Імпорт отримувача ",error_title:"Помилка",export_success:"Експорт довідника отримувачів у файл <br/><b>{1}</b>",RCPT_TITLE:"Отримувач",RCPT_LIST_TITLE:"Отримувачі",NAME:"Найменування",ACCOUNT:"Рахунок",PAYMENT_DETAILS:"Призначення платежу",EDRPOU:"ЄДРПОУ",MFO:"МФО",ADD_COMMENT:"Нове призначення",DEL_COMMENT:"Видалити",NOTE:"Примітка",ADD_REQUISITES:"Додати реквізити",SEVERAL_ACCOUNTS:"дек. рахунків",field_name:"Найменування",field_bill:"Рахунок",field_comments:"Призначення",field_inn:"ЄДРПОУ",field_bic:"МФО",to_list:"Повернутися до списку",import_title:"Результат імпорту отримувачів",empty_list:"Відсутні записи у довіднику одержувачів",dubl_rcpt:"Отримувач із зазначеними реквізитами вже присутній в довіднику отримувачів",optional:"не обов'язково"}),define("apps/recipients/nls/en/recipients",{confirm_delete:"Are you sure you want to delete the recipient?",confirm_delete_many:"Are you sure you want to delete selected recipients?",group_view_delete_h1:"Deleting of recipients",delete_msg_template:"Deleting of recipient {1}",name_okpo_filter_placeholder:"Enter name or EDRPOU",account_filter_placeholder:"Enter account",reset_filter:"Set default values",incorrect_import_file:"File is not the import file of recipients directory in the iBank2 format.",import_rcpt:"Import of recipient ",error_title:"Error",export_success:"Export of the recipients directory to the file <b>{1}</b>",RCPT_TITLE:"Recipient",RCPT_LIST_TITLE:"Recipients",NAME:"Name",ACCOUNT:"Account",PAYMENT_DETAILS:"Payment details",EDRPOU:"EDRPOU",MFO:"MFO",ADD_COMMENT:"New name",DEL_COMMENT:"Delete",NOTE:"Note",ADD_REQUISITES:"Add bank details",SEVERAL_ACCOUNTS:"sev. accounts",to_bank:"Bank",field_name:"Name",field_bill:"Account",field_comments:"Details",field_inn:"EDRPOU",field_bic:"MFO",to_list:"Back to the list",import_title:"Result import of recipients",empty_list:"There are no records in the recipients directory",dubl_rcpt:"Recipient with specified details already present in the recipients directory",optional:"optional"}),define("apps/recipients/recipients_filter_view",["jquery","underscore","bifit","app","appsPieces","commons/base_object/reference/reference_filter_view","components/load_button/load_button_view","text!apps/recipients/templates/filter.tmpl","i18n!apps/recipients/nls/recipients","formatter"],function(a,b,c,d,e,f,g,h,i){"use strict";var j="([0] has '{1}' || [1] hasi '{1}')",k="[2] has '{2}'";return f.extend({template:b.template(h),templateHelpers:function(){return b.extend({},f.prototype.templateHelpers(),i)},ui:{nameOkpoFilterValue:"#name-okpo-filter-value",accountFilterValue:"#account-filter-value",filterClearButton:".ext-filter-clear-button"},events:b.extend({"click @ui.filterClearButton":"resetFilter"},f.prototype.events),sortingFields:{INN:"0",NAME:"1",BILL:"2"},cache:{pageSize:100},onShow:function(){this.loadButtonView=new g,this.loadButton.show(this.loadButtonView),this.addFormatters(),this.listenTo(this.loadButtonView,"reload",this.reloadList),this.listenTo(this.collection,"sync",this.onSyncEnd),this.listenTo(this.collection,"error",this.onSyncEnd),this.listenTo(d.mainLayout.content,"content:reloaded",function(){this.highlightFoundText(),this.renderPaginationInfo()}.bind(this)),this.cache.nameOkpoFilterValue&&this.ui.nameOkpoFilterValue.val(this.cache.nameOkpoFilterValue),this.cache.accountFilterValue&&this.ui.accountFilterValue.val(this.cache.accountFilterValue),this.toggleAmountItemsRef(this.cache.pageSize),this.ui.filterClearButton.tooltip()},addFormatters:function(){this.ui.accountFilterValue.formatter("number")},getSortingFields:function(){return f.prototype.getSortingFields.call(this)+"6,"},renderFooter:function(){a(".summary").hide()},getFilterQuery:function(a){a?(this.ui.nameOkpoFilterValue.val(this.cache.nameOkpoFilterValue),this.ui.accountFilterValue.val(this.cache.accountFilterValue)):(this.cache.nameOkpoFilterValue=this.ui.nameOkpoFilterValue.val(),this.cache.accountFilterValue=this.ui.accountFilterValue.val());var b=[];if(this.cache.nameOkpoFilterValue&&b.push(j),this.cache.accountFilterValue&&b.push(k),b.length){var d="("+b.join(" & ")+")";return c.sprintf(d,c.escapeSpecialChars(this.cache.nameOkpoFilterValue),c.escapeSpecialChars(this.cache.accountFilterValue))}return""},highlightFoundText:function(){e.highlightFoundText(this.ui.nameOkpoFilterValue.val(),"td.rcpt, td.inn"),e.highlightFoundText(this.ui.accountFilterValue.val(),"td.bill")},resetFilter:function(){this.ui.nameOkpoFilterValue.val(""),this.ui.accountFilterValue.val(""),this.cache.nameOkpoFilterValue="",this.cache.accountFilterValue="",this.reloadList()}})}),define("commons/base_object/reference/group_opers_ref_list_view",["jquery","underscore","bifit","actionUtils","commons/base_object/base_list_view","libs/group_opers_utils"],function(a,b,c,d,e,f){"use strict";return e.extend({events:b.extend(e.prototype.events,{"click th.check input":"markAll"}),childEvents:b.extend(e.prototype.childEvents,{markOne:"markOne"}),initialize:function(a){e.prototype.initialize.apply(this,arguments),"false"!==c.getStorageData("is_need_deselect_selected_items")&&b.each(this.collection.selected,function(a){this.collection.deselect(a)}.bind(this)),c.setStorageData("is_need_deselect_selected_items","true")},selectItem:function(a,b){e.prototype.selectItem.call(this,a,b),c.setStorageData("is_need_deselect_selected_items","false")},onRender:function(){e.prototype.onRender.call(this),this.prepareTable()},prepareTable:function(){f.prepareTable.call(this),this.postModelMark()},markOne:f.markOne,markAll:f.markAll,postModelMark:function(){var a=this.collection.selectedLength>0,b=this.getReferenceListActions(),c=this.collection.length===this.collection.selectedLength;this.$("th.check input")[c?"removeClass":"addClass"]("some"),this.$("th.check input").prop("checked",a),this.trigger("update-actions",b)},getReferenceListActions:function(){return this.collection.selectedLength>0?["DELETE_GROUP"]:[d.DocumentAction.CREATE,d.DocumentAction.IMPORT,"EXPORT_GROUP"]}})}),define("commons/base_object/group_opers_list_item_view",["commons/base_object/base_list_item_view"],function(a){"use strict";return a.extend({triggers:{"click td:not(.check)":"selectItem"},events:{"click td.check input":function(a){this.trigger("markOne",a)}}})}),define("text!apps/recipients/templates/list.tmpl",[],function(){return'<table id="rcpts" class="list recipient">\n    <thead class="widescreen">\n    <tr>\n        <th class="check">\n            <input type="checkbox"/>\n            <span class="checkbox"></span>\n        </th>\n        <th class="rcpt">\n            <span class="sortable" data-field="name"><%- NAME %></span>\n        </th>\n        <th class="bill">\n            <span class="sortable" data-field="bill"><%- ACCOUNT %></span>\n        </th>\n        <th class="inn">\n            <span class="sortable" data-field="inn"><%- EDRPOU %></span>\n        </th>\n        <th class="empty"></th>\n    </tr>\n    </thead>\n    <tbody></tbody>\n    <tfoot class="summary">\n    <tr>\n        <td colspan="6"></td>\n    </tr>\n    </tfoot>\n</table>\n'}),define("text!apps/recipients/templates/list-item.tmpl",[],function(){return'<td class="check widescreen"><input type=\'checkbox\'/><span class="checkbox"></span></td>\n<td class="rcpt ellipsis widescreen"><%- name %></td>\n<td class="bill widescreen"><%- bill %></td>\n<td class="inn widescreen"><%- inn %></td>\n<td class="empty"></td>\n<td class="mobile">\n    <span class="rcpt ellipsis"><%- name %></span>\n    <span class="status"><%- bill %></span>\n</td>\n'}),define("apps/recipients/recipients_list_view",["underscore","commons/base_object/reference/group_opers_ref_list_view","commons/base_object/group_opers_list_item_view","text!apps/recipients/templates/list.tmpl","text!apps/recipients/templates/list-item.tmpl","i18n!apps/recipients/nls/recipients"],function(a,b,c,d,e,f){"use strict";return b.extend({template:a.template(d),className:"reference",templateHelpers:f,childView:c.extend({template:a.template(e)})})}),define("commons/base_object/reference/reference_exchange",["jquery","underscore","backbone","bifit","dialogUtils","models/reference","i18n!nls/common"],function(a,b,c,d,e,f,g){"use strict";return{mapping:{},nls:{},exportType:"",modelType:"",saveParams:{defaultFileName:"export.txt",fileMask:'{"text":"'+g.export_ref_types+'","pattern":"*.txt"}',fileType:"txt"},_exportModel:function(a){var c="\n";return b.each(this.mapping,function(b){c+=b.exp+"="+(a.get(b.ref)||"")+"\n"}),c},doExport:function(a,c){var e=c||"Content-Type=ref/"+this.exportType+"\n";return b.each(a.models,function(a){e+=this._exportModel(a)},this),SignPluginServices.saveFile(b.extend({title:g.export_title,data:window.btoa(d.utf8_decode_win1251(e.split("\n").join("\r\n")))},this.saveParams))},doImport:function(a,c,d){a=a.split("\r").join("");var f=a.split("\n"),g=[];if(b.each(f,function(a,c){g=a.split("="),g.length>1&&(g[1]=g[1].replace(/[\u0009]/g," ")),f[c]=b.map(g,function(a){return a.trim()}).join("=")}),f.length<2||f[0]!=="Content-Type=ref/"+this.exportType||""!==f[1])return e.alert(this.nls.incorrect_import_file),!1;var h=[],i=b.object(b.pluck(this.mapping,"exp"),b.pluck(this.mapping,"ref")),j=f.slice(2);return b.each(j,function(a,d){if(0!==a.length&&h.push(a.split("=",2)),h.length>0&&(0===a.length||d===j.length-1)){var e=b.chain(h).filter(function(a){return b.isString(i[a[0]])}).map(function(a){return[i[a[0]],a[1]]}).object().value();c.push(this.createModel(e)),h=[]}}.bind(this)),this._processReference(c,d),!0},createModel:function(a){var b=new f({refType:this.modelType},{isNew:!0});return b.set(a),b},_processReference:function(a,b){return b.call(this,this._validateRefs(a)),!0},_validate:function(a){return a.validateModel()},_validateRefs:function(a){var c=[];return b.each(a.models,function(a){a.enableValidation(),this._validate(a,c)&&c.push(a)},this),a}}}),define("apps/recipients/recipients_exchange",["jquery","underscore","app","commons/base_object/reference/reference_exchange","collections/editabled_thesaurus","models/reference","collections/thesaurus","i18n!apps/recipients/nls/recipients"],function(a,b,c,d,e,f,g,h){"use strict";var i=function(a,b){return a.get(b)||""},j={nls:h,exportType:c.isMultiClient()?"ua_mrecipient":"recipient",modelType:"ua_recipients",mapping:[{exp:"RCPT_INN",ref:"inn"},{exp:"RCPT_NAME",ref:"name"},{exp:"RCPT_ACCOUNT",ref:"bill"},{exp:"RCPT_BANK_BIC",ref:"bic"},{exp:"PAYMENT_DETAILS",ref:"comments"},{exp:"NOTE",ref:"note"}],_exportModel:function(a){var c="",d="RCPT_INN="+i(a,"inn")+"\n";return d+="RCPT_NAME="+i(a,"name")+"\n",b.each(a.get("requisites"),function(a){c+="\n"+d+"RCPT_BANK_BIC="+(a.bic||"")+"\nRCPT_ACCOUNT="+(a.bill||"")+"\nPAYMENT_DETAILS="+(a.comment||"")+"\nNOTE="+(a.note||"")+"\n"}),c},createModel:function(a){a.requisites=[{id:"",bic:a.bic||"",bill:a.bill||"",comment:a.comments||"",note:a.note||""}];var b=new f({refType:this.modelType},{isNew:!0});return b.set(a),b},_processReference:function(a,c){var d="",e=[];a.forEach(function(a){var b=a.get("bic");-1===e.indexOf(b)&&(d&&(d+=" || "),d+="[0]=='"+b+"'",e.push(b))}),g.getThesaurus("ua_swift").fetch({data:{query:d,PAGE_NUMBER:0,PAGE_SIZE:e.length}}).done(function(d){var e={};b.each(d,function(a){e[a.code]=a.name}),a.forEach(function(a){a.set("rcpt_bnk_name",e[a.get("bic")]||"")}),c.call(this,this._validateRefs(a))}.bind(this))},_validate:function(a,c){if(!a.validateModel())return!1;var d=b.union(e.getThesaurus(this.modelType).models,c),f=!b.any(d,function(b){return a.cid!==b.cid&&a.get("inn")===b.get("inn")&&a.get("bill")===b.get("bill")&&a.get("bic")===b.get("bic")},this);return f||(a._isValid=!1,a.trigger("model:completeSync",a,h.error_title,h.dubl_rcpt)),f.dubl_rcpt}};return b.extend({},d,j)}),define("apps/recipients/recipients_list_controller",["bifit","commons/base_object/reference/reference_list_controller","commons/empty_list_view","apps/recipients/recipients_filter_view","apps/recipients/recipients_list_view","apps/recipients/recipients_exchange","i18n!apps/recipients/nls/recipients"],function(a,b,c,d,e,f,g){"use strict";return b.extend({ListView:e,FilterView:d.extend({modelType:"ua_recipients"}),EmptyView:c.extend({message:g.empty_list}),modelType:"ua_recipients",exchange:f,modelItemName:"name",nls:g,supportsGroupOpers:!0,getGroupDeleteMessage:function(b){var c=b.get("name");return a.sprintf(g.delete_msg_template,c)},getAllReference:function(){return b.prototype.getAllReference.call(this,!0)},showItemView:function(a){require(["apps/recipients/recipients_item_controller"],function(b){var c=new b;c.showItemView(a.get("id"))})},CREATE:function(){require(["apps/recipients/recipients_edit_controller"],function(a){var b=new a;b.showCreateView()})}})}),function(a){var b=document,c="appendChild",d="styleSheet",e=b.createElement("style");e.type="text/css",b.getElementsByTagName("head")[0][c](e),e[d]?e[d].cssText=a:e[c](b.createTextNode(a))}(".pagination{\nborder:1px solid #CDCDCD;\nborder-radius:3px;\nmargin-top:1em;\n}\n.pagination button{\nfloat:left;\nwidth:40px;\nheight:20px;\nline-height:2px;\nborder-right:1px solid #CDCDCD;\nborder-left:1px solid #CDCDCD;\nborder-bottom:none;\nborder-top:none;\ncolor:#555555;\n}\n.pagination button:first-child{\nborder:none;\n}\n.pagination button#last{\nborder:none;\n}\n.pagination input#current_page{\nfloat:left;\nwidth:150px;\nheight:20px;\nline-height:1em;\ntext-align:center;\nbackground-color:white;\n}\ndiv.items-amount a{\nmargin:0.25em;\n}\ndiv.items-amount label:not(:first-child){\nvertical-align:top;\n}\ndiv.items-amount a.current{\ncolor:#000000;\n}\ndiv.items-amount{\nmargin-top:1em;\n}");
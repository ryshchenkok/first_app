define("commons/base_object/document/group_opers_document_controller",["jquery","underscore","bifit","app","dialogUtils","thesaurusUtils","libs/multi_client_utils","actionUtils","collections/thesaurus","commons/base_object/document/document_controller","commons/base_object/document/confirm_reason_view","i18n!nls/document"],function(a,b,c,d,e,f,g,h,i,j,k,l){return j.extend({getListViewOptions:function(){return j.prototype.getListViewOptions.call(this)},addListViewListeners:function(a){j.prototype.addListViewListeners.call(this,a),this.listenTo(a,"update-actions",this.updateActions)},updateActions:function(a){d.mainLayout.actionBar.show(this.createActionBar(a))},COPY_GROUP:function(){var e=new this.Model({type:this.docType}),f=b.groupBy(this.collection.selected,function(a){return a.get("owner_id")}),h=0,j=this,k=b.size(f),m=b.keys(f),n=!1,o=this.showGroupList(l.group_view_copy_h1,{stopOperation:function(){n=!0},entityType:"documents",operationType:"copying"}),p=function(){if(k>h&&!n){var q=m[h++],r=f[q],s=d.isMultiClient()?g.loadTemplate(!1,q,e):e.loadTemplate();s.done(function(e){var f,h=[],k=function(a,b){var d,e=j.getWorkContent(a).NUM_DOC,f=b||e+"/C",g=j.getCurrencyName(a.getCurrency());return d=a.getFAmount()?c.sprintf(l.group_view_copy,e,a.getFAmount(),g,f):c.sprintf(l.group_view_copy_2,e,f)},m=0,s=function(){if(!n)if(m<h.length){var a=h[m++];a.on("model:completeSync",s),a.save({},{silent:!0,emulateClientRequest:d.isMultiClient()})}else p()},t=b.size(r);if(d.isMultiClient()){var u=b.findWhere(i.getThesaurus("sub_clients").array,{client_id:q}),v=r[0].attributes,w=(u||{}).name_cln||v.CLN_NAME||v.PAYER_NAME||v.SENDER,x={statusHandlers:{403:function(a){b.each(r,function(b){var c=k(b);o.add(b,c),b.trigger("model:completeSync",b,l.error,a,403)})}}};f=g.loadSubClientData(q,w,x)}else f=a.Deferred().resolve();f.then(function(){var a=function(b){var c=r[b],d=j.getWorkContent(c),f=d.NUM_DOC;j.prepareContent4Save(j.prepareContent4Create(d)).then(function(d){d.NUM_DOC=""+(e.N?e.N++:f+"/C");var g=new j.Model(d,{silent:!0}),i=k(c,d.NUM_DOC);return j.isAccountsForCreateAction()?(o.add(g,i),h.push(g),void(b===t-1?s():b%100===0?setTimeout(a.bind(this,++b),0):a(++b))):(o.add(g,i),void g.trigger("model:completeSync",g,j.getNoAccErrorText()))})};a(0)})})}};p()},DELETE_GROUP:function(){var a=this.collection.selected,c=function(){var c=!1,e=this.group(function(a,b){this.addModelToGroupView(a,b,"delete")}.bind(this),l.group_view_delete_h1,a,{stopOperation:function(){c=!0},entityType:"documents",operationType:"deleting"}),f=b.pluck(e.children,"model"),g=0,h=function(){if(g<f.length&&!c){var a=f[g++];d.isMultiClient()&&(d.multiClient.currentSubClientId=a.get("owner_id"));var e={statusHandlers:{403:function(a){h()}}};a.destroy(b.extend(e,{silent:!0,wait:!0,emulateClientRequest:d.isMultiClient(),success:function(){a.trigger("model:completeSync",a,"Ok"),h()},error:function(){h()}}))}};h()},f=1===b.keys(a).length?l.confirm_delete_doc:l.confirm_delete_many_doc;e.confirm(f,c,!1,this)},SIGN_GROUP:function(){var e=this.collection.urlRoot+this.docType+"/sign/",i=";jsessionid="+c.getStoredItem("JSESSIONID"),j=b.values(this.collection.selected),k=0,m=!1,n=function(){if(k<j.length&&!m){var o=j[k++],p=o.get("attaches");if(!b.isEmpty(p))for(var q=f.getClientProp("documents.attachments.extensions"),r=0;r<p.length;r++)if(!c.checkAttachExtension(p[r].name,q))return o.trigger("model:completeSync",o,l.error,c.sprintf(l.attach_has_not_allowed_extension,q)),void n();var s=b.isEmpty(p)?a.when():this.loadAndSetAttachesContent(o),t=s.then(function(){var a=this.signData(o);return{content:this.prepare4Sign(a),id:o.get("id")}}.bind(this),function(a){o.trigger("model:completeSync",o,l.error,c.sprintf(l.attach_load_error,a.name)),n()}),u=function(b){SignPluginServices.signData(b.content).then(function(c){a.ajax({type:"POST",dataType:"json",url:e+b.id+i,data:JSON.stringify({id:b.id,sign:c.sign,timestamp:c.timestamp}),success:function(a){o.set(a,{silent:!0}),o.trigger("model:completeSync",o,"Ok","",200),n()},error:function(a){o.trigger("model:completeSync",o,l.error,a.responseText,a.status),n()}})})},v=function(a,c){var d=b.contains(["2","2002","3004"],o.get("status"));if(d||a===w.length)return o.trigger("model:completeSync",o,"Ok","",200),void n();var f=parseInt(o.get("sign_groups_mask"));return h.hasSignOfGroup(f,w[a].GR)?void v(a+1,c):void g.useKey(w[a].ID).then(function(){SignPluginServices.signData(c.content).then(function(b){g.ajax({type:"POST",dataType:"json",url:e+c.id,data:JSON.stringify({id:c.id,sign:b.sign,timestamp:b.timestamp}),currentSubClientKeyId:w[a].ID,success:function(b){return o.set(b,{silent:!0}),b.error&&a<w.length-1?(o.trigger("model:completeSync",o,l.error,b.error,200),void n()):void v(a+1,c)},error:function(a){o.trigger("model:completeSync",o,l.error,a.responseText,a.status),n()}})})})};if(d.isMultiClient())if(-1===this.docType.indexOf("budget")){var w=g.getKeysListLocatedMultiClient(o.get("owner_id"));t.then(v.bind(this,0))}else g.useMultiClientKey().then(function(){t.then(u)});else t.then(u)}}.bind(this);this.group(function(a,b){this.addModelToGroupView(a,b,"sign"),j.length===b.children.length&&n()}.bind(this),l.group_view_sign_h1,j,{stopOperation:function(){m=!0},entityType:"documents",operationType:"signing"})},addModelToGroupView:function(a,b,d){var e,f=a.get("NUM_DOC"),g=a.getFAmount(),h="";g?(e="sign"===d?l.group_view_sign:l.group_view_delete,h=c.sprintf(e,f,g,this.getCurrencyName(a.getCurrency()))):(e="sign"===d?l.group_view_sign_2:l.group_view_delete_2,h=c.sprintf(e,f)),b.add(a,h)},REJECT_GROUP:function(){var a=new k({el:e.wrapper(),templateHelpers:{maxLength:200,title:l[1===this.collection.selectedLength?"reject_doc_title":"reject_docs_title"],ok_button_name:l.reject_link_btn,cancel_button_name:l.close_link_btn}}).render();a.on("confirm",this.groupRejectRequest,this)},groupRejectRequest:function(d){var e=b.values(this.collection.selected),f=0,g=!1,h=function(){if(f<e.length&&!g){var b=e[f++];a.ajax({type:"PUT",contentType:"application/json",data:d||"",url:this.collection.urlRoot+this.docType+"/"+b.get("id")+"/reject"+b._session(),success:function(a){b.set(a,{silent:!0}),a.error?b.trigger("model:completeSync",b,l.error,a.error,200):b.trigger("model:completeSync",b,"Ok","",200),h()}.bind(this),error:function(a){b.trigger("model:completeSync",b,"documentNls.error",a.responseText,a.status),h()}.bind(this)})}}.bind(this);this.group(function(a,b){var d=a.get("NUM_DOC");b.add(a,c.sprintf(l.group_view_reject,d)),e.length===b.children.length&&h()},l.group_view_reject_h1,e,{stopOperation:function(){g=!0},entityType:"documents",operationType:"rejecting"})},prepareDeferredForModelsFetch:function(c){var d=a.Deferred(),e=b.values(this.collection.selected),f=0,g=function(){if(f<this.collection.selectedLength){var a=e[f++];!c||c(a)?(this.listenToOnce(a,"model:completeSync",function(){g()}),a.fetch()):g()}else d.resolve()}.bind(this);return g(),d},PRINT_GROUP:function(a){a.stopPropagation(),this.printDocs(b.values(this.collection.selected))},printDocs:function(){}})}),define("apps/ua_currency_sale/nls/ua_currency_sale_base",{root:{no_uah_accs:"Невозможно создать документ. Отсутствует текущий счет в национальной валюте.",no_cur_accs:"Невозможно создать документ. Отсутствует текущий счет в иностранной валюте.",number:"Номер",date:"Дата",sale_account:"Валютный счет",amount:"Сумма",currency:"Валюта",status:"Статус",payer:"Плательщик",ua_currency_sale:"Продажа валюты",ua_currency_sale_list:"Продажа валюты",num_doc:"Номер",cln_fio:"Уполномоченный сотрудник компании",phone:"Телефон",from_acc:"со счета",on_acc:"на счет",date_doc:"Дата документа",rate1:"по курсу уполномоченного банка",sale_amount:"Прошу продать",purchase_amount1:"Сумму в гривне",purchase_amount2:"поручаю зачислить в банк",purchase_amount3:"Соответствующую сумму в гривне поручаю зачислить в банк",value_date:"Дата валютир.",valid_till:"Срок действия",purpose:"Цель продажи",not_required:"необяз.",current:"текущая",autonum:"автонумер.",fio_placeholder:"ФИО (необяз.)",phone_placeholder:"тел. (необяз.)",bank_name:"наименование",bank_mfo:"МФО",amount_in:"Сумму в",enroll_to_account:"со счета",not_acount_for_cur:"Отсутствуют права на работу со счетами в выбранной валюте",field_NUM_DOC:"Номер документа",field_DATE_DOC:"Дата документа",field_CLN_NAME:"Наименование клиента",field_CLN_ADDR:"Адрес клиента",field_CLN_PHONES:"Контактный телефон клиента",field_CLN_EMPLOYEE_FIO:"Ф.И.О. ответственного сотрудника клиента",field_CLN_EMPLOYEE_PHONE:"Контактный телефон ответственного сотрудника клиента",field_BNK_NAME:"Наименование уполномоченного банка",field_BNK_MFO:"МФО уполномоченного банка",field_SALE_SUM:"Сумма продаваемой иностранной валюты",field_SALE_CURRENCY:"Код продаваемой иностранной валюты",field_SALE_ACCOUNT:"Счет для списания валюты",field_SALE_KIND:"Флаг перечисления на банковский счет для продажи иностранной валюты",field_SALE_BNK_ACCOUNT:"Банковский счет для продажи иностранной валюты",field_SALE_RATE_KIND:"Вариант выбора курса продажи иностранной валюты",field_SALE_RATE:"Курс продажи иностранной валюты",field_PURCHASE_SUM:"Сумма гривен для зачисления",field_PURCHASE_ACCOUNT:"Счет клиента для зачисления гривен",field_PURCHASE_BNK_NAME:"Наименование банка, в котором открыт счет клиента для зачисления гривен",field_PURCHASE_BNK_MFO:"МФО банка, в котором открыт счет клиента для зачисления гривен",field_COMMISSION:"Комиссия уполномоченного банка",field_RETURN_ACCOUNT:"Счет клиента для возврата иностранной валюты",field_EXPERIENCE_DATE:"Срок действия Заявления",field_CURRENCY_DATE:"Дата валютирования",footer_s_template:"{1} {2} {3} из {4}",footer_selected_sin:"Выбрано",footer_selected_pl:"Выбрано",footer_1_doc:"заявление",footer_1_doc_pl:"заявление",footer_2_4_docs:"заявления",footer_5_0_docs:"заявлений"},uk:!0,en:!0}),define("apps/ua_currency_sale/nls/ua_currency_sale",["underscore","apps/ua_currency_sale/nls/ua_currency_sale_base"],function(a,b){"use strict";return{root:a.extend({},b.root,{ua_currency_sale:"Заявление о продаже валюты",ua_currency_sale_list:"Заявление о продаже валюты",enroll_to_account:"Необходимую сумму поручаем Банку списать со счета",sale_amount:"Просим продать",value_date:"Дата валютирования",rate0:"по курсу",rate0_label:"по курсу",rate1_label:"по курсу уполномоченного банка",purchase_amount3:"Банк",return_account:"В случае невозможности выполнить заявление средства просим вернуть на счет",commission:"Комиссию поручаем Банку",commission_kind_1:"удержать из средств, полученных от продажи валюты",commission_kind_2:"списать со счета зачисления грн. средств",today:"сегодня",tomorrow:"завтра",spot:"спот",account:"Счет",on_acc:"Сумму в гривнах поручаю зачислить на счет",sale_purpose_11:"продано валютную выручку",sale_purpose_12:"продано инвестиционные средства, которые поступили из-за границы",sale_purpose_13:"продано кредит, выданый банком клиенту",sale_purpose_14:"продажа иностранной валюты, ранее купленной на межбанковском валютном рынке, которая не была использована по назначению, в том числе возвращена нерезидентом в связи с невыполнением последним своих обязательств",sale_purpose_15:"продано собственные средства банка (в том числе продано валюту с целью уменьшения валютной позиции банка)",sale_purpose_16:"продано с другой целью",sale_purpose_18:"продано кредитные средства, полученные банком от нерезидента",sale_purpose_19:"продано кредитные средства, полученные клиентом банка от нерезидента",field_SALE_CODE_REASON:"Код причины продажи валюты",field_SALE_REASON:"Причина продажи валюты",field_VALUE_DATE:'Дата валютирования. Возможные варианты "сегодня", "завтра", "спот"',field_CLN_OKPO:"Код ЕГРПОУ клиента",field_SALE_BNK_NAME:"Наименование Банка для продажи иностранной валюты",field_SALE_BNK_BIC:"МФО Банка для продажи иностранной валюты",field_COMMISSION_ACCOUNT:"Гривневый счет для списания комиссии",field_COMMISSION_BNK_MFO:"МФО банка, в котором открыт гривневый счет для списания комиссии",field_COMMISSION_BNK_NAME:"Наименование банка, в котором открыт гривневый счет для списания комиссии",field_COMMISSION_BNK_ADDR:"Адрес банка с коммиссионным счетом"}),uk:!0,en:!0}}),define("apps/ua_currency_sale/nls/uk/ua_currency_sale_base",{no_uah_accs:"Неможливо створити документ. Вiдсутнiй поточний рахунок у національній валютi.",no_cur_accs:"Неможливо створити документ. Вiдсутнiй поточний рахунок в iноземнiй валютi.",number:"Номер",date:"Дата",sale_account:"Валютний рахунок",amount:"Сума",currency:"Валюта",status:"Статус",payer:"Платник",ua_currency_sale:"Продаж валюти",ua_currency_sale_list:"Продаж валюти",num_doc:"Номер",cln_fio:"Уповноважений співробітник компанії",phone:"Телефон",from_acc:"з рахунку",on_acc:"на рахунок",date_doc:"Дата документа",rate1:"за курсом уповноваженого банку",sale_amount:"Прошу продати",purchase_amount1:"Суму в гривнях",purchase_amount2:"доручаю зарахувати в банк",purchase_amount3:"Відповідну суму в гривнях доручаю зарахувати в банк",value_date:"Дата валютув.",valid_till:"Термін дії",purpose:"Мета продажу",not_required:"не обов’яз.",current:"поточна",autonum:"автонумер.",fio_placeholder:"ПІБ (не обов’яз.)",phone_placeholder:"тел. (не обов’яз.)",bank_name:"найменування",bank_mfo:"МФО",amount_in:"Суму в",enroll_to_account:"з рахунку",not_acount_for_cur:"Відсутні права на роботу з рахунками в обраній валюті",field_NUM_DOC:"Номер документа",field_DATE_DOC:"Дата документа",field_CLN_NAME:"Найменування клієнта",field_CLN_ADDR:"Адреса клієнта",field_CLN_PHONES:"Контактний телефон клієнта",field_CLN_EMPLOYEE_FIO:"П.І.Б. уповноваженого працівника",field_CLN_EMPLOYEE_PHONE:"Контактний телефон уповноваженого працівника",field_BNK_NAME:"Найменування уповноваженого банку",field_BNK_MFO:"МФО уповноваженого банку",field_SALE_SUM:"Сума іноземної валюти, що продається",field_SALE_CURRENCY:"Код іноземної валюти, що продається",field_SALE_ACCOUNT:"Рахунок для списання валюти",field_SALE_KIND:"Прапор перерахування на банківський рахунок для продажу іноземної валюти",field_SALE_BNK_ACCOUNT:"Банківський рахунок для продажу іноземної валюти",field_SALE_RATE_KIND:"Варіант вибору курсу продажу іноземної валюти",field_SALE_RATE:"Курс продажу іноземної валюти",field_PURCHASE_SUM:"Сума гривень для зарахування",field_PURCHASE_ACCOUNT:"Рахунок клієнта для зарахування гривень",field_PURCHASE_BNK_NAME:"Найменування банку, у якому відкритий рахунок клієнта для зарахування гривень",field_PURCHASE_BNK_MFO:"МФО банку, у якому відкритий рахунок клієнта для зарахування гривень",field_COMMISSION:"Комісія уповноваженого банку",field_RETURN_ACCOUNT:"Рахунок клієнта для повернення іноземної валюти",field_EXPERIENCE_DATE:"Термін дії Заяви",field_CURRENCY_DATE:"Дата валютув.",footer_s_template:"{1} {2} {3} з {4}",footer_selected_sin:"Обрана",footer_selected_pl:"Обрано",footer_1_doc:"заява",footer_1_doc_pl:"заява",footer_2_4_docs:"заяви",footer_5_0_docs:"заяв"}),define("apps/ua_currency_sale/nls/uk/ua_currency_sale",["underscore","apps/ua_currency_sale/nls/uk/ua_currency_sale_base"],function(a,b){"use strict";return a.extend({},b,{ua_currency_sale:"Заява про продаж валюти",ua_currency_sale_list:"Заява про продаж валюти",enroll_to_account:"Необхідну суму доручаємо Банку списати з рахунку",sale_amount:"Просимо продати",value_date:"Дата валютування",rate0:"за курсом",rate0_label:"за курсом",rate1_label:"за курсом уповноваженого банку",purchase_amount3:"Банк",return_account:"У разі неможливості виконати заяву кошти просимо повернути на рахунок",commission:"Комісію доручаємо Банку",commission_kind_1:"утримати з коштів, отриманих від продажу валюти",commission_kind_2:"списати з рахунку зарахування грн. коштів",today:"сьогодні",tomorrow:"завтра",spot:"спот",account:"Рахунок",on_acc:"Суму в гривнях доручаю зарахувати на рахунок",sale_purpose_11:"продаж валютної виручки",sale_purpose_12:"продано інвестиційні кошти, що надійшли з-за кордону",sale_purpose_13:"продано кредит, виданий банком клієнту",sale_purpose_14:"продаж іноземної валюти, раніше купленої на міжбанківському валютному ринку, яка не була використана за призначенням, у тому числі повернута нерезидентом у зв'язку з невиконанням останнім своїх зобов'язань",sale_purpose_15:"продано власні кошти банку (у тому числі продано валюту з метою зменшення валютної позиції банку)",sale_purpose_16:"продано з іншою метою",sale_purpose_18:"продано кредитні кошти, отримані банком від нерезидента",sale_purpose_19:"продано кредитні кошти, отримані клієнтом банку від нерезидента",field_SALE_CODE_REASON:"Код підстави продажу валюти",field_SALE_REASON:"Підстава продажу валюти",field_VALUE_DATE:'Дата валютування. Можливі варіанти "сьогодні", "завтра", "спот"',field_CLN_OKPO:"Код ЄДРПОУ клiєнта",field_SALE_BNK_NAME:"Найменування банку для продажу iноземної валюти",field_SALE_BNK_BIC:"МФО банку для продажу iноземної валюти",field_COMMISSION_ACCOUNT:"Гривневий рахунок для списання комісії",field_COMMISSION_BNK_MFO:"МФО банку, у якому відкритий гривневий рахунок для списання комісії",field_COMMISSION_BNK_NAME:"Найменування банку, у якому відкритий гривневий рахунок для списання комісії",field_COMMISSION_BNK_ADDR:"Адреса банку з комісійним рахунком"})}),define("apps/ua_currency_sale/nls/en/ua_currency_sale_base",{no_uah_accs:"Unable to create a document. Current account in national currency is missing.",no_cur_accs:"Unable to create a document. Current account in foreign currency is missing",number:"Number",date:"Date",sale_account:"Currency account",amount:"Amount",currency:"Currency",status:"Status",payer:"Payer",ua_currency_sale:"Currency sale",ua_currency_sale_list:"Currency sale",num_doc:"Number",cln_fio:"Authorized employee of the company",phone:"Phone",from_acc:"from account",on_acc:"on account",date_doc:"Document date",rate1:"за курсом уповноваженого банку",sale_amount:"Request to sell",purchase_amount1:"Amount in hryvna",purchase_amount2:"order to enroll in the bank",purchase_amount3:"Corresponding amount in hryvna order to enroll to the bank",value_date:"Value date",valid_till:"Validity",purpose:"Sale purpose",not_required:"optional",current:"current",autonum:"autonum.",fio_placeholder:"Full name (optional)",phone_placeholder:"phone (optional)",bank_name:"name",bank_mfo:"MFO",amount_in:"Amount in",enroll_to_account:"from account",not_acount_for_cur:"There are no rights for working with accounts in selected currency",field_NUM_DOC:"Document number",field_DATE_DOC:"Date document",field_CLN_NAME:"Client's name",field_CLN_ADDR:"Client address",field_CLN_PHONES:"Client's phone number",field_CLN_EMPLOYEE_FIO:"Responsible employee's full name",field_CLN_EMPLOYEE_PHONE:"Employee's phone number",field_BNK_NAME:"Authorized bank name",field_BNK_MFO:"MFO of authorized bank",field_SALE_SUM:"Amount of foreign currency that is sold",field_SALE_CURRENCY:"Code of foreign currency that is sold",field_SALE_ACCOUNT:"Account for debiting currency",field_SALE_KIND:"Transferring on bank account flag for sale of foreign currency",field_SALE_BNK_ACCOUNT:"Bank account for foreign currency sale",field_SALE_RATE_KIND:"Foreign currency sale rate option",field_SALE_RATE:"Foreign currency sale rate",field_PURCHASE_SUM:"Amount in hryvnia to enroll",field_PURCHASE_ACCOUNT:"Client's account for hryvnia crediting",field_PURCHASE_BNK_NAME:"Bank name where client's account for transfer hryvnia is opened",field_PURCHASE_BNK_MFO:"Bank MFO where client's account for hryvnia transfer is opened",field_COMMISSION:"Commission of authorized bank",field_RETURN_ACCOUNT:"Client's account for foreign currency return",field_EXPERIENCE_DATE:"Order validity period",field_CURRENCY_DATE:"Value date",footer_s_template:"{1} {2} {3} of {4}",footer_selected_sin:"Selected",footer_selected_pl:"Selected",footer_1_doc:"order",footer_1_doc_pl:"orders",footer_2_4_docs:"orders",footer_5_0_docs:"orders"}),define("apps/ua_currency_sale/nls/en/ua_currency_sale",["underscore","apps/ua_currency_sale/nls/en/ua_currency_sale_base"],function(a,b){"use strict";return a.extend({},b,{ua_currency_sale:"Sale order",ua_currency_sale_list:"Sale orders",enroll_to_account:"We authorize to write off the required amount from the account",sale_amount:"Ask to sell",value_date:"Value date",rate0:"за курсом",rate0_label:"according to the exchange rate",rate1_label:"according to the exchange rate of the bank",purchase_amount3:"Bank",return_account:"If unable to execute the order we order to return amount in foreign currency to account",commission:"We authorize the Bank the commission to",commission_kind_1:"deduct from the funds received from the sale of foreign currency",commission_kind_2:"withdraw from transferring account in UAH",today:"today",tomorrow:"tomorrow",spot:"spot",account:"Account",on_acc:"We authorize to transfer the amount in hryvna to the account",sale_purpose_11:"продаж валютної виручки",sale_purpose_12:"продано інвестиційні кошти, що надійшли з-за кордону",sale_purpose_13:"продано кредит, виданий банком клієнту",sale_purpose_14:"продаж іноземної валюти, раніше купленої на міжбанківському валютному ринку, яка не була використана за призначенням, у тому числі повернута нерезидентом у зв'язку з невиконанням останнім своїх зобов'язань",sale_purpose_15:"продано власні кошти банку (у тому числі продано валюту з метою зменшення валютної позиції банку)",sale_purpose_16:"продано з іншою метою",sale_purpose_18:"продано кредитні кошти, отримані банком від нерезидента",sale_purpose_19:"продано кредитні кошти, отримані клієнтом банку від нерезидента",field_SALE_CODE_REASON:"Currency sale reason code",field_SALE_REASON:"The reason for the currency sale",field_VALUE_DATE:'Value date. Possible options "today", "tomorrow", "spot"',field_CLN_OKPO:"Client's EDRPOU",field_SALE_BNK_NAME:"Bank name for foreign currency sale",field_SALE_BNK_BIC:"Bank name for foreign currency sale",field_COMMISSION_ACCOUNT:"Hryvnia account to write off commission",field_COMMISSION_BNK_MFO:"Bank MFO, where hryvnia account opened to write off commission is opened",field_COMMISSION_BNK_NAME:"Bank name, where hryvnia account opened to write off commission is opened",field_COMMISSION_BNK_ADDR:"Bank address with commission account"})}),define("apps/ua_currency_sale/ua_currency_sale_base_model",["underscore","bifit","collections/thesaurus","thesaurusUtils","appsPieces","models/base_document","i18n!apps/ua_currency_sale/nls/ua_currency_sale","i18n!nls/validation","backboneValidation"],function(a,b,c,d,e,f,g,h){"use strict";var i=function(a){var b="documents.ua_currency_sale.rate_length",c=b+"."+(a||"").toLowerCase();return parseInt(+(d.firstPropOf(c,b)||"4"),10)};return f.extend({type:"ua_currency_sale",nls:g,defaults:{status:"",status_desc:"",status_color:"000000",DATE_DOC:"",NUM_DOC:"",CLN_NAME:"",CLN_ADDR:"",CLN_PHONES:"",CLN_EMPLOYEE_FIO:"",CLN_EMPLOYEE_PHONE:"",BNK_NAME:"",BNK_MFO:"",SALE_SUM:"",SALE_CURRENCY:"",SALE_ACCOUNT:"",SALE_KIND:"",SALE_BNK_ACCOUNT:"",SALE_RATE_KIND:"",SALE_RATE:"",PURCHASE_SUM:"",PURCHASE_ACCOUNT:"",PURCHASE_BNK_NAME:"",PURCHASE_BNK_MFO:"",COMMISSION:"",RETURN_ACCOUNT:"",ATT_CNT:"0"},meta:a.extend({},f.prototype.meta,{relatively:a.extend({SALE_SUM:function(a){return parseFloat(a)},SALE_CURRENCY:function(a){return a}},f.prototype.meta.relatively),amount:"SALE_SUM",currency:"SALE_CURRENCY",formattedFields:{SALE_SUM:function(){return this._amountFormatter(this.get("SALE_SUM"),this.get("SALE_CURRENCY"),2)},COMMISSION:function(){return this._amountFormatter(this.get("COMMISSION"),3)},SALE_RATE:function(){return this._amountFormatter(this.get("SALE_RATE"),i(this.get("SALE_CURRENCY")))},PURCHASE_SUM:function(){return this._amountFormatter(this.get("PURCHASE_SUM"),2)}}}),validation:{NUM_DOC:{numDocRequired:!0,maxLength:10},DATE_DOC:{required:!0,dateDoc:!0},CLN_NAME:{required:!0,maxLength:40,clientInfo:"name_cln"},SALE_ACCOUNT:{required:!0,digits:!0,minLength:5,maxLength:14,calcAcc:"BNK_MFO",fn:function(b,c,d){var f,g=a.where(e.getAccounts(["1"],!0)[d.SALE_CURRENCY],{account:b});if(a.isEmpty(g))return f=h.invalid_field;var i=a.any(g,function(a){return a.permissions>0});return i||(f=h.account_not_permission),f}},SALE_CURRENCY:{required:!0,length:3},BNK_NAME:{required:!1,maxLength:45},BNK_MFO:{required:!0,digits:!0,length:6,fn:function(a,b,c){var d,e=c.BNK_NAME;return e&&""!==e||(d=h.mfo_not_found),d}},PURCHASE_ACCOUNT:[{required:!0,digits:!0,maxLength:14,minLength:5,calcAcc:"PURCHASE_BNK_MFO"},{fn:function(b,d,e){var f,g=e.PURCHASE_BNK_MFO;if(a.findWhere(c.getThesaurus("cln_accounts").array,{account:b,mfo:g,currency:"UAH"})){var i=a.findWhere(c.getThesaurus("accs_info").array,{account:b,mfo:g,status:"2",currency:"UAH"});(!i||i.permissions<1)&&(f=h.account_not_permission)}return f}}],PURCHASE_BNK_NAME:{required:!1,maxLength:45},PURCHASE_BNK_MFO:{required:!0,digits:!0,length:6,fn:function(a,b,c){var d;return c.PURCHASE_BNK_NAME||(d=h.mfo_not_found),d}},CLN_ADDR:{required:!0,maxLength:80},CLN_PHONES:{required:!0,maxLength:20},CLN_EMPLOYEE_FIO:{required:!1,maxLength:40},CLN_EMPLOYEE_PHONE:{required:!1,maxLength:20},SALE_SUM:[{required:!0},{max:9999999999.9999,pattern:/^\d+\.\d{4}$/,msg:h.incorrect_amount},{min:.01,msg:h.positive_amount}],PURCHASE_SUM:[{fn:function(a){var b;return a&&0!==a.length&&!a.match(/^\d{1,10}\.\d{0,4}$/)&&(b=h.incorrect_amount),b}},{checkPositive:!0}],SALE_RATE_KIND:[{required:!0},{oneOf:["по курсу","за курсом","по курсу уполномоченного банка","за курсом уповноваженого банку"],msg:h.invalid_field}],RETURN_ACCOUNT:[{required:!0},{fn:function(a,b,c){var d,e=c.SALE_ACCOUNT;return a!==e&&(d=h.invalid_field),d}}],COMMISSION:{fn:function(a){var b;return a&&0!==a.length&&!a.match(/^\d{1,2}\.\d{0,3}$/)&&(b=h.incorrect_amount),b}}}})}),define("apps/ua_currency_sale/ua_currency_sale_model",["underscore","thesaurusUtils","bifit","apps/ua_currency_sale/ua_currency_sale_base_model","i18n!nls/validation","backboneValidation"],function(a,b,c,d,e){"use strict";return d.extend({defaults:a.extend({},d.prototype.defaults,{SALE_CODE_REASON:"",COMMISSION_ACCOUNT:"",COMMISSION_BNK_MFO:"",COMMISSION_BNK_NAME:"",CLN_OKPO:"",SALE_BNK_ACCOUNT:"",SALE_BNK_NAME:"",SALE_BNK_BIC:"",EXPERIENCE_DATE:"",CURRENCY_DATE:""}),order:["DATE_DOC","NUM_DOC","CLN_NAME","CLN_ADDR","CLN_PHONES","CLN_EMPLOYEE_FIO","CLN_EMPLOYEE_PHONE","BNK_NAME","BNK_MFO","SALE_SUM","SALE_CURRENCY","SALE_ACCOUNT","SALE_KIND","SALE_BNK_ACCOUNT","SALE_RATE_KIND","SALE_RATE","PURCHASE_SUM","PURCHASE_ACCOUNT","PURCHASE_BNK_NAME","PURCHASE_BNK_MFO","COMMISSION","RETURN_ACCOUNT","EXPERIENCE_DATE","CURRENCY_DATE","SALE_CODE_REASON","SALE_REASON","SALE_BNK_NAME","SALE_BNK_BIC","VALUE_DATE","CLN_OKPO","COMMISSION_ACCOUNT","COMMISSION_BNK_MFO","COMMISSION_BNK_NAME"],validation:a.extend({},d.prototype.validation,{CLN_OKPO:{required:!0,digits:!0,maxLength:10},SALE_BNK_ACCOUNT:{required:!1},SALE_BNK_NAME:{required:!1,maxLength:140},SALE_BNK_BIC:{required:!1,digits:!0,maxLength:6},SALE_KIND:{required:!1},SALE_RATE:{fn:function(a,b,c){var d,f=c.SALE_RATE_KIND;return"по курсу"!==f&&"за курсом"!==f?a&&0!==a.length&&(d=e.empty_field):a&&0!==a.length?a&&!a.match(/^\d{1,4}\.\d{0,4}$/)&&(d=e.incorrect_amount):d=e.required,d},checkPositive:!0},SALE_CODE_REASON:{fn:function(b){return b?a.contains(["11","12","13","14","15","16","18","19"],b)?void 0:e.invalid_field:e.required}},SALE_REASON:{required:!0,maxLength:250},COMMISSION_ACCOUNT:{required:!1,digits:!0,maxLength:14},COMMISSION_BNK_MFO:{required:!1,digits:!0,maxLength:6},COMMISSION_BNK_NAME:{required:!1,maxLength:45},VALUE_DATE:{fn:function(b){return b?a.contains(["сьогодні","сегодня","завтра","спот"],b)?void 0:e.invalid_field:e.required}},CURRENCY_DATE:{fn:function(a,b,d){var f,g=d.DATE_DOC,h=d.EXPERIENCE_DATE;if(g&&a)if(c.checkDateMatch(a)){g=c.str2date(g),a=c.str2date(a);var i=a.getTime()-g.getTime();0>i?f=e.value_date_01:h&&h.length>0&&c.str2date(h).getTime()<a.getTime()?f=e.value_date_02:Math.floor(i/1e3/60/60/24)>30&&(f=this._valueDateErrorWrapper(30))}else f=e.incorrect_date;return f}},EXPERIENCE_DATE:{fn:function(a,b,d){var f,g=d.DATE_DOC;if(g&&a)if(c.checkDateMatch(a)){g=c.str2date(g),a=c.str2date(a);var h=a.getTime()-g.getTime();0>h?f=e.expire_date_01:Math.floor(h/1e3/60/60/24)>30&&(f=c.sprintf(e.expire_date_02,30))}else f=e.incorrect_date;return f}}})})}),define("text!templates/views/document/group-filter.tmpl",[],function(){return'<div class="group-checkbox" onmousedown="return false" onselectstart="return false">\n    <div class="popup-wrapper bottom sub-menu">\n        <ul class="popup filter">\n        </ul>\n    </div>\n</div>\n\n'}),define("commons/base_object/document/group_opers_doc_list_view",["jquery","underscore","app","bifit","services/doc_statuses","actionUtils","commons/base_object/base_list_view","text!templates/views/document/group-filter.tmpl","i18n!nls/document","libs/group_opers_utils"],function(a,b,c,d,e,f,g,h,i,j){"use strict";return g.extend({events:b.extend(g.prototype.events,{"click th.check input":"markAll","click div.group-checkbox a":"markByStatus","click div.group-checkbox":"toggleFilter"}),childEvents:b.extend(g.prototype.childEvents,{markOne:"markOne"}),footerNls:null,isAccountsForCreateAction:null,initialize:function(a){g.prototype.initialize.apply(this,arguments),this.isAccountsForCreateAction=a.isAccountsForCreateAction,"false"!==d.getStorageData("is_need_deselect_selected_items")&&b.each(this.collection.selected,function(a){this.collection.deselect(a)}.bind(this)),d.setStorageData("is_need_deselect_selected_items","true")},selectItem:function(a,b){g.prototype.selectItem.call(this,a,b),d.setStorageData("is_need_deselect_selected_items","false")},onRender:function(){g.prototype.onRender.call(this),this.prepareTable()},prepareTable:function(){j.prepareTable.call(this),this.initStatusSelector(),this.postModelMark()},initStatusSelector:function(){var c=b.uniq(b.map(this.collection.models,function(a){return a.get("status")})),f=b.intersection(c,["0","1","3004"]);if(f){if(f.length>1){var g=d.getLocale(),j=a(b.template(h,i)),k=j.find("ul");b.each(f,function(b){var c=parseInt(b,10),f=d.sprintf(i.flt_st,e.getLocalizedNameById(c,g)),h="st"+b;a("<li><a data-action='"+h+"' href='#'>"+f+"</a></li>").appendTo(k)}.bind(this)),this.$("table.list").find("th.check").append(j)}}else this.$("table.list").find("th.check, td.check").hide()},toggleFilter:function(b){b.stopPropagation();var c=a(b.target).find(".sub-menu"),d=function(){c.hide(),a("div.group-checkbox").removeClass("shadow"),a(document).unbind("click.filter-sub-menu")};return"block"===c.css("display")?d():(c.show(),this.$("div.group-checkbox").addClass("shadow"),a(document).bind("click.filter-sub-menu",d)),!0},markOne:j.markOne,markAll:j.markAll,markByStatus:function(c){c.preventDefault(),this.$(".group-checkbox .sub-menu").hide(),this.$("tbody tr").removeClass("selected"),this.$("tbody tr").find("input").prop("checked",!1),this.collection.selectNone();var d=a(c.target).attr("data-action");this.$("tbody tr."+d).addClass("selected"),this.$("tbody tr.selected input").prop("checked",!0);var e=this.collection.where({status:d.substr("st".length)});b.each(e,function(a){a.select()}),this.postModelMark()},postModelMark:function(){var a=this.collection.selectedLength>0,c=this.getAvailableActions(a),d=0;a&&b.each(this.collection.selected,function(a){c=b.intersection(c,f.getPossibleActions(a)),d+=parseFloat(a.getAmount())});var e=this.collection.length===this.collection.selectedLength;this.$("th.check input")[e?"removeClass":"addClass"]("some"),this.$("th.check input").prop("checked",a),this.trigger("update-actions",this.getPermittedActions(c)),this.changeFooter(d.toFixed(2))},getAvailableActions:function(a){var b;return a?(b=[f.DocumentAction.PRINT],(c.isMultiClient()||this.isAccountsForCreateAction)&&(b=b.concat([f.DocumentAction.SIGN,f.DocumentAction.COPY,f.DocumentAction.DELETE]))):(c.isMultiClient()||this.isAccountsForCreateAction)&&(b=[f.DocumentAction.CREATE,f.DocumentAction.IMPORT]),b},getPermittedActions:function(a){for(var c=["CREATE","IMPORT","PRINT","SIGN","COPY","DELETE","CONFIRM","TOGGLE","CFC_CONFIRM","CFC_REJECT","CFC_SIGN"],d=this.getDocumentTypeForActions(),e=[],g=0;g<c.length;g++){
var h=c[g],i=b.contains(a,f.DocumentAction[h])&&f.isActionPermitted(h,d);i&&e.push(h+(b.contains(["CREATE","IMPORT"],h)?"":"_GROUP"))}return e},getDocumentTypeForActions:function(){return this.collection.options.document_type},changeFooter:function(a){if(this.footerNls){var b=this.$("tfoot.summary"),c=this.collection.selectedLength;if(b.length){b[c?"show":"hide"]();var e=c%100,f="footer_5_0_docs",g="footer_selected_pl";if(11>e||e>19){var h=c%10;1===h?(f=1===c?"footer_1_doc":"footer_1_doc_pl",g="footer_selected_sin"):h>1&&5>h&&(f="footer_2_4_docs")}var i=this.footerNls,j=d.sprintf(i.footer_s_template,i[g],c,i[f],this.collection.length,a);b.find("td").html(j).trigger("footer:change",c)}}}})}),define("commons/base_object/group_opers_list_item_view",["commons/base_object/base_list_item_view"],function(a){"use strict";return a.extend({triggers:{"click td:not(.check)":"selectItem"},events:{"click td.check input":function(a){this.trigger("markOne",a)}}})}),define("text!apps/ua_currency_sale/templates/ua_currency_sale_list.tmpl",[],function(){return'<table class="list ua_currency_sale" style="display: table;">\n    <thead class="widescreen">\n    <tr>\n        <th class="attach">&nbsp;</th>\n        <th class="check">\n            <input type="checkbox"/>\n            <span class="checkbox"/>\n        </th>\n        <th class="number">\n            <span class="sortable" data-field="NUM_DOC"><%- number %></span>\n        </th>\n        <th class="date">\n            <span class="sortable" data-field="DATE_DOC"><%- date %></span>\n        </th>\n        <% if (isMultiClient()) { %>\n            <th class="payer ellipsis">\n                <span class="sortable" data-field="CLN_NAME"><%= payer %></span>\n            </th>\n        <% } %>\n        <th>\n            <span class="sortable" data-field="SALE_ACCOUNT"><%- account %></span>\n        </th>\n        <th class="amount">\n            <span class="sortable" data-field="SALE_SUM"><%- amount %></span>\n        </th>\n        <th class="currency">\n            <span class="sortable" data-field="SALE_CURRENCY"><%- currency %></span>\n        </th>\n        <th class="status">\n            <span class="sortable" data-field="status_desc"><%- status %></span>\n        </th>\n        <th class="empty">&nbsp;</th>\n        <th class="mobile" colspan="2">&nbsp;</th>\n    </tr>\n    </thead>\n    <tbody></tbody>\n    <tfoot class=\'summary\'>\n    <tr>\n        <td colspan="8"></td>\n    </tr>\n    </tfoot>\n</table>\n'}),define("text!apps/ua_currency_sale/templates/ua_currency_sale_list_item.tmpl",[],function(){return'<td class="attach widescreen">\n    <% if (ATT_CNT != \'0\') { %>\n    <span class=\'att-cnt\'>&nbsp;</span>\n    <% } %>\n</td>\n<td class="check widescreen"><input type=\'checkbox\'/><span class="checkbox"></span></td>\n<td class="number widescreen"><%- NUM_DOC %></td>\n<td class="date widescreen"><%- DATE_DOC %></td>\n<% if (isMultiClient()) { %>\n    <td class="payer ellipsis widescreen"><%- CLN_NAME %></td>\n<% } %>\n<td class="sale_account widescreen"><%- SALE_ACCOUNT %></td>\n<td class="amount widescreen"><%- formatAmount(SALE_SUM) %></td>\n<td class="currency widescreen"><%- SALE_CURRENCY %></td>\n<td class="status widescreen"><%- status_desc %></td>\n<td class="empty widescreen">&nbsp;</td>\n<td class=\'mobile\'>\n    <span class=\'attaches<% if (ATT_CNT != \'0\') { %> att-cnt <% } %>\'>&nbsp;</span>\n    <span class=\'date\'><%- DATE_DOC %></span>\n    <span class=\'amount\'><%- formatAmount(SALE_SUM) %>&nbsp;<%- SALE_CURRENCY %></span>\n    <span class=\'rcpt ellipsis\'><%- SALE_ACCOUNT %></span>\n    <span class=\'status\'><%- status_desc %></span>\n</td>\n'}),define("apps/ua_currency_sale/ua_currency_sale_list_view",["underscore","commons/base_object/document/group_opers_doc_list_view","commons/base_object/group_opers_list_item_view","text!apps/ua_currency_sale/templates/ua_currency_sale_list.tmpl","text!apps/ua_currency_sale/templates/ua_currency_sale_list_item.tmpl","i18n!apps/ua_currency_sale/nls/ua_currency_sale"],function(a,b,c,d,e,f){"use strict";return b.extend({template:a.template(d),templateHelpers:a.extend({},b.prototype.templateHelpers,f),footerNls:f,childView:c.extend({template:a.template(e)})})}),define("nls/states_types",{root:{any:"любые","new":"новые",in_bank:"в банке",rejected:"отвергнутые",signed:"подписаные",executed:"исполненные",partly_executed:"исп. частично",sent_to_client:"отправленные клиенту",not_confirmed:"не подтвержденные",requires_confirmation:"требуют подтверждения",formed:"сформированные",approved:"одобренные"},uk:!0,en:!0}),define("nls/uk/states_types",{any:"будь-які","new":"нові",in_bank:"у банку",rejected:"відхилені",signed:"підписані",executed:"виконані",partly_executed:"виконані частково",sent_to_client:"відправлені клієнту",not_confirmed:"не підтверджені",requires_confirmation:"вимагають підтвердження",formed:"сформовані",approved:"узгоджені"}),define("nls/en/states_types",{any:"any","new":"new",in_bank:"in bank",rejected:"rejected",signed:"signed",executed:"executed",partly_executed:"partly executed",sent_to_client:"sent to the client",not_confirmed:"not confirmed",requires_confirmation:"requires confirmation",formed:"formed",approved:"approved"}),define("commons/base_object/document/document_state_filter_view",["underscore","commons/base_object/document/document_filter_view","i18n!nls/states_types"],function(a,b,c){"use strict";return b.extend({ui:a.extend({statesChosen:"#state_chosen_filter",statesChosenContainer:"div.state-chosen-filter"},b.prototype.ui),events:a.extend({"chosen:select @ui.statesChosen":"onStateFilterChanged"},b.prototype.events),states:{work:[{id:"any",name:c.any},{id:"new",name:c["new"],filter:"0,1,3004"},{id:"in_bank",name:c.in_bank,filter:"2,3,4,11,12,13,17,2001,2002"},{id:"rejected",name:c.rejected,filter:"6"}]},cache:{},onShow:function(){this.createStateFilter(),b.prototype.onShow.call(this)},createStateFilter:function(){this.ui.statesChosenContainer.show(),this.ui.statesChosen.chosen({searchable:!1,data:{array:[],id:"id",text:"name"}}),this.configureStateFilterForStatusTab()},onStateFilterChanged:function(a,b){b.id!==this.getSelectedState()&&(this.setSelectedState(b.id),this.reload())},changeStatus:function(a){b.prototype.changeStatus.call(this,a),this.configureStateFilterForStatusTab()},configureStateFilterForStatusTab:function(){return this.isStateFilterRequired()?(this.ui.statesChosenContainer.show(),this.ui.statesChosen.trigger("refresh",{array:this.getStatesRef()}),void this.ui.statesChosen.trigger("chooseById",this.getSelectedState())):void this.ui.statesChosenContainer.hide()},reload:function(a){a=this.addStateFilterData(a),b.prototype.reload.call(this,a)},addStateFilterData:function(b){if(this.isStateFilterRequired()){var c=a.findWhere(this.getStatesRef(),{id:this.getSelectedState()});b=c&&c.filter?a.extend({},b,{status:c.filter}):b}return b},getStatesRef:function(){return this.states[this.tabsStatuses.selectedTab]},getSelectedState:function(){return this.cache[this.docType+this.tabsStatuses.selectedTab]||"any"},setSelectedState:function(a){return this.cache[this.docType+this.tabsStatuses.selectedTab]=a},isStateFilterRequired:function(){return this.getStatesRef()&&this.getStatesRef().length>1},onBeforeDestroy:function(){this.ui.statesChosen.disposeChosen()}})}),define("text!commons/base_object/document/templates/document_ext_filter_minimized_item.tmpl",[],function(){return"<label><%- (label ? label + ': ' : '') %></label>\n<span class=\"value <%- id %>\"><%- displayValue %></span>\n<span class=\"delete-filter-item\">&#10005;</span>"}),define("nls/document-filter",{root:{status_all:"Все",period_from:"Период с",period_to:"по",getdocs:"Получить",loading_docs:"Получение",incorrect_filter_date:"Дата окончания интервала для получения документов ранее даты начала интервала",ua_payment:"Гривневые поручения",bank_ua_payment_request:"Гривневые требования",ua_payment_request:"Гривневые требования",ua_currency_purchase:"Покупка валюты",ua_currency_sale:"Продажа валюты",ua_currency_convert:"Конвертация валюты",ua_currency_payment:"Валютные поручения",pay_sheet:"Зарплатные ведомости",letter:"Письма",inStatus:"В статусе",any:"Все",several:"Выбрано статусов: {1}",num_doc:"Номер документа",currency:"Валюта",amount:"Сумма",from:"от",to:"до",amount_from:"Сумма от",amount_to:"Сумма до",payer:"Плательщик",recipient:"Получатель",account:"Счет",start_entering:"Начинайте вводить",start_entering_acc:"Начинайте вводить номер счета",start_entering_name:"Начинайте вводить наименование",all:"Все",amountError:"Максимальная сумма должна быть больше минимальной"},uk:!0,en:!0}),define("nls/uk/document-filter",{status_all:"Всі",period_from:"Перiод від",period_to:"до",getdocs:"Отримати",loading_docs:"Отримання",incorrect_filter_date:"Дата завершення інтервалу для отримання документів раніше дати початку інтервалу",ua_payment:"Гривневі доручення",bank_ua_payment_request:"Гривневі вимоги",ua_payment_request:"Гривневі вимоги",ua_currency_purchase:"Купівля валюти",ua_currency_sale:"Продаж валюти",ua_currency_payment:"Валютні доручення",ua_currency_convert:"Конвертація валюти",pay_sheet:"Зарплатні відомості",letter:"Листи",inStatus:"У статусі",any:"Всі",several:"Обрано статусів: {1}",num_doc:"Номер документа",currency:"Валюта",amount:"Сума",from:"від",to:"до",amount_from:"Сума від",amount_to:"Сума до",payer:"Платник",recipient:"Отримувач",account:"Рахунок",start_entering:"Починайте вводити",start_entering_acc:"Починайте вводити номер рахунку",start_entering_name:"Починайте вводити найменування",all:"Всі",amountError:"Максимальна сума повинна бути більше ніж мінімальна"}),define("nls/en/document-filter",{status_all:"All",period_from:"Period from",period_to:"to",getdocs:"Receive",loading_docs:"Loading",incorrect_filter_date:"Interval final date for receiving the statement is earlier than its initial one",ua_payment:"Hryvnia Payment orders",bank_ua_payment_request:"Hryvnia Payment requests",ua_payment_request:"Hryvnia Outgoing Payment Request-Orders",ua_currency_purchase:"Currency purchase",ua_currency_sale:"Currency sale",ua_currency_convert:"Currency conversion",ua_currency_payment:"Currency payments",pay_sheet:"Salary sheets",letter:"Letters",inStatus:"In status",any:"Any",several:"Selected statuses: {1}",num_doc:"Document number",currency:"Currency",amount:"Amount",from:"from",to:"to",amount_from:"Amount from",amount_to:"Amount to",payer:"Payer",recipient:"Recipient",account:"Account",start_entering:"Start typing",start_entering_acc:"Start typing the account",start_entering_name:"Start typing the name",all:"All",amountError:"The maximum amount should be more than the minimum"}),define("commons/base_object/document/document_ext_filter_view",["underscore","backbone","marionette","app","bifit","collections/thesaurus","dialogUtils","text!commons/base_object/document/templates/document_ext_filter_minimized_item.tmpl","i18n!nls/document-filter"],function(a,b,c,d,e,f,g,h,i){"use strict";return c.CompositeView.extend({template:a.template('<div id="expanded-view"></div><div id="minimized-view"></div>'),templateHelpers:{isMultiClient:d.isMultiClient},ui:{expanded:"#expanded-view",minimized:"#minimized-view"},events:{"chosen:select #client":"onClientSelected"},fieldsMeta:{},childView:c.ItemView.extend({template:a.template(h),tagName:"span",id:function(){return this.model.id},triggers:{"click .delete-filter-item":"deleteFilterItem"}}),selectedClient:null,childViewContainer:"#minimized-view",childEvents:{deleteFilterItem:"deleteFilterItem"},isExpanded:!0,isFieldsOrder:!1,getExtFilterData:function(){if(this.isExpanded&&this.resetFilterCollection(),this.isValidFilterData()){var b={};return a.extend(b,this.getQueryFilter()),a.extend(b,this.getAdditionalFilter()),a.extend(b,this.getClientIdFilter()),b}},toggleMode:function(){this.isExpanded?this.isValidFilterData()&&(this.ui.expanded.hide(),this.ui.minimized.show(),this.resetFilterCollection()):(this.ui.expanded.show(),this.ui.minimized.hide(),this.restoreFilter()),this.isExpanded=!this.isExpanded,this.trigger("filter:resized")},resetFilter:function(){this.clearForm(),this.setDefaults(),!this.isExpanded&&this.collection.length&&(this.collection.reset(),this.trigger("filter:changed"),this.trigger("filter:resized"))},clearForm:function(){this.ui.expanded.find("input:text:not([readonly])").val("").change().trigger("empty")},setDefaults:function(){},initialize:function(){},onShow:function(){this.initForm(),this.ui.client&&this.ui.client.length&&this.initClientChosen(),this.collection.length&&this.restoreFilter()},initForm:function(){},restoreFilter:function(){this.restoreQueryFields(),this.restoreAdditionalFields()},restoreQueryFields:function(){a.each(this.fieldsMeta,function(a,b){var c=this.collection.get(b);if(0!==this.ui[b].length){var d=c?c.get("displayValue"):"";this.ui[b].val(d),d||this.ui[b].trigger("empty"),this.ui[b].change()}}.bind(this))},restoreAdditionalFields:function(){},resetFilterCollection:function(){var b=a.union(this.collectQueryData(),this.collectAdditionalData());this.isFieldsOrder&&b.sort(function(b,c){return a.has(b,"order")&&a.has(c,"order")?b.order-c.order:0}),this.collection.reset(b)},collectQueryData:function(){var b=[];return a.each(this.fieldsMeta,function(c,d){var e=this.getFilterValue(d);if(e){var f={id:d,idx:c.idx,order:c.order,value:e,type:c.type,operation:c.operation,displayValue:this.getDisplayValue(d),label:"<="===c.operation&&a.findWhere(b,{idx:c.idx})?c.shortLabel:c.label};"client"===c.type&&this.selectedClient&&this.selectedClient.name_cln===f.value&&(f.client_id=this.selectedClient.client_id),b.push(f)}}.bind(this)),b},collectAdditionalData:function(){return[]},getQueryFilter:function(){var b="";return a.each(this.fieldsMeta,function(a,c){var d=this.collection.get(c);if(d){var e=this.getQueryPart(d);e&&(b+=(b?" && ":"")+e)}}.bind(this)),b?{query:b}:{}},getQueryPart:function(a){var b=a.get("type");return"amount"===b?this.getAmountQuery(a):"client"===b?this.getClientQuery(a):"number"===b?this.getNumberQuery(a):this.getStringQuery(a)},getAdditionalFilter:function(){return{}},getClientIdFilter:function(){var a=this.collection.get("client");if(a){var b=a.get("client_id");if(b)return{clients:b}}},isValidFilterData:function(){return this.hasAmountFields()?this.isAmountValid():!0},hasAmountFields:function(){return!!a.findWhere(this.fieldsMeta,{type:"amount"})},isAmountValid:function(){var a=+this.ui.AMOUNT_MIN.getUnformattedValue(),b=+this.ui.AMOUNT_MAX.getUnformattedValue();return!(b>0&&a>b)},clearInvalidFields:function(){this.hasAmountFields()&&!this.isAmountValid()&&this.clearAmountFields()},clearAmountFields:function(){this.ui.AMOUNT_MIN.val(""),this.ui.AMOUNT_MAX.val(""),b.Validation.callbacks.valid(null,"AMOUNT_MIN")},validateFilterAmount:function(){this.isAmountValid()?b.Validation.callbacks.valid(null,"AMOUNT_MIN"):b.Validation.invalidField(this,"AMOUNT_MIN",i.amountError)},getFilterValue:function(a){var b=this.ui[a].getUnformattedValue();return this.fieldsMeta[a]&&("amount"===this.fieldsMeta[a].type||"number"===this.fieldsMeta[a].type)&&0>=b?null:b?b.trim():null},getDisplayValue:function(a){return this.ui[a].val().trim()},deleteFilterItem:function(b,c){var d=c.model.id,e=this.fieldsMeta[d];if(e&&">="===e.operation){var f;a.each(this.fieldsMeta,function(a,b){e.idx===a.idx&&b!==d&&"<="===a.operation&&(f=b)}),f&&this.collection.get(f)&&this.ui.minimized.find("#"+f).find("label").html(this.fieldsMeta[f].label+":")}this.collection.remove(c.model),this.ui[d].trigger("empty"),this.trigger("filter:changed"),this.trigger("filter:resized")},onClientSelected:function(a,b){this.selectedClient=b},initClientChosen:function(){this.ui.client.chosen({data:{array:f.getThesaurus("sub_clients").array,id:"client_id",text:"name_cln"}})},getStringQuery:function(a){return"["+a.get("idx")+"] hasi '"+e.escapeSpecialChars(a.get("value"))+"'"},getAmountQuery:function(a){return"["+a.get("idx")+"] "+a.get("operation")+" "+a.get("value")},getNumberQuery:function(a){return"["+a.get("idx")+"] has '"+a.get("value")+"'"},getClientQuery:function(a){return a.get("client_id")?"":this.getStringQuery(a)},onBeforeDestroy:function(){this.ui.client&&this.ui.client.length&&this.ui.client.disposeChosen()}})}),define("text!apps/ua_currency_sale/templates/ua_currency_sale_ext_filter.tmpl",[],function(){return'<div id="expanded-view">\n    <% if (isMultiClient()) { %>\n    <div class="data-row">\n        <div class="row">\n            <label class="col-xs-12"><%- payer %></label>\n        </div>\n        <div class="row">\n            <div class="col-xs-12"><input class="ellipsis" id="client" placeholder="<%- start_entering_name %>"></div>\n        </div>\n    </div>\n    <% } %>\n    <div class="data-row">\n        <div class="row">\n            <label class="col-xs-3"><%- num_doc %></label>\n            <label class="col-xs-6"><%- amount %></label>\n            <label class="col-xs-3"><%- currency %></label>\n        </div>\n        <div class="row">\n            <div class="col-xs-3">\n                <input id="NUM_DOC" maxlength="10">\n            </div>\n            <div class="col-xs-6 amount-filter">\n                <input id="AMOUNT_MIN" class="sum" autocomplete="off" placeholder="<%- from %>">\n                <label class="amount-to">-</label>\n                <input id="AMOUNT_MAX" class="sum" autocomplete="off" placeholder="<%- to %>">\n            </div>\n            <div class="col-xs-3">\n                <input id="SALE_CURRENCY" autocomplete="off" placeholder="<%- all %>">\n            </div>\n        </div>\n    </div>\n    <div class="data-row">\n        <div class="row">\n            <label class="col-xs-6"><%- account %></label>\n        </div>\n        <div class="row">\n            <div class="col-xs-6">\n                <input class="ellipsis" id="SALE_ACCOUNT" maxlength="14" placeholder="<%- start_entering %>">\n            </div>\n        </div>\n    </div>\n</div>\n<div id="minimized-view"></div>\n'}),define("apps/ua_currency_sale/ua_currency_sale_ext_filter_view",["jquery","underscore","backbone","app","bifit","customConstants","collections/thesaurus","appsPieces","commons/base_object/document/document_ext_filter_view","text!apps/ua_currency_sale/templates/ua_currency_sale_ext_filter.tmpl","i18n!nls/document-filter"],function(a,b,c,d,e,f,g,h,i,j,k){"use strict";var l=new c.Collection,m={},n=function(a){return"UAH"!==a.currency&&!b.contains(["2","9","10"],a.type)},o=function(c){return m[c]?a.when(m[c]):h.getClnAccounts(c).then(function(a){return a=b.filter(a,n),h.setAccountComments(a)}).then(function(a){return m[c]=a,a})};return i.extend({template:b.template(j),templateHelpers:b.extend({},i.prototype.templateHelpers,k),className:"ua_currency_sale",ui:b.defaults({client:"#client",NUM_DOC:"#NUM_DOC",AMOUNT_MIN:"#AMOUNT_MIN",AMOUNT_MAX:"#AMOUNT_MAX",SALE_ACCOUNT:"#SALE_ACCOUNT",SALE_CURRENCY:"#SALE_CURRENCY"},i.prototype.ui),events:b.defaults({"blur @ui.AMOUNT_MIN":"validateFilterAmount","blur @ui.AMOUNT_MAX":"validateFilterAmount","change @ui.SALE_CURRENCY":"onChangeCurrency","chosen:select @ui.SALE_CURRENCY":"onChangeCurrency","chosen:select @ui.SALE_ACCOUNT":"onChangeAccount","change @ui.client":"onClientNameChanged"},i.prototype.events),fieldsMeta:{client:{idx:"2",type:"client",label:k.payer},NUM_DOC:{idx:"1",label:k.num_doc},AMOUNT_MIN:{idx:"9",label:k.amount_from,type:"amount",operation:">="},AMOUNT_MAX:{idx:"9",label:k.amount_to,shortLabel:k.to,type:"amount",operation:"<="},SALE_CURRENCY:{idx:"10",label:k.currency},SALE_ACCOUNT:{idx:"11",label:k.account}},accounts:null,initialize:function(a){this.collection=l,this.accounts=[],i.prototype.initialize.call(this,a)},initForm:function(){this.addFormatters(),this.initCurrencyChosen(),this.initAccountsChosen(),this.listenTo(d.mainLayout.content,"content:reloaded",this.highlightFoundText)},addFormatters:function(){this.ui.AMOUNT_MIN.formatter("amount"),this.ui.AMOUNT_MAX.formatter("amount"),this.ui.SALE_ACCOUNT.formatter("number")},initCurrencyChosen:function(){var a=[k.all];this.ui.SALE_CURRENCY.chosen({searchable:!1,data:{array:a},value:k.all}),this.getClientCurrenciesPromise().done(function(b){a.push.apply(a,b),this.ui.SALE_CURRENCY.trigger("refresh",{array:a,value:k.all})}.bind(this))},getClientCurrenciesPromise:function(){var c;return c=d.isMultiClient()?g.getThesaurus("accs_currency").fetch().then(b.partial(b.pluck,b,"currency")):a.when(b.keys(h.getAccounts(["1"],!0))),c.then(function(a){return b.chain(a).without("UAH").sort().value()}).promise()},initAccountsChosen:function(){if(this.ui.SALE_ACCOUNT.chosen({accType:f.NEED_SHOW_ACC_TYPE,data:{id:d.isMultiClient()?"id":"account_id",array:this.accounts,text:["account","currency"]}}),!d.isMultiClient()){var a=b.chain(g.getThesaurus("accs_info").array).filter(n).sortBy("account").value();h.setAccountComments(a).done(function(a){this.accounts=h.addAccountTypeDescription(a),this.refreshAccounts()}.bind(this))}},onChangeCurrency:function(){h.getCurrencies().done(function(a){var c=b.findWhere(a,{currency:this.ui.SALE_CURRENCY.val()}),d=c?c.decimals:2;this.updateAmountDecimals("AMOUNT_MIN",d),this.updateAmountDecimals("AMOUNT_MAX",d)}.bind(this)),this.refreshAccounts()},onChangeAccount:function(a,b){this.ui.SALE_ACCOUNT.val(b.account)},restoreQueryFields:function(){i.prototype.restoreQueryFields.apply(this,arguments);var a=this.collection.get("SALE_CURRENCY");this.ui.SALE_CURRENCY.trigger("choose",a?a.get("value"):k.all)},getFilterValue:function(a){return"SALE_CURRENCY"===a&&this.ui[a].val()===k.all?"":i.prototype.getFilterValue.apply(this,arguments)},onClientNameChanged:function(){var c=this.ui.client.val(),d=b.findWhere(g.getThesaurus("sub_clients").array,{name_cln:c});a.when(d?o(d.client_id):[]).done(function(a){this.accounts=h.addAccountTypeDescription(a),this.refreshAccounts()}.bind(this))},refreshAccounts:function(){var a=this.ui.SALE_CURRENCY.val(),c=a&&a!==k.all?b.where(this.accounts,{currency:a}):this.accounts,d=this.ui.SALE_ACCOUNT.val();if(this.ui.SALE_ACCOUNT.trigger("refresh",{array:c}),d){var e=!c.length||b.any(c,function(a){return a.account.indexOf(d)>-1});this.ui.SALE_ACCOUNT.val(e?d:"").change()}},setDefaults:function(){this.ui.SALE_CURRENCY.trigger("choose",k.all)},highlightFoundText:function(){var a=this.collection.get("NUM_DOC");a&&h.highlightFoundText(a.get("value"),"td.number");var b=this.collection.get("SALE_ACCOUNT");b&&h.highlightFoundText(b.get("value"),"td.sale_account");var c=this.collection.get("client");c&&h.highlightFoundText(c.get("value"),"td.payer")},updateAmountDecimals:function(a,b){this.ui[a].formatter("amount",{decimallength:b});var c=this.ui[a].getUnformattedValue();this.ui[a].val(e.changeFloatScaleWithoutRounding(c,b)).blur()}})}),define("apps/ua_currency_sale/ua_currency_sale_filter_view",["commons/base_object/document/document_state_filter_view","apps/ua_currency_sale/ua_currency_sale_ext_filter_view","i18n!apps/ua_currency_sale/nls/ua_currency_sale"],function(a,b,c){"use strict";return a.extend({documentTypeTitle:c.ua_currency_sale_list,ExtFilterComponent:b})}),define("text!apps/ua_currency_sale/templates/ua_currency_sale_edit.tmpl",[],function(){return'<form>\n    <div class="grey-container">\n        <h1><%- ua_currency_sale %></h1>\n\n        <% if (isMultiClient) { %>\n            <div class="sub-client-info"></div>\n        <% } %>\n\n        <% if (viewMode) { %>\n            <span id="status_desc" class="status-code-<%- statusCode %>"><%- status_desc %></span>\n        <% } %>\n\n    </div>\n\n    <div class="grey-container">\n        <div class="row form-group">\n            <div class="col-xs-3">\n                <label for="NUM_DOC"><%- num_doc %></label>\n                <input type="text" name="NUM_DOC" id="NUM_DOC" maxlength="10" placeholder="<%- autonum %>"/>\n            </div>\n            <div class="col-xs-3 col-xs-offset-1">\n                <label for="DATE_DOC"><%- date_doc %></label>\n\n                <div class="datepicker-container">\n                    <input type="text" name="DATE_DOC" id="DATE_DOC" autocomplete="off"\n                           class="date form-control datepicker"\n                           maxlength="10" placeholder="<%- current %>"/>\n                    <span class="datepicker"></span>\n                </div>\n            </div>\n            <div class="col-xs-4 col-xs-offset-1">\n                <label for="VALUE_DATE"><%- value_date %></label>\n                <input type="text" id="VALUE_DATE" autocomplete="off" class="date"\n                       maxlength="10" placeholder="<%- current %>"/>\n            </div>\n        </div>\n\n        <div class="row form-group">\n            <label class="col-xs-12" for="SALE_SUM"><%- sale_amount %></label>\n\n            <div class="col-xs-5">\n                <input type="text" id="SALE_SUM" name="SALE_SUM" autocomplete="off" placeholder="0.00"/>\n            </div>\n            <div class="col-xs-2">\n                <input type="text" id="SALE_CURRENCY" name="SALE_CURRENCY" autocomplete="off"/>\n            </div>\n        </div>\n\n        <div class="row form-group">\n            <div class="col-xs-7">\n                <input type="text" id="SALE_RATE_KIND" tabindex="3"/>\n            </div>\n            <div class="col-xs-3 row">\n                <input type="text" name="SALE_RATE" id="SALE_RATE" autocomplete="off" class="amount"\n                       placeholder="0.0000"/>\n            </div>\n        </div>\n\n        <div class="row form-group">\n            <div class="col-xs-7">\n                <label for="SALE_ACCOUNT"><%- enroll_to_account %></label>\n                <input type="text" name="SALE_ACCOUNT" id="SALE_ACCOUNT" class="account"/>\n            </div>\n        </div>\n\n        <div class="row form-group">\n            <div class="col-xs-7">\n                <label for="PURCHASE_ACCOUNT"><%- on_acc %></label>\n                <input type="text" name="PURCHASE_ACCOUNT" id="PURCHASE_ACCOUNT" maxlength="14" class="account"/>\n            </div>\n        </div>\n\n        <div class="row form-group">\n            <label class="col-xs-12" for="PURCHASE_BNK_NAME"><%- purchase_amount3 %></label>\n\n            <div class="col-xs-2">\n                <input type="text" id="PURCHASE_BNK_MFO" name="PURCHASE_BNK_MFO" maxlength="6" class="mfo"\n                       placeholder="<%- bank_mfo %>" tabindex="9"/>\n            </div>\n            <div class="col-xs-10">\n                <input type="text" id="PURCHASE_BNK_NAME" name="PURCHASE_BNK_NAME" readonly="readonly" class="name"\n                       placeholder="<%- bank_name %>"/>\n            </div>\n        </div>\n\n        <div class="row">\n            <label class="col-xs-12" for="SALE_CODE_REASON"><%- purpose %></label>\n\n            <div class="col-xs-12">\n                <input type="text" style="padding-right: 2em" name="SALE_CODE_REASON" id="SALE_CODE_REASON"\n                       class="ellipsis" tabindex="5"/>\n            </div>\n        </div>\n        <div class="row form-group">\n            <div class="col-xs-12">\n                <textarea class="col-xs-12" id="SALE_REASON" name="SALE_REASON" rows="1" disabled="disabled"/>\n            </div>\n        </div>\n\n        <div class="row form-group">\n            <label class="col-xs-12" for="RETURN_ACCOUNT"><%- return_account %></label>\n\n            <div class="col-xs-6">\n                <input type="text" name="RETURN_ACCOUNT" id="RETURN_ACCOUNT" autocomplete="off" maxlength="14"\n                       class="account"/>\n            </div>\n        </div>\n\n        <div class="row form-group">\n            <label class="col-xs-12" for="commission_account_kind"><%- commission %></label>\n\n            <div class="col-xs-12">\n                <input type="text" id="commission_account_kind" name="commission_account_kind" autocomplete="off"\n                       class="commission-account-kind"/>\n            </div>\n        </div>\n\n        <br/>\n\n        <div class="row">\n            <div class="col-xs-8">\n                <label for="CLN_EMPLOYEE_FIO"><%- cln_fio %></label>\n                <input id="CLN_EMPLOYEE_FIO" class="fio" type="text" maxlength="40" name="CLN_EMPLOYEE_FIO"\n                       placeholder="<%- fio_placeholder %>" tabindex="13"/>\n            </div>\n            <div class="col-xs-4">\n                <label for="CLN_EMPLOYEE_PHONE"><%- phone %></label>\n                <input id="CLN_EMPLOYEE_PHONE" class="phone" type="text" maxlength="20" name="CLN_EMPLOYEE_PHONE"\n                       placeholder="<%- phone_placeholder %>" tabindex="14"/>\n            </div>\n        </div>\n\n        <div class="row form-group">\n            <div class="attach-container"></div>\n        </div>\n    </div>\n\n\n</form>\n<div class="document-status-bar"></div>\n<div class="comments-bar"></div>\n'}),define("apps/ua_currency_sale/ua_currency_sale_base_item_view",["underscore","commons/base_object/document/document_item_view","text!apps/ua_currency_sale/templates/ua_currency_sale_edit.tmpl","i18n!apps/ua_currency_sale/nls/ua_currency_sale","formatter"],function(a,b,c,d){"use strict";return b.extend({className:"doc-wrapper ua_currency_sale",template:a.template(c),templateHelpers:d,ui:{form:"form",PURCHASE_BNK_NAME_LABEL:"label[for='PURCHASE_BNK_NAME']"},behaviors:{AttachBehavior:{viewType:"VIEW",docType:"ua_currency_sale",checkPermissions:!0}},initialize:function(a){this.rates=a.rates,this.currencies=a.currencies,this.getRatePrecision=a.getRatePrecision,this.fillUiElements(this.getUiElementsTitles())},getUiElementsTitles:function(){return["SALE_KIND","SALE_RATE","PURCHASE_SUM","SALE_CURRENCY","SALE_RATE_KIND","CLN_EMPLOYEE_PHONE","SALE_CURRENCY_SPAN","SALE_PURPOSE","SALE_SUM"]},onShow:function(){b.prototype.onShow.call(this),this.ui.form.attr("id","view"),this.ui.SALE_CURRENCY_SPAN.html(this.model.get("SALE_CURRENCY")),this.setRateKind(),this.addSaleSumFormatter()},addSaleSumFormatter:function(){this.currencies.done(function(b){var c=a.findWhere(b,{currency:this.ui.SALE_CURRENCY.val()}).decimals;if(this.ui.SALE_SUM.formatter("amount",{decimallength:c,maxlength:10}),this.ui.SALE_SUM.val()){var d=parseFloat(this.ui.SALE_SUM.getUnformattedValue()).toFixed(c);this.ui.SALE_SUM.val(d).trigger("paste")}}.bind(this))},setRateKind:function(){var b=this.model.get("SALE_RATE_KIND"),c=a.find(this.rates,function(a){return a.value===b||a.label===b});if("1"===c.id){this.ui.SALE_RATE.show(),this.ui.PURCHASE_SUM.closest("div").show();var d=this.ui.SALE_RATE,e=this.getRatePrecision(this.ui.SALE_CURRENCY.val(),"sale");d.formatter("amount",{decimallength:e,maxlength:4}),d.val().length>0&&d.val(parseFloat(d.getUnformattedValue()).toFixed(e)).trigger("paste")}else this.ui.SALE_RATE.hide(),this.ui.PURCHASE_SUM.closest("div").hide();this.ui.SALE_RATE_KIND.val(c.label),this.setPurchaseBankNameLabel(c.id)},setPurchaseBankNameLabel:function(a){this.ui.PURCHASE_BNK_NAME_LABEL.html("1"===a?d.purchase_amount2:d.purchase_amount3)}})}),define("styles!apps/ua_currency_sale/css/ua_currency_sale",[],function(){}),define("apps/ua_currency_sale/ua_currency_sale_item_view",["underscore","apps/ua_currency_sale/ua_currency_sale_base_item_view","styles!apps/ua_currency_sale/css/ua_currency_sale"],function(a,b){"use strict";return b.extend({ui:a.extend(b.prototype.ui,{COMMISSION_ACCOUNT_KIND:"#commission_account_kind"}),initialize:function(a){b.prototype.initialize.call(this,a),this.commissionKinds=a.commissionKinds,this.fillUiElements(["SALE_REASON","SALE_CODE_REASON","SALE_ACCOUNT","RETURN_ACCOUNT"])},onShow:function(){b.prototype.onShow.call(this),this.ui.SALE_REASON.formatter("oneline_textarea").change();var a=this.commissionKinds[this.model.get("COMMISSION_ACCOUNT")?1:0];this.ui.COMMISSION_ACCOUNT_KIND.val(a.value),this.ui.SALE_CODE_REASON.val(this.model.get("SALE_CODE_REASON")+" "+this.model.get("SALE_REASON")),this.ui.SALE_ACCOUNT.val(this.model.get("SALE_ACCOUNT")+" "+this.model.get("SALE_CURRENCY")),
this.ui.RETURN_ACCOUNT.val(this.model.get("RETURN_ACCOUNT")+" "+this.model.get("SALE_CURRENCY"))},setPurchaseBankNameLabel:function(){}})}),define("apps/ua_currency_sale/ua_currency_sale_base_item_edit",["jquery","underscore","backbone","bifit","appsPieces","commons/base_object/document/document_item_edit","text!apps/ua_currency_sale/templates/ua_currency_sale_edit.tmpl","i18n!apps/ua_currency_sale/nls/ua_currency_sale","formatter","chosen"],function(a,b,c,d,e,f,g,h){"use strict";return f.extend({id:"edit",className:"doc-wrapper ua_currency_sale",template:b.template(g),templateHelpers:h,ui:{selectBoxes:"input.select-box",PURCHASE_BNK_NAME_LABEL:"label[for='PURCHASE_BNK_NAME']"},behaviors:{AttachBehavior:{viewType:"EDIT",docType:"ua_currency_sale",checkPermissions:!0}},events:{"input #SALE_RATE":"calcAmount","input #SALE_SUM":"calcAmount","input #PURCHASE_BNK_MFO":"showBankName","change #PURCHASE_BNK_MFO":"showBankName","change #PURCHASE_ACCOUNT":"onChangePurchaseAccount","change input[type=text]":"onChangeField","chosen:select #SALE_CURRENCY":"onChangeSaleCurrency","chosen:select #PURCHASE_ACCOUNT":"onChangePurchaseAccount","chosen:select #SALE_RATE_KIND":"onChangeSaleRateKind","hide #DATE_DOC":"onBlurDate","blur #DATE_DOC":"onBlurDate"},initialize:function(a){this.rates=a.rates,this.banks=a.banks,this.accounts=a.accounts,this.currencies=a.currencies,this.docType=a.docType,this.getMfo=a.getMfo,this.getRatePrecision=a.getRatePrecision,this.getSaleBnkAccount=a.getSaleBnkAccount,this.fillUiElements(this.getUiElementsTitles())},getUiElementsTitles:function(){return["SALE_SUM","SALE_CURRENCY","PURCHASE_SUM","SALE_KIND","SALE_RATE_KIND","PURCHASE_BNK_MFO","SALE_RATE","SALE_BNK_ACCOUNT","PURCHASE_BNK_NAME","SALE_ACCOUNT","SALE_CURRENCY_SPAN","PURCHASE_ACCOUNT","SALE_PURPOSE","COMMISSION","CLN_EMPLOYEE_PHONE","DATE_DOC"]},onShow:function(){f.prototype.onShow.call(this,arguments),this.addFormatters(),this.initAccountsChosen(),this.fillCurrencyList(),this.fillPurchaseAccount(),this.initBanks(),this.initRateType(),this.initSaleKind(),this.ui.DATE_DOC.formatter("date"),d.datePicker(a("input.datepicker"),{orientation:"bottom auto"})},addFormatters:function(){this.ui.SALE_SUM.formatter("amount"),this.ui.PURCHASE_SUM.formatter("amount"),this.ui.PURCHASE_BNK_MFO.formatter("number"),this.ui.PURCHASE_ACCOUNT.formatter("number"),this.ui.CLN_EMPLOYEE_PHONE.formatter("phone"),this.ui.COMMISSION.formatter("amount",{maxlength:2,decimallength:3})},onBeforeDestroy:function(){this.ui.selectBoxes.disposeChosen()},onChangeField:function(a){if(-1===a.target.id.indexOf("DATE")){var b=this.getConvertRules(),c=["SALE_ACCOUNT","SALE_RATE_KIND","PURCHASE_BNK_MFO"],e=d.convertByRules(a,b,c);return f.prototype.onChangeField.call(this,a,e)}},onBlurDate:function(a){var b=a.target.id;""===this.ui[b].val().replace(/\s+/g,"").replace(/\./g,"")&&this.ui[b].val(""),this.validateField(b,this.ui[b].val())},getConvertRules:function(){return{SALE_SUM:d.getAmountConverterRule(4),SALE_RATE:d.getAmountConverterRule(4)}},refreshField:function(a,b){c.Validation.callbacks.valid(null,a),this.ui[a].val(b),this.model.set(a,b,{silent:!0})},initAccountsChosen:function(a){this.ui.SALE_ACCOUNT.chosen({searchable:!1,width:"9em",data:{array:[],id:"account_id",text:a||"account"}}),this.ui.PURCHASE_ACCOUNT.chosen({searchable:!0,width:"9em",data:{array:[],id:"account_id",text:"account"}})},initBanks:function(){var a={};b.each(this.accounts.UAH,function(b){a[b.mfo]=!0});var c=b.filter(this.banks,function(b){return a[b.bik]});this.ui.PURCHASE_BNK_MFO.chosen({width:"4em",searchable:!0,data:{array:c,id:"bik",text:"bik"}})},initRateType:function(){this.ui.SALE_RATE_KIND.chosen({searchable:!1,width:"13em",data:{id:"id",text:"label",array:this.rates}});var a=b.findWhere(this.rates,{value:this.model.get("SALE_RATE_KIND")});this.ui.SALE_RATE_KIND.trigger("chooseById",(a||b.last(this.rates)).id)},fillCurrencyList:function(){var a=b.without(b.keys(this.accounts),"UAH");if(0===a.length)throw h.no_cur_accs;a.sort(),this.ui.SALE_CURRENCY.chosen({width:"3.6em",searchable:!1,data:{array:a}}),this.onChangeSaleCurrency(null,this.ui.SALE_CURRENCY.val())},fillPurchaseAccount:function(){var a=this.accounts.UAH,b=this.model.get("PURCHASE_ACCOUNT");if(this.ui.PURCHASE_ACCOUNT.trigger("refresh",{array:a||[]}),b)this.ui.PURCHASE_ACCOUNT.val(b).change(),this.ui.PURCHASE_BNK_NAME.val("").change(),this.fillBankName(this.model.get("PURCHASE_BNK_MFO"),"PURCHASE_BNK_NAME");else{var c=d.getStorageDocData(this.docType+"_purchase_bnk_mfo");c&&this.ui.PURCHASE_BNK_MFO.val(c).change();var e=d.getStorageDocData(this.docType+"_purchase_account");e&&(this.ui.PURCHASE_ACCOUNT.val(e),this.validateField("PURCHASE_ACCOUNT",e))}},onChangePurchaseAccount:function(a,e){c.Validation.callbacks.valid(null,a.target.id),e=e||b.findWhere(this.accounts.UAH,{account:a.target.value}),d.setStorageDocData(this.docType+"_purchase_account",e?e.account:a.target.value),e?this.selectAccount(e,"PURCHASE_"):d.setStorageDocData(this.docType+"_purchase_bnk_mfo",this.ui.PURCHASE_BNK_MFO.val())},onChangeSaleCurrency:function(a,c){this.ui.SALE_CURRENCY_SPAN.html(c),this.model.set("SALE_CURRENCY",c),this.refreshAccounts(c);var e=this.getRatePrecision(c,"sale");if(this.setFormattedAmount("SALE_RATE",e,4),this.currencies.done(function(a){var d=b.findWhere(a,{currency:c});this.setFormattedAmount("SALE_SUM",d.decimals,10)}.bind(this)),this.validateField("SALE_BNK_ACCOUNT",this.ui.SALE_BNK_ACCOUNT.val()),d.setStorageDocData(this.docType+"_sale_currency",c),this.ui.SALE_BNK_ACCOUNT&&this.ui.SALE_BNK_ACCOUNT.val()){var f=this.validateField("SALE_BNK_ACCOUNT",this.ui.SALE_BNK_ACCOUNT.val());this.ui.SALE_BNK_ACCOUNT.css("border-color",f?"#FF6666":"")}},setFormattedAmount:function(a,b,c){if(this.ui[a].formatter("amount",{decimallength:b,maxlength:c}),this.ui[a].attr("placeholder",e.getDecimalsPlaceholder(b)),this.ui[a].val()){var d=parseFloat(this.ui[a].getUnformattedValue()).toFixed(b);this.ui[a].val(d).trigger("paste")}},refreshAccounts:function(a){var e=this.accounts[a];if(e){var f=1===e.length?e[0]:b.findWhere(e,{account:this.ui.SALE_ACCOUNT.val()});f=f||(e.length>0?e[0]:{}),this.ui.SALE_ACCOUNT.trigger("refresh",{array:e}),this.ui.SALE_ACCOUNT.trigger("chooseById",f.account_id||""),this.ui.SALE_ACCOUNT.attr("disabled",1===e.length),c.Validation.callbacks.valid(null,"SALE_ACCOUNT")}else this.ui.SALE_ACCOUNT.trigger("refresh",{array:[]}),c.Validation.invalidField(null,"SALE_ACCOUNT",d.sprintf(h.not_acount_for_cur))},selectAccount:function(a,b){var c=b+"ACCOUNT";this.ui[c].val(a.account),this.model.set(c,a.account);var d="SALE_"===b,e=d?"":b;this.model.set(e+"BNK_MFO",a.mfo),d||this.ui[e+"BNK_MFO"].val(a.mfo).change(),this.fillBankName(a.mfo,e+"BNK_NAME")},fillBankName:function(a,b){var c=this.getMfo(a);c&&c.done(function(a){if(1===a.length){var c=a[0].name;this.model.set(b,c),this.$("#"+b).val(c)}"PURCHASE_BNK_NAME"===b&&this.validateField("PURCHASE_BNK_MFO",this.ui.PURCHASE_BNK_MFO.val())}.bind(this))},onChangeSaleRateKind:function(a,b){this.refreshField("PURCHASE_SUM",""),"1"===b.id?(this.ui.SALE_RATE.show(),this.ui.PURCHASE_SUM.closest("div").show(),this.ui.PURCHASE_BNK_NAME_LABEL.html(h.purchase_amount2)):(this.ui.SALE_RATE.hide(),this.ui.PURCHASE_SUM.closest("div").hide(),this.ui.PURCHASE_BNK_NAME_LABEL.html(h.purchase_amount3),this.refreshField("SALE_RATE","")),this.model.set("SALE_RATE_KIND",b.value),this.calcAmount()},calcAmount:function(){var a=parseFloat(+this.ui.SALE_SUM.getUnformattedValue()),b=parseFloat(+this.ui.SALE_RATE.getUnformattedValue()),c="";a&&b&&(c=(a*b).toFixed(2)),this.ui.PURCHASE_SUM.val(d.formatAmount(c)),this.model.set("PURCHASE_SUM",c)},showBankName:function(a){var b=a.target.value;this.refreshField("PURCHASE_BNK_NAME",""),d.setStorageDocData(this.docType+"_purchase_bnk_mfo",b),6===b.length?(this.fillBankName(b,"PURCHASE_BNK_NAME"),this.ui.PURCHASE_ACCOUNT.val().length>0&&this.validateField("PURCHASE_ACCOUNT",this.ui.PURCHASE_ACCOUNT.val())):"change"===a.type&&this.validateField("PURCHASE_BNK_MFO",a.target.value)}})}),define("apps/ua_currency_sale/ua_currency_sale_item_edit",["jquery","underscore","backbone","bifit","appsPieces","commons/base_object/document/document_item_edit","apps/ua_currency_sale/ua_currency_sale_base_item_edit","chosen"],function(a,b,c,d,e,f,g){"use strict";return g.extend({ui:b.extend(g.prototype.ui,{COMMISSION_ACCOUNT_KIND:"#commission_account_kind"}),events:b.extend(g.prototype.events,{"chosen:select @ui.COMMISSION_ACCOUNT_KIND":"onChangeCommissionAccountKind","chosen:select #SALE_ACCOUNT":"onChangeSaleAccount","chosen:select #SALE_CODE_REASON":"onChangeSaleCodeReason","chosen:select #VALUE_DATE":"onChangeValueDate","keyup input#PURCHASE_BNK_MFO":"fillCommissionAccountKind","change input#PURCHASE_BNK_MFO":"fillCommissionAccountKind"}),initialize:function(a){g.prototype.initialize.call(this,a),this.commissionKinds=a.commissionKinds,this.saleReasons=a.saleReasons,this.valueDateKinds=a.valueDateKinds,this.fillUiElements(["SALE_CODE_REASON","SALE_REASON","VALUE_DATE","RETURN_ACCOUNT"]),this.accounts=e.addAccountTypeDescription(this.accounts)},onShow:function(){g.prototype.onShow.call(this,arguments),this.ui.RETURN_ACCOUNT.attr("disabled",!0),this.initCommissionAccountKind(),this.initSaleCodeReason(),this.initValueDateKind()},addFormatters:function(){g.prototype.addFormatters.call(this),this.ui.SALE_REASON.formatter("oneline_textarea").change()},initCommissionAccountKind:function(){this.ui.COMMISSION_ACCOUNT_KIND.chosen({searchable:!1,data:{id:"id",text:"value",array:this.commissionKinds}}),this.fillCommissionAccountKind()},initValueDateKind:function(){this.ui.VALUE_DATE.chosen({searchable:!1,data:{id:"id",text:"value",array:this.valueDateKinds}});var a=this.model.get("VALUE_DATE");this.ui.VALUE_DATE.trigger("chooseById",a?b.findWhere(this.valueDateKinds,{value:a}).id:b.first(this.valueDateKinds).id)},initSaleCodeReason:function(){this.ui.SALE_CODE_REASON.chosen({searchable:!1,data:{array:this.saleReasons,id:"id",text:["id","value"]}}),this.ui.SALE_CODE_REASON.trigger("chooseById",this.model.get("SALE_CODE_REASON")||b.first(this.saleReasons).id)},initAccountsChosen:function(){this.ui.SALE_ACCOUNT.chosen({searchable:!1,accType:!0,data:{array:[],id:"account_id",text:["account","currency"]}}),this.ui.PURCHASE_ACCOUNT.chosen({searchable:!0,accType:!0,data:{array:[],id:"account_id",text:"account"}})},initRateType:function(){this.ui.SALE_RATE_KIND.chosen({searchable:!1,width:"13em",data:{id:"id",text:"label",array:this.rates}});var a=b.findWhere(this.rates,{label:this.model.get("SALE_RATE_KIND")});this.ui.SALE_RATE_KIND.trigger("chooseById",(a||b.last(this.rates)).id)},fillCommissionAccountKind:function(){if("380805"===this.ui.PURCHASE_BNK_MFO.val()){var a=d.getStorageDocData(this.docType+"_commission_account_kind_id")||(this.model.get("COMMISSION_ACCOUNT")?1:0);this.ui.COMMISSION_ACCOUNT_KIND.attr("disabled",!1).trigger("chooseById",a)}else this.ui.COMMISSION_ACCOUNT_KIND.trigger("chooseById","1").attr("disabled",!0)},onChangeCommissionAccountKind:function(a,b){d.setStorageDocData(this.docType+"_commission_account_kind_id",b.id)},onChangeSaleCodeReason:function(a,b){c.Validation.callbacks.valid(null,"SALE_CODE_REASON"),this.model.set({SALE_REASON:b.value},{silent:!0}),this.ui.SALE_REASON.val(b.value).change()},onChangeSaleRateKind:function(a,b){"1"===b.id?this.ui.SALE_RATE.show():(this.ui.SALE_RATE.hide(),this.refreshField("SALE_RATE","")),this.model.set("SALE_RATE_KIND",b.value)},onChangeSaleAccount:function(a,b){this.model.set({BNK_MFO:b.mfo,SALE_ACCOUNT:b.account,RETURN_ACCOUNT:b.account}),this.fillBankName(b.mfo,"BNK_NAME"),this.ui.RETURN_ACCOUNT.val(b.account+" "+b.currency),d.setStorageDocData(this.docType+"_sale_account",b.account_id)},onChangeValueDate:function(a,b){this.model.set("VALUE_DATE","en"===localStorage.getItem("locale")?b.dbValue:b.value)},initSaleKind:function(){}})}),define("commons/base_object/document/document_print_processor",["jquery","underscore","bifit","printUtils"],function(a,b,c,d){"use strict";function e(b,c,d,e,f){this.form=b,this.$mainElement=a(b[0].querySelector("section.main").querySelector("article.main")),this.$printButton=a(b[0].querySelector("button.print.to-printer")),this.$printPdfButton=a(b[0].querySelector("button.print.to-pdf")),this.printStyle=d,this.pdfTemplate=e,this.documentType=c,this.modelStatus=f,this.printPromises=[]}return e.prototype.run=function(c){a(this.form[0].querySelector("#doc-div")).remove(),this.$mainElement.append('<style type="text/css">'+this.printStyle+"</style>"),this.$printPdfButton.parent().show(),d.spinBtn(this.$printButton),d.spinBtn(this.$printPdfButton),d.createLeftMenu(c,this.form).then(function(){var e=this.form.find("input[type=checkbox]");e.prop("disabled",!0),this.renderDocument(c[0],this.$mainElement);var f=!b.contains(["pay_sheet","assign_card_order","fire_staff_order","card_prolongation"],this.documentType);setTimeout(function(){a.when.apply(a,this.printPromises).then(function(){for(var b=f?this.$mainElement.clone(!0):this.$mainElement,g=1;g<c.length;g++)this.renderDocument(c[g],b);a.when.apply(a,this.printPromises).always(function(){f&&(this.$mainElement[0].innerHTML=b[0].innerHTML),e.prop("disabled",!1),d.stopBtn(this.$printButton),d.stopBtn(this.$printPdfButton)}.bind(this))}.bind(this))}.bind(this),300),this.addPrintPdfButtonHandler()}.bind(this))},e.prototype.renderDocument=function(){throw new Error("renderDocument is not implemented")},e.prototype.addPrintPdfButtonHandler=function(){this.$printPdfButton.bind("click",function(){var b=this.documentType+".pdf",e=this.prepareDocumentForPdf(this.$mainElement.clone(!0));a.ajax({type:"POST",url:localStorage.getItem("addr")+"/print_to_pdf;jsessionid="+c.getStoredItem("JSESSIONID"),contentType:"application/x-www-form-urlencoded; charset=UTF-8",mimeType:"text/plain; charset=x-user-defined",data:{html:this.getHtmlForPdf(e),fileName:b,stampAbsolutePosition:!0},success:function(a){d.createPdfFile(a,b,this.form[0])}.bind(this)})}.bind(this))},e.prototype.getHtmlForPdf=function(a){var c={"<br>":"<br/>",'"':'"',"<hr>":"<hr/>"};return b.template(this.pdfTemplate,{content_for_pdf:a[0].outerHTML}).replace(/<br>|"|<hr>/gi,function(a){return c[a]})},e.prototype.prepareDocumentForPdf=function(c){c.find("style").remove(),c.find("h1.empty").remove(),c.find(".hidden").remove(),c.find("colgroup").remove(),this.form.find("#ecp_owner").is(":checked")||c.find(".sign1, .sign2").children().remove(),this.form.find("#service_info").is(":checked")||0===c.find(".serv-info-table")||c.find(".serv-info-table").remove(),b.contains(["ua_payment","ua_payment_request","bank_ua_payment_request"],this.documentType)&&(this.form.find("#two_copies").is(":checked")||0===c.find(".doc-div-copied")||c.find(".doc-div-copied").remove());var d=c.find(".for-img img").parent();return d.empty(),this.form.find("#bank_stamp").is(":checked")&&d.each(function(){var b=a(this);b.append("<"+b.attr("data-stamp-name")+"/>")}),c},e}),define("text!apps/ua_currency_sale/templates/ua_currency_sale_print.tmpl",[],function(){return'<div class="main">\n    <table>\n        <tbody class="centered">\n        <tr>\n            <td width="92%"></td>\n            <td width="8%" class="border doc_ident bold-text">0408005</td>\n        </tr>\n        </tbody>\n    </table>\n    <div class="onright small">Примірник ____</div>\n    <div class="centered bold-text">ЗАЯВА ПРО ПРОДАЖ ІНОЗЕМНОЇ ВАЛЮТИ/</div>\n    <div class="centered bold-text">APPLICATION FOR FOREIGN CURRENCY SALE</div>\n    <table>\n        <tbody>\n        <tr>\n            <td width="32%"></td>\n            <td width="1%" class="bold-text">N</td>\n            <td width="13%" class="bbordered bold-text"> <%- NUM_DOC %></td>\n            <td width="8%" class="bold-text">ВІД/DATED</td>\n            <td width="15%" class="bbordered date-doc bold-text"> <%- DATE_DOC %></td>\n            <td width="31%"></td>\n        </tr>\n        </tbody>\n    </table>\n    <div class="centered bold-text bank-name">\n        <%- BNK_NAME %>, <span class="bank-address"></span> (далі - Банк)\n    </div>\n    <div class="centered bold-text">\n        <span class="bank-eng-name"></span>, <span class="bank-eng-address"></span> (hereinafter - the "Bank")\n    </div>\n    <table class="block">\n        <tr>\n            <td width="35%" class="bold-text">\n                Найменування (прізвище, ім\'я, по батькові) Клієнта /\n                Client name (surname, name)\n            </td>\n            <td colspan="4"><%- CLN_NAME %></td>\n        </tr>\n        <tr>\n            <td class="bold-text">\n                Місцезнаходження (місце проживання) Клієнта /\n                Client address of registered office (place of residence)\n            </td>\n            <td width="36%" colspan="2"><%- CLN_ADDR %></td>\n            <td width="15%" class="bold-text">\n                Код ЄДРПОУ (ідентифікаційний код) Клієнта / Client ID code\n            </td>\n            <td width="14%" class="centered"><%- CLN_OKPO %></td>\n        </tr>\n        <tr>\n            <td width="40%" colspan="2" class="bold-text">\n                Прізвище, ініціали уповноваженого працівника Клієнта /\n                Surname, initials of the Client\'s responsible employee\n                (hereinafter - the "Client\'s responsible employee")\n            </td>\n            <td width="60%" colspan="3"><%- CLN_EMPLOYEE_FIO %></td>\n        </tr>\n        <tr>\n            <td class="bold-text" colspan="2">\n                Контактний телефон уповноваженого працівника Клієнта /\n                Contact telephone of the Client\'s responsible employee\n            </td>\n            <td colspan="3"><%- CLN_EMPLOYEE_PHONE %></td>\n        </tr>\n    </table>\n    <div class="text" align="justify">\n        Клієнт доручає Банку здійснити продаж іноземної валюти на умовах, визначених у цій Заяві. З метою здійснення\n        продажу іноземної валюти Клієнт надає Банку право здійснити договірне списання з Рахунку Клієнта в іноземній\n        валюті Суми іноземної валюти, що підлягає продажу. Клієнт доручає Банку реалізувати зазначене право та\n        здійснити договірне списання у випадку, якщо Клієнт самостійно не здійснить переказ Суми іноземної валюти, що\n        підлягає продажу, в дату подання Заяви. /\n    </div>\n    <div class="small text" align="justify">\n        The Client authorizes the Bank to sell the foreign currency (FCY) based on conditions defined in this\n        Application. For the purpose of selling FCY, the Client authorizes the Bank to perform direct debiting of the\n        Amount for sale in FCY from the Account in FCY. The Client authorizes the Bank to realize mentioned right and\n        to perform direct debiting of funds, if the Client does not provide necessary amount of funds for sale at the\n        date of Application.\n    </div>\n    <table class="block">\n        <tr>\n            <td class="bold-text" style="width: 43%">\n                Сума та назва iноземної валюти, що пiдлягає продажу (цифрами) /\n                Amount and name of FCY for sale (in numbers)\n            </td>\n            <td style="width: 30%" class="sale-sum-numbers"></td>\n            <td style="width: 14%;" class="bold-text">Код валюти / Currency code</td>\n            <td class="centered"><%- SALE_CURRENCY %></td>\n        </tr>\n        <tr>\n            <td class="bold-text">\n                Сума та назва iноземної валюти, що пiдлягає продажу (прописом) /\n                Amount and name of FCY for sale (in words)\n            </td>\n            <td colspan="3" class="sale-sum-words"></td>\n        </tr>\n        <tr>\n            <td class="bold-text">Курс продажу в гривнях/Exchange rate in UAH</td>\n            <td colspan="3" class="sale-rate"></td>\n        </tr>\n    </table>\n    <table class="block margin-top-4">\n        <tr>\n            <td class="bold-text">Додаткова iнформацiя/Additional information:</td>\n        </tr>\n        <tr>\n            <td><%- SALE_CODE_REASON + \' \'%><span class="sale-reason"></span></td>\n        </tr>\n    </table>\n\n    <table class="block margin-top-4">\n        <tr>\n            <td width="40%" class="bold-text">Рахунок Клієнта в іноземній валюті / Client\'s account in FCY</td>\n            <td width="24%"><%- SALE_ACCOUNT %></td>\n            <td width="24%" class="bold-text">Код Банку / Bank code</td>\n            <td width="12%" class="centered"><%- BNK_MFO %></td>\n        </tr>\n    </table>\n    <table class="block margin-top-4">\n        <tr>\n            <td rowspan="2" class="bold-text value-date-desc" style="width: 40%;">\n                Клієнт доручає Банку зарахувати гривневий еквівалент проданої Суми іноземної валюти на рахунок Клієнта\n                в гривнях / The Client authorizes the Bank to credit the UAH equivalent of the sold Amount of FCY to\n                the Client\'s account in UAH\n            </td>\n            <td class="centered checkbox" style="width: 20%;">\n                <% if (VALUE_DATE === \'сьогодні\' || VALUE_DATE === \'сегодня\') { %>\n                <div class="check-mark">&#10004;</div>\n                <% } %>\n            </td>\n            <td class="centered checkbox" style="width: 20%;">\n                <% if (VALUE_DATE === \'завтра\') { %>\n                <div class="check-mark">&#10004;</div>\n                <% } %>\n            </td>\n            <td class="centered checkbox">\n                <% if (VALUE_DATE === \'спот\') { %>\n                <div class="check-mark">&#10004;</div>\n                <% } %>\n            </td>\n        </tr>\n        <tr>\n            <td class="centered">\n                в Дату прийняття Заяви до виконання (Т) /<br/>on the Date of acceptance of the Application for execution\n                (T)\n            </td>\n            <td class="centered">\n                в Дату прийняття Заяви до виконання + 1 роб. день (Т+1) /<br/>on the Date of acceptance of the\n                Application\n                for execution + 1 business day (T+1)\n            </td>\n            <td class="centered">\n                в Дату прийняття Заяви до виконання + 2 роб. дні (Т+2) /<br/>on the Date of acceptance of the\n                Application\n                for execution + 2 business days (T+2)\n            </td>\n        </tr>\n    </table>\n\n    <table class="block margin-top-4">\n        <tr>\n            <td width="40%" class="bold-text">Рахунок Клієнта в гривнях / Client\'s account in UAH</td>\n            <td width="24%"><%- PURCHASE_ACCOUNT %></td>\n            <td width="24%" class="bold-text">Код Банку / Bank code</td>\n            <td width="12%" class="centered"><%- PURCHASE_BNK_MFO %></td>\n        </tr>\n    </table>\n\n    <div class="text" align="justify">\n        У разі неможливості виконання Заяви Клієнт доручає Банку повернути Суму іноземної валюти, що підлягає продажу,\n        на наступний Рахунок Клієнта для повернення коштів: / If the Application cannot be fulfilled, the Client\n        authorizes the Bank to return the Amount of FCY for sale to the following Client’s account for return of funds:\n    </div>\n\n    <table class="block">\n        <tr>\n            <td width="40%" class="bold-text">\n                Рахунок Клієнта для повернення коштів /<br/>Client\'s account for return of funds\n            </td>\n            <td width="24%"><%- RETURN_ACCOUNT %></td>\n            <td width="24%" class="bold-text" style="vertical-align: middle;">Код Банку / Bank code</td>\n            <td width="12%" class="centered"><%- BNK_MFO %></td>\n        </tr>\n    </table>\n\n    <div class="text" align="justify">\n        Клієнт зобов’язується сплатити Банку комісійну винагороду в розмірі, визначеному Тарифами Банку станом на\n        дату прийняття Банком Заяви на виконання. / The Client undertakes to pay the commission fee to the Bank in the\n        amount provided by the Bank’s Tariffs effective as of the date of acceptance by the Bank of the Application for\n        execution.\n    </div>\n\n    <div class="text">\n        З метою сплати комісійної винагороди Клієнт доручає Банку: /\n        In order to ensure payment of the commission fee the Client authorizes the Bank:\n    </div>\n\n    <table class="block">\n        <tr>\n            <td width="2%" class="text commission-account-kind border-right-0">\n                <% if (COMMISSION_ACCOUNT) { %>\n                <div class="checkbox ballot-box">&#9744;</div>\n                <% } else { %>\n                <div class="checkbox ballot-box-with-x">&#9746;</div>\n                <% } %>\n            </td>\n            <td width="98%" valign="middle" class="border-left-0">\n                утримати комісійну винагороду з гривневого еквіваленту проданої валюти /\n                to deduct the commission fee from the UAH equivalent of the sold FCY\n            </td>\n        </tr>\n    </table>\n\n    <div class="small">\n        або / or\n    </div>\n\n    <table class="block margin-top-4">\n        <tr>\n            <td width="2%" class="text commission-account-kind border-right-0">\n                <% if (COMMISSION_ACCOUNT) { %>\n                <div class="checkbox ballot-box-with-x">&#9746;</div>\n                <% } else { %>\n                <div class="checkbox ballot-box">&#9744;</div>\n                <% } %>\n            </td>\n            <td width="98%" class="border-left-0">\n                здійснити договірне списання суми комісійної винагороди з Рахунку Клієнта в гривнях. Клієнт доручає\n                Банку реалізувати зазначене право та здійснити договірне списання у випадку, якщо Клієнт самостійно\n                не здійснить переказ суми комісійної винагороди в дату подання Заяви. У випадку здійснення Банком\n                договірного списання Клієнт зобов’язується забезпечити наявність на Рахунку Клієнта в гривнях коштів\n                у розмірі, необхідному для сплати комісійної винагороди. /\n                <div class="small padding-top-3">\n                    to perform direct debiting of the amount of the commission fee from the Client’s account in UAH.\n                    The Client authorizes the Bank to realize mentioned right and to perform direct debiting of funds,\n                    if the Client does not provide necessary amount of funds for commission fee at the date of\n                    Application. If the Bank performs direct debiting, the Client ensures that the funds in the\n                    required amount are available in the amount enough to pay the commission fee.\n                </div>\n            </td>\n        </tr>\n    </table>\n\n    <div class="text" align="justify">\n        Підписанням цієї Заяви Клієнт підтверджує свою згоду з усіма положеннями, вказаними в цій Заяві, в тому числі\n        наведеними в примітці до цієї Заяви. / By signing this Application the Client confirms its consent will all\n        provisions specified in this Application, including in the note to this Application.\n    </div>\n\n    <div class="text" align="justify">\n        Ця Заява є невід’ємною частиною договору банківського рахунку, укладеного між Клієнтом та Банком. / This\n        Application shall be an inseparable part of the Bank account agreement, concluded between the Client and the\n        Bank.\n    </div>\n\n    <table class="block">\n        <tr>\n            <td width="40%" class="bold-text centered">Керівник Клієнта /<br/>General manager of the Client</td>\n            <td width="20%" style="vertical-align: middle;" valign="middle" class="bold-text centered" rowspan="2">\n                М.П./Seal\n            </td>\n            <td class="bold-text centered">\n                Головний бухгалтер Клієнта (за наявності) / <br/> Chief accountant of the Client (if present)\n            </td>\n        </tr>\n        <tr>\n            <td class="sign">\n                <div>\n                    <div class="sign1"></div>\n                    <table class="sign">\n                        <tr>\n                            <td class="text italic-text">(Прізвище, ініціали/Surname, initials)</td>\n                        </tr>\n                    </table>\n                    <div class="text italic-text">(Підпис/Signature)</div>\n                </div>\n            </td>\n            <td class="sign">\n                <div>\n                    <div class="sign2"></div>\n                    <table class="sign">\n                        <tr>\n                            <td class="text italic-text">(Прізвище, ініціали/Surname, initials)</td>\n                        </tr>\n                    </table>\n                    <div class="text italic-text">(Підпис/Signature)</div>\n                </div>\n            </td>\n        </tr>\n    </table>\n\n    <div class="bold-text">Позначки Банку/Bank\'s remarks:</div>\n\n    <table class="block banks-remarks">\n        <tr>\n            <td width="33%" class="bold-text centered">Дата виконання /Trade date</td>\n            <td width="34%" class="bold-text centered">Розмiр комiсiї, % / Amount of commission fee, %</td>\n            <td width="33%" class="bold-text centered">Сума комiсiї / Amount of commission fee</td>\n        </tr>\n        <tr>\n            <td></td>\n            <td></td>\n            <td></td>\n        </tr>\n    </table>\n    <div>\n        <div class="for-service-info fleft"></div>\n    </div>\n</div>\n<div class="for-img" style="float: right"></div>\n<div class="note">\n    <div align="justify">\n        <span class="bold-text">Примітка:</span> Датою прийняття Заяви є дата отримання Банком Заяви, якщо вона\n        надійшла не пізніше 12:00 відповідного робочого дня. Банк приймає Заяву до виконання виключно за умови, що\n        Клієнт надав необхідні документи відповідно до законодавства України та вимог Банку. Банк має право відмовитися\n        від прийняття Заяви до виконання та/або відмовити у виконанні Заяви. Заява заповнюється українською мовою. Якщо\n        Клієнт в графі "Курс продажу в гривнях" обрав позначку "за курсом Банку", підписанням цієї Заяви Клієнт\n        підтверджує, що він ознайомлений з поточним курсом Банку, оприлюдненим на веб-сторінці Банку в мережі Інтернет\n        (http://www.aval.ua) та/або в системі "Клієнт-Банк", та/або засобами телефонного зв’язку із відповідальним\n        співробітником Банку станом на дату подання Заяви до Банку. Клієнт зобов’язується самостійно слідкувати за\n        змінами курсу Банку до моменту її виконання та не має претензій до Банку стосовно значення курсу Банку. Якщо\n        після подання Заяви до Банку Клієнт не згоден зі змінами курсу Банку та/або бажає відкликати Заяву з інших\n        причин, Клієнт повинен негайно, але до моменту продажу іноземної валюти на підставі цієї Заяви, відкликати\n        Заяву. /\n    </div>\n    <div align="justify">\n        <span class="bold-text">Note:</span> The date of acceptance of the Application is the date of receiving this\n        Application by the Bank, provided that it was transferred not later than 12:00 of the relevant business day.\n        The Bank accepts the Application for execution only if the Client has provided the necessary documents\n        according to the Ukrainian law and the Bank’s requirements. The Bank has the right to refuse accepting the\n        Application for execution and/or to refuse execution of the Application. The Application must be filled in the\n        Ukrainian language. If the Client in the line "Exchange rate in UAH" chooses the option "According to the\n        exchange rate of the Bank", by signing this Application the Client acknowledges that it is aware of the\n        current rate of the Bank published on the Bank’s web page on Internet (http: //www.aval.ua) and/or in the\n        "Client-Bank" system, and/or by means of telephone communication with the responsible employee of the Bank as\n        of the date of submitting the Application to the Bank. The Client agrees to independently monitor changes of\n        the exchange rate of the Bank up to the moment of execution of this Application and has no claims as to the\n        value of the Bank’s exchange rate. If after submitting the Application to the Bank the Client does not agree\n        with changes of the exchange rate of the Bank and/or intends to withdraw the Application from other reasons,\n        the Client must immediately, but in any case by the moment of sale of the foreign currency on the basis of this\n        Application, withdraw this Application\n    </div>\n</div>\n\n';
}),define("text!apps/ua_currency_sale/templates/ua_currency_sale_print_pdf.tmpl",[],function(){return"<html>\n<head>\n<style type=\"text/css\">\narticle div, div td, div span, div p, div h3 {\n    font-family: 'Times Roman', 'Times New Roman', Georgia, serif;\n    font-size: 7pt;\n    word-wrap: break-word;\n    line-height: 1.1;\n}\ndiv.small {\n    font-size: 5pt;\n}\n.onright {\n    text-align: right;\n}\n.border {\n    border: 1px solid black;\n}\n.centered, table.centered td {\n    text-align: center;\n}\n.bold-text {\n    font-weight: bold;\n}\n.italic-text {\n    font-style: italic;\n}\ntd.doc_ident {\n    padding: 2px;\n}\ntable {\n    width: 100%;\n    border-collapse: collapse;\n}\ntable td {\n    padding: 1px;\n}\n.text {\n    padding: 0 15px;\n    font-size: 6pt;\n}\n.bbordered {\n    border-bottom: 1px solid black;\n}\ntable.block {\n    border-top: 2px solid black;\n    border-left: 2px solid black;\n}\ntable.block td {\n    border-right: 2px solid black;\n    border-bottom: 2px solid black;\n    height: 15px;\n}\ntable.sign td {\n    height: 20px;\n    border-width: 1px 0 1px 0;\n}\ntd.sign {\n    text-align: center;\n    padding-top: 3px;\n}\ndiv.sign1, div.sign2 {\n    height: 18px;\n}\ntd.sign div {\n    padding: 0 3px 0 3px;\n}\ndiv.for-service-info {\n    padding-top: 10px;\n    padding-left: 3px;\n}\ndiv table.serv-info-table {\n    border-top: 1px solid black;\n    border-left: 1px solid black;\n}\ndiv table.serv-info-table td {\n    border-right: 1px solid black;\n    border-bottom: 1px solid black;\n}\ndiv table.serv-info-table td {\n    font-size: 7pt;\n}\ndiv table.serv-info-table {\n    font-weight: 600;\n    width: 65%;\n}\ndiv.note div, div.note div span {\n    font-size: 4pt;\n}\ndiv.note div {\n    padding: 0.2em 1.3em;\n}\ntable td.border-right-0 {\n    border-right: 0;\n}\ntable td.border-left-0 {\n    border-left: 0;\n}\n.commission-account-kind {\n    padding: 0 0 0 1em;\n}\ntd.value-date-desc {\n    padding: 10em 1em 0em 1em;\n}\ndiv.main {\n    height: 1000px;\n}\ndiv.padding-top-3 {\n    padding-top: 3px;\n}\n</style>\n</head>\n<body>\n<%= content_for_pdf %>\n</body>\n</html>"}),define("text!apps/ua_currency_sale/css/ua_currency_sale_print.css",[],function(){return"section.doc-print div.doc-div{\npadding:2em 1.5em 1em 5.5em;\nposition:relative;\n}\nsection.doc-print div.for-img img{\ntop:1em !important;\n}\nsection.doc-print div.ua_currency_sale.doc-div *{\nfont-size:7pt;\nline-height:1.1;\n}\nsection.doc-print div.ua_currency_sale .text{\npadding:0 15px;\nfont-size:6pt;\n}\nsection.doc-print div.ua_currency_sale div.small{\nfont-size:5pt;\n}\nsection.doc-print div.ua_currency_sale .border{\nborder:1px solid black;\n}\ndiv.ua_currency_sale div.doc-number,div.date-doc{\nborder-bottom:1px solid black;\ndisplay:inline-block;\n}\ndiv.ua_currency_sale div.doc-number{\nwidth:7em;\ntext-align:left;\n}\ndiv.ua_currency_sale div.date-doc{\nwidth:10em;\n}\ndiv.ua_currency_sale div.bank-name{\npadding-top:0.5em;\n}\ndiv.ua_currency_sale table{\nwidth:100%;\nborder-collapse:collapse;\n}\ndiv.ua_currency_sale table td{\npadding:1px !important;\n}\ndiv.ua_currency_sale table.block,div.ua_currency_sale table.block td{\nborder:2px solid black;\n}\ndiv.ua_currency_sale table td.border-right-0{\nborder-right:none;\n}\ndiv.ua_currency_sale table td.border-left-0{\nborder-left:none;\n}\nsection.doc-print div.ua_currency_sale .checkbox{\nfont-size:12pt;\nvertical-align:middle;\n}\ndiv.ua_currency_sale table.serv-info-table{\npadding-left:0;\n}\nsection.doc-print div.ua_currency_sale.doc-div div.sign1,\nsection.doc-print div.ua_currency_sale.doc-div div.sign2{\nheight:2.2em;\nline-height:2.2em;\n}\ndiv.ua_currency_sale td.sign{\npadding:0 0.5em !important;\ntext-align:center;\nvertical-align:top;\n}\ndiv.ua_currency_sale .margin-top-4{\nmargin-top:0.4em;\n}\nsection.doc-print div.ua_currency_sale div.note div{\nfont-size:4pt;\npadding:0.2em 1.3em;\n}\nsection.doc-print div.ua_currency_sale div.note span{\nfont-size:4pt;\n}\ndiv.ua_currency_sale .commission-account-kind{\npadding-left:0.5em !important;\n}\ndiv.ua_currency_sale .checkbox.perform-debiting{\nheight:1.5em;\nfloat:left;\n}\ndiv.ua_currency_sale td.value-date-desc{\npadding:0.7em 0.7em 0 0.2em !important\n}\ndiv.ua_currency_sale table.banks-remarks tr{\nheight:1.5em;\n}\ndiv.ua_currency_sale table.block td{\nvertical-align:middle;\n}\ndiv.ua_currency_sale table.sign td{\nheight:20px;\nborder-right:none;\nborder-left:none;\nborder-top:1px solid black;\nborder-bottom:1px solid black;\nvertical-align:top;\n}\ndiv.ua_currency_sale div.ballot-box.checkbox,div.ua_currency_sale div.checkbox.ballot-box-with-x{\nfloat:left;\nfont-size:10pt;\n}\nsection.doc-print div.ua_currency_sale div.note{\nposition:absolute;\nbottom:2em;\nmargin:0 3em 0 0;\n}\n"}),define("apps/ua_currency_sale/ua_currency_sale_print",["jquery","underscore","bifit","printUtils","appsPieces","commons/base_object/document/document_print_processor","text!apps/ua_currency_sale/templates/ua_currency_sale_print.tmpl","text!apps/ua_currency_sale/templates/ua_currency_sale_print_pdf.tmpl","text!apps/ua_currency_sale/css/ua_currency_sale_print.css"],function(a,b,c,d,e,f,g,h,i){"use strict";function j(a,b){return c.translate("ua_currency_sale",a,null,null,b||c.getLocale())}function k(a,b){f.call(this,a,b,i,h)}return k.prototype=Object.create(f.prototype),k.prototype.constructor=k,k.prototype.prepareDocumentForPdf=function(a){return a.find(".check-mark").append("<check-mark/>"),a.find(".ballot-box").append("<ballot-box/>"),a.find(".ballot-box-with-x").append("<ballot-box-with-x/>"),f.prototype.prepareDocumentForPdf.call(this,a)},k.prototype.renderDocument=function(a,f){f.append('<div id="doc-div-'+a.id+'" class="doc-div"></div>');var h=f[0].querySelector("#doc-div-"+a.id);h.className=h.className+" "+a.type,h.innerHTML=b.template(g)(a.toJSON());var i=e.getMixedBankInfo(a.get("BNK_MFO")).then(function(a){h.querySelector(".bank-address").innerText=a.addr,h.querySelector(".bank-eng-name").innerText=a.nameLatin,h.querySelector(".bank-eng-address").innerText=a.addrLatin});this.printPromises.push(i),h.querySelector(".date-doc").innerHTML=d.dateToWords(a.get("DATE_DOC")).replace("року","р.").replace(/<(?:.|\n)*?>/g,"");var k=a.get("SALE_CURRENCY"),l=a.get("SALE_RATE");if(l){var m=e.getRatePrecision(k,"sale");h.querySelector("td.sale-rate").innerText=c.formatAmount(l,{decimallength:m}).replace(".",",")}else{var n=j(a.get("SALE_RATE_KIND"),null,null,"uk").then(function(a){h.querySelector("td.sale-rate").innerText=a});this.printPromises.push(n)}var o=e.getCurrencies().then(function(e){var f=b.findWhere(e,{currency:k});if(f){var g=a.toFormattedJSON();h.querySelector(".sale-sum-numbers").innerText=g.SALE_SUM.replace(".",","),h.querySelector(".sale-sum-words").innerText=d.amountToWords(c.removeThousandSeparator(g.SALE_SUM),f)}});this.printPromises.push(o);var p=j(a.get("SALE_REASON"),"uk").then(function(a){h.querySelector(".sale-reason").innerText=a||""});this.printPromises.push(p),this.printPromises.push(d.addDocumentAdditionalInfo(h,a))},function(a){d.createPrintFormForPdf().then(function(b){var c=new k(b,a[0].type);c.run(a)})}}),define("apps/ua_currency_sale/ua_currency_sale_base_controller",["jquery","underscore","backbone","app","bifit","appsPieces","collections/thesaurus","services/doc_permissions","commons/base_object/document/group_opers_document_controller","apps/ua_currency_sale/ua_currency_sale_model","apps/ua_currency_sale/ua_currency_sale_list_view","apps/ua_currency_sale/ua_currency_sale_filter_view","apps/ua_currency_sale/ua_currency_sale_item_view","apps/ua_currency_sale/ua_currency_sale_item_edit","apps/ua_currency_sale/ua_currency_sale_print","text!apps/ua_currency_sale/templates/ua_currency_sale_list_item.tmpl","i18n!apps/ua_currency_sale/nls/ua_currency_sale"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){"use strict";var r=function(a){return f.getRatePrecision(a,"sale")},s=function(a,b){return f.getParam(a+".ua_currency_sale.sale_bnk_account",b)},t=function(){return g.getThesaurus("cln_accounts").fetch()};return i.extend({tabsStatuses:{work:"0,1,2,3,4,6",executed:"5",selectedTab:"work"},Model:j,ListView:k,FilterView:l,View:m,Edit:n,docType:"ua_currency_sale",nls:q,listItemTemplate:p,aliases:null,saleRateDecimals:10,viewDocumentOptions:function(){var a=i.prototype.viewDocumentOptions.call(this);return a.getRatePrecision=r,a.currencies=f.getCurrencies(),this.customViewDocumentOptions(a),a},customViewDocumentOptions:function(a){},showDocumentEdit:function(a,b){g.getThesaurus("account_alias",!1).fetch().done(function(c){this.aliases=c,i.prototype.showDocumentEdit.call(this,a,b)}.bind(this))},editDocumentOptions:function(){var b=i.prototype.editDocumentOptions.call(this),c=a.Deferred();return f.setAccountComments(f.getAccounts()).done(function(a){b.accounts=a,b.banks=f.getBanks(),b.currencies=f.getCurrencies(),b.docType=this.docType,b.getMfo=f.getMfo,b.getRatePrecision=r,b.getSaleBnkAccount=s,this.customEditDocumentOptions(b),c.resolve(b)}.bind(this)),c},customEditDocumentOptions:function(a){},reloadDocumentsList:function(a){d.mainLayout.actionBar.show(this.createActionBar(this.actionsList)),i.prototype.reloadDocumentsList.call(this,a)},prepareContent:function(c){var d=i.prototype.prepareContent.call(this,c);return a.when(f.getCurrencies(),d,t(),this.translateContent(c)).then(function(c,d){var f=a.Deferred(),h=g.getThesaurus("clients").array[0];d.CLN_NAME=h.name_cln,d.CLN_ADDR=h.addr_cln,d.CLN_PHONES=h.phone_cln;var i=b.findWhere(c,{currency:d.SALE_CURRENCY});d.SALE_SUM=d.SALE_SUM?e.roundFloat(d.SALE_SUM,i.decimals,4):"",d.PURCHASE_SUM=d.PURCHASE_SUM?e.roundFloat(d.PURCHASE_SUM,2):"",d.COMMISSION=d.COMMISSION?e.changeFloatScale(d.COMMISSION,3):"",d.SALE_RATE=d.SALE_RATE?e.changeFloatScale(d.SALE_RATE,this.saleRateDecimals):"";var j={BNK_MFO:"BNK_NAME",PURCHASE_BNK_MFO:"PURCHASE_BNK_NAME"},k=[],l=b.keys(j);if(b.each(l,function(a){d[a]&&k.push(d[a])}),k.length>0){var m=b.unique(k),n="[0] IN ('"+m.join("', '")+"')";g.getThesaurus("ua_swift").fetch({data:{query:n,PAGE_NUMBER:0,PAGE_SIZE:m.length}}).done(function(a){var c={};b.each(a,function(a){c[a.code]=a.name}),b.each(j,function(a,b){d[a]=c[d[b]]||""}),f.resolve(d)})}else f.resolve(d);return f}.bind(this))},prepareContent4View:function(b){var c=i.prototype.prepareContent4View.call(this,b);return a.when(c,this.translateContent(b))},prepareContent4Create:function(a){var c=i.prototype.prepareContent4Create.call(this,a);return c.then(function(a){if(a.SALE_KIND=a.SALE_KIND||e.getStorageDocData(this.docType+"_sale_kind")||"0",a.SALE_CURRENCY=a.SALE_CURRENCY||e.getStorageDocData(this.docType+"_sale_currency"),!a.SALE_ACCOUNT){var c=f.getAccounts(),d=b.without(b.keys(c),"UAH");a.SALE_CURRENCY=c[a.SALE_CURRENCY]?a.SALE_CURRENCY:d[0];var g=c[a.SALE_CURRENCY],h=1===g.length?g[0]:b.findWhere(g,{account_id:e.getStorageDocData(this.docType+"_sale_account")});h&&(a.SALE_ACCOUNT=h.account,a.RETURN_ACCOUNT=h.account,a.BNK_MFO=h.mfo,a.BNK_NAME=b.findWhere(f.getBanks(),{bik:h.mfo}).name,this.fillSaleBankAccount(a,h))}return a}.bind(this))},getContentFromForm:function(){var a=i.prototype.getContentFromForm.call(this);return a.SALE_SUM=e.removeThousandSeparator(a.SALE_SUM),a.SALE_SUM=e.changeFloatScale(a.SALE_SUM,4),a.SALE_RATE=e.removeThousandSeparator(a.SALE_RATE),a.SALE_RATE=e.changeFloatScale(a.SALE_RATE,this.saleRateDecimals),delete a.SALE_KIND,delete a.SALE_RATE_KIND,a},PRINT:function(){this.printDocs([this.selectedModel])},SIGN:function(a){return t().then(function(){i.prototype.SIGN.call(this,a)}.bind(this))},printDocs:function(a){o(a,f.getCurrencies(),f.getBanks(),r)},isAccountsForCreateAction:function(){var a=f.getAccounts(),c=b.without(b.keys(a),"UAH"),d=b.filter(a.UAH,function(a){return"1"===a.type});return d.length>0&&c.length>0},getWorkContent:function(a){var b=i.prototype.getWorkContent.call(this,a);return b.attaches=[],b.ATT_CNT="0",b},getNoAccErrorText:function(){return b.without(b.keys(f.getAccounts()),"UAH").length>0?q.no_uah_accs:q.no_cur_accs}})}),define("apps/ua_currency_sale/ua_currency_sale_controller",["jquery","underscore","bifit","app","appsPieces","collections/thesaurus","apps/ua_currency_sale/ua_currency_sale_base_controller","i18n!apps/ua_currency_sale/nls/ua_currency_sale"],function(a,b,c,d,e,f,g,h){"use strict";var i=[{id:"1",value:h.rate0,label:h.rate0_label},{id:"2",value:h.rate1,label:h.rate1_label}],j=[{id:"1",value:h.commission_kind_1},{id:"2",value:h.commission_kind_2}],k=[{id:"",value:""},{id:"11",value:h.sale_purpose_11},{id:"12",value:h.sale_purpose_12},{id:"13",value:h.sale_purpose_13},{id:"14",value:h.sale_purpose_14},{id:"15",value:h.sale_purpose_15},{id:"16",value:h.sale_purpose_16},{id:"18",value:h.sale_purpose_18},{id:"19",value:h.sale_purpose_19}],l=[{id:"1",value:h.today,dbValue:"сьогодні"},{id:"2",value:h.tomorrow,dbValue:"завтра"},{id:"3",value:h.spot,dbValue:"спот"}];return g.extend({saleRateDecimals:4,customViewDocumentOptions:function(a){a.rates=i,a.commissionKinds=j},customEditDocumentOptions:function(a){a.saleReasons=k,a.commissionKinds=j,a.valueDateKinds=l,a.rates=e.getAvailableRates(i)},prepareContent:function(a){var c=g.prototype.prepareContent.call(this,a);return c.then(function(a){return a.CLN_OKPO=f.getThesaurus("clients").array[0].okpo,a.SALE_BNK_ACCOUNT=a.SALE_BNK_BIC=a.SALE_BNK_NAME="",a.SALE_REASON=(b.findWhere(k,{id:a.SALE_CODE_REASON})||{}).value,a})},prepareContent4Import:function(b){return a.when(b).then(function(a){return"en"===localStorage.getItem("locale")&&(a.SALE_RATE_KIND=this.translateSaleRateKind(a),a.VALUE_DATE=this.translateValueDate(a)),a}.bind(this))},prepareContent4Save:function(b){return a.when(b).then(function(a){return"en"===localStorage.getItem("locale")&&(a.SALE_RATE_KIND=this.translateSaleRateKind(a),a.VALUE_DATE=this.translateValueDate(a)),a}.bind(this))},translateSaleRateKind:function(a){var c=b.findWhere(i,{label:a.SALE_RATE_KIND});return c?c.value:a.SALE_RATE_KIND},translateValueDate:function(a){var c=(b.findWhere(l,{value:a.VALUE_DATE})||{}).dbValue;return c||a.VALUE_DATE},translateContent:function(d){var e=a.Deferred(),f=d.SALE_RATE_KIND||b.last(i).value,g=c.translate("ua_currency_sale",f),h=d.VALUE_DATE||b.first(l).value,j=c.translate("ua_currency_sale",h),k=c.translate("ua_currency_sale",d.SALE_REASON);return a.when(g,j,k).done(function(a,b,c){d.SALE_RATE_KIND=a,d.VALUE_DATE=b,d.SALE_REASON=c,e.resolve(d)}),e},getContentFromForm:function(){var a=g.prototype.getContentFromForm.call(this),b=function(b){var c=parseInt(a[b]);return isNaN(c)?"":c.toString()},c=a.commission_account_kind===h.commission_kind_2;return a.COMMISSION_ACCOUNT=c?a.PURCHASE_ACCOUNT:"",a.COMMISSION_BNK_MFO=c?a.PURCHASE_BNK_MFO:"",a.COMMISSION_BNK_NAME=c?a.PURCHASE_BNK_NAME:"",a.SALE_CODE_REASON=b("SALE_CODE_REASON"),a.SALE_ACCOUNT&&(a.SALE_ACCOUNT=b("SALE_ACCOUNT")),delete a.commission_account_kind,a},fillSaleBankAccount:function(){}})}),function(a){var b=document,c="appendChild",d="styleSheet",e=b.createElement("style");e.type="text/css",b.getElementsByTagName("head")[0][c](e),e[d]?e[d].cssText=a:e[c](b.createTextNode(a))}(".ua_currency_sale label{\nmargin-bottom:0.25em !important;\n}\n.ua_currency_sale div.datepicker-container{\nposition:relative;\n}\n.ua_currency_sale #status_desc{\nmargin-bottom:1em;\n}\n.ua_currency_sale div.datepicker-container > span.datepicker{\ntop:5px;\n}\n.ua_currency_sale div.col-md-offset-1 span.error-tooltip{\nwidth:8.6em;\nword-wrap:break-word;\n}");
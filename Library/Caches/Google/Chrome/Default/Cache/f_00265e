define("text!commons/base_object/document/templates/document_ext_filter_minimized_item.tmpl",[],function(){return"<label><%- (label ? label + ': ' : '') %></label>\n<span class=\"value <%- id %>\"><%- displayValue %></span>\n<span class=\"delete-filter-item\">&#10005;</span>"}),define("nls/document-filter",{root:{status_all:"Все",period_from:"Период с",period_to:"по",getdocs:"Получить",loading_docs:"Получение",incorrect_filter_date:"Дата окончания интервала для получения документов ранее даты начала интервала",ua_payment:"Гривневые поручения",bank_ua_payment_request:"Гривневые требования",ua_payment_request:"Гривневые требования",ua_currency_purchase:"Покупка валюты",ua_currency_sale:"Продажа валюты",ua_currency_convert:"Конвертация валюты",ua_currency_payment:"Валютные поручения",pay_sheet:"Зарплатные ведомости",letter:"Письма",inStatus:"В статусе",any:"Все",several:"Выбрано статусов: {1}",num_doc:"Номер документа",currency:"Валюта",amount:"Сумма",from:"от",to:"до",amount_from:"Сумма от",amount_to:"Сумма до",payer:"Плательщик",recipient:"Получатель",account:"Счет",start_entering:"Начинайте вводить",start_entering_acc:"Начинайте вводить номер счета",start_entering_name:"Начинайте вводить наименование",all:"Все",amountError:"Максимальная сумма должна быть больше минимальной"},uk:!0,en:!0}),define("nls/uk/document-filter",{status_all:"Всі",period_from:"Перiод від",period_to:"до",getdocs:"Отримати",loading_docs:"Отримання",incorrect_filter_date:"Дата завершення інтервалу для отримання документів раніше дати початку інтервалу",ua_payment:"Гривневі доручення",bank_ua_payment_request:"Гривневі вимоги",ua_payment_request:"Гривневі вимоги",ua_currency_purchase:"Купівля валюти",ua_currency_sale:"Продаж валюти",ua_currency_payment:"Валютні доручення",ua_currency_convert:"Конвертація валюти",pay_sheet:"Зарплатні відомості",letter:"Листи",inStatus:"У статусі",any:"Всі",several:"Обрано статусів: {1}",num_doc:"Номер документа",currency:"Валюта",amount:"Сума",from:"від",to:"до",amount_from:"Сума від",amount_to:"Сума до",payer:"Платник",recipient:"Отримувач",account:"Рахунок",start_entering:"Починайте вводити",start_entering_acc:"Починайте вводити номер рахунку",start_entering_name:"Починайте вводити найменування",all:"Всі",amountError:"Максимальна сума повинна бути більше ніж мінімальна"}),define("nls/en/document-filter",{status_all:"All",period_from:"Period from",period_to:"to",getdocs:"Receive",loading_docs:"Loading",incorrect_filter_date:"Interval final date for receiving the statement is earlier than its initial one",ua_payment:"Hryvnia Payment orders",bank_ua_payment_request:"Hryvnia Payment requests",ua_payment_request:"Hryvnia Outgoing Payment Request-Orders",ua_currency_purchase:"Currency purchase",ua_currency_sale:"Currency sale",ua_currency_convert:"Currency conversion",ua_currency_payment:"Currency payments",pay_sheet:"Salary sheets",letter:"Letters",inStatus:"In status",any:"Any",several:"Selected statuses: {1}",num_doc:"Document number",currency:"Currency",amount:"Amount",from:"from",to:"to",amount_from:"Amount from",amount_to:"Amount to",payer:"Payer",recipient:"Recipient",account:"Account",start_entering:"Start typing",start_entering_acc:"Start typing the account",start_entering_name:"Start typing the name",all:"All",amountError:"The maximum amount should be more than the minimum"}),define("commons/base_object/document/document_ext_filter_view",["underscore","backbone","marionette","app","bifit","collections/thesaurus","dialogUtils","text!commons/base_object/document/templates/document_ext_filter_minimized_item.tmpl","i18n!nls/document-filter"],function(a,b,c,d,e,f,g,h,i){"use strict";return c.CompositeView.extend({template:a.template('<div id="expanded-view"></div><div id="minimized-view"></div>'),templateHelpers:{isMultiClient:d.isMultiClient},ui:{expanded:"#expanded-view",minimized:"#minimized-view"},events:{"chosen:select #client":"onClientSelected"},fieldsMeta:{},childView:c.ItemView.extend({template:a.template(h),tagName:"span",id:function(){return this.model.id},triggers:{"click .delete-filter-item":"deleteFilterItem"}}),selectedClient:null,childViewContainer:"#minimized-view",childEvents:{deleteFilterItem:"deleteFilterItem"},isExpanded:!0,isFieldsOrder:!1,getExtFilterData:function(){if(this.isExpanded&&this.resetFilterCollection(),this.isValidFilterData()){var b={};return a.extend(b,this.getQueryFilter()),a.extend(b,this.getAdditionalFilter()),a.extend(b,this.getClientIdFilter()),b}},toggleMode:function(){this.isExpanded?this.isValidFilterData()&&(this.ui.expanded.hide(),this.ui.minimized.show(),this.resetFilterCollection()):(this.ui.expanded.show(),this.ui.minimized.hide(),this.restoreFilter()),this.isExpanded=!this.isExpanded,this.trigger("filter:resized")},resetFilter:function(){this.clearForm(),this.setDefaults(),!this.isExpanded&&this.collection.length&&(this.collection.reset(),this.trigger("filter:changed"),this.trigger("filter:resized"))},clearForm:function(){this.ui.expanded.find("input:text:not([readonly])").val("").change().trigger("empty")},setDefaults:function(){},initialize:function(){},onShow:function(){this.initForm(),this.ui.client&&this.ui.client.length&&this.initClientChosen(),this.collection.length&&this.restoreFilter()},initForm:function(){},restoreFilter:function(){this.restoreQueryFields(),this.restoreAdditionalFields()},restoreQueryFields:function(){a.each(this.fieldsMeta,function(a,b){var c=this.collection.get(b);if(0!==this.ui[b].length){var d=c?c.get("displayValue"):"";this.ui[b].val(d),d||this.ui[b].trigger("empty"),this.ui[b].change()}}.bind(this))},restoreAdditionalFields:function(){},resetFilterCollection:function(){var b=a.union(this.collectQueryData(),this.collectAdditionalData());this.isFieldsOrder&&b.sort(function(b,c){return a.has(b,"order")&&a.has(c,"order")?b.order-c.order:0}),this.collection.reset(b)},collectQueryData:function(){var b=[];return a.each(this.fieldsMeta,function(c,d){var e=this.getFilterValue(d);if(e){var f={id:d,idx:c.idx,order:c.order,value:e,type:c.type,operation:c.operation,displayValue:this.getDisplayValue(d),label:"<="===c.operation&&a.findWhere(b,{idx:c.idx})?c.shortLabel:c.label};"client"===c.type&&this.selectedClient&&this.selectedClient.name_cln===f.value&&(f.client_id=this.selectedClient.client_id),b.push(f)}}.bind(this)),b},collectAdditionalData:function(){return[]},getQueryFilter:function(){var b="";return a.each(this.fieldsMeta,function(a,c){var d=this.collection.get(c);if(d){var e=this.getQueryPart(d);e&&(b+=(b?" && ":"")+e)}}.bind(this)),b?{query:b}:{}},getQueryPart:function(a){var b=a.get("type");return"amount"===b?this.getAmountQuery(a):"client"===b?this.getClientQuery(a):"number"===b?this.getNumberQuery(a):this.getStringQuery(a)},getAdditionalFilter:function(){return{}},getClientIdFilter:function(){var a=this.collection.get("client");if(a){var b=a.get("client_id");if(b)return{clients:b}}},isValidFilterData:function(){return this.hasAmountFields()?this.isAmountValid():!0},hasAmountFields:function(){return!!a.findWhere(this.fieldsMeta,{type:"amount"})},isAmountValid:function(){var a=+this.ui.AMOUNT_MIN.getUnformattedValue(),b=+this.ui.AMOUNT_MAX.getUnformattedValue();return!(b>0&&a>b)},clearInvalidFields:function(){this.hasAmountFields()&&!this.isAmountValid()&&this.clearAmountFields()},clearAmountFields:function(){this.ui.AMOUNT_MIN.val(""),this.ui.AMOUNT_MAX.val(""),b.Validation.callbacks.valid(null,"AMOUNT_MIN")},validateFilterAmount:function(){this.isAmountValid()?b.Validation.callbacks.valid(null,"AMOUNT_MIN"):b.Validation.invalidField(this,"AMOUNT_MIN",i.amountError)},getFilterValue:function(a){var b=this.ui[a].getUnformattedValue();return this.fieldsMeta[a]&&("amount"===this.fieldsMeta[a].type||"number"===this.fieldsMeta[a].type)&&0>=b?null:b?b.trim():null},getDisplayValue:function(a){return this.ui[a].val().trim()},deleteFilterItem:function(b,c){var d=c.model.id,e=this.fieldsMeta[d];if(e&&">="===e.operation){var f;a.each(this.fieldsMeta,function(a,b){e.idx===a.idx&&b!==d&&"<="===a.operation&&(f=b)}),f&&this.collection.get(f)&&this.ui.minimized.find("#"+f).find("label").html(this.fieldsMeta[f].label+":")}this.collection.remove(c.model),this.ui[d].trigger("empty"),this.trigger("filter:changed"),this.trigger("filter:resized")},onClientSelected:function(a,b){this.selectedClient=b},initClientChosen:function(){this.ui.client.chosen({data:{array:f.getThesaurus("sub_clients").array,id:"client_id",text:"name_cln"}})},getStringQuery:function(a){return"["+a.get("idx")+"] hasi '"+e.escapeSpecialChars(a.get("value"))+"'"},getAmountQuery:function(a){return"["+a.get("idx")+"] "+a.get("operation")+" "+a.get("value")},getNumberQuery:function(a){return"["+a.get("idx")+"] has '"+a.get("value")+"'"},getClientQuery:function(a){return a.get("client_id")?"":this.getStringQuery(a)},onBeforeDestroy:function(){this.ui.client&&this.ui.client.length&&this.ui.client.disposeChosen()}})}),define("text!apps/ua_payment_request/templates/bank_ua_payment_request_ext_filter.tmpl",[],function(){return'<div id="expanded-view">\n    <% if (isMultiClient()) { %>\n    <div class="data-row">\n        <div class="row">\n            <label class="col-xs-9"><%- payer %></label>\n        </div>\n        <div class="row">\n            <div class="col-xs-9"><input class="ellipsis" id="client" placeholder="<%- start_entering_name %>"></div>\n        </div>\n    </div>\n    <% } %>\n    <div class="data-row">\n        <div class="row">\n            <label class="col-xs-3"><%- num_doc %></label>\n            <label class="col-xs-6"><%- amount %></label>\n        </div>\n        <div class="row">\n            <div class="col-xs-3">\n                <input id="NUM_DOC" maxlength="10">\n            </div>\n            <div class="col-xs-6 amount-filter">\n                <input id="AMOUNT_MIN" class="sum" autocomplete="off" placeholder="<%- from %>">\n                <label class="amount-to">-</label>\n                <input id="AMOUNT_MAX" class="sum" autocomplete="off" placeholder="<%- to %>">\n            </div>\n        </div>\n    </div>\n    <div class="data-row">\n        <div class="row">\n            <label class="col-xs-8"><%- recipient %></label>\n        </div>\n        <div class="row">\n            <div class="col-xs-9">\n                <input id="CLN_NAME" maxlength="40" autocomplete="off" placeholder="<%- start_entering_name %>">\n            </div>\n        </div>\n    </div>\n</div>\n<div id="minimized-view"></div>'}),define("apps/ua_payment_request/bank_ua_payment_request_ext_filter_view",["underscore","backbone","app","appsPieces","collections/editabled_thesaurus","commons/base_object/document/document_ext_filter_view","text!apps/ua_payment_request/templates/bank_ua_payment_request_ext_filter.tmpl","i18n!nls/document-filter"],function(a,b,c,d,e,f,g,h){"use strict";var i=new b.Collection;return f.extend({template:a.template(g),templateHelpers:a.extend({},f.prototype.templateHelpers,h),className:"bank_ua_payment_request",ui:a.defaults({NUM_DOC:"#NUM_DOC",AMOUNT_MIN:"#AMOUNT_MIN",AMOUNT_MAX:"#AMOUNT_MAX",CLN_NAME:"#CLN_NAME",client:"#client"},f.prototype.ui),events:a.defaults({"blur @ui.AMOUNT_MIN":"validateFilterAmount","blur @ui.AMOUNT_MAX":"validateFilterAmount"},f.prototype.events),fieldsMeta:{NUM_DOC:{idx:"1",label:h.num_doc},AMOUNT_MIN:{idx:"2",label:h.amount_from,type:"amount",operation:">="},AMOUNT_MAX:{idx:"2",label:h.amount_to,shortLabel:h.to,type:"amount",operation:"<="},CLN_NAME:{idx:"8",label:h.recipient},client:{idx:"3",type:"client",label:h.payer}},initialize:function(a){this.collection=i,f.prototype.initialize.call(this,a)},initForm:function(){this.addFormatters(),this.initRecipientsChosen(),this.listenTo(c.mainLayout.content,"content:reloaded",this.highlightFoundText)},addFormatters:function(){this.ui.AMOUNT_MIN.formatter("amount"),this.ui.AMOUNT_MAX.formatter("amount")},initRecipientsChosen:function(){this.ui.CLN_NAME.chosen({data:{array:[],id:"id",text:"name"}}),e.getThesaurus("ua_recipients").fetch().done(function(a){this.ui.CLN_NAME.trigger("refresh",{array:a})}.bind(this))},highlightFoundText:function(){var a=this.collection.get("NUM_DOC");a&&d.highlightFoundText(a.get("value"),"td.number");var b=this.collection.get("client");b&&d.highlightFoundText(b.get("value"),"td.payer");var c=this.collection.get("CLN_NAME");c&&d.highlightFoundText(c.get("value"),"td.rcpt")}})}),define("apps/ua_payment_request/nls/ua_payment_request",{root:{request:"Требования-поручения",ua_payment_requests:"Гривневые требования-поручения",ua_payment_request:"Гривневое требование-поручение",footer_s_template:"{1} {2} {3} из {4} на общую сумму {5} грн.",footer_selected_sin:"Выбрано",footer_selected_pl:"Выбрано",footer_1_doc:"требование",footer_1_doc_pl:"требование",footer_2_4_docs:"требования",footer_5_0_docs:"требований"},uk:!0,en:!0}),define("apps/ua_payment_request/nls/uk/ua_payment_request",{request:"Вимоги-доручення",ua_payment_requests:"Гривневі вимоги-доручення",ua_payment_request:"Гривнева вимога-доручення",footer_s_template:"{1} {2} {3} з {4} на загальну суму {5} грн.",footer_selected_sin:"Обрана",footer_selected_pl:"Обрано",footer_1_doc:"вимога",footer_1_doc_pl:"вимога",footer_2_4_docs:"вимоги",footer_5_0_docs:"вимог"}),define("apps/ua_payment_request/nls/en/ua_payment_request",{request:"Requests-orders",ua_payment_requests:"Hryvnia payment request-orders",ua_payment_request:"Hryvnia payment request-order",footer_s_template:"{1} {2} {3} of {4}, total {5} UAH.",footer_selected_sin:"Selected",footer_selected_pl:"Selected",footer_1_doc:"request",footer_1_doc_pl:"requests",footer_2_4_docs:"requests",footer_5_0_docs:"requests"}),define("apps/ua_payment_request/bank_ua_payment_filter_view",["commons/base_object/document/document_filter_view","apps/ua_payment_request/bank_ua_payment_request_ext_filter_view","i18n!apps/ua_payment_request/nls/ua_payment_request"],function(a,b,c){"use strict";return a.extend({documentTypeTitle:c.ua_payment_requests,keyFromSelectedTab:"request",ExtFilterComponent:b})}),define("commons/access_denied_view",["underscore","marionette","bifit"],function(a,b,c){"use strict";return b.ItemView.extend({message:"",text:"",docType:"",template:a.template("<h2><%-message%></h2> <%-text%>"),tagName:"p",className:"message red",templateHelpers:function(){return{message:this.message,text:c.sprintf(this.text,this.docType)}}})}),define("text!templates/views/document/group-filter.tmpl",[],function(){return'<div class="group-checkbox" onmousedown="return false" onselectstart="return false">\n    <div class="popup-wrapper bottom sub-menu">\n        <ul class="popup filter">\n        </ul>\n    </div>\n</div>\n\n'}),define("commons/base_object/document/group_opers_doc_list_view",["jquery","underscore","app","bifit","services/doc_statuses","actionUtils","commons/base_object/base_list_view","text!templates/views/document/group-filter.tmpl","i18n!nls/document","libs/group_opers_utils"],function(a,b,c,d,e,f,g,h,i,j){"use strict";return g.extend({events:b.extend(g.prototype.events,{"click th.check input":"markAll","click div.group-checkbox a":"markByStatus","click div.group-checkbox":"toggleFilter"}),childEvents:b.extend(g.prototype.childEvents,{markOne:"markOne"}),footerNls:null,isAccountsForCreateAction:null,initialize:function(a){g.prototype.initialize.apply(this,arguments),this.isAccountsForCreateAction=a.isAccountsForCreateAction,"false"!==d.getStorageData("is_need_deselect_selected_items")&&b.each(this.collection.selected,function(a){this.collection.deselect(a)}.bind(this)),d.setStorageData("is_need_deselect_selected_items","true")},selectItem:function(a,b){g.prototype.selectItem.call(this,a,b),d.setStorageData("is_need_deselect_selected_items","false")},onRender:function(){g.prototype.onRender.call(this),this.prepareTable()},prepareTable:function(){j.prepareTable.call(this),this.initStatusSelector(),this.postModelMark()},initStatusSelector:function(){var c=b.uniq(b.map(this.collection.models,function(a){return a.get("status")})),f=b.intersection(c,["0","1","3004"]);if(f){if(f.length>1){var g=d.getLocale(),j=a(b.template(h,i)),k=j.find("ul");b.each(f,function(b){var c=parseInt(b,10),f=d.sprintf(i.flt_st,e.getLocalizedNameById(c,g)),h="st"+b;a("<li><a data-action='"+h+"' href='#'>"+f+"</a></li>").appendTo(k)}.bind(this)),this.$("table.list").find("th.check").append(j)}}else this.$("table.list").find("th.check, td.check").hide()},toggleFilter:function(b){b.stopPropagation();var c=a(b.target).find(".sub-menu"),d=function(){c.hide(),a("div.group-checkbox").removeClass("shadow"),a(document).unbind("click.filter-sub-menu")};return"block"===c.css("display")?d():(c.show(),this.$("div.group-checkbox").addClass("shadow"),a(document).bind("click.filter-sub-menu",d)),!0},markOne:j.markOne,markAll:j.markAll,markByStatus:function(c){c.preventDefault(),this.$(".group-checkbox .sub-menu").hide(),this.$("tbody tr").removeClass("selected"),this.$("tbody tr").find("input").prop("checked",!1),this.collection.selectNone();var d=a(c.target).attr("data-action");this.$("tbody tr."+d).addClass("selected"),this.$("tbody tr.selected input").prop("checked",!0);var e=this.collection.where({status:d.substr("st".length)});b.each(e,function(a){a.select()}),this.postModelMark()},postModelMark:function(){var a=this.collection.selectedLength>0,c=this.getAvailableActions(a),d=0;a&&b.each(this.collection.selected,function(a){c=b.intersection(c,f.getPossibleActions(a)),d+=parseFloat(a.getAmount())});var e=this.collection.length===this.collection.selectedLength;this.$("th.check input")[e?"removeClass":"addClass"]("some"),this.$("th.check input").prop("checked",a),this.trigger("update-actions",this.getPermittedActions(c)),this.changeFooter(d.toFixed(2))},getAvailableActions:function(a){var b;return a?(b=[f.DocumentAction.PRINT],(c.isMultiClient()||this.isAccountsForCreateAction)&&(b=b.concat([f.DocumentAction.SIGN,f.DocumentAction.COPY,f.DocumentAction.DELETE]))):(c.isMultiClient()||this.isAccountsForCreateAction)&&(b=[f.DocumentAction.CREATE,f.DocumentAction.IMPORT]),b},getPermittedActions:function(a){for(var c=["CREATE","IMPORT","PRINT","SIGN","COPY","DELETE","CONFIRM","TOGGLE","CFC_CONFIRM","CFC_REJECT","CFC_SIGN"],d=this.getDocumentTypeForActions(),e=[],g=0;g<c.length;g++){var h=c[g],i=b.contains(a,f.DocumentAction[h])&&f.isActionPermitted(h,d);i&&e.push(h+(b.contains(["CREATE","IMPORT"],h)?"":"_GROUP"))}return e},getDocumentTypeForActions:function(){return this.collection.options.document_type},changeFooter:function(a){if(this.footerNls){var b=this.$("tfoot.summary"),c=this.collection.selectedLength;if(b.length){b[c?"show":"hide"]();var e=c%100,f="footer_5_0_docs",g="footer_selected_pl";if(11>e||e>19){var h=c%10;1===h?(f=1===c?"footer_1_doc":"footer_1_doc_pl",g="footer_selected_sin"):h>1&&5>h&&(f="footer_2_4_docs")}var i=this.footerNls,j=d.sprintf(i.footer_s_template,i[g],c,i[f],this.collection.length,a);b.find("td").html(j).trigger("footer:change",c)}}}})}),define("commons/base_object/group_opers_list_item_view",["commons/base_object/base_list_item_view"],function(a){"use strict";return a.extend({triggers:{"click td:not(.check)":"selectItem"},events:{"click td.check input":function(a){this.trigger("markOne",a)}}})}),define("text!apps/ua_payment/templates/ua_payment_list.tmpl",[],function(){return'<table class="list ua_payment" style="display: table;">\n    <thead class="widescreen">\n    <tr>\n        <th class="check">\n            <input type="checkbox"/>\n            <span class="checkbox"></span>\n        </th>\n        <th class="number">\n            <span class="sortable" data-field="NUM_DOC"><%- number %></span>\n        </th>\n        <th class="date">\n            <span class="sortable" data-field="DATE_DOC"><%- date %></span>\n        </th>\n        <% if (!isMultiClient()) { %>\n            <th class="rcpt-account">\n                <span class="sortable" data-field="RCPT_ACCOUNT"><%- field_RCPT_ACCOUNT %></span>\n            </th>\n        <% } %>\n        <% if (isMultiClient()) { %>\n            <th class="payer ellipsis">\n                <span class="sortable" data-field="CLN_NAME"><%= payer %></span>\n            </th>\n        <% } %>\n        <th class="rcpt ellipsis">\n            <span class="sortable" data-field="RCPT_NAME"><%- rcpt %></span>\n        </th>\n        <th class="amount">\n            <span class="sortable" data-field="AMOUNT"><%- amount %></span>\n        </th>\n        <th class="status">\n            <span class="sortable" data-field="status_desc"><%- status %></span>\n        </th>\n        <th class="empty"></th>\n        <th class="mobile">&nbsp;</th>\n    </tr>\n    </thead>\n    <tbody></tbody>\n    <tfoot class="summary">\n        <tr>\n            <td colspan="8"></td>\n        </tr>\n    </tfoot>\n</table>\n'}),define("text!apps/ua_payment/templates/ua_payment_list_item.tmpl",[],function(){return'<td class="check widescreen"><input type=\'checkbox\'/><span class="checkbox"></span></td>\n<td class="number widescreen"><%- NUM_DOC %></td>\n<td class="date widescreen"><%- DATE_DOC %></td>\n<% if (!isMultiClient()) { %>\n<td class="rcpt-account widescreen"><%- RCPT_ACCOUNT %></td>\n<% } %>\n<% if (isMultiClient()) { %>\n    <td class="payer ellipsis widescreen"><%- CLN_NAME %></td>\n<% } %>\n<td class="rcpt ellipsis widescreen"><%- RCPT_NAME %></td>\n<td class="amount widescreen"><%- formatAmount(AMOUNT) %></td>\n<td class="status widescreen"><%- status_desc %></td>\n<td class="empty"></td>\n<td class="deposits mobile">\n    <span class=\'date\'><%- DATE_DOC %></span>\n    <span class=\'amount\'><%- formatAmount(AMOUNT) %></span>\n    <span class=\'rcpt ellipsis\'><%- RCPT_NAME %></span>\n    <span class=\'status\'><%- status_desc %></span>\n</td>\n'}),define("apps/ua_payment/nls/ua_payment_base",{root:{no_uah_accs:"Невозможно создать документ. Отсутствует текущий счет в национальной валюте.",number:"Номер",date:"Дата",rcpt:"Получатель",payer:"Плательщик",sender:"Отправитель",acc:"Счет",several_accs:"неск. счетов",several_reqs:"неск. реквизитов",amount:"Сумма",details:"Назначение",status:"Статус",links:"Связи",linkTo:"Связь с",from:"от",amount_from:"Сумма от",to:"до",of:"из",amount_to:"Сумма до",amountError:"Максимальная сумма должна быть больше минимальной",no_filter:"Выбрать всё",any:"Любые связи",no_links:"Нет связей","doc/pay_sheet":"Зарплатная ведомость",add_to_rcpt:"Сохранить в справочник",pp:"Номер",value_date:"Дата валютир.",date_doc:"Дата документа",from_acc:"Со счета",to_acc:"На счет",by_amount:"Прошу перечислить",okpo:"ЕГРПОУ",mfo:"МФО",details_ext:"Назначение платежа",not_required:"необяз.",current:"текущая",autonum:"автонумер.",name:"Наименование",ua_payment:"Гривневое поручение",ua_payment_list:"Гривневые поручения",ua_payment_print_registry:"Печать реестра",ua_payment_print_docs:"Печать документов",ua_payment_print_registry_title:"Печать реестра документов",to_bank:"Банк",seria:"Серия",passp:"Паспорт",expense_item:"Статья бюджета",budget_payment:"Платеж в бюджет",payment_kind_code_placeholder:"Начинайте вводить код или вид уплаты",nds1:"Без НДС",nds2:"НДС 20%",country_code:"Страна",no_nds_dtls:"Без ПДВ.",with_nds_dtls:"у т.ч. ПДВ ",preload_text:"Загрузка списка получателей",footer_s_template:"{1} {2} {3} из {4} на общую сумму {5} грн.",footer_selected_sin:"Выбрано",footer_selected_pl:"Выбрано",footer_1_doc:"поручение",footer_1_doc_pl:"поручение",footer_2_4_docs:"поручения",footer_5_0_docs:"поручений",field_DATE_DOC:"Дата документа",field_NUM_DOC:"Номер документа",field_AMOUNT:"Сумма платежа",field_CLN_NAME:"Наименование плательщика",field_CLN_OKPO:"ЕГРПОУ плательщика",field_CLN_ACCOUNT:"Счет плательщика",field_CLN_BANK_NAME:"Наименование банка плательщика",field_CLN_BANK_MFO:"МФО банка плательщика",field_RCPT_NAME:"Наименование получателя",field_RCPT_OKPO:"ЕГРПОУ получателя",field_RCPT_ACCOUNT:"Счет получателя",field_RCPT_BANK_NAME:"Наименование банка получателя",field_RCPT_BANK_MFO:"МФО банка получателя",field_PAYMENT_DETAILS:"Назначение платежа",field_VALUE_DATE:"Дата валютирования",field_CLN_COUNTRY_CODE:"Код страны плательщика",field_RCPT_COUNTRY_CODE:"Код страны получателя",field_EXPENSE_ITEM:"Код бюджетирования",field_RCPT_PASSP_SER:"Серия паспорта получателя",field_RCPT_PASSP_NUM:"Номер паспорта получателя",field_PAYER_NAME:"Наименование плательщика",field_PAYER_OKPO:"ЕГРПОУ плательщика",field_PAYER_ACCOUNT:"Счет плательщика",field_PAYER_BANK_NAME:"Наименование банка плательщика",field_PAYER_BANK_MFO:"МФО банка плательщика",field_PAYER_COUNTRY_CODE:"Код страны плательщика",field_PAYER_PASSP_SER:"Серия паспорта плательщика",field_PAYER_PASSP_NUM:"Номер паспорта плательщика",incorrect_payments_kinds:"Указанный код отсутствует в справочнике",incorrectPassp:"Данные паспорта заполнены некорректно. Данные могут представлять собой номер документа (9 символов) или серию и номер документа (6 символов)",bank_client:"ИБИС",requisites_change_is_forbidden:"Для платежей по зарплатному проекту запрещено редактирование основных реквизитов получателя",incoming_payment:"ВХОДЯЩИЕ",sent_payment:"ИСХОДЯЩИЕ",code_type:"Код вида уплаты",payer_number:"Номер плательщика",explain_inf:"Назначение платежа",confirm_select:"Выбрать",close_link_btn:"Закрыть",start_entering:"Начинайте вводить наименование",entering_placeholder:"Начинайте вводить",recount_with_nds:"пересчитать сумму с учетом НДС",item_search:"Поиск статьи",item_code:"Код статьи",code_label:"Код",descr_label:"Описание",planned_remainder:"Планируемый остаток",archives_notification_1:"Обратите внимание, что в этом списке отсутствуют документы с датой создания не больше, чем {1}",archives_notification_2:'Для их просмотра перейдите на вкладку "Архивные"',pay_sheet:"Зарплатная ведомость",link0_title:"Основной платеж",link1_title:"Платеж за РКО",links_warn:"Внимание!",links_incorrect:"'{1}' не соответствует ведомости. Возможная причина - изменение ведомости или документа '{1}'."},uk:!0,en:!0}),define("apps/ua_payment/nls/ua_payment",["underscore","apps/ua_payment/nls/ua_payment_base"],function(a,b){return{root:a.extend({},b.root,{bank_client:"Банк-клиент"}),uk:!0,en:!0}}),define("apps/ua_payment/nls/uk/ua_payment_base",{no_uah_accs:"Неможливо створити документ. Вiдсутнiй поточний рахунок в нацiональнiй валютi.",number:"Номер",date:"Дата",rcpt:"Отримувач",payer:"Платник",sender:"Вiдправник",acc:"Рахунок",several_accs:"дек. рахунків",several_reqs:"дек. реквізитів",amount:"Сума",details:"Призначення",status:"Статус",links:"Зв’язки",linkTo:"Зв’язок з",from:"від",amount_from:"Сума від",to:"до",of:"з",amount_to:"Сума до",amountError:"Максимальна сума повинна бути більше ніж мінімальна",no_filter:"Вибрати все",any:"Будь-які зв'язки",no_links:"Немає зв'язків","doc/pay_sheet":"Зарплатна відомість",add_to_rcpt:"Зберегти у довідник",pp:"Номер",value_date:"Дата валютув.",date_doc:"Дата документа",from_acc:"З рахунку",to_acc:"На рахунок",by_amount:"Прошу перерахувати",okpo:"ЄДРПОУ",mfo:"МФО",to_bank:"Банк",seria:"Серія",passp:"Паспорт",expense_item:"Стаття витрат",budget_payment:"Плата до бюджету",payment_kind_code_placeholder:"Починайте вводити код або вид сплати",nds1:"Без ПДВ",nds2:"ПДВ 20%",country_code:"Країна",details_ext:"Призначення платежу",not_required:"не обов.",current:"поточна",autonum:"автонумер.",name:"Найменування",ua_payment:"Гривневе доручення",ua_payment_list:"Гривневі доручення",ua_payment_print_registry:"Друк реєстру",ua_payment_print_docs:"Друк документів",ua_payment_print_registry_title:"Друк реєстру документів",no_nds_dtls:"Без ПДВ.",with_nds_dtls:"у т.ч. ПДВ ",preload_text:"Завантаження списку отримувачів",footer_s_template:"{1} {2} {3} з {4} на загальну суму {5} грн.",footer_selected_sin:"Обрано",footer_selected_pl:"Обрано",footer_1_doc:"доручення",footer_1_doc_pl:"доручення",footer_2_4_docs:"доручення",footer_5_0_docs:"доручень",field_DATE_DOC:"Дата документа",field_NUM_DOC:"Номер документа",field_AMOUNT:"Сума платежу",field_CLN_NAME:"Найменування платника",field_CLN_OKPO:"ЄДРПОУ платника",field_CLN_ACCOUNT:"Рахунок платника",field_CLN_BANK_NAME:"Найменування банку платника",field_CLN_BANK_MFO:"МФО банку платника",field_RCPT_NAME:"Найменування отримувача",field_RCPT_OKPO:"ЄДРПОУ отримувача",field_RCPT_ACCOUNT:"Рахунок отримувача",field_RCPT_BANK_NAME:"Найменування банку отримувача",field_RCPT_BANK_MFO:"МФО банку отримувача",field_PAYMENT_DETAILS:"Призначення платежу",field_VALUE_DATE:"Дата валютування",field_CLN_COUNTRY_CODE:"Код країни платника",field_RCPT_COUNTRY_CODE:"Код країни отримувача",field_EXPENSE_ITEM:"Код бюджетування",field_RCPT_PASSP_SER:"Серія паспорта отримувача",field_RCPT_PASSP_NUM:"Номер паспорта отримувача",field_PAYER_NAME:"Найменування платника",field_PAYER_OKPO:"ЄДРПОУ платника",field_PAYER_ACCOUNT:"Рахунок платника",field_PAYER_BANK_NAME:"Найменування банку платника",field_PAYER_BANK_MFO:"МФО банку платника",field_PAYER_COUNTRY_CODE:"Код країни платника",field_PAYER_PASSP_SER:"Серія паспорта платника",field_PAYER_PASSP_NUM:"Номер паспорта платника",incorrect_payments_kinds:"Зазначений код відсутній в довіднику",incorrectPassp:"Дані паспорта заповнені некоректно. Дані можуть являти собою номер документа (9 символів) або серію та номер документа (6 символів)",bank_client:"ІБІС",requisites_change_is_forbidden:"Для платежів за зарплатним проектом заборонено редагування основних реквізитів отримувача",incoming_payment:"ВХІДНІ",sent_payment:"ВИХІДНІ",code_type:"Код виду сплати",payer_number:"Номер платника",explain_inf:"Призначення платежу",confirm_select:"Вибрати",close_link_btn:"Закрити",start_entering:"Починайте вводити найменування",entering_placeholder:"Починайте вводити",recount_with_nds:"перерахувати суму враховуючи ПДВ",item_search:"Пошук статті",item_code:"Код статті",code_label:"Код",descr_label:"Опис",planned_remainder:"Плановий залишок",archives_notification_1:"Зверніть увагу, що в цьому списку відсутні документи з датою створення не більш, ніж {1}",archives_notification_2:'Для їх перегляду перейдіть на вкладку "Архівні"',pay_sheet:"Зарплатна відомість",link0_title:"Основний платіж",link1_title:"Платіж за РКО",links_warn:"Увага!",links_incorrect:"'{1}' не відповідає відомості. Можлива причина - зміна відомості або документа '{1}'."}),define("apps/ua_payment/nls/uk/ua_payment",["underscore","apps/ua_payment/nls/uk/ua_payment_base"],function(a,b){return a.extend({},b,{bank_client:"Банк-клієнт"})}),define("apps/ua_payment/nls/en/ua_payment_base",{no_uah_accs:"Unable to create a document. Current account in national currency is missing.",number:"Number",date:"Date",rcpt:"Recipient",payer:"Payer",sender:"Sender",acc:"Account",several_accs:"sev. accounts",several_reqs:"sev. requisites",amount:"Amount",details:"Details",status:"Status",links:"Links",linkTo:"Link with",from:"from",amount_from:"Amount from",to:"to",of:"of",amount_to:"Amount to",amountError:"The maximum amount should be more than the minimum",no_filter:"Select all",any:"Any links",no_links:"No links","doc/pay_sheet":"Salary sheet",add_to_rcpt:"Save to the directory",pp:"Number",value_date:"Value date",date_doc:"Document date",from_acc:"From account",to_acc:"To account",by_amount:"Ask to transfer",okpo:"EDRPOU",mfo:"MFO",details_ext:"Payment details",not_required:"optional",current:"current",autonum:"autonum.",name:"Name",ua_payment:"Hryvnia payment order",ua_payment_list:"Hryvnia payment orders",ua_payment_print_registry:"Print a list",ua_payment_print_docs:"Print documents",ua_payment_print_registry_title:"Print a list of documents",to_bank:"Bank",seria:"Series",passp:"Passport",expense_item:"Budget item",budget_payment:"Budget payment",payment_kind_code_placeholder:"Start to enter a code or type of payment",nds1:"VAT not included",nds2:"VAT 20%",country_code:"Country",no_nds_dtls:"Без ПДВ.",with_nds_dtls:"у т.ч. ПДВ ",preload_text:"Loading of recipients list",footer_s_template:"{1} {2} {3} of {4}, total {5} UAH.",footer_selected_sin:"Selected",footer_selected_pl:"Selected",footer_1_doc:"order",footer_1_doc_pl:"orders",footer_2_4_docs:"orders",footer_5_0_docs:"orders",
field_DATE_DOC:"Document date",field_NUM_DOC:"Document number",field_AMOUNT:"Amount of payment",field_CLN_NAME:"Payer's name",field_CLN_OKPO:"Payer's EDRPOU",field_CLN_ACCOUNT:"Payer's account",field_CLN_BANK_NAME:"Payer's bank name",field_CLN_BANK_MFO:"Payer's bank MFO",field_RCPT_NAME:"Recipient's name",field_RCPT_OKPO:"Recipient's EDRPOU",field_RCPT_ACCOUNT:"Recipient's account",field_RCPT_BANK_NAME:"Recipient's bank name",field_RCPT_BANK_MFO:"Recipient's bank MFO",field_PAYMENT_DETAILS:"Payment details",field_VALUE_DATE:"Value date",field_CLN_COUNTRY_CODE:"Country code of payer",field_RCPT_COUNTRY_CODE:"Country code of recipient",field_EXPENSE_ITEM:"Budgetary code",field_RCPT_PASSP_SER:"Recipient's passport series",field_RCPT_PASSP_NUM:"Recipient's passport number",field_PAYER_NAME:"Payer's name",field_PAYER_OKPO:"Payer's EDRPOU",field_PAYER_ACCOUNT:"Payer's account",field_PAYER_BANK_NAME:"Payer's bank name",field_PAYER_BANK_MFO:"Payer's bank MFO",field_PAYER_COUNTRY_CODE:"Country code of payer",field_PAYER_PASSP_SER:"Payer's passport series",field_PAYER_PASSP_NUM:"Payer's passport number",incorrect_payments_kinds:"Specified code does not exist in directory",incorrectPassp:"Passport requisites are filled incorrectly. Requisites may be a number of the document (9 characters) or a series and number (6 characters)",bank_client:"IBIS",requisites_change_is_forbidden:"It is not allowed to edit the basic requisites of the recipient in the salary project payments",incoming_payment:"INBOX",sent_payment:"OUTBOX",code_type:"Code of payment type",payer_number:"Payer's number",explain_inf:"Payment details",confirm_select:"Select",close_link_btn:"Close",start_entering:"Start typing the name",entering_placeholder:"Start typing",recount_with_nds:"recount the amount in view of VAT",item_search:"Item search",item_code:"Item code",code_label:"Code",descr_label:"Description",planned_remainder:"Planned balance",archives_notification_1:"Please note that in this list are no documents created before {1}",archives_notification_2:'To view them, click on the tab "Archived"',pay_sheet:"Salary sheet",link0_title:"Main payment",link1_title:"Payment for CSS",links_warn:"Attention!",links_incorrect:"'{1}' does not match the salary sheet. Possible cause - changes in salary sheet or in document '{1}'."}),define("apps/ua_payment/nls/en/ua_payment",["underscore","apps/ua_payment/nls/en/ua_payment_base"],function(a,b){return a.extend({},b,{bank_client:"Bank-client"})}),define("apps/ua_payment/ua_payment_list_view",["app","jquery","underscore","bifit","actionUtils","commons/base_object/document/group_opers_doc_list_view","commons/base_object/group_opers_list_item_view","text!apps/ua_payment/templates/ua_payment_list.tmpl","text!apps/ua_payment/templates/ua_payment_list_item.tmpl","text!templates/views/document/group-filter.tmpl","i18n!apps/ua_payment/nls/ua_payment"],function(a,b,c,d,e,f,g,h,i,j,k){"use strict";return f.extend({template:c.template(h),templateHelpers:c.extend({},f.prototype.templateHelpers,k),childView:g.extend({template:c.template(i)}),footerNls:k,getAvailableActions:function(c){var d=[e.DocumentAction.PRINT];return(a.isMultiClient()||this.isAccountsForCreateAction)&&(c?"archived"===b("#tab_statuses .current").attr("data-status")?d.push(e.DocumentAction.COPY):(d=d.concat([e.DocumentAction.SIGN,e.DocumentAction.COPY,e.DocumentAction.DELETE,e.DocumentAction.CONFIRM]),a.isMultiClient()&&(d=d.concat([e.DocumentAction.CFC_CONFIRM,e.DocumentAction.CFC_REJECT]))):d=d.concat([e.DocumentAction.CREATE,e.DocumentAction.IMPORT])),d}})}),define("text!apps/ua_payment_request/templates/bank_ua_payment_request_list.tmpl",[],function(){return'<table class="list ua_payment">\n    <thead class="widescreen">\n    <tr>\n        <th class="check">\n            <input type="checkbox"/>\n            <span class="checkbox"/>\n        </th>\n        <th class="number">\n            <span class="sortable" data-field="NUM_DOC"><%- number %></span>\n        </th>\n        <th class="date">\n            <span class="sortable" data-field="DATE_DOC"><%- date %></span>\n        </th>\n        <% if (isMultiClient()) { %>\n            <th class="payer ellipsis">\n                <span class="sortable" data-field="PAYER_NAME"><%= payer %></span>\n            </th>\n        <% } %>\n        <th class="rcpt ellipsis">\n            <span class="sortable" data-field="CLN_NAME"><%- rcpt %></span>\n        </th>\n        <th class="amount">\n            <span class="sortable" data-field="AMOUNT"><%- amount %></span>\n        </th>\n        <th class="empty"></th>\n        <th colspan="2" class="mobile">&nbsp;</th>\n    </tr>\n    </thead>\n    <tbody></tbody>\n    <tfoot class="summary">\n        <tr>\n            <td colspan="9"></td>\n        </tr>\n    </tfoot>\n</table>\n'}),define("text!apps/ua_payment_request/templates/bank_ua_payment_request_list_item.tmpl",[],function(){return'<%\n    addclass = \'\';\n    if (status == \'11\' && readed == \'0\') { addclass = \'unread\' };\n%>\n<td class="check widescreen"><input type=\'checkbox\'/><span class="checkbox"></span></td>\n<td class="number widescreen <%- addclass %> "><%- NUM_DOC %></td>\n<td class="date widescreen <%- addclass %>"><%- DATE_DOC %></td>\n<% if (isMultiClient()) { %>\n    <td class="payer ellipsis widescreen <%- addclass %>"><%- PAYER_NAME %></td>\n<% } %>\n<td class="rcpt ellipsis widescreen <%- addclass %>"><%- CLN_NAME %></td>\n<td class="amount widescreen <%- addclass %>"><%- formatAmount(AMOUNT) %></td>\n<td class="empty"></td>\n<td class="mobile <%- addclass %>">\n    <span class="date"><%- DATE_DOC %></span>\n    <span class="amount"><%- formatAmount(AMOUNT) %></span>\n\n    <span class="rcpt ellipsis"><%- CLN_NAME %></span>\n    <span class="status"><%- status_desc %></span>\n</td>\n'}),define("apps/ua_payment_request/bank_ua_payment_request_list_view",["jquery","underscore","bifit","app","actionUtils","apps/ua_payment/ua_payment_list_view","text!apps/ua_payment_request/templates/bank_ua_payment_request_list.tmpl","text!apps/ua_payment_request/templates/bank_ua_payment_request_list_item.tmpl","commons/base_object/group_opers_list_item_view","i18n!apps/ua_payment_request/nls/ua_payment_request"],function(a,b,c,d,e,f,g,h,i,j){"use strict";return f.extend({className:"doc-list bank_ua_payment_request",template:b.template(g),childView:i.extend({template:b.template(h)}),footerNls:j,initialize:function(a){f.prototype.initialize.apply(this,arguments),this.allowedAccounts=a.allowedAccounts},getAvailableActions:function(a){return a?[e.DocumentAction.PRINT]:(d.isMultiClient()||this.allowedAccounts&&this.allowedAccounts.length>0)&&!a?[e.DocumentAction.CREATE,e.DocumentAction.IMPORT]:void 0},getDocumentTypeForActions:function(){return"ua_payment_request"}})}),define("apps/ua_payment/ua_payment_model",["jquery","underscore","backbone","collections/thesaurus","bifit","appsPieces","customConstants","models/base_document","i18n!apps/ua_payment/nls/ua_payment","i18n!nls/validation","backboneValidation"],function(a,b,c,d,e,f,g,h,i,j){"use strict";d.getThesaurus("country").fetch();var k=function(a,b,c,d){var e;return"0000000000"===c[d.okpo]&&(a?2!==a.length&&(e=j.invalid_field):9!==c[d.num].length&&(e=j.required)),e},l=function(a,b,c,d){var e;return"0000000000"===c[d.okpo]&&(a?a.length!==(c[d.ser]?6:9)?e=j.invalid_field:a.match(/^\d+$/)||(e=j.incorrect_digest):e=j.required),e};return h.extend({type:"ua_payment",nls:i,defaults:{status:"",status_desc:"",status_color:"000000",planned_remainder:"",DATE_DOC:"",NUM_DOC:"",AMOUNT:"",CLN_NAME:"",CLN_OKPO:"",CLN_ACCOUNT:"",CLN_BANK_NAME:"",CLN_BANK_MFO:"",RCPT_NAME:"",RCPT_OKPO:"",RCPT_ACCOUNT:"",RCPT_BANK_NAME:"",RCPT_BANK_MFO:"",PAYMENT_DETAILS:"",VALUE_DATE:"",CLN_COUNTRY_CODE:"",EXPENSE_ITEM:"",RCPT_COUNTRY_CODE:"",RCPT_PASSP_SER:"",RCPT_PASSP_NUM:""},checkPasspSer:k,checkPasspNum:l,meta:b.extend({},h.prototype.meta,{relatively:b.extend({RCPT_NAME:function(a){return a},AMOUNT:function(a){return parseFloat(a)},CLN_NAME:function(a){return a},PAYER_NAME:function(a){return a}},h.prototype.meta.relatively),formattedFields:{AMOUNT:function(){return this._amountFormatter(this.get("AMOUNT"),2)},planned_remainder:function(){return e.formatAmount(this.get("planned_remainder"))}}}),order:["DATE_DOC","NUM_DOC","AMOUNT","CLN_NAME","CLN_OKPO","CLN_ACCOUNT","CLN_BANK_NAME","CLN_BANK_MFO","RCPT_NAME","RCPT_OKPO","RCPT_ACCOUNT","RCPT_BANK_NAME","RCPT_BANK_MFO","PAYMENT_DETAILS","VALUE_DATE","RCPT_COUNTRY_CODE","CLN_COUNTRY_CODE"],validation:{NUM_DOC:{numDocRequired:!0,maxLength:10},DATE_DOC:{required:!0,dateDoc:!0},AMOUNT:[{required:!0},{max:999999999999.99,pattern:/^\d+\.\d{2}$/,msg:j.incorrect_amount},{min:.01,msg:j.positive_amount}],CLN_NAME:{required:!0,maxLength:40,clientInfo:"name_cln"},CLN_OKPO:{required:!0,clientInfo:"okpo",minLength:8,maxLength:10,digits:!0},CLN_ACCOUNT:[{required:!0,minLength:5,maxLength:14,digits:!0},{fn:function(a){var c,d=b.where(f.getAccounts(g.ACCOUNT_TYPES,!0).UAH,{account:a});if(0===d.length)return c=j.invalid_field;var e=b.any(d,function(a){return a.permissions>0});return e||(c=j.account_not_permission),c}}],CLN_BANK_NAME:{required:!0,maxLength:45},CLN_BANK_MFO:[{required:!0,length:6,digits:!0},{fn:function(a){var c,e=b.any(d.getThesaurus("accs_info").array,function(b){return b.mfo===a});return e||(c=j.invalid_field),c}}],RCPT_NAME:{required:!0,minLength:3,maxLength:40},RCPT_OKPO:{okpo:!0},RCPT_ACCOUNT:[{required:!0,minLength:5,maxLength:14,digits:!0,calcAcc:"RCPT_BANK_MFO"},{fn:function(a,b,c){var d;return c.CLN_ACCOUNT===a&&(d=j.rcpt_acc_eq_cln),d}}],RCPT_BANK_NAME:{required:!0,maxLength:45},RCPT_BANK_MFO:[{required:!0,length:6,digits:!0},{fn:function(a,b,c){var d,e=c.RCPT_BANK_NAME;return e||(d=j.mfo_not_found),d}}],PAYMENT_DETAILS:{required:!0,minLength:3,maxLength:g.PAYMENT_DETAILS_LENGTH},VALUE_DATE:{fn:function(a,b,c){var d;if(a)if(e.checkDateMatch(a)){var f=c.DATE_DOC||e.date2str(new Date);if(f){f=e.str2date(f),a=e.str2date(a);var g=a.getTime()-f.getTime();0>g?d=j.value_date_01:Math.floor(g/1e3/60/60/24)>10&&(d=this._valueDateErrorWrapper(10))}}else d=j.incorrect_date;return d}},CLN_COUNTRY_CODE:{required:!1,digits:!0},RCPT_COUNTRY_CODE:{fn:function(a,c,e){var f,g=e.RCPT_OKPO;return"000000000"===g&&(a?3!==a.length?f=j.invalid_field:a.match(/^\d+$/)?b.findWhere(d.getThesaurus("country").array,{code:a})||(f=j.invalid_field):f=j.incorrect_digest:f=j.required),f}},RCPT_PASSP_SER:{fn:function(a,b,c){return k(a,b,c,{okpo:"RCPT_OKPO",ser:"RCPT_PASSP_SER",num:"RCPT_PASSP_NUM"})}},RCPT_PASSP_NUM:{fn:function(a,b,c){return l(a,b,c,{okpo:"RCPT_OKPO",ser:"RCPT_PASSP_SER",num:"RCPT_PASSP_NUM"})}}},getCurrency:function(){return"UAH"}})}),define("apps/ua_payment_request/bank_ua_payment_request_model",["apps/ua_payment/ua_payment_model"],function(a){"use strict";return a.extend({type:"bank_ua_payment_request",validation:{}})}),define("commons/base_object/document/group_opers_document_controller",["jquery","underscore","bifit","app","dialogUtils","thesaurusUtils","libs/multi_client_utils","actionUtils","collections/thesaurus","commons/base_object/document/document_controller","commons/base_object/document/confirm_reason_view","i18n!nls/document"],function(a,b,c,d,e,f,g,h,i,j,k,l){return j.extend({getListViewOptions:function(){return j.prototype.getListViewOptions.call(this)},addListViewListeners:function(a){j.prototype.addListViewListeners.call(this,a),this.listenTo(a,"update-actions",this.updateActions)},updateActions:function(a){d.mainLayout.actionBar.show(this.createActionBar(a))},COPY_GROUP:function(){var e=new this.Model({type:this.docType}),f=b.groupBy(this.collection.selected,function(a){return a.get("owner_id")}),h=0,j=this,k=b.size(f),m=b.keys(f),n=!1,o=this.showGroupList(l.group_view_copy_h1,{stopOperation:function(){n=!0},entityType:"documents",operationType:"copying"}),p=function(){if(k>h&&!n){var q=m[h++],r=f[q],s=d.isMultiClient()?g.loadTemplate(!1,q,e):e.loadTemplate();s.done(function(e){var f,h=[],k=function(a,b){var d,e=j.getWorkContent(a).NUM_DOC,f=b||e+"/C",g=j.getCurrencyName(a.getCurrency());return d=a.getFAmount()?c.sprintf(l.group_view_copy,e,a.getFAmount(),g,f):c.sprintf(l.group_view_copy_2,e,f)},m=0,s=function(){if(!n)if(m<h.length){var a=h[m++];a.on("model:completeSync",s),a.save({},{silent:!0,emulateClientRequest:d.isMultiClient()})}else p()},t=b.size(r);if(d.isMultiClient()){var u=b.findWhere(i.getThesaurus("sub_clients").array,{client_id:q}),v=r[0].attributes,w=(u||{}).name_cln||v.CLN_NAME||v.PAYER_NAME||v.SENDER,x={statusHandlers:{403:function(a){b.each(r,function(b){var c=k(b);o.add(b,c),b.trigger("model:completeSync",b,l.error,a,403)})}}};f=g.loadSubClientData(q,w,x)}else f=a.Deferred().resolve();f.then(function(){var a=function(b){var c=r[b],d=j.getWorkContent(c),f=d.NUM_DOC;j.prepareContent4Save(j.prepareContent4Create(d)).then(function(d){d.NUM_DOC=""+(e.N?e.N++:f+"/C");var g=new j.Model(d,{silent:!0}),i=k(c,d.NUM_DOC);return j.isAccountsForCreateAction()?(o.add(g,i),h.push(g),void(b===t-1?s():b%100===0?setTimeout(a.bind(this,++b),0):a(++b))):(o.add(g,i),void g.trigger("model:completeSync",g,j.getNoAccErrorText()))})};a(0)})})}};p()},DELETE_GROUP:function(){var a=this.collection.selected,c=function(){var c=!1,e=this.group(function(a,b){this.addModelToGroupView(a,b,"delete")}.bind(this),l.group_view_delete_h1,a,{stopOperation:function(){c=!0},entityType:"documents",operationType:"deleting"}),f=b.pluck(e.children,"model"),g=0,h=function(){if(g<f.length&&!c){var a=f[g++];d.isMultiClient()&&(d.multiClient.currentSubClientId=a.get("owner_id"));var e={statusHandlers:{403:function(a){h()}}};a.destroy(b.extend(e,{silent:!0,wait:!0,emulateClientRequest:d.isMultiClient(),success:function(){a.trigger("model:completeSync",a,"Ok"),h()},error:function(){h()}}))}};h()},f=1===b.keys(a).length?l.confirm_delete_doc:l.confirm_delete_many_doc;e.confirm(f,c,!1,this)},SIGN_GROUP:function(){var e=this.collection.urlRoot+this.docType+"/sign/",i=";jsessionid="+c.getStoredItem("JSESSIONID"),j=b.values(this.collection.selected),k=0,m=!1,n=function(){if(k<j.length&&!m){var o=j[k++],p=o.get("attaches");if(!b.isEmpty(p))for(var q=f.getClientProp("documents.attachments.extensions"),r=0;r<p.length;r++)if(!c.checkAttachExtension(p[r].name,q))return o.trigger("model:completeSync",o,l.error,c.sprintf(l.attach_has_not_allowed_extension,q)),void n();var s=b.isEmpty(p)?a.when():this.loadAndSetAttachesContent(o),t=s.then(function(){var a=this.signData(o);return{content:this.prepare4Sign(a),id:o.get("id")}}.bind(this),function(a){o.trigger("model:completeSync",o,l.error,c.sprintf(l.attach_load_error,a.name)),n()}),u=function(b){SignPluginServices.signData(b.content).then(function(c){a.ajax({type:"POST",dataType:"json",url:e+b.id+i,data:JSON.stringify({id:b.id,sign:c.sign,timestamp:c.timestamp}),success:function(a){o.set(a,{silent:!0}),o.trigger("model:completeSync",o,"Ok","",200),n()},error:function(a){o.trigger("model:completeSync",o,l.error,a.responseText,a.status),n()}})})},v=function(a,c){var d=b.contains(["2","2002","3004"],o.get("status"));if(d||a===w.length)return o.trigger("model:completeSync",o,"Ok","",200),void n();var f=parseInt(o.get("sign_groups_mask"));return h.hasSignOfGroup(f,w[a].GR)?void v(a+1,c):void g.useKey(w[a].ID).then(function(){SignPluginServices.signData(c.content).then(function(b){g.ajax({type:"POST",dataType:"json",url:e+c.id,data:JSON.stringify({id:c.id,sign:b.sign,timestamp:b.timestamp}),currentSubClientKeyId:w[a].ID,success:function(b){return o.set(b,{silent:!0}),b.error&&a<w.length-1?(o.trigger("model:completeSync",o,l.error,b.error,200),void n()):void v(a+1,c)},error:function(a){o.trigger("model:completeSync",o,l.error,a.responseText,a.status),n()}})})})};if(d.isMultiClient())if(-1===this.docType.indexOf("budget")){var w=g.getKeysListLocatedMultiClient(o.get("owner_id"));t.then(v.bind(this,0))}else g.useMultiClientKey().then(function(){t.then(u)});else t.then(u)}}.bind(this);this.group(function(a,b){this.addModelToGroupView(a,b,"sign"),j.length===b.children.length&&n()}.bind(this),l.group_view_sign_h1,j,{stopOperation:function(){m=!0},entityType:"documents",operationType:"signing"})},addModelToGroupView:function(a,b,d){var e,f=a.get("NUM_DOC"),g=a.getFAmount(),h="";g?(e="sign"===d?l.group_view_sign:l.group_view_delete,h=c.sprintf(e,f,g,this.getCurrencyName(a.getCurrency()))):(e="sign"===d?l.group_view_sign_2:l.group_view_delete_2,h=c.sprintf(e,f)),b.add(a,h)},REJECT_GROUP:function(){var a=new k({el:e.wrapper(),templateHelpers:{maxLength:200,title:l[1===this.collection.selectedLength?"reject_doc_title":"reject_docs_title"],ok_button_name:l.reject_link_btn,cancel_button_name:l.close_link_btn}}).render();a.on("confirm",this.groupRejectRequest,this)},groupRejectRequest:function(d){var e=b.values(this.collection.selected),f=0,g=!1,h=function(){if(f<e.length&&!g){var b=e[f++];a.ajax({type:"PUT",contentType:"application/json",data:d||"",url:this.collection.urlRoot+this.docType+"/"+b.get("id")+"/reject"+b._session(),success:function(a){b.set(a,{silent:!0}),a.error?b.trigger("model:completeSync",b,l.error,a.error,200):b.trigger("model:completeSync",b,"Ok","",200),h()}.bind(this),error:function(a){b.trigger("model:completeSync",b,"documentNls.error",a.responseText,a.status),h()}.bind(this)})}}.bind(this);this.group(function(a,b){var d=a.get("NUM_DOC");b.add(a,c.sprintf(l.group_view_reject,d)),e.length===b.children.length&&h()},l.group_view_reject_h1,e,{stopOperation:function(){g=!0},entityType:"documents",operationType:"rejecting"})},prepareDeferredForModelsFetch:function(c){var d=a.Deferred(),e=b.values(this.collection.selected),f=0,g=function(){if(f<this.collection.selectedLength){var a=e[f++];!c||c(a)?(this.listenToOnce(a,"model:completeSync",function(){g()}),a.fetch()):g()}else d.resolve()}.bind(this);return g(),d},PRINT_GROUP:function(a){a.stopPropagation(),this.printDocs(b.values(this.collection.selected))},printDocs:function(){}})}),define("nls/states_types",{root:{any:"любые","new":"новые",in_bank:"в банке",rejected:"отвергнутые",signed:"подписаные",executed:"исполненные",partly_executed:"исп. частично",sent_to_client:"отправленные клиенту",not_confirmed:"не подтвержденные",requires_confirmation:"требуют подтверждения",formed:"сформированные",approved:"одобренные"},uk:!0,en:!0}),define("nls/uk/states_types",{any:"будь-які","new":"нові",in_bank:"у банку",rejected:"відхилені",signed:"підписані",executed:"виконані",partly_executed:"виконані частково",sent_to_client:"відправлені клієнту",not_confirmed:"не підтверджені",requires_confirmation:"вимагають підтвердження",formed:"сформовані",approved:"узгоджені"}),define("nls/en/states_types",{any:"any","new":"new",in_bank:"in bank",rejected:"rejected",signed:"signed",executed:"executed",partly_executed:"partly executed",sent_to_client:"sent to the client",not_confirmed:"not confirmed",requires_confirmation:"requires confirmation",formed:"formed",approved:"approved"}),define("commons/base_object/document/document_state_filter_view",["underscore","commons/base_object/document/document_filter_view","i18n!nls/states_types"],function(a,b,c){"use strict";return b.extend({ui:a.extend({statesChosen:"#state_chosen_filter",statesChosenContainer:"div.state-chosen-filter"},b.prototype.ui),events:a.extend({"chosen:select @ui.statesChosen":"onStateFilterChanged"},b.prototype.events),states:{work:[{id:"any",name:c.any},{id:"new",name:c["new"],filter:"0,1,3004"},{id:"in_bank",name:c.in_bank,filter:"2,3,4,11,12,13,17,2001,2002"},{id:"rejected",name:c.rejected,filter:"6"}]},cache:{},onShow:function(){this.createStateFilter(),b.prototype.onShow.call(this)},createStateFilter:function(){this.ui.statesChosenContainer.show(),this.ui.statesChosen.chosen({searchable:!1,data:{array:[],id:"id",text:"name"}}),this.configureStateFilterForStatusTab()},onStateFilterChanged:function(a,b){b.id!==this.getSelectedState()&&(this.setSelectedState(b.id),this.reload())},changeStatus:function(a){b.prototype.changeStatus.call(this,a),this.configureStateFilterForStatusTab()},configureStateFilterForStatusTab:function(){return this.isStateFilterRequired()?(this.ui.statesChosenContainer.show(),this.ui.statesChosen.trigger("refresh",{array:this.getStatesRef()}),void this.ui.statesChosen.trigger("chooseById",this.getSelectedState())):void this.ui.statesChosenContainer.hide()},reload:function(a){a=this.addStateFilterData(a),b.prototype.reload.call(this,a)},addStateFilterData:function(b){if(this.isStateFilterRequired()){var c=a.findWhere(this.getStatesRef(),{id:this.getSelectedState()});b=c&&c.filter?a.extend({},b,{status:c.filter}):b}return b},getStatesRef:function(){return this.states[this.tabsStatuses.selectedTab]},getSelectedState:function(){return this.cache[this.docType+this.tabsStatuses.selectedTab]||"any"},setSelectedState:function(a){return this.cache[this.docType+this.tabsStatuses.selectedTab]=a},isStateFilterRequired:function(){return this.getStatesRef()&&this.getStatesRef().length>1},onBeforeDestroy:function(){this.ui.statesChosen.disposeChosen()}})}),define("text!apps/ua_payment_request/templates/ua_payment_request_ext_filter.tmpl",[],function(){return'<div id="expanded-view">\n    <div class="data-row">\n        <div class="row">\n            <label class="col-xs-3"><%- num_doc %></label>\n            <label class="col-xs-6"><%- amount %></label>\n        </div>\n        <div class="row">\n            <div class="col-xs-3">\n                <input id="NUM_DOC" maxlength="10">\n            </div>\n            <div class="col-xs-6 amount-filter">\n                <input id="AMOUNT_MIN" class="sum" autocomplete="off" placeholder="<%- from %>">\n                <label class="amount-to">-</label>\n                <input id="AMOUNT_MAX" class="sum" autocomplete="off" placeholder="<%- to %>">\n            </div>\n        </div>\n    </div>\n    <div class="data-row">\n        <div class="row">\n            <label class="col-xs-8"><%- payer %></label>\n        </div>\n        <div class="row">\n            <div class="col-xs-9">\n                <input id="PAYER_NAME" maxlength="40" autocomplete="off" placeholder="<%- start_entering_name %>">\n            </div>\n        </div>\n    </div>\n</div>\n<div id="minimized-view"></div>'}),define("apps/ua_payment_request/ua_payment_request_ext_filter_view",["underscore","backbone","app","appsPieces","collections/editabled_thesaurus","commons/base_object/document/document_ext_filter_view","text!apps/ua_payment_request/templates/ua_payment_request_ext_filter.tmpl","i18n!nls/document-filter"],function(a,b,c,d,e,f,g,h){"use strict";var i=new b.Collection;return f.extend({template:a.template(g),templateHelpers:a.extend({},f.prototype.templateHelpers,h),className:"ua_payment_request",ui:a.defaults({PAYER_NAME:"#PAYER_NAME",NUM_DOC:"#NUM_DOC",AMOUNT_MIN:"#AMOUNT_MIN",AMOUNT_MAX:"#AMOUNT_MAX"},f.prototype.ui),events:a.defaults({"blur @ui.AMOUNT_MIN":"validateFilterAmount","blur @ui.AMOUNT_MAX":"validateFilterAmount"},f.prototype.events),fieldsMeta:{PAYER_NAME:{idx:"3",label:h.payer},NUM_DOC:{idx:"1",label:h.num_doc},AMOUNT_MIN:{idx:"2",label:h.amount_from,type:"amount",operation:">="},AMOUNT_MAX:{idx:"2",label:h.amount_to,shortLabel:h.to,type:"amount",operation:"<="}},initialize:function(a){this.collection=i,f.prototype.initialize.call(this,a)},initForm:function(){this.addFormatters(),this.initRecipientsChosen(),this.listenTo(c.mainLayout.content,"content:reloaded",this.highlightFoundText)},addFormatters:function(){this.ui.AMOUNT_MIN.formatter("amount"),this.ui.AMOUNT_MAX.formatter("amount")},initRecipientsChosen:function(){this.ui.PAYER_NAME.chosen({data:{array:[],id:"id",text:"name"}}),e.getThesaurus("ua_recipients").fetch().done(function(a){this.ui.PAYER_NAME.trigger("refresh",{array:a})}.bind(this))},highlightFoundText:function(){var a=this.collection.get("NUM_DOC");a&&d.highlightFoundText(a.get("value"),"td.number");var b=this.collection.get("PAYER_NAME");b&&d.highlightFoundText(b.get("value"),"td.rcpt")}})}),define("text!apps/ua_payment_request/templates/ua_payment_request_list_item.tmpl",[],function(){return'<td class="check widescreen"><input type="checkbox"/><span class="checkbox"></span></td>\n<td class="number widescreen"><%- NUM_DOC %></td>\n<td class="date widescreen"><%- DATE_DOC %></td>\n<td class="rcpt ellipsis widescreen"><%- PAYER_NAME %></td>\n<td class="amount widescreen"><%- formatAmount(AMOUNT) %></td>\n<td class="status widescreen"><%- status_desc %></td>\n<td class="empty"></td>\n<td class="mobile">\n    <span class="date"><%- DATE_DOC %></span>\n    <span class="amount"><%- formatAmount(AMOUNT) %></span>\n\n    <span class="rcpt ellipsis"><%- PAYER_NAME %></span>\n    <span class="status"><%- status_desc %></span>\n</td>\n'}),define("text!apps/ua_payment_request/templates/ua_payment_request_list.tmpl",[],function(){return'<table class="list ua_payment_request" style="display: table;">\n    <thead class="widescreen">\n    <tr>\n        <th class="check">\n            <input type="checkbox"/>\n            <span class="checkbox"></span>\n        </th>\n        <th class="number">\n            <span class="sortable" data-field="NUM_DOC"><%- number %></span>\n        </th>\n        <th class="date">\n            <span class="sortable" data-field="DATE_DOC"><%- date %></span>\n        </th>\n        <th class="rcpt ellipsis">\n            <span class="sortable" data-field="PAYER_NAME"><%- payer %></span>\n        </th>\n        <th class="amount">\n            <span class="sortable" data-field="AMOUNT"><%- amount %></span>\n        </th>\n        <th class="status">\n            <span class="sortable" data-field="status_desc"><%- status %></span>\n        </th>\n        <th class="empty"></th>\n        <th class="mobile">&nbsp;</th>\n    </tr>\n    </thead>\n    <tbody></tbody>\n    <tfoot class="summary">\n    <tr>\n        <td colspan="8"></td>\n    </tr>\n    </tfoot>\n</table>\n'}),define("styles!apps/ua_payment_request/css/ua_payment_request",[],function(){}),define("apps/ua_payment_request/ua_payment_request_list_view",["jquery","underscore","bifit","commons/base_object/document/group_opers_doc_list_view","commons/base_object/group_opers_list_item_view","text!apps/ua_payment_request/templates/ua_payment_request_list_item.tmpl","text!apps/ua_payment_request/templates/ua_payment_request_list.tmpl","i18n!apps/ua_payment_request/nls/ua_payment_request","styles!apps/ua_payment_request/css/ua_payment_request"],function(a,b,c,d,e,f,g,h){"use strict";return d.extend({className:"doc-list ua_payment",template:b.template(g),templateHelpers:function(){return this.nls},footerNls:h,childView:e.extend({template:b.template(f)}),initialize:function(a){d.prototype.initialize.apply(this,arguments),this.nls=a.nls}})}),function(a){"use strict";function b(a){function l(a,b){var c,d,e,f,g,h,i=this;if(!(i instanceof l))return R&&E(26,"constructor call without new",a),new l(a,b);if(null!=b&&S(b,2,64,I,"base")){if(b=0|b,h=a+"",10==b)return i=new l(a instanceof l?a:h),F(i,L+i.e+1,M);if((f="number"==typeof a)&&0*a!=0||!new RegExp("^-?"+(c="["+s.slice(0,b)+"]+")+"(?:\\."+c+")?$",37>b?"i":"").test(h))return H(i,h,f,b);f?(i.s=0>1/a?(h=h.slice(1),-1):1,R&&h.replace(/^0\.0*|\./,"").length>15&&E(I,r,a),f=!1):i.s=45===h.charCodeAt(0)?(h=h.slice(1),-1):1,h=z(h,10,b,i.s)}else{if(a instanceof l)return i.s=a.s,i.e=a.e,i.c=(a=a.c)?a.slice():a,void(I=0);if((f="number"==typeof a)&&0*a==0){if(i.s=0>1/a?(a=-a,-1):1,a===~~a){for(d=0,e=a;e>=10;e/=10,d++);return i.e=d,i.c=[a],void(I=0)}h=a+""}else{if(!m.test(h=a+""))return H(i,h,f);i.s=45===h.charCodeAt(0)?(h=h.slice(1),-1):1}}for((d=h.indexOf("."))>-1&&(h=h.replace(".","")),(e=h.search(/e/i))>0?(0>d&&(d=e),d+=+h.slice(e+1),h=h.substring(0,e)):0>d&&(d=h.length),e=0;48===h.charCodeAt(e);e++);for(g=h.length;48===h.charCodeAt(--g););if(h=h.slice(e,g+1))if(g=h.length,f&&R&&g>15&&(a>v||a!==o(a))&&E(I,r,i.s*a),d=d-e-1,d>Q)i.c=i.e=null;else if(P>d)i.c=[i.e=0];else{if(i.e=d,i.c=[],e=(d+1)%u,0>d&&(e+=u),g>e){for(e&&i.c.push(+h.slice(0,e)),g-=u;g>e;)i.c.push(+h.slice(e,e+=u));h=h.slice(e),e=u-h.length}else e-=g;for(;e--;h+="0");i.c.push(+h)}else i.c=[i.e=0];I=0}function z(a,b,c,e){var f,g,i,k,m,n,o,p=a.indexOf("."),q=L,r=M;for(37>c&&(a=a.toLowerCase()),p>=0&&(i=V,V=0,a=a.replace(".",""),o=new l(c),m=o.pow(a.length-p),V=i,o.c=h(j(d(m.c),m.e),10,b),o.e=o.c.length),n=h(a,c,b),g=i=n.length;0==n[--i];n.pop());if(!n[0])return"0";if(0>p?--g:(m.c=n,m.e=g,m.s=e,m=G(m,o,q,r,b),n=m.c,k=m.r,g=m.e),f=g+q+1,p=n[f],i=b/2,k=k||0>f||null!=n[f+1],k=4>r?(null!=p||k)&&(0==r||r==(m.s<0?3:2)):p>i||p==i&&(4==r||k||6==r&&1&n[f-1]||r==(m.s<0?8:7)),1>f||!n[0])a=k?j("1",-q):"0";else{if(n.length=f,k)for(--b;++n[--f]>b;)n[f]=0,f||(++g,n=[1].concat(n));for(i=n.length;!n[--i];);for(p=0,a="";i>=p;a+=s.charAt(n[p++]));a=j(a,g)}return a}function A(a,b,c,e){var f,g,h,k,m;if(c=null!=c&&S(c,0,8,e,q)?0|c:M,!a.c)return a.toString();if(f=a.c[0],h=a.e,null==b)m=d(a.c),m=19==e||24==e&&N>=h?i(m,h):j(m,h);else if(a=F(new l(a),b,c),g=a.e,m=d(a.c),k=m.length,19==e||24==e&&(g>=b||N>=g)){for(;b>k;m+="0",k++);m=i(m,g)}else if(b-=h,m=j(m,g),g+1>k){if(--b>0)for(m+=".";b--;m+="0");}else if(b+=g-k,b>0)for(g+1==k&&(m+=".");b--;m+="0");return a.s<0&&f?"-"+m:m}function B(a,b){var c,d,e=0;for(g(a[0])&&(a=a[0]),c=new l(a[0]);++e<a.length;){if(d=new l(a[e]),!d.s){c=d;break}b.call(c,d)&&(c=d)}return c}function C(a,b,c,d,e){return(b>a||a>c||a!=k(a))&&E(d,(e||"decimal places")+(b>a||a>c?" out of range":" not an integer"),a),!0}function D(a,b,c){for(var d=1,e=b.length;!b[--e];b.pop());for(e=b[0];e>=10;e/=10,d++);return(c=d+c*u-1)>Q?a.c=a.e=null:P>c?a.c=[a.e=0]:(a.e=c,a.c=b),a}function E(a,b,c){var d=new Error(["new BigNumber","cmp","config","div","divToInt","eq","gt","gte","lt","lte","minus","mod","plus","precision","random","round","shift","times","toDigits","toExponential","toFixed","toFormat","toFraction","pow","toPrecision","toString","BigNumber"][a]+"() "+b+": "+c);throw d.name="BigNumber Error",I=0,d}function F(a,b,c,d){var e,f,g,h,i,j,k,l=a.c,m=w;if(l){a:{for(e=1,h=l[0];h>=10;h/=10,e++);if(f=b-e,0>f)f+=u,g=b,i=l[j=0],k=i/m[e-g-1]%10|0;else if(j=n((f+1)/u),j>=l.length){if(!d)break a;for(;l.length<=j;l.push(0));i=k=0,e=1,f%=u,g=f-u+1}else{for(i=h=l[j],e=1;h>=10;h/=10,e++);f%=u,g=f-u+e,k=0>g?0:i/m[e-g-1]%10|0}if(d=d||0>b||null!=l[j+1]||(0>g?i:i%m[e-g-1]),d=4>c?(k||d)&&(0==c||c==(a.s<0?3:2)):k>5||5==k&&(4==c||d||6==c&&(f>0?g>0?i/m[e-g]:0:l[j-1])%10&1||c==(a.s<0?8:7)),1>b||!l[0])return l.length=0,d?(b-=a.e+1,l[0]=m[(u-b%u)%u],a.e=-b||0):l[0]=a.e=0,a;if(0==f?(l.length=j,h=1,j--):(l.length=j+1,h=m[u-f],l[j]=g>0?o(i/m[e-g]%m[g])*h:0),d)for(;;){if(0==j){for(f=1,g=l[0];g>=10;g/=10,f++);for(g=l[0]+=h,h=1;g>=10;g/=10,h++);f!=h&&(a.e++,l[0]==t&&(l[0]=1));break}if(l[j]+=h,l[j]!=t)break;l[j--]=0,h=1}for(f=l.length;0===l[--f];l.pop());}a.e>Q?a.c=a.e=null:a.e<P&&(a.c=[a.e=0])}return a}var G,H,I=0,J=l.prototype,K=new l(1),L=20,M=4,N=-7,O=21,P=-1e7,Q=1e7,R=!0,S=C,T=!1,U=1,V=0,W={decimalSeparator:".",groupSeparator:",",groupSize:3,secondaryGroupSize:0,fractionGroupSeparator:" ",fractionGroupSize:0};return l.another=b,l.ROUND_UP=0,l.ROUND_DOWN=1,l.ROUND_CEIL=2,l.ROUND_FLOOR=3,l.ROUND_HALF_UP=4,l.ROUND_HALF_DOWN=5,l.ROUND_HALF_EVEN=6,l.ROUND_HALF_CEIL=7,l.ROUND_HALF_FLOOR=8,l.EUCLID=9,l.config=l.set=function(){var a,b,c=0,d={},e=arguments,h=e[0],i=h&&"object"==typeof h?function(){return h.hasOwnProperty(b)?null!=(a=h[b]):void 0}:function(){return e.length>c?null!=(a=e[c++]):void 0};return i(b="DECIMAL_PLACES")&&S(a,0,y,2,b)&&(L=0|a),d[b]=L,i(b="ROUNDING_MODE")&&S(a,0,8,2,b)&&(M=0|a),d[b]=M,i(b="EXPONENTIAL_AT")&&(g(a)?S(a[0],-y,0,2,b)&&S(a[1],0,y,2,b)&&(N=0|a[0],O=0|a[1]):S(a,-y,y,2,b)&&(N=-(O=0|(0>a?-a:a)))),d[b]=[N,O],i(b="RANGE")&&(g(a)?S(a[0],-y,-1,2,b)&&S(a[1],1,y,2,b)&&(P=0|a[0],Q=0|a[1]):S(a,-y,y,2,b)&&(0|a?P=-(Q=0|(0>a?-a:a)):R&&E(2,b+" cannot be zero",a))),d[b]=[P,Q],i(b="ERRORS")&&(a===!!a||1===a||0===a?(I=0,S=(R=!!a)?C:f):R&&E(2,b+p,a)),d[b]=R,i(b="CRYPTO")&&(a===!0||a===!1||1===a||0===a?a?(a="undefined"==typeof crypto,
!a&&crypto&&(crypto.getRandomValues||crypto.randomBytes)?T=!0:R?E(2,"crypto unavailable",a?void 0:crypto):T=!1):T=!1:R&&E(2,b+p,a)),d[b]=T,i(b="MODULO_MODE")&&S(a,0,9,2,b)&&(U=0|a),d[b]=U,i(b="POW_PRECISION")&&S(a,0,y,2,b)&&(V=0|a),d[b]=V,i(b="FORMAT")&&("object"==typeof a?W=a:R&&E(2,b+" not an object",a)),d[b]=W,d},l.max=function(){return B(arguments,J.lt)},l.min=function(){return B(arguments,J.gt)},l.random=function(){var a=9007199254740992,b=Math.random()*a&2097151?function(){return o(Math.random()*a)}:function(){return 8388608*(1073741824*Math.random()|0)+(8388608*Math.random()|0)};return function(a){var c,d,e,f,g,h=0,i=[],j=new l(K);if(a=null!=a&&S(a,0,y,14)?0|a:L,f=n(a/u),T)if(crypto.getRandomValues){for(c=crypto.getRandomValues(new Uint32Array(f*=2));f>h;)g=131072*c[h]+(c[h+1]>>>11),g>=9e15?(d=crypto.getRandomValues(new Uint32Array(2)),c[h]=d[0],c[h+1]=d[1]):(i.push(g%1e14),h+=2);h=f/2}else if(crypto.randomBytes){for(c=crypto.randomBytes(f*=7);f>h;)g=281474976710656*(31&c[h])+1099511627776*c[h+1]+4294967296*c[h+2]+16777216*c[h+3]+(c[h+4]<<16)+(c[h+5]<<8)+c[h+6],g>=9e15?crypto.randomBytes(7).copy(c,h):(i.push(g%1e14),h+=7);h=f/7}else T=!1,R&&E(14,"crypto unavailable",crypto);if(!T)for(;f>h;)g=b(),9e15>g&&(i[h++]=g%1e14);for(f=i[--h],a%=u,f&&a&&(g=w[u-a],i[h]=o(f/g)*g);0===i[h];i.pop(),h--);if(0>h)i=[e=0];else{for(e=-1;0===i[0];i.splice(0,1),e-=u);for(h=1,g=i[0];g>=10;g/=10,h++);u>h&&(e-=u-h)}return j.e=e,j.c=i,j}}(),G=function(){function a(a,b,c){var d,e,f,g,h=0,i=a.length,j=b%x,k=b/x|0;for(a=a.slice();i--;)f=a[i]%x,g=a[i]/x|0,d=k*f+g*j,e=j*f+d%x*x+h,h=(e/c|0)+(d/x|0)+k*g,a[i]=e%c;return h&&(a=[h].concat(a)),a}function b(a,b,c,d){var e,f;if(c!=d)f=c>d?1:-1;else for(e=f=0;c>e;e++)if(a[e]!=b[e]){f=a[e]>b[e]?1:-1;break}return f}function d(a,b,c,d){for(var e=0;c--;)a[c]-=e,e=a[c]<b[c]?1:0,a[c]=e*d+a[c]-b[c];for(;!a[0]&&a.length>1;a.splice(0,1));}return function(e,f,g,h,i){var j,k,m,n,p,q,r,s,v,w,x,y,z,A,B,C,D,E=e.s==f.s?1:-1,G=e.c,H=f.c;if(!(G&&G[0]&&H&&H[0]))return new l(e.s&&f.s&&(G?!H||G[0]!=H[0]:H)?G&&0==G[0]||!H?0*E:E/0:NaN);for(s=new l(E),v=s.c=[],k=e.e-f.e,E=g+k+1,i||(i=t,k=c(e.e/u)-c(f.e/u),E=E/u|0),m=0;H[m]==(G[m]||0);m++);if(H[m]>(G[m]||0)&&k--,0>E)v.push(1),n=!0;else{for(A=G.length,C=H.length,m=0,E+=2,p=o(i/(H[0]+1)),p>1&&(H=a(H,p,i),G=a(G,p,i),C=H.length,A=G.length),z=C,w=G.slice(0,C),x=w.length;C>x;w[x++]=0);D=H.slice(),D=[0].concat(D),B=H[0],H[1]>=i/2&&B++;do{if(p=0,j=b(H,w,C,x),0>j){if(y=w[0],C!=x&&(y=y*i+(w[1]||0)),p=o(y/B),p>1)for(p>=i&&(p=i-1),q=a(H,p,i),r=q.length,x=w.length;1==b(q,w,r,x);)p--,d(q,r>C?D:H,r,i),r=q.length,j=1;else 0==p&&(j=p=1),q=H.slice(),r=q.length;if(x>r&&(q=[0].concat(q)),d(w,q,x,i),x=w.length,-1==j)for(;b(H,w,C,x)<1;)p++,d(w,x>C?D:H,x,i),x=w.length}else 0===j&&(p++,w=[0]);v[m++]=p,w[0]?w[x++]=G[z]||0:(w=[G[z]],x=1)}while((z++<A||null!=w[0])&&E--);n=null!=w[0],v[0]||v.splice(0,1)}if(i==t){for(m=1,E=v[0];E>=10;E/=10,m++);F(s,g+(s.e=m+k*u-1)+1,h,n)}else s.e=k,s.r=+n;return s}}(),H=function(){var a=/^(-?)0([xbo])(?=\w[\w.]*$)/i,b=/^([^.]+)\.$/,c=/^\.([^.]+)$/,d=/^-?(Infinity|NaN)$/,e=/^\s*\+(?=[\w.])|^\s+|\s+$/g;return function(f,g,h,i){var j,k=h?g:g.replace(e,"");if(d.test(k))f.s=isNaN(k)?null:0>k?-1:1;else{if(!h&&(k=k.replace(a,function(a,b,c){return j="x"==(c=c.toLowerCase())?16:"b"==c?2:8,i&&i!=j?a:b}),i&&(j=i,k=k.replace(b,"$1").replace(c,"0.$1")),g!=k))return new l(k,j);R&&E(I,"not a"+(i?" base "+i:"")+" number",g),f.s=null}f.c=f.e=null,I=0}}(),J.absoluteValue=J.abs=function(){var a=new l(this);return a.s<0&&(a.s=1),a},J.ceil=function(){return F(new l(this),this.e+1,2)},J.comparedTo=J.cmp=function(a,b){return I=1,e(this,new l(a,b))},J.decimalPlaces=J.dp=function(){var a,b,d=this.c;if(!d)return null;if(a=((b=d.length-1)-c(this.e/u))*u,b=d[b])for(;b%10==0;b/=10,a--);return 0>a&&(a=0),a},J.dividedBy=J.div=function(a,b){return I=3,G(this,new l(a,b),L,M)},J.dividedToIntegerBy=J.divToInt=function(a,b){return I=4,G(this,new l(a,b),0,1)},J.equals=J.eq=function(a,b){return I=5,0===e(this,new l(a,b))},J.floor=function(){return F(new l(this),this.e+1,3)},J.greaterThan=J.gt=function(a,b){return I=6,e(this,new l(a,b))>0},J.greaterThanOrEqualTo=J.gte=function(a,b){return I=7,1===(b=e(this,new l(a,b)))||0===b},J.isFinite=function(){return!!this.c},J.isInteger=J.isInt=function(){return!!this.c&&c(this.e/u)>this.c.length-2},J.isNaN=function(){return!this.s},J.isNegative=J.isNeg=function(){return this.s<0},J.isZero=function(){return!!this.c&&0==this.c[0]},J.lessThan=J.lt=function(a,b){return I=8,e(this,new l(a,b))<0},J.lessThanOrEqualTo=J.lte=function(a,b){return I=9,-1===(b=e(this,new l(a,b)))||0===b},J.minus=J.sub=function(a,b){var d,e,f,g,h=this,i=h.s;if(I=10,a=new l(a,b),b=a.s,!i||!b)return new l(NaN);if(i!=b)return a.s=-b,h.plus(a);var j=h.e/u,k=a.e/u,m=h.c,n=a.c;if(!j||!k){if(!m||!n)return m?(a.s=-b,a):new l(n?h:NaN);if(!m[0]||!n[0])return n[0]?(a.s=-b,a):new l(m[0]?h:3==M?-0:0)}if(j=c(j),k=c(k),m=m.slice(),i=j-k){for((g=0>i)?(i=-i,f=m):(k=j,f=n),f.reverse(),b=i;b--;f.push(0));f.reverse()}else for(e=(g=(i=m.length)<(b=n.length))?i:b,i=b=0;e>b;b++)if(m[b]!=n[b]){g=m[b]<n[b];break}if(g&&(f=m,m=n,n=f,a.s=-a.s),b=(e=n.length)-(d=m.length),b>0)for(;b--;m[d++]=0);for(b=t-1;e>i;){if(m[--e]<n[e]){for(d=e;d&&!m[--d];m[d]=b);--m[d],m[e]+=t}m[e]-=n[e]}for(;0==m[0];m.splice(0,1),--k);return m[0]?D(a,m,k):(a.s=3==M?-1:1,a.c=[a.e=0],a)},J.modulo=J.mod=function(a,b){var c,d,e=this;return I=11,a=new l(a,b),!e.c||!a.s||a.c&&!a.c[0]?new l(NaN):!a.c||e.c&&!e.c[0]?new l(e):(9==U?(d=a.s,a.s=1,c=G(e,a,0,3),a.s=d,c.s*=d):c=G(e,a,0,U),e.minus(c.times(a)))},J.negated=J.neg=function(){var a=new l(this);return a.s=-a.s||null,a},J.plus=J.add=function(a,b){var d,e=this,f=e.s;if(I=12,a=new l(a,b),b=a.s,!f||!b)return new l(NaN);if(f!=b)return a.s=-b,e.minus(a);var g=e.e/u,h=a.e/u,i=e.c,j=a.c;if(!g||!h){if(!i||!j)return new l(f/0);if(!i[0]||!j[0])return j[0]?a:new l(i[0]?e:0*f)}if(g=c(g),h=c(h),i=i.slice(),f=g-h){for(f>0?(h=g,d=j):(f=-f,d=i),d.reverse();f--;d.push(0));d.reverse()}for(f=i.length,b=j.length,0>f-b&&(d=j,j=i,i=d,b=f),f=0;b;)f=(i[--b]=i[b]+j[b]+f)/t|0,i[b]=t===i[b]?0:i[b]%t;return f&&(i=[f].concat(i),++h),D(a,i,h)},J.precision=J.sd=function(a){var b,c,d=this,e=d.c;if(null!=a&&a!==!!a&&1!==a&&0!==a&&(R&&E(13,"argument"+p,a),a!=!!a&&(a=null)),!e)return null;if(c=e.length-1,b=c*u+1,c=e[c]){for(;c%10==0;c/=10,b--);for(c=e[0];c>=10;c/=10,b++);}return a&&d.e+1>b&&(b=d.e+1),b},J.round=function(a,b){var c=new l(this);return(null==a||S(a,0,y,15))&&F(c,~~a+this.e+1,null!=b&&S(b,0,8,15,q)?0|b:M),c},J.shift=function(a){var b=this;return S(a,-v,v,16,"argument")?b.times("1e"+k(a)):new l(b.c&&b.c[0]&&(-v>a||a>v)?b.s*(0>a?0:1/0):b)},J.squareRoot=J.sqrt=function(){var a,b,e,f,g,h=this,i=h.c,j=h.s,k=h.e,m=L+4,n=new l("0.5");if(1!==j||!i||!i[0])return new l(!j||0>j&&(!i||i[0])?NaN:i?h:1/0);if(j=Math.sqrt(+h),0==j||j==1/0?(b=d(i),(b.length+k)%2==0&&(b+="0"),j=Math.sqrt(b),k=c((k+1)/2)-(0>k||k%2),j==1/0?b="1e"+k:(b=j.toExponential(),b=b.slice(0,b.indexOf("e")+1)+k),e=new l(b)):e=new l(j+""),e.c[0])for(k=e.e,j=k+m,3>j&&(j=0);;)if(g=e,e=n.times(g.plus(G(h,g,m,1))),d(g.c).slice(0,j)===(b=d(e.c)).slice(0,j)){if(e.e<k&&--j,b=b.slice(j-3,j+1),"9999"!=b&&(f||"4999"!=b)){+b&&(+b.slice(1)||"5"!=b.charAt(0))||(F(e,e.e+L+2,1),a=!e.times(e).eq(h));break}if(!f&&(F(g,g.e+L+2,0),g.times(g).eq(h))){e=g;break}m+=4,j+=4,f=1}return F(e,e.e+L+1,M,a)},J.times=J.mul=function(a,b){var d,e,f,g,h,i,j,k,m,n,o,p,q,r,s,v=this,w=v.c,y=(I=17,a=new l(a,b)).c;if(!(w&&y&&w[0]&&y[0]))return!v.s||!a.s||w&&!w[0]&&!y||y&&!y[0]&&!w?a.c=a.e=a.s=null:(a.s*=v.s,w&&y?(a.c=[0],a.e=0):a.c=a.e=null),a;for(e=c(v.e/u)+c(a.e/u),a.s*=v.s,j=w.length,n=y.length,n>j&&(q=w,w=y,y=q,f=j,j=n,n=f),f=j+n,q=[];f--;q.push(0));for(r=t,s=x,f=n;--f>=0;){for(d=0,o=y[f]%s,p=y[f]/s|0,h=j,g=f+h;g>f;)k=w[--h]%s,m=w[h]/s|0,i=p*k+m*o,k=o*k+i%s*s+q[g]+d,d=(k/r|0)+(i/s|0)+p*m,q[g--]=k%r;q[g]=d}return d?++e:q.splice(0,1),D(a,q,e)},J.toDigits=function(a,b){var c=new l(this);return a=null!=a&&S(a,1,y,18,"precision")?0|a:null,b=null!=b&&S(b,0,8,18,q)?0|b:M,a?F(c,a,b):c},J.toExponential=function(a,b){return A(this,null!=a&&S(a,0,y,19)?~~a+1:null,b,19)},J.toFixed=function(a,b){return A(this,null!=a&&S(a,0,y,20)?~~a+this.e+1:null,b,20)},J.toFormat=function(a,b){var c=A(this,null!=a&&S(a,0,y,21)?~~a+this.e+1:null,b,21);if(this.c){var d,e=c.split("."),f=+W.groupSize,g=+W.secondaryGroupSize,h=W.groupSeparator,i=e[0],j=e[1],k=this.s<0,l=k?i.slice(1):i,m=l.length;if(g&&(d=f,f=g,g=d,m-=d),f>0&&m>0){for(d=m%f||f,i=l.substr(0,d);m>d;d+=f)i+=h+l.substr(d,f);g>0&&(i+=h+l.slice(d)),k&&(i="-"+i)}c=j?i+W.decimalSeparator+((g=+W.fractionGroupSize)?j.replace(new RegExp("\\d{"+g+"}\\B","g"),"$&"+W.fractionGroupSeparator):j):i}return c},J.toFraction=function(a){var b,c,e,f,g,h,i,j,k,m=R,n=this,o=n.c,p=new l(K),q=c=new l(K),r=i=new l(K);if(null!=a&&(R=!1,h=new l(a),R=m,(m=h.isInt())&&!h.lt(K)||(R&&E(22,"max denominator "+(m?"out of range":"not an integer"),a),a=!m&&h.c&&F(h,h.e+1,1).gte(K)?h:null)),!o)return n.toString();for(k=d(o),f=p.e=k.length-n.e-1,p.c[0]=w[(g=f%u)<0?u+g:g],a=!a||h.cmp(p)>0?f>0?p:q:h,g=Q,Q=1/0,h=new l(k),i.c[0]=0;j=G(h,p,0,1),e=c.plus(j.times(r)),1!=e.cmp(a);)c=r,r=e,q=i.plus(j.times(e=q)),i=e,p=h.minus(j.times(e=p)),h=e;return e=G(a.minus(c),r,0,1),i=i.plus(e.times(q)),c=c.plus(e.times(r)),i.s=q.s=n.s,f*=2,b=G(q,r,f,M).minus(n).abs().cmp(G(i,c,f,M).minus(n).abs())<1?[q.toString(),r.toString()]:[i.toString(),c.toString()],Q=g,b},J.toNumber=function(){return+this},J.toPower=J.pow=function(a,b){var c,d,e,f=o(0>a?-a:+a),g=this;if(null!=b&&(I=23,b=new l(b)),!S(a,-v,v,23,"exponent")&&(!isFinite(a)||f>v&&(a/=0)||parseFloat(a)!=a&&!(a=NaN))||0==a)return c=Math.pow(+g,a),new l(b?c%b:c);for(b?a>1&&g.gt(K)&&g.isInt()&&b.gt(K)&&b.isInt()?g=g.mod(b):(e=b,b=null):V&&(c=n(V/u+2)),d=new l(K);;){if(f%2){if(d=d.times(g),!d.c)break;c?d.c.length>c&&(d.c.length=c):b&&(d=d.mod(b))}if(f=o(f/2),!f)break;g=g.times(g),c?g.c&&g.c.length>c&&(g.c.length=c):b&&(g=g.mod(b))}return b?d:(0>a&&(d=K.div(d)),e?d.mod(e):c?F(d,V,M):d)},J.toPrecision=function(a,b){return A(this,null!=a&&S(a,1,y,24,"precision")?0|a:null,b,24)},J.toString=function(a){var b,c=this,e=c.s,f=c.e;return null===f?e?(b="Infinity",0>e&&(b="-"+b)):b="NaN":(b=d(c.c),b=null!=a&&S(a,2,64,25,"base")?z(j(b,f),0|a,10,e):N>=f||f>=O?i(b,f):j(b,f),0>e&&c.c[0]&&(b="-"+b)),b},J.truncated=J.trunc=function(){return F(new l(this),this.e+1,1)},J.valueOf=J.toJSON=function(){var a,b=this,c=b.e;return null===c?b.toString():(a=d(b.c),a=N>=c||c>=O?i(a,c):j(a,c),b.s<0?"-"+a:a)},J.isBigNumber=!0,null!=a&&l.config(a),l}function c(a){var b=0|a;return a>0||a===b?b:b-1}function d(a){for(var b,c,d=1,e=a.length,f=a[0]+"";e>d;){for(b=a[d++]+"",c=u-b.length;c--;b="0"+b);f+=b}for(e=f.length;48===f.charCodeAt(--e););return f.slice(0,e+1||1)}function e(a,b){var c,d,e=a.c,f=b.c,g=a.s,h=b.s,i=a.e,j=b.e;if(!g||!h)return null;if(c=e&&!e[0],d=f&&!f[0],c||d)return c?d?0:-h:g;if(g!=h)return g;if(c=0>g,d=i==j,!e||!f)return d?0:!e^c?1:-1;if(!d)return i>j^c?1:-1;for(h=(i=e.length)<(j=f.length)?i:j,g=0;h>g;g++)if(e[g]!=f[g])return e[g]>f[g]^c?1:-1;return i==j?0:i>j^c?1:-1}function f(a,b,c){return(a=k(a))>=b&&c>=a}function g(a){return"[object Array]"==Object.prototype.toString.call(a)}function h(a,b,c){for(var d,e,f=[0],g=0,h=a.length;h>g;){for(e=f.length;e--;f[e]*=b);for(f[d=0]+=s.indexOf(a.charAt(g++));d<f.length;d++)f[d]>c-1&&(null==f[d+1]&&(f[d+1]=0),f[d+1]+=f[d]/c|0,f[d]%=c)}return f.reverse()}function i(a,b){return(a.length>1?a.charAt(0)+"."+a.slice(1):a)+(0>b?"e":"e+")+b}function j(a,b){var c,d;if(0>b){for(d="0.";++b;d+="0");a=d+a}else if(c=a.length,++b>c){for(d="0",b-=c;--b;d+="0");a+=d}else c>b&&(a=a.slice(0,b)+"."+a.slice(b));return a}function k(a){return a=parseFloat(a),0>a?n(a):o(a)}var l,m=/^-?(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,n=Math.ceil,o=Math.floor,p=" not a boolean or binary digit",q="rounding mode",r="number type has more than 15 significant digits",s="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ$_",t=1e14,u=14,v=9007199254740991,w=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],x=1e7,y=1e9;l=b(),l["default"]=l.BigNumber=l,"function"==typeof define&&define.amd?define("bigNumber",[],function(){return l}):"undefined"!=typeof module&&module.exports?module.exports=l:(a||(a="undefined"!=typeof self?self:Function("return this")()),a.BigNumber=l)}(this),define("apps/pay_sheet/nls/pay_sheet_base",{root:{no_uah_accs:"Невозможно создать документ. Отсутствует текущий счет в национальной валюте.",pay_type:"Вид начисления",number:"Номер",date:"Дата",amount:"Сумма",priority:"Приоритет",status:"Статус",summary:"Общая сумма:",client:"Клиент",pay_sheet:"Зарплатная ведомость",pay_sheet_list:"Зарплатные ведомости",ua_payment:"Платежное поручение",from_acc:"Счет списания",from_commission_acc:"Счет списания комиссии за РКО",not_required:"необяз.",current:"текущая",autonum:"автонумер.",pp:"Номер",value_date:"Дата валютир.",date_doc:"Дата документа",period:"Период начисления",sks:"СКС",inn:"ИНН",fio:"ФИО",add_employee:"Добавить",remove_employees:"Удалить все",total:"всего",count:"Насчитано",recipients:"Получатели",total_recipients:"Всего получателей:",title_add_employee:"ввод можно завершить нажав Enter",loading:"Загрузка данных",wait:"Подождите, это может занять несколько секунд",preload_text:"Загрузка списка сотрудников. Подождите несколько секунд.",creating:"Создание документа ...",start_entering:"Начинайте вводить ФИО, СКС или ИНН",change:"Изменить",cancel:"Отменить",success_link_btn:"Применить",generate_link_btn:"Создать",generating_link_btn:"Создание",unlink_btn:"УКАЗАТЬ",close_link_btn:"Закрыть",links:"платежи",links_warn:"Внимание!",links_payment_rejected:"Обратите внимание, что '{1}' отклонен.",links_payment_incorrect:"'{1}' не соответствует ведомости. Возможная причина - изменение ведомости или документа '{1}'.",has_payment:"№{1} от {2} на сумму {3} ({4})",without_payment:"<платеж не выбран>",without_conformity_payment:"<Отсутствуют платежи, соответствующие ЗП-ведомости>",link0_title:"Основной платеж",link1_title:"Платеж за РКО",create_payments:"Создать платежи",links_management:"Управление связями",need_to_fill:"Для отправки документа в банк необходимо указать:",need_to_deliver:"Для дальнейшей обработки документа необходимо отправить Основной платеж и платеж за РКО в банк",impossible_to_delete:"Удаление невозможно – к зарплатной ведомости привязано(ы) платежное(ые) поручение(я)",need_to_deliver_one:"Для дальнейшей обработки документа необходимо отправить Основной платеж в банк",similar_employee:"В списке получателей есть одинаковые сотрудники. Убедитесь, что список получателей не содержит лишних записей - для удобства поиска такие сотрудники выделены синим цветом",unspecifiedParam:"Для документа '{1}' банком не указан параметр {2}",incorrectParam:"Для документа '{1}' банком для параметра '{2}' задано не корректное значение '{3}'",rcpt_mfo:"МФО",rcpt_account:"Счет",rcpt_okpo:"ЕГПРОУ",rcpt_name:"Наименование получателя",commission:"коммисия за РКО",selectedAll:"Выбрать всех",bank_name:"Банк",field_DATE_DOC:"Дата документа",field_NUM_DOC:"Номер документа",field_AMOUNT:"Сумма платежа",field_CLN_NAME:"Наименование клиента",field_CLN_OKPO:"ЕГРПОУ клиента",field_PAYER_ACCOUNT:"Счет клиента",field_PAYER_BANK_ACCOUNT:"Счет банка клиента",field_PAYER_BANK_NAME:"Наименование банка клиента",field_PAYER_BANK_MFO:"МФО банка клиента",field_PAYER_COMMISSION_ACCOUNT:"Счет для списания комиссии за РКО",field_PAYER_COMMISSION_BANK_MFO:"МФО банка для списания комиссии за РКО",field_PAYER_COMMISSION_BANK_NAME:"Наименование банка для списания комиссии за РКО",field_ONFLOW_TYPE:"Тип начисления",field_VALUE_DATE:"Дата валютирования",field_COMMISSION_PERCENT:"Процент комиссии",field_ONFLOW_TYPE_ID:"Код типа начисления",field_PERIOD:"Период начисления",field_CARD_HOLDERS:"Список сотрудников","field_CARD_HOLDERS.AMOUNT":"Сумма зачисления","field_CARD_HOLDERS.CARD_NUM":"Карточный счет","field_CARD_HOLDERS.CARD_HOLDER":"ФИО сотрудника","field_CARD_HOLDERS.CARD_HOLDER_INN":"ИНН",field_not_specify:"Не указан(а) {1} для {2}",field_specify:"Для {1} указан {2} = {3}, в банке = {4}",empl_is_absent:"Нет данных о {1}",field_is_incorrect:"Некорректное значение в поле '{1}' = {2} для {3}",incorrect_amount:"Некорректное значение суммы начисления",incorrect_onflow_type:"Указан неактуальный вид начисления",card_holders_is_empty:"Добавьте начисления сотрудникам",unallowed_transfer_type:"У вас нет прав на данный тип начисления для Зарплатной ведомости",unknown_transfer_type:"{1}: '{2}' отсутствует в справочнике",unknown_sks:"{1}: '{2}' отсутствует в справочнике сотрудников",inn_is_incorrect:"{1} '{2}' для {3} '{4}' не совпадает со значением {5} '{6}' в справочнике сотрудников",card_holder_name_not_specify:"Не указан(а) {1} для Карточного счета {2}",employess_number_selected:"Выбрано сотрудников: {1}",not_ua_acount_for_mfo:"Отсутствуют права на работу с гривневыми счетами в МФО {1}",footer_s_template:"{1} {2} {3} из {4} на общую сумму {5} грн.",footer_selected_sin:"Выбрана",footer_selected_pl:"Выбрано",footer_1_doc:"ведомость",footer_1_doc_pl:"ведомость",footer_2_4_docs:"ведомости",footer_5_0_docs:"ведомостей",onflow_type_deleted:"(удален)"},uk:!0,en:!0}),define("apps/pay_sheet/nls/pay_sheet",["underscore","apps/pay_sheet/nls/pay_sheet_base"],function(a,b){return{root:a.extend({},b.root,{bank_client:"Банк-клиент"}),uk:!0,en:!0}}),define("apps/pay_sheet/nls/uk/pay_sheet_base",{no_uah_accs:"Неможливо створити документ. Вiдсутнiй поточний рахунок в нацiональнiй валютi.",pay_type:"Вид нарахування",number:"Номер",date:"Дата",amount:"Сума",priority:"Пріоритет",status:"Статус",summary:"Загальна сума:",client:"Клієнт",pay_sheet:"Зарплатна відомість",pay_sheet_list:"Зарплатні відомості",ua_payment:"Платіжне доручення",from_acc:"Рахунок списання",from_commission_acc:"Рахунок списання комісії за РКО",not_required:"не обов.",current:"поточна",autonum:"автонумер.",pp:"Номер",value_date:"Дата валютув.",date_doc:"Дата документа",period:"Період нарахування",sks:"СКР",inn:"ІПН",fio:"ПІБ",add_employee:"Додати",remove_employees:"Вилучити всі",total:"усього",count:"Начислено",recipients:"Отримувачі",total_recipients:"Разом отримувачів:",title_add_employee:"введення можна завершити натиснувши Enter",loading:"Завантаження даних",wait:"Зачекайте, це може зайняти декілька секунд",preload_text:"Завантаження списка співробітників. Зачекайте декілька секунд",creating:"Створення документу ...",start_entering:"Починайте вводити ПІБ, СКР або ІПН",links_warn:"Увага!",links_payment_rejected:"Зверніть увагу, що '{1}' відхилений.",links_payment_incorrect:"'{1}' не відповідає відомості. Можлива причина - зміна відомості або документа '{1}'.",links:"платежi",has_payment:"№{1} від {2} на суму {3} ({4})",without_payment:"<платіж не вибраний>",without_conformity_payment:"<Відсутні платежі, що відповідають ЗП-відомості>",link0_title:"Основний платіж",link1_title:"Платіж за РКО",create_payments:"Створити платежі",links_management:"Керування зв’язками",need_to_fill:"Для відправлення документа в банк необхідно вказати:",need_to_deliver:"Для подальшої обробки документа необхідно відправити Основний платіж і платіж за РКО в банк",impossible_to_delete:"Вилучення неможливе - до зарплатної відомості прив'язано(і) платіжне(і) доручення.",need_to_deliver_one:"Для подальшої обробки документа необхідно відправити Основний платіж в банк",similar_employee:"У списку отримувачів присутні однакові співробітники. Переконайтеся, що список отримувачів не містить зайвих записів - для зручності пошуку такі співробітники виділені синім кольором",unspecifiedParam:"Для документа '{1}' банком не задано параметр {2}",incorrectParam:"Для документа '{1}' банком для параметру '{2}' задано не корректне значення '{3}'",rcpt_mfo:"МФО",rcpt_account:"Рахунок",rcpt_okpo:"ЄДРПОУ",rcpt_name:"Найменування отримувача",commission:"комісія за РКО",selectedAll:"Обрати всіх",bank_name:"Банк",change:"Змінити",cancel:"Відмінити",success_link_btn:"Застосувати",generate_link_btn:"Створити",generating_link_btn:"Створення",unlink_btn:"ВКАЗАТИ",close_link_btn:"Закрити",field_DATE_DOC:"Дата документа",field_NUM_DOC:"Номер документа",field_AMOUNT:"Сума платежу",field_CLN_NAME:"Найменування платника",field_CLN_OKPO:"ЄДРПОУ платника",field_PAYER_ACCOUNT:"Рахунок платника",field_PAYER_BANK_ACCOUNT:"Рахунок банку платника",field_PAYER_BANK_NAME:"Найменування банку платника",field_PAYER_BANK_MFO:"МФО банку платника",field_PAYER_COMMISSION_ACCOUNT:"Рахунок для списання комісії за РКО",field_PAYER_COMMISSION_BANK_MFO:"МФО банку для списання комісії за РКО",field_PAYER_COMMISSION_BANK_NAME:"Найменування банку для списання комісії за РКО",field_ONFLOW_TYPE:"Тип нарахування",field_VALUE_DATE:"Дата валютування",field_COMMISSION_PERCENT:"Процент комісії",field_ONFLOW_TYPE_ID:"Код типу нарахування",field_PERIOD:"Період нарахування",field_CARD_HOLDERS:"Список співробітників","field_CARD_HOLDERS.AMOUNT":"Сума зарахування","field_CARD_HOLDERS.CARD_NUM":"Картковий рахунок","field_CARD_HOLDERS.CARD_HOLDER":"ПІБ співробітника","field_CARD_HOLDERS.CARD_HOLDER_INN":"ІПН",field_not_specify:"Не вказаний(-а) {1} для {2}",field_specify:"Для {1} вказаний {2} = {3}, в банку = {4}",empl_is_absent:"Нема даних про {1}",field_is_incorrect:"Некоректне значення в полі '{1}' = {2} для {3}",incorrect_amount:"Некоректне значення суми нарахування",incorrect_onflow_type:"Вказано неактуальний вид нарахування",card_holders_is_empty:"Додайте нарахування співробітникам",unallowed_transfer_type:"У вас немає прав на даний тип нарахування для Зарплатної відомості",unknown_transfer_type:"{1}: '{2}' відсутній в довіднику",unknown_sks:"{1}: '{2}' відсутній у довіднику співробітників",inn_is_incorrect:"{1} '{2}' для {3} '{4}' не співпадає зі значенням {5} '{6}' у довіднику співробітників",card_holder_name_not_specify:"Не вказаний(-а) {1} для Карткового рахунку {2}",employess_number_selected:"Обрано співробітників: {1}",not_ua_acount_for_mfo:"Відсутні права на роботу з гривневими рахунками в МФО {1}",footer_s_template:"{1} {2} {3} з {4} на загальну суму {5} грн.",footer_selected_sin:"Обрана",footer_selected_pl:"Обрано",footer_1_doc:"відомість",footer_1_doc_pl:"відомість",footer_2_4_docs:"відомості",footer_5_0_docs:"відомостей",onflow_type_deleted:"(видалений)"}),define("apps/pay_sheet/nls/uk/pay_sheet",["underscore","apps/pay_sheet/nls/uk/pay_sheet_base"],function(a,b){return a.extend({},b,{bank_client:"Банк-клієнт"})}),define("apps/pay_sheet/nls/en/pay_sheet_base",{no_uah_accs:"Unable to create a document. Current account in national currency is missing.",pay_type:"Type of charge",number:"Number",date:"Date",amount:"Amount",priority:"Priority",status:"Status",summary:"Total amount:",client:"Client",pay_sheet:"Salary sheet",pay_sheet_list:"Salary sheets",ua_payment:"Payment order",from_acc:"Write-off account",from_commission_acc:"RKO write-off account",not_required:"optional",current:"current",autonum:"autonum.",pp:"Number",value_date:"Value date",date_doc:"Document date",period:"Period of charging",sks:"SCA",inn:"ITN",fio:"Full name",add_employee:"Add",remove_employees:"Delete all",total:"total",count:"Accrued",recipients:"Recipients",total_recipients:"All recipients:",title_add_employee:"you can stop inputting by pressing Enter",loading:"Loading data",wait:"Wait, it may take a few seconds",preload_text:"Loading of recipients list. Wait for a few seconds.",creating:"Creation of document …",start_entering:"Start typing full name, SCA or ITN",change:"Change",cancel:"Cancel",success_link_btn:"Apply",generate_link_btn:"Create",generating_link_btn:"Creation",unlink_btn:"SPECIFY",close_link_btn:"Close",links:"payments",links_warn:"Attention!",links_payment_rejected:"Please note that the '{1}' is rejected.",links_payment_incorrect:"'{1}' does not match the salary sheet. Possible cause - changes in salary sheet or in document '{1}'.",has_payment:"No {1} from {2} on amount {3} ({4})",without_payment:"<payment not selected>",without_conformity_payment:"<No payments conformity for the salary sheet>",link0_title:"Main payment",link1_title:"Payment for CSS",create_payments:"Generate payments",links_management:"Links management",need_to_fill:"To send a document to the bank you must specify:",need_to_deliver:"For further processing of document you should send the main and CSS commission payments to the bank",impossible_to_delete:"Deleting is not possible — salary sheets is linked with payment(s).",need_to_deliver_one:"For further processing of document you should send the main payment to the bank",similar_employee:"There are the same employees in the recipients list. Make sure that the recipients list doesn't contain unwanted records - for easy search such employees are highlighted in blue",unspecifiedParam:"For document '{1}' parameter {2} is not specified by the bank",incorrectParam:"For document '{1}' parameter '{2}' is set to an invalid value '{3}' by the bank",rcpt_mfo:"MFO",rcpt_account:"Account",rcpt_okpo:"EDRPOU",rcpt_name:"Recipient's name",commission:"CSS commission",selectedAll:"Select all",bank_name:"Bank",field_DATE_DOC:"Document date",field_NUM_DOC:"Document number",field_AMOUNT:"Amount of payment",field_CLN_NAME:"Client's name",field_CLN_OKPO:"Client's EDRPOU",field_PAYER_ACCOUNT:"Client's account",field_PAYER_BANK_ACCOUNT:"Account of client's bank",field_PAYER_BANK_NAME:"Client's bank name",field_PAYER_BANK_MFO:"Client's bank MFO",field_PAYER_COMMISSION_ACCOUNT:"Account to charge off commissions for RKO",field_PAYER_COMMISSION_BANK_MFO:"Bank MFO to charge off commissions for RKO",field_PAYER_COMMISSION_BANK_NAME:"Name of the bank to charge off commissions for RKO",field_ONFLOW_TYPE:"Type of charge",field_VALUE_DATE:"Value date",field_COMMISSION_PERCENT:"Commission percent",field_ONFLOW_TYPE_ID:"Charging type code",field_PERIOD:"Period of charging",field_CARD_HOLDERS:"List of employees","field_CARD_HOLDERS.AMOUNT":"Amount of charging","field_CARD_HOLDERS.CARD_NUM":"Card account","field_CARD_HOLDERS.CARD_HOLDER":"Employee's full name","field_CARD_HOLDERS.CARD_HOLDER_INN":"ITN",field_not_specify:"Not specified {1} for {2}",field_specify:"For {1} is specified {2} = {3}, in bank = {4}",empl_is_absent:"There is no data for {1}",field_is_incorrect:"Invalid value in field '{1}' = {2} for {3}",incorrect_amount:"Invalid amount of charge",incorrect_onflow_type:"The specified type of charge is not relevant",card_holders_is_empty:"Add charging for employees",unallowed_transfer_type:"You don't have rights for this type of charge for the salary sheet",unknown_transfer_type:"{1}: '{2}' is not found in the directory",unknown_sks:"{1}: '{2}' is not found in the employees directory",inn_is_incorrect:"{1} '{2}' to {3} '{4}' is not matches the value {5} '{6}' in employees directory",card_holder_name_not_specify:"Not specified {1} for card account {2}",employess_number_selected:"Selected employees: {1}",not_ua_acount_for_mfo:"There are no rights for working with hryvnia accounts in MFO {1}",footer_s_template:"{1} {2} {3} of {4}, total {5} UAH.",footer_selected_sin:"Selected",footer_selected_pl:"Selected",footer_1_doc:"sheet",footer_1_doc_pl:"sheets",footer_2_4_docs:"sheets",footer_5_0_docs:"sheets",onflow_type_deleted:"(removed)"}),define("apps/pay_sheet/nls/en/pay_sheet",["underscore","apps/pay_sheet/nls/en/pay_sheet_base"],function(a,b){return a.extend({},b,{bank_client:"Bank-client"})}),define("apps/pay_sheet/pay_sheet_model",["jquery","underscore","backbone","app","collections/thesaurus","appsPieces","thesaurusUtils","bifit","models/base_document","i18n!apps/pay_sheet/nls/pay_sheet","i18n!nls/validation","backboneValidation"],function(a,b,c,d,e,f,g,h,i,j,k){"use strict";function l(a,b){var c=g.getClientProp("documents.pay_sheet.commission.percent",a),d=!(!c||0===parseFloat(c));return"1"===b.account_commission_flag&&d}return i.extend({type:"pay_sheet",nls:j,defaults:{status:"",status_desc:"",status_color:"000000",DATE_DOC:"",NUM_DOC:"",CLN_NAME:"",PAYER_BANK_MFO:"",PAYER_BANK_NAME:"",PAYER_ACCOUNT:"",CARD_HOLDERS:"",ONFLOW_TYPE:"",AMOUNT:"",PAYER_BANK_ACCOUNT:"",COMMISSION_PERCENT:"",VALUE_DATE:"",CLN_OKPO:"",ONFLOW_TYPE_ID:"",PERIOD:"",PAYER_COMMISSION_ACCOUNT:"",PAYER_COMMISSION_BANK_MFO:"",PAYER_COMMISSION_BANK_NAME:"",ATT_CNT:"0"},meta:b.extend({},i.prototype.meta,{relatively:b.extend({ONFLOW_TYPE:function(a){return a},AMOUNT:function(a){return parseFloat(a)}},i.prototype.meta.relatively),formattedFields:{AMOUNT:function(){return this._amountFormatter(this.get("AMOUNT"),2)}}}),order:["DATE_DOC","NUM_DOC","CLN_NAME","PAYER_BANK_MFO","PAYER_BANK_NAME","PAYER_ACCOUNT",{name:"CARD_HOLDERS",order:["CARD_NUM","CARD_HOLDER","CARD_HOLDER_INN","AMOUNT","STAFF_ID","RESIDENT_FLAG"]},"ONFLOW_TYPE","AMOUNT","PAYER_BANK_ACCOUNT","COMMISSION_PERCENT","VALUE_DATE"],validation:{NUM_DOC:{numDocRequired:!0,maxLength:10},DATE_DOC:{required:!0,dateDoc:!0},VALUE_DATE:{fn:function(a,b,c){var d;if(a)if(h.checkDateMatch(a)){var e=c.DATE_DOC||h.date2str(new Date);if(e){e=h.str2date(e),a=h.str2date(a);var f=a.getTime()-e.getTime();0>f?d=k.value_date_01:Math.floor(f/1e3/60/60/24)>10&&(d=this._valueDateErrorWrapper(10))}}else d=k.incorrect_date;return d}},CLN_NAME:{required:!0,maxLength:40,clientInfo:"name_cln"},CLN_OKPO:{required:!0,clientInfo:"okpo",minLength:8,maxLength:10,digits:!0},PAYER_ACCOUNT:[{required:!0,minLength:5,maxLength:14,digits:!0},{fn:function(a){var c,d=b.where(f.getAccounts(["1"],!0).UAH,{account:a});if(0===d.length)return c=k.invalid_field;var e=b.any(d,function(a){return a.permissions>0});return e||(c=k.account_not_permission),c}}],PAYER_BANK_NAME:{required:!0,maxLength:45},PAYER_BANK_MFO:[{required:!0,length:6,digits:!0},{fn:function(a){var c,d=b.any(e.getThesaurus("accs_info").array,function(b){return b.mfo===a});return d||(c=k.invalid_field),c}}],PAYER_COMMISSION_ACCOUNT:[{digits:!0},{fn:function(a,c,d){var g=e.getThesaurus("pay_sheet_transfer_types").array;if(0!==g.length){var i=b.findWhere(g,{id:d.ONFLOW_TYPE_ID})||{};if(l(d.PAYER_BANK_MFO,i)){if(!a)return h.sprintf(k.required_field,j.field_PAYER_COMMISSION_ACCOUNT);if(a.length<5||a.length>14)return h.sprintf(k.length_range,j.field_PAYER_COMMISSION_ACCOUNT,5,14);var m=b.findWhere(f.getAccounts(["1"],!0).UAH,{mfo:d.PAYER_COMMISSION_BANK_MFO,account:a});if(!m)return k.invalid_field;if(m.permissions<=0)return k.account_not_permission}else if(a)return k.empty_field}}}],PAYER_COMMISSION_BANK_NAME:[{maxLength:45},{fn:function(a,c,d){var f=e.getThesaurus("pay_sheet_transfer_types").array;if(0!==f.length){var g=b.findWhere(f,{id:d.ONFLOW_TYPE_ID})||{};if(l(d.PAYER_BANK_MFO,g)){if(!a)return h.sprintf(k.required_field,j.field_PAYER_COMMISSION_BANK_NAME)}else if(a)return k.empty_field}}}],PAYER_COMMISSION_BANK_MFO:[{maxLength:6,digits:!0},{fn:function(a,c,d){var f=e.getThesaurus("pay_sheet_transfer_types").array;if(0!==f.length){var g=b.findWhere(f,{id:d.ONFLOW_TYPE_ID})||{};if(l(d.PAYER_BANK_MFO,g)){if(!a)return h.sprintf(k.required_field,j.field_PAYER_COMMISSION_BANK_MFO);var i=b.any(e.getThesaurus("accs_info").array,function(b){return b.mfo===a});if(!i)return k.required_field}else if(a)return k.empty_field}}}],ONFLOW_TYPE:[{required:!0,msg:k.invalid_field},{fn:function(a){var c=b.filter(e.getThesaurus("pay_sheet_transfer_types").array,function(a){return"1"===a.status});if(c.length){var f=d.isMultiClient()?d.multiClient.defaultClientKeysByCID[d.multiClient.currentSubClientId].EMPL_ID:localStorage.getItem("eid"),h=g.getClientProp("documents.pay_sheet.transfer_type_id."+f),i=b.find(c,function(b){return b.name_ru===a||b.name_ua===a||b.name_en===a});return i?h&&!b.contains(h.split(";"),i.ext_code)?j.unallowed_transfer_type:"":j.incorrect_onflow_type}}}],ONFLOW_TYPE_ID:{required:!0,maxLength:20,digits:!0},PERIOD:[{maxLength:60},{fn:function(a,c,d){var f=e.getThesaurus("pay_sheet_transfer_types").array;if(f.length){var g=b.some(f,b.matches({id:d.ONFLOW_TYPE_ID,payment_period:"Y"}));return Boolean(a)===g?"":k.invalid_field}}}],_CARD_HOLDERS:{fn:function(a,d,f){var i=f.CARD_HOLDERS;if(!i||0===i.length)return c.trigger("pay-sheet-model:card-holders_is_empty",j.card_holders_is_empty),
h.sprintf(k.required_field,j.field_CARD_HOLDERS);for(var l=g.getClientProp("documents.pay_sheet.need_validation"),m=e.getThesaurus("staff"),n=0;n<i.length;n++){var o,p=i[n];if(!p.CARD_HOLDER||0===p.CARD_HOLDER.length)return o=h.sprintf(j.card_holder_name_not_specify,j["field_CARD_HOLDERS.CARD_HOLDER"],p.CARD_NUM),c.trigger("pay-sheet-model:card-holder_is_incorrect",o),o;for(var q=["CARD_NUM","CARD_HOLDER_INN","AMOUNT"],r=0;r<q.length;r++){var s=q[r];if(!p[s]||0===p[s].length)return o=h.sprintf(j.field_not_specify,j["field_CARD_HOLDERS."+s],p.CARD_HOLDER),c.trigger("pay-sheet-model:card-holder_is_incorrect",o),o}var t=parseFloat(p.AMOUNT);if(0>=t||t>1e11)return o=h.sprintf(j.field_is_incorrect,j["field_CARD_HOLDERS.AMOUNT"],t,p.CARD_HOLDER),c.trigger("pay-sheet-model:card-holder_is_incorrect",o),o;if(m.loaded&&(0===l.length||"true"===l)){var u,v=b.findWhere(m.array,{sks_number:p.CARD_NUM}),w=b.findWhere(m.array,{card_holder_inn:p.CARD_HOLDER_INN});if(v&&!w)return u=h.sprintf(j.inn_is_incorrect,j.inn,p.CARD_HOLDER_INN,j.sks,p.CARD_NUM,j.inn,v.card_holder_inn),c.trigger("pay-sheet-model:card-holder_is_incorrect",u),u;if(!v)return u=h.sprintf(j.unknown_sks,j.sks,p.CARD_NUM),c.trigger("pay-sheet-model:card-holder_is_incorrect",u),u}}}}},revert:function(){i.prototype.revert.call(this),this.unset("CARD_HOLDERS",{silent:!0})},getCurrency:function(){return"UAH"}})}),define("text!apps/ua_payment/templates/ua_payment_edit.tmpl",[],function(){return'<form>\n    <div class="grey-container">\n        <div class="link_pay_sheet link" style="display: none">\n            <ul>\n                <li id="pay_sheet">\n                    <span id="status_desc_link">&nbsp;</span>\n                    <a id="link" href="#"><%- pay_sheet %></a>\n                </li>\n                <li id="payment">\n                    <a class=\'disabled\'></a>\n                </li>\n            </ul>\n        </div>\n        <h1><%- ua_payment %></h1>\n\n        <% if (isMultiClient) { %>\n            <div class="sub-client-info"></div>\n        <% } %>\n\n        <% if (viewMode) { %>\n            <span id="status_desc" class="status-code-<%- statusCode %>"><%- status_desc %></span>\n        <% } %>\n\n    </div>\n\n    <div class="grey-container">\n        <div class=\'form-group additional\'>\n            <div class="num-doc">\n                <label for="NUM_DOC"><%- pp %></label>\n                <input type="text" id="NUM_DOC" name="NUM_DOC" autocomplete="off" maxlength="10"\n                       tabindex="11" placeholder="<%- autonum %>"/>\n            </div>\n\n            <div class=\'right\'>\n                <div class=\'date-doc\'>\n                    <label for="DATE_DOC"><%- date_doc %></label>\n                    <input type="text" id="DATE_DOC" name="DATE_DOC" class="form-control date datepicker" maxlength="10"\n                           tabindex="12" placeholder="<%- current %>"/>\n                    <span class="datepicker"></span>\n                </div>\n\n                <div class=\'value-date\'>\n                    <label for="VALUE_DATE"><%- value_date %></label>\n                    <input type="text" id="VALUE_DATE" name="VALUE_DATE" class="form-control date datepicker"\n                           maxlength="10"\n                           tabindex="13" placeholder="<%- not_required %>"/>\n                    <span class="datepicker"></span>\n                </div>\n            </div>\n        </div>\n\n        <div class="container">\n            <div class=\'amount\'>\n                <label for="AMOUNT"><%- by_amount %></label>\n                <input type="text" id="AMOUNT" name="AMOUNT" autocomplete="off" tabindex="1" placeholder="0.00"/>\n                <label class="nds-calc">\n                    <input type="checkbox" id="nds-calc"/>\n                    <span class="checkbox"></span>\n                    <%- recount_with_nds %>\n                </label>\n            </div>\n\n            <div class=\'acc with-type\'>\n                <label for="CLN_ACCOUNT"><%- from_acc %></label>\n                <input type="text" name="CLN_ACCOUNT" id="CLN_ACCOUNT" tabindex="2" class="account"/>\n            </div>\n\n            <div class=\'planned-remainder\'>\n                <label><%- planned_remainder %></label>\n                <input id=\'PLANNED_REMAINDER\' type="text"/>\n            </div>\n        </div>\n\n        <h2><%- rcpt %></h2>\n\n        <div class=\'rcpt container\'>\n            <div class=\'name\'>\n                <input type="text" value="<%- RCPT_NAME %>" name="RCPT_NAME" id="RCPT_NAME" maxlength="40" tabindex="3"\n                       placeholder="<%- start_entering %>"/>\n            </div>\n\n            <div>\n                <div class=\'okpo\'>\n                    <label for="RCPT_OKPO"><%- okpo %></label>\n                    <input type="text" name="RCPT_OKPO" id="RCPT_OKPO" tabindex="4" maxlength="10" class="unique"\n                           autocomplete="off" placeholder="<%- entering_placeholder %>"/>\n                </div>\n\n                <div class=\'country\'>\n                    <label for="RCPT_COUNTRY_CODE" id="country_label"><%- country_code %></label>\n                    <input type="text" name="RCPT_COUNTRY_CODE" id="RCPT_COUNTRY_CODE"/>\n                </div>\n\n                <div class=\'passp\'>\n                    <label for="RCPT_PASSP_SER" id="passp_label"><%- passp %></label>\n                    <div class="left">\n                        <input type="text" name="RCPT_PASSP_SER" id="RCPT_PASSP_SER" tabindex="5"\n                               maxlength="2" autocomplete="off" placeholder="<%- seria %>"/>\n                    </div>\n                    <div class="right-aligned">\n                        <input type="text" name="RCPT_PASSP_NUM" id="RCPT_PASSP_NUM" tabindex="6"\n                               maxlength="<%- RCPT_PASSP_SER ? 6 : 9 %>" autocomplete="off"\n                               placeholder="<%- number %>"/>\n                    </div>\n                </div>\n                <div class="clear"></div>\n            </div>\n\n            <div class="bank">\n                <label for="RCPT_BANK_MFO"><%- to_bank %></label>\n                <input type="text" name="RCPT_BANK_MFO" id="RCPT_BANK_MFO" tabindex="8" placeholder="<%- mfo %>"\n                       maxlength="6" class="mfo unique" autocomplete="off"/>\n                <input type="text" name="RCPT_BANK_NAME" id="RCPT_BANK_NAME" disabled=\'disabled\'\n                       placeholder="<%- name %>" tabindex="7" class="name"/>\n            </div>\n\n            <div class="rcpt-account">\n                <label for="RCPT_ACCOUNT"><%- to_acc %></label>\n                <input type="text" id="RCPT_ACCOUNT" name="RCPT_ACCOUNT" tabindex="9" class="account unique"\n                       maxlength="14" autocomplete="off" placeholder="<%- entering_placeholder %>"/>\n            </div>\n\n            <div id="add">\n                <label>\n                    <input type="checkbox" class="add-rcpt"/>\n                    <span class="checkbox"></span>\n                    <%- add_to_rcpt %>\n                </label>\n            </div>\n        </div>\n\n        <div class=\'expense-item container\'>\n            <a id=\'expense_item_link\' href="#"><%- expense_item %></a>\n            <label id=\'expense_item_lable\' for="EXPENSE_ITEM"><%- expense_item %></label>\n            <input type="text" id="EXPENSE_ITEM" name="EXPENSE_ITEM" maxlength="20"\n                   placeholder="<%- item_code %>" disabled="disabled"/>\n        </div>\n\n        <div class="details">\n            <div class="group-box">\n                <a id=\'with_nds\' class="select-box" href="#"><%- nds2 %></a>\n                <a id=\'without_nds\' class="select-box" href="#"><%- nds1 %></a>\n                <a id=\'budget_payment\' class="select-box" href="#">(<%- budget_payment %>)</a>\n            </div>\n\n            <% if (typeof promptValue !== "undefined" && promptValue !== "") { %>\n            <label for="PAYMENT_DETAILS"\n                   data-toggle="tooltip"\n                   data-trigger="hover"\n                   data-placement="bottom"\n                   title="<%- promptValue %>"><%- details_ext %></label>\n            <% } else { %>\n            <label for="PAYMENT_DETAILS"><%- details_ext %></label>\n            <% } %>\n            <textarea id="PAYMENT_DETAILS" name="PAYMENT_DETAILS" rows="2" tabindex="10">\n            </textarea>\n        </div>\n    </div>\n</form>\n\n<div class="document-status-bar"></div>\n<div class="comments-bar"></div>\n'}),define("styles!apps/ua_payment/css/ua_payment",[],function(){}),define("apps/ua_payment/ua_payment_view",["jquery","underscore","marionette","backbone","app","bifit","bigNumber","appsPieces","thesaurusUtils","libs/multi_client_utils","collections/documents","commons/base_object/document/document_item_view","apps/pay_sheet/pay_sheet_model","text!apps/ua_payment/templates/ua_payment_edit.tmpl","i18n!apps/ua_payment/nls/ua_payment","styles!apps/ua_payment/css/ua_payment"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){"use strict";return l.extend({tagName:"div",className:"doc-wrapper ua_payment",template:b.template(n),templateHelpers:o,okpoFieldTitle:"RCPT_OKPO",ui:{passpInfo:"div.passp",countryInfo:"div.country",tooltips:'[data-toggle="tooltip"]'},events:{"click div.link_pay_sheet a":"clickLinkPaySheet"},initialize:function(a){a&&(this.plannedRemainders=a.plannedRemainders,"archived"===a.selectedTab&&a.maxArchiveDate&&this.model.set("maxArchiveDate",a.maxArchiveDate,{silent:!0})),this.canGoToPaySheet=!0,this.listenTo(e,"toggleCanChooseItem",function(a){this.canGoToPaySheet=a})},updatePlannedRemainders:function(b){this.model.attributes.planned_remainder=(parseFloat(this.model.attributes.planned_remainder)-parseFloat(b)).toFixed(2),a("#PLANNED_REMAINDER").val(f.formatAmount(this.model.attributes.planned_remainder))},onShow:function(){if(l.prototype.onShow.call(this),this.renderPassportContent(),this.$("div.rcpt label.add").hide(),this.$("#with_nds, #without_nds, #budget_payment").hide(),this.$("label.nds-calc").hide(),this.$("#PAYMENT_DETAILS").formatter("oneline_textarea",{maxlength:550}).change(),this.model.get("EXPENSE_ITEM")?this.$("#expense_item_link").hide():this.$("div.expense-item").hide(),this.plannedRemainders&&(this.$("#PLANNED_REMAINDER").val(f.formatAmount(this.plannedRemainders[this.$("#CLN_ACCOUNT").val()])),this.model.attributes.planned_remainder=this.plannedRemainders[this.$("#CLN_ACCOUNT").val()]),this.model.get("links"))this.renderLinkPaySheet();else{var b=e.isMultiClient()?{data:{subClientEmployees:a.param(j.getDefaultEmployees())}}:null;this.model.fetch(b).done(function(){this.renderLinkPaySheet()}.bind(this))}this.ui.tooltips.tooltip()},renderLinkPaySheet:function(){if(this.model.get("links")&&this.model.get("links").length>0){this.$("div.link_pay_sheet").show();var b=this.isCommissionPaySheetLink(),c=b?o.link1_title:o.link0_title;this.$("div.link_pay_sheet li#payment a").text(c);var d=this.model.get("links")[0];if(this.$("span#status_desc_link").removeClass().addClass("status-code-"+d.status).attr("data-original-title",d.status_desc).tooltip({placement:"bottom",trigger:"hover"}),k.options.document_type===this.model.get("type")&&a("div.link_pay_sheet ul li#pay_sheet").appendTo(a("div.link_pay_sheet ul")),b||d.AMOUNT===this.model.get("AMOUNT")){if(b){var e,h=this.findProp("documents.pay_sheet.commission.percent");if(h&&!isNaN(h)){var i=new g(d.AMOUNT);e=i.times(h).div(100).toFixed(2,g.ROUND_HALF_UP)}this.model.get("AMOUNT")!==e&&this.renderWarnMsg(f.sprintf(o.links_incorrect,c))}}else this.renderWarnMsg(f.sprintf(o.links_incorrect,c))}},renderPassportContent:function(){switch(this.model.get(this.okpoFieldTitle)){case"0000000000":this.ui.passpInfo.show(),this.ui.countryInfo.hide();break;case"000000000":this.ui.passpInfo.hide(),this.ui.countryInfo.show();break;default:this.ui.passpInfo.hide(),this.ui.countryInfo.hide()}},clickLinkPaySheet:function(b){b&&(b.preventDefault(),"disabled"===a(b.target).attr("class"))||this.canGoToPaySheet!==!1&&(this.canGoToPaySheet=!1,this.goToPaySheet())},goToPaySheet:function(c){this.model.get("links").length>0?(d.history.navigate("document/list/pay_sheet"),require(["apps/pay_sheet/pay_sheet_controller"],function(d){(e.isMultiClient()?h.loadPermsForAllSubclients("pay_sheet,ua_payment"):a.Deferred().resolve()).done(function(){var a=new d,e=new m(this.model.get("links")[0]);a.collection&&(c&&(e=a.collection.findWhere({id:e.id}),e.set("links",b.reject(e.get("links"),function(a){return a.id===c}))),a.showItemView(e))}.bind(this))}.bind(this))):this.trigger("showList")},isCommissionPaySheetLink:function(){return this.model.get("RCPT_OKPO")===this.findProp("documents.pay_sheet.commission.rcpt_okpo")&&this.model.get("RCPT_ACCOUNT")===this.findProp("documents.pay_sheet.commission.rcpt_account")&&this.model.get("RCPT_BANK_MFO")===this.findProp("documents.pay_sheet.commission.rcpt_mfo")},findProp:function(a){var b=this.model.get("CLN_BANK_MFO");return i.getClientProp(a,b)},renderWarnMsg:function(b){a("<div>",{id:"warn-msg"}).insertAfter(this.$("#status_desc")),a("#warn-msg").append("<h2>"+o.links_warn+"</h2>").append("<span>"+b+"</span>")}})}),define("text!apps/ua_payment_request/templates/ua_payment_request_edit.tmpl",[],function(){return'<form>\r\n    <div class="grey-container">\r\n        <div class="link_pay_sheet link" style="display: none">\r\n            <ul>\r\n                <li id="pay_sheet">\r\n                    <span id="status_desc_link">&nbsp;</span>\r\n                    <a id="link" href="#"><%- pay_sheet %></a>\r\n                </li>\r\n                <li id="payment">\r\n                    <a class="disabled"></a>\r\n                </li>\r\n            </ul>\r\n        </div>\r\n        <h1><%- ua_payment %></h1>\r\n\r\n        <% if (isMultiClient) { %>\r\n            <div class="sub-client-info"></div>\r\n        <% } %>\r\n\r\n        <% if (viewMode) { %>\r\n            <span id="status_desc" class="status-code-<%- statusCode %>"><%- status_desc %></span>\r\n        <% } %>\r\n\r\n    </div>\r\n\r\n    <div class="grey-container">\r\n        <div class="clearfix form-group">\r\n            <div class="num-doc pull-left">\r\n                <label for="NUM_DOC"><%- pp %></label>\r\n                <input type="text" id="NUM_DOC" name="NUM_DOC" autocomplete="off" maxlength="10"\r\n                       tabindex="11" placeholder="<%- autonum %>"/>\r\n            </div>\r\n\r\n            <div class="date-doc pull-right">\r\n                <label for="DATE_DOC"><%- date_doc %></label>\r\n                <input type="text" id="DATE_DOC" name="DATE_DOC" class="form-control date datepicker"\r\n                       maxlength="10" tabindex="12" placeholder="<%- current %>"/>\r\n                <span class="datepicker"></span>\r\n            </div>\r\n        </div>\r\n\r\n        <div class="row form-group">\r\n            <div class="col-xs-4 amount">\r\n                <label for="AMOUNT"><%- by_amount %></label>\r\n                <input type="text" id="AMOUNT" name="AMOUNT" autocomplete="off" tabindex="1" placeholder="0.00"/>\r\n            </div>\r\n\r\n            <div class="col-xs-offset-2 col-xs-6 acc">\r\n                <label for="CLN_ACCOUNT"><%- from_acc %></label>\r\n                <input type="text" name="CLN_ACCOUNT" id="CLN_ACCOUNT" tabindex="2" class="account"/>\r\n            </div>\r\n        </div>\r\n\r\n        <h2 class="form-group">\r\n        <% if (typeof type !== "undefined" && type === "bank_ua_payment_request") { %>\r\n            <%- rcpt %>\r\n        <% } else { %>\r\n            <%- payer %>\r\n        <% } %>\r\n        </h2>\r\n\r\n        <div class="rcpt">\r\n            <div class="name clearfix form-group">\r\n                <input type="text" value="<%- RCPT_NAME %>" name="RCPT_NAME" id="RCPT_NAME" maxlength="40" tabindex="3"\r\n                       placeholder="<%- start_entering %>"/>\r\n            </div>\r\n\r\n            <div class="clearfix form-group">\r\n                <div class="okpo">\r\n                    <label for="RCPT_OKPO"><%- okpo %></label>\r\n                    <input type="text" name="RCPT_OKPO" id="RCPT_OKPO" tabindex="4" maxlength="10" class="unique"\r\n                           autocomplete="off" placeholder="<%- entering_placeholder %>"/>\r\n                </div>\r\n\r\n                <div class="country form-group">\r\n                    <label for="RCPT_COUNTRY_CODE" id="country_label"><%- country_code %></label>\r\n                    <input type="text" name="RCPT_COUNTRY_CODE" id="RCPT_COUNTRY_CODE" />\r\n                </div>\r\n\r\n                <div class="passp form-group clearfix">\r\n                    <label for="RCPT_PASSP_SER" id="passp_label"><%- passp %></label>\r\n                    <div class="left">\r\n                        <input type="text" name="RCPT_PASSP_SER" id="RCPT_PASSP_SER" tabindex="5"\r\n                               maxlength="2" autocomplete="off" placeholder="<%- seria %>"/>\r\n                    </div>\r\n                    <div class="right-aligned">\r\n                        <input type="text" name="RCPT_PASSP_NUM" id="RCPT_PASSP_NUM" tabindex="6"\r\n                               maxlength="<%- RCPT_PASSP_SER ? 6 : 9 %>" autocomplete="off"\r\n                               placeholder="<%- number %>"/>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            <div class="bank form-group">\r\n                <label for="RCPT_BANK_MFO"><%- to_bank %></label>\r\n                <input type="text" name="RCPT_BANK_MFO" id="RCPT_BANK_MFO" tabindex="8" placeholder="<%- mfo %>"\r\n                       maxlength="6" class="mfo unique" autocomplete="off"/>\r\n                <input type="text" name="RCPT_BANK_NAME" id="RCPT_BANK_NAME" disabled="disabled"\r\n                       placeholder="<%- name %>" tabindex="7"  class="name"/>\r\n            </div>\r\n\r\n            <div class="rcpt-account clearfix">\r\n                <label for="RCPT_ACCOUNT"><%- to_acc %></label>\r\n                <input type="text" id="RCPT_ACCOUNT" name="RCPT_ACCOUNT" tabindex="9" class="account unique"\r\n                       maxlength="14" autocomplete="off" placeholder="<%- entering_placeholder %>"/>\r\n            </div>\r\n\r\n            <div id="add">\r\n                <label>\r\n                    <input type="checkbox" class="add-rcpt"/>\r\n                    <span class="checkbox"></span>\r\n                    <%- add_to_rcpt %>\r\n                </label>\r\n            </div>\r\n        </div>\r\n\r\n        <div class="expense-item container">\r\n            <a id="expense_item_link" href="#"><%- expense_item %></a>\r\n            <label id="expense_item_lable" for="EXPENSE_ITEM"><%- expense_item %></label>\r\n            <input type="text" id="EXPENSE_ITEM" name="EXPENSE_ITEM" maxlength="20"\r\n                   placeholder="<%- item_code %>" disabled="disabled"/>\r\n        </div>\r\n\r\n        <div class="details">\r\n            <label for="PAYMENT_DETAILS"><%- details_ext %></label>\r\n            <textarea id="PAYMENT_DETAILS" name="PAYMENT_DETAILS" rows="2" tabindex="10">\r\n            </textarea>\r\n        </div>\r\n\r\n    </div>\r\n\r\n</form>\r\n<div class="document-status-bar"></div>\r\n<div class="comments-bar"></div>\r\n'}),define("apps/ua_payment_request/ua_payment_request_view",["jquery","underscore","bifit","apps/ua_payment/ua_payment_view","text!apps/ua_payment_request/templates/ua_payment_request_edit.tmpl"],function(a,b,c,d,e){"use strict";return d.extend({className:"doc-wrapper ua_payment ua_payment_request",template:b.template(c.replaceAll(e,"RCPT_","PAYER_")),okpoFieldTitle:"PAYER_OKPO",templateHelpers:function(){return this.nls},initialize:function(a){d.prototype.initialize.apply(this,arguments),this.nls=a.nls,b.each(["VALUE_DATE","RCPT_BANK_NAME","RCPT_BANK_MFO"],function(a){this.model.unset(a)}.bind(this))}})}),define("text!apps/ua_payment/templates/budget_payment_editor.tmpl",[],function(){return'<div class="box">\n    <div class="exit">&nbsp;</div>\n    <div class="title"><%- budget_payment %></div>\n\n    <div id="budget_payment-editor">\n        <div class="payment_kind_code">\n            <label for="PAYMENT_KIND_CODE"><%- code_type %></label>\n            <input type="text" id="PAYMENT_KIND_CODE" name="PAYMENT_KIND_CODE"\n                   placeholder="<%- payment_kind_code_placeholder %>"/>\n        </div>\n\n        <div id="DETAILS"></div>\n\n        <div>\n            <label for="PAYER_NUMBER"><%- payer_number %></label>\n            <input type="text" id="PAYER_NUMBER"/>\n        </div>\n\n        <div>\n            <label for="EXPLAIN_INF"><%- explain_inf %></label>\n            <textarea id="EXPLAIN_INF" rows="3"></textarea>\n        </div>\n    </div>\n\n    <button type="button" class=\'select primary\'><%- confirm_select %></button>\n    <button type="button" class="exit"><%- close_link_btn %></button>\n</div>\n\n'}),define("apps/ua_payment/budget_payment_editor_view",["jquery","underscore","backbone","marionette","bifit","collections/thesaurus","thesaurusUtils","dialogUtils","text!apps/ua_payment/templates/budget_payment_editor.tmpl","i18n!apps/ua_payment/nls/ua_payment","styles!apps/ua_payment/css/ua_payment"],function(a,b,c,d,e,f,g,h,i,j){var k={ru:"name_ru",uk:"name_uk",en:"name_en"}[e.getLocale()],l=function(a,c){var d=function(a,c){c=c||"";var d=c.indexOf(a);if(-1!==d){var e=b.escape(c.substr(0,d)),f=b.escape(c.substr(d,a.length)),g=b.escape(c.substr(d+a.length));return e+"<em>"+f+"</em>"+g}return b.escape(c)},e=d(c,a.code),f=d(c,a[k]);return e+"<br/>"+f};return d.ItemView.extend({template:b.template(i),templateHelpers:j,ui:{PAYMENT_KIND_CODE:"#PAYMENT_KIND_CODE",PAYER_NUMBER:"#PAYER_NUMBER",EXPLAIN_INF:"#EXPLAIN_INF",CONFIRM_BTN:".select",DETAILS:"#DETAILS"},events:{"click @ui.CONFIRM_BTN":"onConfirmBtnClick","change @ui.PAYMENT_KIND_CODE":"onPaymentKindCodeChange","click .exit":"destroy"},paymentsKinds:[],getSelectedKindCode:function(){return this.ui.PAYMENT_KIND_CODE.val().trim().split(" ")[0]},onRender:function(){this.$el.addClass("show"),this.ui.CONFIRM_BTN.focus().attr("disabled","disabled"),this.ui.PAYER_NUMBER.val(g.getClientProp("ua_payment.budget.client_code")),this.ui.EXPLAIN_INF.formatter("oneline_textarea"),this.ui.PAYMENT_KIND_CODE.formatter(["number","text_cyrillic","text_cyrillic_up","text_latin","text_latin_up","text_ua","space_symbol"]),this.ui.PAYMENT_KIND_CODE.chosen({searchable:!0,maxHeight:105,data:{array:this.paymentsKinds,id:"id",text:["code",k]},render:l}),f.getThesaurus("ua_payment_payments_kinds").fetch().done(function(a){this.paymentsKinds=b.sortBy(a,function(a){return+a.code||a.code}),this.ui.PAYMENT_KIND_CODE.trigger("refresh",{array:this.paymentsKinds}),this.ui.PAYMENT_KIND_CODE.val().length>0&&this.ui.PAYMENT_KIND_CODE.change()}.bind(this))},onPaymentKindCodeChange:function(d){if(0===a(d.target).val().length)return this.ui.DETAILS.empty(),this.ui.CONFIRM_BTN.prop("disabled",!0),c.Validation.callbacks.invalid(null,"PAYMENT_KIND_CODE",c.Validation.messages.required),void c.Validation.callbacks.showError({PAYMENT_KIND_CODE:c.Validation.messages.required});var e=this.getSelectedKindCode(),f=b.findWhere(this.paymentsKinds,{code:e});return f?(this.ui.DETAILS.html(f[k]),this.ui.CONFIRM_BTN.prop("disabled",!1),void c.Validation.callbacks.valid(null,"PAYMENT_KIND_CODE")):(this.ui.DETAILS.empty(),this.ui.CONFIRM_BTN.prop("disabled",!0),c.Validation.callbacks.invalid(null,"PAYMENT_KIND_CODE",j.incorrect_payments_kinds),void c.Validation.callbacks.showError({PAYMENT_KIND_CODE:j.incorrect_payments_kinds}))},onConfirmBtnClick:function(a){a.preventDefault();var b=this.getSelectedKindCode(),c=this.ui.PAYER_NUMBER.val()||" ",d=this.ui.EXPLAIN_INF.val(),e="*;"+b+";"+c+";"+d+";;;";this.trigger("ua_payment:payment_details:append",e),this.destroy()},onBeforeDestroy:function(){this.ui.PAYMENT_KIND_CODE.disposeChosen()}})}),define("text!apps/ua_payment/templates/budget_code_list.tmpl",[],function(){return'<div id="budget-code-list" class="box">\n    <div class="exit">&nbsp;</div>\n    <div class="title"><%- expense_item %></div>\n\n    <div class="errors" style="display: none"/>\n\n    <input type="text" name="filter" id="filter" placeholder="<%- item_search %>"/>\n\n    <div class="table-header">\n        <table class="list">\n            <thead>\n                <tr>\n                    <th class="code-col"><%- code_label %></th>\n                    <th class="descr-col"><%- descr_label %></th>\n                </tr>\n            </thead>\n        </table>\n    </div>\n    <div class="scrollbox">\n        <table class="list">\n            <tbody></tbody>\n        </table>\n    </div>\n\n    <button type="button" class="exit"><%- close_link_btn %></button>\n</div>\n'}),define("text!apps/ua_payment/templates/budget_code_item.tmpl",[],function(){return'<td class="ellipsis code-col" style="white-space: pre"><%- Array(parseInt(nesting_level)).join(\'   \') + code %></td>\n<td class="ellipsis descr-col"><%- description %></td>\n'}),define("apps/ua_payment/budget_code_list_view",["jquery","underscore","backbone","marionette","bifit","collections/thesaurus","thesaurusUtils","dialogUtils","text!apps/ua_payment/templates/budget_code_list.tmpl","text!apps/ua_payment/templates/budget_code_item.tmpl","i18n!apps/ua_payment/nls/ua_payment","styles!apps/ua_payment/css/ua_payment"],function(a,b,c,d,e,f,g,h,i,j,k){return d.CompositeView.extend({template:b.template(i),templateHelpers:k,events:{"click .exit":"dispose","input #filter":"doFilter"},childView:d.ItemView.extend({template:b.template(j),tagName:"tr",triggers:{click:"selectItem"}}),childViewContainer:"tbody",childEvents:{selectItem:"selectItem"},ui:{filterInput:"#filter"},collection:new c.Collection,initialize:function(a){this.collection.comparator=function(a,b){return a.get("left_key")-b.get("left_key")},this.originalCollection=a.expenceItems,this.collection.set(this.originalCollection)},onRender:function(){this.$el.addClass("show"),a(".box button:first-of-type").focus()},selectItem:function(a,b){b.model.get("right_key")-b.model.get("left_key")===1&&(this.trigger("ua_payment:budget_code:selected",b.model.get("code")),this.dispose())},doFilter:function(){var a=this.ui.filterInput.val(),c=a?b.filter(this.originalCollection,function(b){return a=a.toLowerCase(),b.code.toLowerCase().indexOf(a)>-1||b.description.toLowerCase().indexOf(a)>-1}):this.originalCollection;this.collection.reset(c)},dispose:function(){this.off("ua_payment:budget_code:selected"),this.remove()}})}),define("text!components/requisites_list_modal/template/requisites_list_modal_view.tmpl",[],function(){return'<div class="box requisites-list">\n    <div class="exit">&nbsp;</div>\n    <div class="title"><%- name %></div>\n    <div><%- edrpou %>: <%- inn %></div>\n\n    <table>\n        <thead>\n            <tr>\n                <th><%- account %></th>\n                <th><%- payment_details %></th>\n                <th><%- notes %></th>\n            </tr>\n        </thead>\n        <tbody></tbody>\n    </table>\n\n    <button type="button" class="exit"><%- close_link_btn %></button>\n</div>\n'}),define("text!components/requisites_list_modal/template/requisites_list_modal_row.tmpl",[],function(){return'<td class="bill"><%- bill %></td>\n<td class="comment ellipsis"><%- comment %></td>\n<td class="notes ellipsis"><%- note %></td>'}),define("components/requisites_list_modal/nls/requisites_list_modal",{root:{edrpou:"ЕГРПОУ",close_link_btn:"Закрыть",account:"счет",payment_details:"Назначение платежа",notes:"примечание"},uk:!0,en:!0}),define("components/requisites_list_modal/nls/uk/requisites_list_modal",{edrpou:"ЄДРПОУ",close_link_btn:"Закрити",account:"рахунок",payment_details:"Призначення платежу",notes:"примітка"}),define("components/requisites_list_modal/nls/en/requisites_list_modal",{edrpou:"EDRPOU",close_link_btn:"Close",account:"account",payment_details:"Payment details",notes:"notes"}),define("components/requisites_list_modal/requisites_list_modal_view",["underscore","backbone","marionette","dialogUtils","text!components/requisites_list_modal/template/requisites_list_modal_view.tmpl","text!components/requisites_list_modal/template/requisites_list_modal_row.tmpl","i18n!components/requisites_list_modal/nls/requisites_list_modal"],function(a,b,c,d,e,f,g){"use strict";var h=c.ItemView.extend({tagName:"tr",template:a.template(f),triggers:{click:"selectRequisites"}});return c.CompositeView.extend({template:a.template(e),templateHelpers:g,childView:h,childViewContainer:"tbody",childEvents:{selectRequisites:"selectRequisites"},events:{"click .exit":"destroy"},initialize:function(c){this.recipient=c.recipient,this.templateHelpers=a.extend({},this.templateHelpers,{inn:this.recipient.inn,name:this.recipient.name}),this.collection=new b.Collection(this.recipient.requisites)},onRender:function(){this.$el.addClass("show")},selectRequisites:function(a){var b={bic:a.model.get("bic"),bill:a.model.get("bill"),comment:a.model.get("comment")};this.trigger("recipient_requisites:choose",b),this.destroy()}})}),define("apps/ua_payment/ua_payment_edit",["jquery","underscore","appsPieces","backbone","marionette","dialogUtils","customConstants","commons/base_object/document/document_item_edit","collections/thesaurus","thesaurusUtils","bifit","customConstants","chosen","apps/ua_payment/budget_payment_editor_view","apps/ua_payment/budget_code_list_view","components/requisites_list_modal/requisites_list_modal_view","text!apps/ua_payment/templates/ua_payment_edit.tmpl","i18n!apps/ua_payment/nls/ua_payment","styles!apps/ua_payment/css/ua_payment","formatter"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){"use strict";var s=null,t=[];return h.extend({id:"edit",className:"doc-wrapper ua_payment",template:b.template(q),templateHelpers:r,serializeModel:function(){return b.extend({promptValue:this.getPromptValue()},h.prototype.serializeModel.apply(this,arguments))},ui:{passpInfo:"div.passp",countryInfo:"div.country",addRecipient:"input.add-rcpt",addDiv:"div#add",expenseItemPanel:"div.expense-item",calcNds:"input#nds-calc",withNds:"a#with_nds",withoutNds:"a#without_nds",tooltips:'[data-toggle="tooltip"]'},events:{"change #RCPT_OKPO":"onChangeRcptOkpo","input #RCPT_BANK_MFO":"changedMfo","change #RCPT_BANK_MFO":"changedMfo","change #RCPT_PASSP_SER":"onChangePasspSer","change #RCPT_PASSP_NUM":"onChangePasspNum","click @ui.withoutNds":"withoutNdsCalc","click @ui.withNds":"withNdsCalc","click a#budget_payment":"budgetPaymentCalc","click a#expense_item_link":"selectExpenseItem","change @ui.calcNds":"onCalcNdsClick","change input.unique":"toggleAddLabel","blur input.unique":"toggleAddLabel","change input[type=text]":"onChangeField","change textarea":"onChangeField","chosen:select #CLN_ACCOUNT":"onChangeClientAccount","keyup #RCPT_ACCOUNT":"onInputRcptAccount","keyup #RCPT_OKPO":"onInputRcptOkpo","hide #DATE_DOC":"onBlurDate","blur #DATE_DOC":"onBlurDate","hide #VALUE_DATE":"onBlurDate","blur #VALUE_DATE":"onBlurDate"},passpSerField:"RCPT_PASSP_SER",passpNumField:"RCPT_PASSP_NUM",initialize:function(a){this.accounts=a.accounts,this.recipientList=a.recipientList,this.countryList=a.countryList,this.getMfo=a.getMfo,this.getReference=a.getReference,this.getBankBranches=a.getBankBranches,this.plannedRemainders=a.plannedRemainders,this.currentSubClientId=a.currentSubClientId,this.fillUiElements(this.getUiElementsTitles()),this.on("budgetId:changed",this.updateExpenseItemPanel),r=this.changedNls||r},getUiElementsTitles:function(){return["DATE_DOC","NUM_DOC","AMOUNT","CLN_NAME","CLN_OKPO","CLN_ACCOUNT","CLN_BANK_NAME","CLN_BANK_MFO","RCPT_NAME","RCPT_OKPO","RCPT_ACCOUNT","RCPT_BANK_NAME","RCPT_BANK_MFO","PAYMENT_DETAILS","VALUE_DATE","CLN_COUNTRY_CODE","EXPENSE_ITEM","RCPT_COUNTRY_CODE","RCPT_PASSP_SER","RCPT_PASSP_NUM","PLANNED_REMAINDER"];
},onShow:function(){if(h.prototype.onShow.call(this,arguments),this._prepareLists(),this.onChangeRcptOkpo(!0),this.ui.AMOUNT.formatter("amount"),this.ui.RCPT_ACCOUNT.formatter("number"),this.ui.RCPT_OKPO.formatter("number"),this.ui.RCPT_BANK_MFO.formatter("number"),this.ui.RCPT_PASSP_NUM.formatter("number"),this.ui.PLANNED_REMAINDER.formatter("amount"),this.ui.RCPT_NAME.formatter("text"),!this.model.isNew()){var c=this.model.get("links");c&&c.length>0&&(this.ui.RCPT_ACCOUNT.prop("disabled",!0),this.ui.RCPT_BANK_MFO.prop("disabled",!0),this.ui.RCPT_OKPO.prop("disabled",!0),this.ui.RCPT_NAME.prop("disabled",!0),a("<div>",{id:"warn-msg"}).html(r.requisites_change_is_forbidden).insertAfter(this.$("h1")))}if(this.model.isNew()&&this.model.get("CLN_ACCOUNT")){var d=b.findWhere(this.accounts,{account:this.model.get("CLN_ACCOUNT")});d&&this.saveAccountIdToLocalStorage(d)}this.ui.PLANNED_REMAINDER.prop("disabled",!0),this.ui.DATE_DOC.formatter("date"),this.ui.VALUE_DATE.formatter("date"),k.datePicker(a("input.datepicker"),{orientation:"bottom auto"}),this.ui.PAYMENT_DETAILS.formatter("oneline_textarea",{maxlength:l.PAYMENT_DETAILS_LENGTH}).change(),this.$("#expense_item_lable").hide(),this.updateBudgetId(),this.ui.tooltips.tooltip()},onBeforeDestroy:function(){this.ui.CLN_ACCOUNT.disposeChosen(),this.ui.RCPT_NAME.disposeChosen(),this.ui.RCPT_COUNTRY_CODE.disposeChosen()},fillAccountList:function(){this.accounts=c.addAccountTypeDescription(this.accounts);var a={array:this.accounts,id:"account_id",text:"account"};this.ui.CLN_ACCOUNT.chosen({searchable:!1,data:a,accType:g.NEED_SHOW_ACC_TYPE}),this.updatePlannedRemainders(this.ui.CLN_ACCOUNT.val())},saveAccountIdToLocalStorage:function(a){k.setStorageDocData("ua_payment_acc_id",a.account_id)},onChangeClientAccount:function(a,b){this.saveAccountIdToLocalStorage(b),this.model.set(this.fillClientAccount(b)),this.updateBudgetId(),this.updatePlannedRemainders(b.account)},updatePlannedRemainders:function(a){this.plannedRemainders&&this.ui.PLANNED_REMAINDER.prop("value",k.formatAmount(this.plannedRemainders[a]))},fillClientAccount:function(a){var c=b.findWhere(this.getBankBranches,{bik:a.mfo});return{CLN_ACCOUNT:a.account,CLN_BANK_MFO:a.mfo,CLN_BANK_NAME:c.name}},onInputRcptAccount:function(a){this._onInput("bill",a.target.value,5)},onInputRcptOkpo:function(a){this._onInput("inn",a.target.value,8)},createFromRecipients:function(){var a=sessionStorage.getItem("rcpt_id");a&&(this.ui.RCPT_NAME.trigger("chooseById",a),sessionStorage.removeItem("rcpt_id"))},toggleAddLabel:function(){var a=this.ui.RCPT_OKPO.val(),c=this.ui.RCPT_ACCOUNT.val(),d=this.ui.RCPT_BANK_MFO.val();a&&c&&d?this.recipientList.done(function(e){var f=b.find(e,function(e){var f=k.getContent(e,"inn");return f===a&&b.findWhere(e.requisites,{bill:c})&&b.findWhere(e.requisites,{bic:d})});f?(this.ui.addDiv.hide(),this.ui.addRecipient.removeAttr("checked")):this.ui.addDiv.show()}.bind(this)):(this.ui.addDiv.hide(),this.ui.addRecipient.removeAttr("checked"))},onChangeRcptOkpo:function(a){switch(this.ui.RCPT_OKPO.val()){case"0000000000":a||(this.ui.RCPT_PASSP_SER.val(""),this.ui.RCPT_PASSP_NUM.val("")),this.ui.passpInfo.show(),this.ui.countryInfo.hide(),this.ui.RCPT_COUNTRY_CODE.val("");break;case"000000000":this.ui.RCPT_PASSP_SER.val(""),this.ui.RCPT_PASSP_NUM.val(""),this.ui.passpInfo.hide(),this.ui.countryInfo.show(),this.ui.RCPT_COUNTRY_CODE.is(".select-box")||this.fillCountryList();break;default:this.ui.RCPT_COUNTRY_CODE.val(""),this.ui.RCPT_PASSP_SER.val(""),this.ui.RCPT_PASSP_NUM.val(""),this.ui.passpInfo.hide(),this.ui.countryInfo.hide()}},fillCountryList:function(){var a={ru:"country",uk:"ukr_name",en:"eng_name"},c=a[k.getLocale()];this.countryList.done(function(a){var d=function(a,d,e){var f=a.code;if(d&&0!==d.length){e=e||0;var g=b.escape(f.substr(0,e)),h=b.escape(f.substr(e,d.length)),i=b.escape(f.substr(e+d.length));d=g+"<em>"+h+"</em>"+i}else d=b.escape(f);return d+="<span class='country-name'>"+b.escape(a[c])+"</span>"};this.ui.RCPT_COUNTRY_CODE.chosen({width:"10em",render:d,strict:!0,data:{array:a,id:"code",text:"code"}}),this.ui.RCPT_COUNTRY_CODE.formatter("number")}.bind(this))},getPromptValue:function(){var a=j.getClientProp("documents.ua_payment.prompt");return k.replaceAll(a,"^"," ")},changedMfo:function(){this.onChangeMfo("RCPT_BANK_NAME")},onChangeMfo:function(a){var b=this.ui.RCPT_BANK_MFO.val(),c=this.getMfo(b);this.ui.RCPT_BANK_NAME.val(""),c&&c.done(function(c){this.ui.RCPT_BANK_NAME.val(c[0]?c[0].name:""),this.model.set(a,c[0]?c[0].name:""),this.ui.RCPT_ACCOUNT.change(),this.validateField(this.ui.RCPT_BANK_MFO[0].id,b);var d=this.ui.RCPT_ACCOUNT.val();d&&this.validateField(this.ui.RCPT_ACCOUNT[0].id,d)}.bind(this))},withNdsCalc:function(a){a.preventDefault(),this.clearPrevNds();var b=.2,c=this.ui.AMOUNT.getUnformattedValue()||"0.00",d=r.with_nds_dtls+(100*b).toFixed(0)+"% - "+(c-c/(1+b)).toFixed(2)+" грн.";return this.addNdsInfo(d),!1},withoutNdsCalc:function(a){return a.preventDefault(),this.clearPrevNds(),this.addNdsInfo(r.no_nds_dtls),!1},budgetPaymentCalc:function(a){a.preventDefault();var b=new n({el:f.wrapper()});return b.render(),b.once("ua_payment:payment_details:append",function(a){this.ui.PAYMENT_DETAILS.val(this.ui.PAYMENT_DETAILS.val()+a).change()},this),!1},clearPrevNds:function(){var a=this.ui.PAYMENT_DETAILS.val();a=k.replaceAll(a,r.no_nds_dtls,"");var b=new RegExp(r.with_nds_dtls+".*?грн\\.","g");a=a.replace(b,""),this.ui.PAYMENT_DETAILS.val(a)},addNdsInfo:function(a){var b=this.ui.PAYMENT_DETAILS.val().trim(),c=b.length;b+=" "+a,b=b.length>l.PAYMENT_DETAILS_LENGTH?b.substr(0,l.PAYMENT_DETAILS_LENGTH):b,this.ui.PAYMENT_DETAILS.val(b).change(),k.setSelectionRange(this.ui.PAYMENT_DETAILS,c,b.length)},onChangePasspSer:function(a){var b=this.ui.RCPT_PASSP_SER.val();b?this.validateField(this.passpSerField,this.ui.RCPT_PASSP_SER.val()):(this.model.set(this.passpSerField,b,{silent:!0}),d.Validation.callbacks.valid(null,this.passpSerField)),this.ui.RCPT_PASSP_NUM.attr("maxlength",b?6:9),b&&this.ui.RCPT_PASSP_NUM.val().length>6&&this.ui.RCPT_PASSP_NUM.val(""),this.ui.RCPT_PASSP_NUM.val()&&this.ui.RCPT_PASSP_NUM.change()},onChangePasspNum:function(){this.validateField(this.passpNumField,this.ui.RCPT_PASSP_NUM.val()),this.onPasspChanged()},onPasspChanged:function(){this.ui.RCPT_PASSP_SER.hasClass("error")||this.ui.RCPT_PASSP_NUM.hasClass("error")?d.Validation.callbacks.showGlobalError(r.incorrectPassp):this.$("div.errors").remove()},onCalcNdsClick:function(a){this.clearPrevNds();var b=this.ui.AMOUNT.getUnformattedValue(),c=a.target.checked;c&&this.addNdsInfo(r.with_nds_dtls+"20% - "+(.2*(b||"0.00")).toFixed(2)+" грн."),b&&(b=c?1.2*b:b/1.2,this.ui.AMOUNT.val(k.formatAmount(b.toFixed(2))).change()),this.ui.AMOUNT.prop("disabled",c),this.ui.withNds.css("display",c?"none":"inline"),this.ui.withoutNds.css("display",c?"none":"inline")},onChangeField:function(a){var c=a.target.id;-1===c.indexOf("BANK_MFO")&&-1===c.indexOf("PASSP")&&-1===c.indexOf("DATE")&&h.prototype.onChangeField.call(this,a);var d=["RCPT_NAME","RCPT_OKPO","RCPT_ACCOUNT","PAYER_NAME","PAYER_OKPO","PAYER_ACCOUNT"];-1!==b.indexOf(d,c)&&(this.ui.RCPT_NAME.val()||this.ui.RCPT_OKPO.val()||this.ui.RCPT_ACCOUNT.val()||this.recipientList.done(function(a){this.ui.RCPT_OKPO.trigger("refresh",{array:b.isArray(a)?b.sortBy(a,"name"):[a],value:this.ui.RCPT_OKPO.val()}),this.ui.RCPT_ACCOUNT.trigger("refresh",{array:this._getAllRequisites(a),value:this.ui.RCPT_ACCOUNT.val()})}.bind(this)))},onBlurDate:function(a){var b=a.target.id;""===this.ui[b].val().replace(/\s+/g,"").replace(/\./g,"")&&this.ui[b].val(""),this.validateField(b,this.ui[b].val())},updateExpenseItemPanel:function(){s?this.getExpenceItems().done(function(a){t=a;var c=b.findWhere(t,{code:this.ui.EXPENSE_ITEM.val()});c||this.ui.EXPENSE_ITEM.val(""),this.ui.expenseItemPanel.show()}.bind(this)):(this.ui.EXPENSE_ITEM.val(""),this.ui.expenseItemPanel.hide())},updateBudgetId:function(){this.getBudgetId().done(function(a){s=a,this.trigger("budgetId:changed")}.bind(this))},getBudgetId:function(){var b=a.Deferred();if(this.isBudgetAccount()){var c=this.model.get("CLN_ACCOUNT"),d=this.model.get("CLN_BANK_MFO");if(""===this.validateField("DATE_DOC",this.ui.DATE_DOC.val())||""===this.ui.DATE_DOC.val()){var e=this.getDocDate(),f={query:"[0]=='"+d+"' && [1]=='"+c+"' && [4]==1 && [2] <= '"+e+"' && [3] >= '"+e+"'"};this.getReference("budget",f,!0,this.currentSubClientId).done(function(a){var c=a&&a.length>0?a[0].id:null;b.resolve(c)})}else b.resolve(null)}else b.resolve(null);return b},isBudgetAccount:function(){return Boolean(b.findWhere(this.accounts,{account:this.model.get("CLN_ACCOUNT"),currency:"UAH"}))},selectExpenseItem:function(a){a.preventDefault();var b=this;if(s){var c=new o({el:f.wrapper(),expenceItems:t});c.render(),c.on("ua_payment:budget_code:selected",function(a){this.ui.EXPENSE_ITEM.val(a)},b)}return!1},getExpenceItems:function(){var a=this.getDocDate(),b={query:"[0]=="+s+" && [7]==1 && (([14] <= '"+a+"' && [15] >= '"+a+"') || ([14] == NULL && [15] == NULL))"};return this.getReference("budget_item",b,!0,this.currentSubClientId)},getDocDate:function(){return this.ui.DATE_DOC.val()||k.date2str(k.getServerDate())},_prepareLists:function(){this.fillAccountList(),this._fillList(this.ui.RCPT_NAME,"name",200),this._fillList(this.ui.RCPT_OKPO,"inn",10),this._fillRecipientAccountsList()},_fillList:function(a,c,d){var e={data:{array:[],id:"id",text:c},maxLength:d};if(-1!==a.attr("name").indexOf("_NAME")){var f=function(a,c,d){var e=k.getContent(a,"name");if(c&&0!==c.length){d=d||0;var f=b.escape(e.substr(0,d)),g=b.escape(e.substr(d,c.length)),h=b.escape(e.substr(d+c.length));c=f+"<em>"+g+"</em>"+h}else c=b.escape(e);var i=k.getContent(a,"requisites"),j=i.length>1?r.several_reqs:b.escape(i[0].bill);return c+="<div class='bill'>"+j+"</div>"};b.extend(e,{render:f})}a.chosen(e),this.recipientList.done(function(c){var d=a.val(),e=b.clone(c);a.trigger("refresh",{array:b.isArray(e)?b.sortBy(e,"name"):[e],value:d}),a.bind("chosen:select",function(a,b){this._onChooseRcptField(e,b)}.bind(this)),a.val(d).change(),this.createFromRecipients(),this.toggleAddLabel()}.bind(this))},_fillRecipientAccountsList:function(){this.recipientList.done(function(a){b.each(a,function(a){b.each(a.requisites,function(b){b.idd=a.idd})});var c=this.ui.RCPT_ACCOUNT.val(),d=this._filterRecipients(a),e=this._getAllRequisites(d),f={data:{array:e,id:"id",text:"bill",value:c},maxLength:14};this.ui.RCPT_ACCOUNT.chosen(f),this.ui.RCPT_ACCOUNT.bind("chosen:select",function(c,d){var e=b.findWhere(a,{idd:d.idd});this._onChooseRcptField(a,e)}.bind(this)),this.ui.RCPT_ACCOUNT.val(c).change()}.bind(this))},_onChooseRcptField:function(a,c){c.requisites.length>1?this._showRequisitesListModal(c,a):this._fillFields({recipient:b.extend(c,c.requisites[0]),recipients:a})},_filterRecipients:function(a){var c=this.model.get("RCPT_OKPO")||this.model.get("PAYER_OKPO");return c?b.findWhere(a,{inn:c,name:this.model.get("RCPT_NAME")})||[]:b.clone(a)},_getAllRequisites:function(a){var c=b.isArray(a)?b.map(a,function(a){return a.requisites}):a.requisites;return b.flatten(c)},_showRequisitesListModal:function(a,c){var d={el:f.wrapper(),recipient:a},e=new p(d);e.render(),e.once("recipient_requisites:choose",function(d){this._fillFields({recipient:b.extend(a,d),recipients:c})}.bind(this))},_fillFields:function(a){var b=a.recipient;this.ui.RCPT_ACCOUNT.val(k.getContent(b,"bill")),this.ui.RCPT_NAME.val(k.getContent(b,"name")).change(),this.ui.RCPT_OKPO.val(k.getContent(b,"inn")).change(),this.ui.RCPT_BANK_MFO.val(k.getContent(b,"bic")).change(),b.comment=this.getCorrectPaymentDetailsOld(b.comment);var c=k.getContent(b,"comment");this.ui.PAYMENT_DETAILS.val(c).change(),this.ui.RCPT_ACCOUNT.trigger("refresh",{array:b.requisites,value:this.ui.RCPT_ACCOUNT.val()}),this.ui.RCPT_OKPO.trigger("refresh",{array:[b],value:this.ui.RCPT_OKPO.val()})},_onInput:function(a,c,d){c.length>=d&&this.recipientList.done(function(d){var e=b.filter(d,function(b){return k.getContent(b,a)===c});1===e.length&&this._onChooseRcptField(d,e[0])}.bind(this))},getCorrectPaymentDetailsOld:function(a){return a.length>l.PAYMENT_DETAILS_LENGTH?a.slice(0,l.PAYMENT_DETAILS_LENGTH):a}})}),define("apps/ua_payment_request/ua_payment_request_edit",["jquery","underscore","marionette","bifit","apps/ua_payment/ua_payment_edit","text!apps/ua_payment_request/templates/ua_payment_request_edit.tmpl"],function(a,b,c,d,e,f){"use strict";return e.extend({className:"doc-wrapper ua_payment ua_payment_request",template:b.template(d.replaceAll(f,"RCPT_","PAYER_")),okpoFieldTitle:"PAYER_OKPO",templateHelpers:function(){return this.nls},events:b.extend({"input #PAYER_BANK_MFO":"changedMfo","change #PAYER_BANK_MFO":"changedMfo","change #PAYER_OKPO":"onChangeRcptOkpo","change #PAYER_PASSP_SER":"onChangePasspSer","change #PAYER_PASSP_NUM":"onChangePasspNum","keyup #PAYER_OKPO":"onInputRcptOkpo","keyup #PAYER_ACCOUNT":"onInputRcptAccount"},e.prototype.events),passpSerField:"PAYER_PASSP_SER",passpNumField:"PAYER_PASSP_NUM",initialize:function(a){this.nls=a.nls,e.prototype.initialize.call(this,a),b.each(["VALUE_DATE","RCPT_BANK_NAME","RCPT_BANK_MFO"],function(a){this.model.unset(a)}.bind(this))},onRender:function(){e.prototype.onRender.call(this)},fillUiElements:function(){e.prototype.fillUiElements.apply(this,arguments),b.each(["_NAME","_OKPO","_ACCOUNT","_BANK_NAME","_BANK_MFO","_COUNTRY_CODE","_PASSP_SER","_PASSP_NUM"],function(a){this.ui["RCPT"+a]="#PAYER"+a},this)},saveAccountIdToLocalStorage:function(a){d.setStorageDocData("ua_payment_request_acc_id",a.account_id)},changedMfo:function(){this.onChangeMfo("PAYER_BANK_NAME")}})}),define("apps/ua_payment_request/ua_payment_request_model",["jquery","underscore","apps/ua_payment/ua_payment_model","collections/thesaurus","appsPieces","customConstants","i18n!nls/validation"],function(a,b,c,d,e,f,g){"use strict";function h(c){for(var f=a.extend(!0,{},c),h=0;h<j.length;h++){var i=j[h];f["PAYER"+i]=f["RCPT"+i],delete f["RCPT"+i]}return f.PAYER_BANK_MFO=b.clone(f.PAYER_BANK_MFO),f.PAYER_BANK_MFO[1]=b.clone(f.PAYER_BANK_MFO[1]),f.PAYER_BANK_MFO[1].fn=function(a,b,c){var d,e=c.PAYER_BANK_NAME;return e||(d=g.mfo_not_found),d},f.PAYER_ACCOUNT=b.clone(f.PAYER_ACCOUNT),f.PAYER_ACCOUNT[0]=b.clone(f.PAYER_ACCOUNT[0]),f.PAYER_ACCOUNT[0].calcAcc="PAYER_BANK_MFO",f.PAYER_COUNTRY_CODE=b.clone(f.PAYER_COUNTRY_CODE),f.PAYER_COUNTRY_CODE.fn=function(a,c,e){var f;return"000000000"===e.PAYER_OKPO&&(a?3!==a.length?f=g.invalid_field:a.match(/^\d+$/)?b.findWhere(d.getThesaurus("country").array,{code:a})||(f=g.invalid_field):f=g.incorrect_digest:f=g.required),f},f.PAYER_PASSP_SER=b.clone(f.PAYER_PASSP_SER),f.PAYER_PASSP_SER.fn=function(a,b,c){return this.checkPasspSer(a,b,c,{okpo:"PAYER_OKPO",ser:"PAYER_PASSP_SER",num:"PAYER_PASSP_NUM"})},f.PAYER_PASSP_NUM=b.clone(f.PAYER_PASSP_NUM),f.PAYER_PASSP_NUM.fn=function(a,b,c){return this.checkPasspNum(a,b,c,{okpo:"PAYER_OKPO",ser:"PAYER_PASSP_SER",num:"PAYER_PASSP_NUM"})},f.CLN_ACCOUNT=b.clone(f.CLN_ACCOUNT),f.CLN_ACCOUNT[1].fn=function(a){var c,d=b.findWhere(e.getAccounts(["1","2","9","10","101"],!0).UAH,{account:a});return d?d.permissions<=0?g.account_not_permission:("1"!==d.type&&(c=g.account_invalid_type),c):g.invalid_field},f}function i(a){var c=["NAME","OKPO","ACCOUNT","BANK_NAME","BANK_MFO","COUNTRY_CODE"],d=b.clone(a);return b.each(c,function(b){d["field_CLN_"+b]=a["field_RCPT_"+b]}),d}var j=["_NAME","_OKPO","_ACCOUNT","_BANK_NAME","_BANK_MFO","_COUNTRY_CODE","_PASSP_SER","_PASSP_NUM"];return c.extend({type:"ua_payment_request",nls:i(c.prototype.nls),defaults:{status:"",status_desc:"",status_color:"000000",DATE_DOC:"",NUM_DOC:"",AMOUNT:"",CLN_NAME:"",CLN_OKPO:"",CLN_ACCOUNT:"",CLN_BANK_NAME:"",CLN_BANK_MFO:"",PAYER_NAME:"",PAYER_OKPO:"",PAYER_ACCOUNT:"",PAYER_BANK_NAME:"",PAYER_BANK_MFO:"",PAYMENT_DETAILS:"",PAYER_COUNTRY_CODE:"",PAYER_PASSP_SER:"",PAYER_PASSP_NUM:"",CLN_COUNTRY_CODE:""},meta:b.extend({},c.prototype.meta,{relatively:b.extend({PAYER_NAME:function(a){return a}},c.prototype.meta.relatively)}),validation:h(c.prototype.validation),order:["DATE_DOC","NUM_DOC","AMOUNT","PAYER_NAME","PAYER_OKPO","PAYER_ACCOUNT","PAYER_BANK_NAME","PAYER_BANK_MFO","CLN_NAME","CLN_OKPO","CLN_ACCOUNT","CLN_BANK_NAME","CLN_BANK_MFO","PAYMENT_DETAILS","PAYER_COUNTRY_CODE","CLN_COUNTRY_CODE"]})}),define("apps/ua_payment/ua_payment_confirm",["app","jquery","underscore","collections/thesaurus","thesaurusUtils","libs/multi_client_utils","bifit","i18n!nls/common","commons/base_object/base_confirm","chosen"],function(a,b,c,d,e,f,g,h,i){"use strict";var j=function(a){if(this.silent_error=a.silent_error,this.groupedCollection=a.groupedCollection,this.data={},this.idsOfAllDocs=[],this.model){var b={};b[this.model.id]=this.model,this.data[this.model.get("owner_id")]=b,this.idsOfAllDocs.push(this.model.id)}this.collection&&c.each(this.groupedCollection,function(a,b){var d={};c.each(a,function(a){d[a.id]=a,this.idsOfAllDocs.push(a.id)},this),this.data[b]=d},this),this.idsOfAllDocs=this.idsOfAllDocs.join(",")},k=function(a,b){var c=localStorage.getItem("addr"),d=this.model||this.collection[0];return g.sprintf("{1}/document/{2}/{3}/{4}{5}",c,d.type,b,a,d._session())},l=function(e){function g(d){a.isMultiClient()&&(a.multiClient.currentSubClientId=j[d][0]);var l=j[d][1],m=c.keys(l).join(",");(a.isMultiClient()?f:b).ajax({url:k.call(i,"confirm",m),type:"post",dataType:"json",data:JSON.stringify(e),success:function(a){a=c.reject(a,function(a){return a.session_password?(e.session_password=a.session_password,!0):!1});var f=!1;c.each(a,function(a){var d=l[a.doc_id||a.id];c.has(a,"error")?(d.trigger("model:completeSync",d,h.error,a.message,400),f=!0,i.silent_error||b("<div class='errors'>"+a.message+"</div>").insertAfter(i.$("input:last"))):(d.set(a),d.trigger("model:completeSync",d,"Ok","",200))}),f&&!i.silent_error||i.trigger("navigate","finish"),d<j.length-1&&g(d+1)},error:function(a){b("<div class='errors'>"+a.responseText+"</div>").insertBefore(i.$("br:last"))}})}this.$("div.errors").remove();var i=this;a.isMultiClient()&&(e.mempl_id=d.getThesaurus("mempl_info").array[0].empl_id);var j=c.pairs(this.data);g(0)},m=i.OTPView.extend({initialize:function(a){i.OTPView.prototype.initialize.call(this,a),j.call(this,a)},loadTokenSerials:function(a){d.getThesaurus("token_serials",!1).fetch().done(a)},getEmployeeTokenSerial:function(){var b=a.isMultiClient()?"mempl_info":"empl_info";return d.getThesaurus(b).array[0].token_serial},confirm:l}),n=i.GoogleView.extend({initialize:function(a){i.GoogleView.prototype.initialize.call(this,a),j.call(this,a)},confirm:l}),o=i.SMSView.extend({initialize:function(a){i.SMSView.prototype.initialize.call(this,a),j.call(this,a)},getUrl:function(a){return k.call(this,a,this.idsOfAllDocs)},getMobilePhone:function(){return d.getThesaurus(a.isMultiClient()?"mempl_info":"empl_info").array[0].phone},getSendAgainTimeProp:function(){return e.getClientProp("security.sms.send_again_time")},confirm:l});return i.extend({initialize:function(a){i.prototype.initialize.call(this,a),this.silent_error=a.silent_error,this.map=c.extend(c.clone(i.STEP_VIEWS_MAP),{sms:o,otp:m,google:n}),this.model?this.clientsId=this.model.get("owner_id"):this.collection&&(this.groupedCollection=c.groupBy(this.collection,function(a){return a.get("owner_id")}),this.clientsId=c.keys(this.groupedCollection).join(";"))},getOptions:function(){return{collection:this.collection,silent_error:this.silent_error,groupedCollection:this.groupedCollection}},render:function(){var a={data:{query:this.clientsId}};return d.getThesaurus("document_confirm",!1).fetch(a).done(function(a){this.obtainable=c.intersection(c.keys(a[0]),c.keys(this.map)),!c.contains(this.obtainable,"google")||0!==d.getThesaurus("google_auth").array.length&&"true"===g.getStorageData("google.authenticator.can_usage")||(this.obtainable=c.without(this.obtainable,"google"));var b;switch(this.obtainable.length){case 0:b="empty";break;case 1:b="otp"===this.obtainable[0]?"otp":"way";break;default:b="way"}this.to(this.map[b])}.bind(this)),this}})}),define("commons/base_object/document/document_status_filter_view",["underscore","bifit","collections/thesaurus","services/doc_statuses","commons/base_object/document/document_filter_view","i18n!nls/document-filter"],function(a,b,c,d,e,f){"use strict";return e.extend({ui:a.extend({status:"#state_chosen_filter",statusContainer:"div.state-chosen-filter"},e.prototype.ui),statusesIds:[],statusSelection:{},initialize:function(){e.prototype.initialize.apply(this,arguments),this.on("tabStatus:changed",this.refreshStatusesForTab.bind(this))},reload:function(a){var b=this.getStatusFilterString();b&&(a=a||{},a.status=b),e.prototype.reload.call(this,a)},showTabStatuses:function(){e.prototype.showTabStatuses.apply(this,arguments),this.initStatusChosen(),this.refreshStatusesForTab()},initStatusChosen:function(){var c=b.getLocale();this.ui.statusContainer.show(),this.ui.status.chosen({searchable:!1,data:{array:[],id:"status_id",text:"localized_name",selection:this.statusSelection,all:f.any},renderInput:function(e,g){var h,i=a.size(g.selection);if(g.selection.all)h=f.any;else if(1===i){var j=parseInt(a.keys(g.selection)[0],10);h=d.getLocalizedNameById(j,c)}else h=b.sprintf(f.several,i);e.val(h)}}),this.ui.status.on("group:itemSelected",function(b,c,d){"all"!==c&&(delete d.selection.all,a.size(d.selection)===d.array.length-1&&(d.selection.all=!0))}),this.ui.status.on("chosen:group:selected",function(){a.isEmpty(this.statusSelection)&&this.ui.status.trigger("chooseById","all")}.bind(this))},refreshStatusesForTab:function(){if(!this.canSelectStatus())return void this.ui.statusContainer.hide();var b=this.statusSelection.all?[]:a.keys(this.statusSelection);this.ui.statusContainer.show(),this.ui.status.trigger("refresh",{array:this.getStatusesForSelectedTab()}),a.each(b,function(a){this.ui.status.trigger("chooseById",a)}.bind(this)),a.isEmpty(this.statusSelection)&&this.ui.status.trigger("chooseById","all")},canSelectStatus:function(){return this.tabsStatuses[this.tabsStatuses.selectedTab].split(",").length>1},getStatusesForSelectedTab:function(){var c=b.getLocale(),e=this.tabsStatuses[this.tabsStatuses.selectedTab].split(",");return a.chain(this.statusesIds).map(function(b){return a.contains(e,b)?{status_id:b,localized_name:d.getLocalizedNameById(b,c)}:void 0}).compact().value()},getStatusFilterString:function(){return this.canSelectStatus()&&!this.statusSelection.all?a.keys(this.statusSelection).join(","):null},restoreLastLoadFilterData:function(){this.lastLoadFilterData.status&&(a.each(this.statusSelection,function(a,b,c){delete c[b]}),a.each(this.lastLoadFilterData.status.split(","),function(a){this.ui.status.trigger("chooseById",a)}.bind(this))),e.prototype.restoreLastLoadFilterData.call(this)}})}),define("text!apps/ua_payment/templates/ua_payment_ext_filter.tmpl",[],function(){return'<div id="expanded-view">\n    <% if (isMultiClient()) { %>\n    <div class="data-row">\n        <div class="row">\n            <label for="client" class="col-xs-12"><%- payer %></label>\n        </div>\n        <div class="row">\n            <div class="col-xs-12"><input class="ellipsis" id="client"></div>\n        </div>\n    </div>\n    <% } %>\n    <div class="data-row">\n        <div class="row">\n            <label class="col-xs-4"><%- field_NUM_DOC %></label>\n            <label class="col-xs-8 links"><%- links %></label>\n        </div>\n        <div class="row">\n            <div class="col-xs-4">\n                <input autocomplete="off" maxlength="10" id="NUM_DOC">\n            </div>\n            <div class="col-xs-8 links">\n                <input id="LINK_TYPE">\n            </div>\n        </div>\n    </div>\n    <div class="data-row">\n        <div class="row">\n            <label class="col-xs-6"><%- amount %></label>\n            <label class="col-xs-6"><%- from_acc %></label>\n        </div>\n        <div class="row">\n            <div class="col-xs-6">\n                <div class="row">\n                    <div class="col-xs-5">\n                        <input id="AMOUNT_MIN" class="sum" autocomplete="off" placeholder="<%- from %>">\n                    </div>\n                    <div class="col-xs-1">\n                        <label class="amount-to">-</label>\n                    </div>\n                    <div class="col-xs-5">\n                        <input id="AMOUNT_MAX" class="sum" autocomplete="off" placeholder="<%- to %>">\n                    </div>\n                </div>\n            </div>\n            <div class="col-xs-6">\n                <input id="CLN_ACCOUNT" maxlength="14" autocomplete="off" placeholder="<%- entering_placeholder %>">\n            </div>\n        </div>\n    </div>\n    <div class="data-row">\n        <div class="row">\n            <label class="col-xs-8"><%- rcpt %></label>\n            <label class="col-xs-4"><%- to_acc %></label>\n        </div>\n        <div class="row">\n            <div class="col-xs-8">\n                <input id="RCPT_NAME" maxlength="40" autocomplete="off" placeholder="<%- start_entering %>">\n            </div>\n            <div class="col-xs-4">\n                <input id="RCPT_ACCOUNT" maxlength="14" autocomplete="off" placeholder="<%- entering_placeholder %>">\n            </div>\n        </div>\n    </div>\n    <div class="data-row">\n        <div class="row">\n            <label class="col-xs-4"><%- okpo %></label>\n            <label class="col-xs-8"><%- details_ext %></label>\n        </div>\n        <div class="row">\n            <div class="col-xs-4">\n                <input id="RCPT_OKPO" maxlength="10" autocomplete="off" placeholder="<%- entering_placeholder %>">\n            </div>\n            <div class="col-xs-8">\n                <input id="PAYMENT_DETAILS" maxlength="160" autocomplete="off">\n            </div>\n        </div>\n    </div>\n</div>\n<div id="minimized-view"></div>\n'}),define("apps/ua_payment/ua_payment_ext_filter_view",["underscore","backbone","app","bifit","customConstants","collections/thesaurus","appsPieces","commons/base_object/document/document_ext_filter_view","text!apps/ua_payment/templates/ua_payment_ext_filter.tmpl","i18n!apps/ua_payment/nls/ua_payment"],function(a,b,c,d,e,f,g,h,i,j){"use strict";var k=["no_filter","any","no_links","doc/pay_sheet"];k=a.map(k,function(a){return{id:a,text:j[a]}});var l=new b.Collection;return h.extend({template:a.template(i),templateHelpers:a.extend({},j,h.prototype.templateHelpers),className:"ua_payment",ui:a.defaults({NUM_DOC:"#NUM_DOC",AMOUNT_MIN:"#AMOUNT_MIN",AMOUNT_MAX:"#AMOUNT_MAX",CLN_ACCOUNT:"#CLN_ACCOUNT",LINK_TYPE:"#LINK_TYPE",RCPT_NAME:"#RCPT_NAME",RCPT_ACCOUNT:"#RCPT_ACCOUNT",RCPT_OKPO:"#RCPT_OKPO",PAYMENT_DETAILS:"#PAYMENT_DETAILS",client:"#client",status:"#STATUS",links:"#expanded-view .links"},h.prototype.ui),events:a.defaults({"blur @ui.AMOUNT_MIN":"validateFilterAmount","blur @ui.AMOUNT_MAX":"validateFilterAmount","chosen:select @ui.LINK_TYPE":"onChangeLinkType","chosen:select @ui.RCPT_NAME":"onRecipientSelected","chosen:select @ui.RCPT_ACCOUNT":"onRecipientAccountSelected","chosen:select @ui.RCPT_OKPO":"onRecipientSelected","blur @ui.RCPT_NAME":"onRecipientChanged","blur @ui.RCPT_OKPO":"onRecipientChanged"},h.prototype.events),fieldsMeta:{NUM_DOC:{idx:"1",order:2,label:j.field_NUM_DOC},AMOUNT_MIN:{idx:"2",order:4,label:j.amount_from,type:"amount",operation:">="},AMOUNT_MAX:{idx:"2",order:5,label:j.amount_to,shortLabel:j.to,type:"amount",operation:"<="},CLN_ACCOUNT:{idx:"5",order:6,label:j.from_acc},RCPT_NAME:{idx:"8",order:7,label:j.rcpt},RCPT_ACCOUNT:{idx:"10",order:8,label:j.to_acc},RCPT_OKPO:{idx:"9",order:9,label:j.okpo},PAYMENT_DETAILS:{idx:"13",order:10,label:j.details_ext},client:{idx:"3",order:1,type:"client",label:j.payer}},isFieldsOrder:!0,initialize:function(a){this.collection=l,this.recipients=[],h.prototype.initialize.call(this,a)},getExtFilterData:function(){var a=h.prototype.getExtFilterData.call(this);return this.trigger("getExtFilterData",this.collection),a},initForm:function(){this.addFormatters(),this.initChosens(),this.listenTo(c.mainLayout.content,"content:reloaded",this.highlightFoundText)},addFormatters:function(){this.ui.AMOUNT_MIN.formatter("amount"),this.ui.AMOUNT_MAX.formatter("amount"),this.ui.CLN_ACCOUNT.formatter("number"),this.ui.RCPT_ACCOUNT.formatter("number"),this.ui.RCPT_OKPO.formatter("number")},initChosens:function(){this.initClnAccountChosen(),this.initLinksChosen(),this.initRcptNameChosen(),this.initRcptOkpoChosen(),this.initRcptBillsChosen(),this.fillRcptChosens()},fillRcptChosens:function(){var a=c.isMultiClient()?f.loadMultiClientThesaurus("ua_recipients"):f.loadClientThesaurus("ua_recipients");a.done(function(a){this.recipients=a,this.fillRcptAccountsChosen(),this.fillRcptNameChosen(a),this.fillRcptOkpoChosen(a)}.bind(this))},fillRcptAccountsChosen:function(){if(this.recipients.length)if(this.ui.RCPT_ACCOUNT.val()&&this.ui.RCPT_NAME.val()&&this.ui.RCPT_OKPO.val()){var b=a.findWhere(this.recipients,{name:this.ui.RCPT_NAME.val(),inn:this.ui.RCPT_OKPO.val()});b&&this.ui.RCPT_ACCOUNT.trigger("refresh",{array:b.requisites})}else this.fillAllRcptAccountsChosen()},fillAllRcptAccountsChosen:function(){if(this.recipients&&this.recipients.length){var b=a.flatten(a.pluck(this.recipients,"requisites"));this.ui.RCPT_ACCOUNT.trigger("refresh",{array:b})}},fillRcptNameChosen:function(a){this.ui.RCPT_NAME.trigger("refresh",{array:a})},fillRcptOkpoChosen:function(a){this.ui.RCPT_OKPO.trigger("refresh",{array:a})},initLinksChosen:function(){this.ui.LINK_TYPE.chosen({searchable:!1,data:{array:k,id:"id",text:"text"}})},initClnAccountChosen:function(){this.ui.CLN_ACCOUNT.chosen({accType:e.NEED_SHOW_ACC_TYPE,data:{id:"account_id",array:[],text:"account"}});var a=g.getAccounts(e.ACCOUNT_TYPES,!0).UAH;g.removeDepositAccountsWithoutLinks(a).then(function(a){this.ui.CLN_ACCOUNT.trigger("refresh",{array:g.addAccountTypeDescription(a)})}.bind(this))},initRcptNameChosen:function(){this.ui.RCPT_NAME.chosen({data:{array:[],id:"id",text:"name"}})},initRcptOkpoChosen:function(){this.ui.RCPT_OKPO.chosen({data:{array:[],id:"id",text:"inn"}})},initRcptBillsChosen:function(){this.ui.RCPT_ACCOUNT.chosen({data:{array:[],id:"id",text:"bill"}})},collectAdditionalData:function(){var a=[];return this.linkType&&"no_filter"!==this.linkType.value&&a.push(this.linkType),a},restoreAdditionalFields:function(){var a=this.collection.get("LINK_TYPE");this.ui.LINK_TYPE.trigger("chooseById",a?a.get("value"):"no_filter")},onChangeLinkType:function(a,b){this.linkType={id:"LINK_TYPE",order:3,value:b.id,displayValue:b.text,label:j.linkTo}},onRecipientSelected:function(a,b){var c=b.requisites[0];this.ui.RCPT_NAME.val(d.getContent(b,"name")),this.ui.RCPT_OKPO.val(d.getContent(b,"inn")),this.ui.RCPT_ACCOUNT.trigger("refresh",{array:b.requisites}),this.ui.RCPT_ACCOUNT.val(d.getContent(c,"bill")),this.ui.PAYMENT_DETAILS.val(c.comment)},onRecipientAccountSelected:function(a,b){this.fillRcptFields(b)},fillRcptFields:function(a){var b=this.findRcptByRequisite(a);b&&(this.ui.RCPT_ACCOUNT.trigger("refresh",{array:b.requisites,value:d.getContent(a,"bill")}),this.ui.RCPT_NAME.val(d.getContent(b,"name")),this.ui.RCPT_OKPO.val(d.getContent(b,"inn")),this.ui.PAYMENT_DETAILS.val(a.comment))},findRcptByRequisite:function(a){if(this.recipients.length)for(var b,c=0;c<this.recipients.length;c++){b=this.recipients[c].requisites;for(var d=0;d<b.length;d++)if(b[d].id===a.id)return this.recipients[c]}},onRecipientChanged:function(){this.ui.RCPT_NAME.val()||this.ui.RCPT_OKPO.val()||(this.ui.RCPT_ACCOUNT.val(""),this.fillRcptAccountsChosen())},getAdditionalFilter:function(){var a={},b=this.collection.get("LINK_TYPE");return b&&(a.linkType=b.get("value")),a},highlightFoundText:function(){var a=this.collection.get("NUM_DOC");a&&g.highlightFoundText(a.get("value"),"td.number");var b=this.collection.get("RCPT_NAME");b&&g.highlightFoundText(b.get("value"),"td.rcpt");var c=this.collection.get("RCPT_ACCOUNT");
c&&g.highlightFoundText(c.get("value"),"td.rcpt-account")},setDefaults:function(){this.ui.LINK_TYPE.trigger("chooseById","no_filter"),this.fillAllRcptAccountsChosen()},handleTabStatusChanged:function(a){this.ui.links.length&&this.ui.links.css("display","archived"===a.selectedTab?"none":"block")},onBeforeDestroy:function(){this.ui.LINK_TYPE.disposeChosen(),this.ui.RCPT_NAME.disposeChosen(),this.ui.CLN_ACCOUNT.disposeChosen(),this.ui.RCPT_ACCOUNT.disposeChosen(),this.ui.RCPT_OKPO.disposeChosen(),h.prototype.onBeforeDestroy.call(this)}})}),define("apps/ua_payment/ua_payment_mclient_ext_filter_view",["jquery","underscore","bifit","customConstants","collections/thesaurus","appsPieces","apps/ua_payment/ua_payment_ext_filter_view"],function(a,b,c,d,e,f,g){"use strict";var h=function(a){return f.getClnAccounts(a).then(function(c){return f.removeDepositAccountsWithoutLinks(c,a).then(function(a){return b.filter(a,function(a){return"UAH"===a.currency&&"2"===a.status&&b.contains(["1","3","10"],a.type)})})})};return g.extend({events:b.extend({"change @ui.client":"onClientNameChanged"},g.prototype.events),initClnAccountChosen:function(){this.ui.CLN_ACCOUNT.chosen({accType:d.NEED_SHOW_ACC_TYPE,data:{id:"id",array:[],text:"account"}})},onClientNameChanged:function(){var c=this.ui.client.val(),d=b.findWhere(e.getThesaurus("sub_clients").array,{name_cln:c});a.when(d?h(d.client_id):[]).done(function(a){a=f.addAccountTypeDescription(a);var c=this.ui.CLN_ACCOUNT.val();this.ui.CLN_ACCOUNT.trigger("refresh",{array:a});var d=c&&(!a.length||b.any(a,function(a){return a.account.indexOf(c)>-1}));d&&this.ui.CLN_ACCOUNT.val(c).change()}.bind(this))},highlightFoundText:function(){g.prototype.highlightFoundText.call(this);var a=this.collection.get("client");a&&f.highlightFoundText(a.get("value"),"td.payer")}})}),define("apps/ua_payment/ua_payment_filter_view",["jquery","underscore","backbone","app","bifit","commons/base_object/document/document_status_filter_view","apps/ua_payment/ua_payment_ext_filter_view","apps/ua_payment/ua_payment_mclient_ext_filter_view","collections/thesaurus","components/date_period/date_period","i18n!apps/ua_payment/nls/ua_payment"],function(a,b,c,d,e,f,g,h,i,j,k){"use strict";return f.extend({documentTypeTitle:k.ua_payment_list,maxArchiveDate:null,ExtFilterComponent:d.isMultiClient()?h:g,statusesIds:["0","1","2","3","4","6","21","22","3004","5","13","14","15","16","17","18"],initialize:function(a){f.prototype.initialize.call(this,a),this.maxArchiveDate=a.maxArchiveDate,this.addModelListeners()},addModelListeners:function(){this.listenTo(c,"update-archive-dates",function(a,b){this.createDatePeriodComponent(a,b)})},createDatePeriodComponent:function(b,c){if(this.datePeriodComponent=new j({docType:this.docType,selectedTab:this.tabsStatuses.selectedTab}),"archived"!==this.tabsStatuses.selectedTab){if(this.maxArchiveDate){var d=e.str2date(this.maxArchiveDate);d.setDate(d.getDate()+1),this.datePeriodComponent.minDate=e.date2str(d)||""}if(this.maxArchiveDate&&!a(".archives-notification").length){var f=e.sprintf(k.archives_notification_1,this.maxArchiveDate)+"</br>"+k.archives_notification_2;a('<div class="archives-notification">'+f+"</div>").appendTo("div.toolbar-container")}}else this.datePeriodComponent.bdate=b||localStorage.getItem("ua_payment_archived_filter_bdate")||this.maxArchiveDate,this.datePeriodComponent.edate=c||localStorage.getItem("ua_payment_archived_filter_edate")||this.maxArchiveDate,this.datePeriodComponent.maxDate=this.maxArchiveDate,a(".archives-notification").remove();this.datePeriod.show(this.datePeriodComponent)},onShow:function(){f.prototype.onShow.call(this),this.listenTo(this.extFilterView,"getExtFilterData",function(a){this.trigger("getExtFilterData",a)}),this.tabsStatuses.archived&&(this.on("tabStatus:changed",this.extFilterView.handleTabStatusChanged.bind(this.extFilterView,this.tabsStatuses)),this.extFilterView.handleTabStatusChanged(this.tabsStatuses))},onSyncEnd:function(){f.prototype.onSyncEnd.call(this),this.trigger("onSyncEnd",this.collection)}})}),define("commons/base_object/document/document_print_processor",["jquery","underscore","bifit","printUtils"],function(a,b,c,d){"use strict";function e(b,c,d,e,f){this.form=b,this.$mainElement=a(b[0].querySelector("section.main").querySelector("article.main")),this.$printButton=a(b[0].querySelector("button.print.to-printer")),this.$printPdfButton=a(b[0].querySelector("button.print.to-pdf")),this.printStyle=d,this.pdfTemplate=e,this.documentType=c,this.modelStatus=f,this.printPromises=[]}return e.prototype.run=function(c){a(this.form[0].querySelector("#doc-div")).remove(),this.$mainElement.append('<style type="text/css">'+this.printStyle+"</style>"),this.$printPdfButton.parent().show(),d.spinBtn(this.$printButton),d.spinBtn(this.$printPdfButton),d.createLeftMenu(c,this.form).then(function(){var e=this.form.find("input[type=checkbox]");e.prop("disabled",!0),this.renderDocument(c[0],this.$mainElement);var f=!b.contains(["pay_sheet","assign_card_order","fire_staff_order","card_prolongation"],this.documentType);setTimeout(function(){a.when.apply(a,this.printPromises).then(function(){for(var b=f?this.$mainElement.clone(!0):this.$mainElement,g=1;g<c.length;g++)this.renderDocument(c[g],b);a.when.apply(a,this.printPromises).always(function(){f&&(this.$mainElement[0].innerHTML=b[0].innerHTML),e.prop("disabled",!1),d.stopBtn(this.$printButton),d.stopBtn(this.$printPdfButton)}.bind(this))}.bind(this))}.bind(this),300),this.addPrintPdfButtonHandler()}.bind(this))},e.prototype.renderDocument=function(){throw new Error("renderDocument is not implemented")},e.prototype.addPrintPdfButtonHandler=function(){this.$printPdfButton.bind("click",function(){var b=this.documentType+".pdf",e=this.prepareDocumentForPdf(this.$mainElement.clone(!0));a.ajax({type:"POST",url:localStorage.getItem("addr")+"/print_to_pdf;jsessionid="+c.getStoredItem("JSESSIONID"),contentType:"application/x-www-form-urlencoded; charset=UTF-8",mimeType:"text/plain; charset=x-user-defined",data:{html:this.getHtmlForPdf(e),fileName:b,stampAbsolutePosition:!0},success:function(a){d.createPdfFile(a,b,this.form[0])}.bind(this)})}.bind(this))},e.prototype.getHtmlForPdf=function(a){var c={"<br>":"<br/>",'"':'"',"<hr>":"<hr/>"};return b.template(this.pdfTemplate,{content_for_pdf:a[0].outerHTML}).replace(/<br>|"|<hr>/gi,function(a){return c[a]})},e.prototype.prepareDocumentForPdf=function(c){c.find("style").remove(),c.find("h1.empty").remove(),c.find(".hidden").remove(),c.find("colgroup").remove(),this.form.find("#ecp_owner").is(":checked")||c.find(".sign1, .sign2").children().remove(),this.form.find("#service_info").is(":checked")||0===c.find(".serv-info-table")||c.find(".serv-info-table").remove(),b.contains(["ua_payment","ua_payment_request","bank_ua_payment_request"],this.documentType)&&(this.form.find("#two_copies").is(":checked")||0===c.find(".doc-div-copied")||c.find(".doc-div-copied").remove());var d=c.find(".for-img img").parent();return d.empty(),this.form.find("#bank_stamp").is(":checked")&&d.each(function(){var b=a(this);b.append("<"+b.attr("data-stamp-name")+"/>")}),c},e}),define("text!apps/ua_payment/templates/print/print_pdf.tmpl",[],function(){return"<html>\n    <head>\n        <style type=\"text/css\">\n            div.ua_payment {\n                font-size: 8px;\n                font-family: 'Courier New', Courier, 'Lucida Console', monospace;\n                line-height: 1;\n            }\n\n            div.bank_ua_payment_request, div.ua_payment_request {\n                font-size: 10px;\n                font-family: \"Times_New_Roman\", serif;\n                line-height: 1;\n            }\n\n            table {\n                width: 100%;\n                border-spacing: 1px;\n                border-collapse: collapse;\n            }\n\n            td {\n                font-size: 11px;\n                padding: 3px;\n            }\n\n            div.doc-div {\n                page-break-after: always;\n            }\n\n            hr {\n                border-top-style: dashed;\n            }\n\n            body table .bordered, .border {\n                border: solid 1px #000000;\n            }\n\n            body table .bordered, body table .pad4 {\n                padding: 4px;\n            }\n\n            .tbordered {\n                border-top: 1px solid black;\n            }\n\n            .lbordered {\n                border-left: 1px solid black;\n            }\n\n            .bbordered {\n                border-bottom: 1px solid black;\n            }\n\n\n            .header, .header * {\n                font-weight: bold;\n            }\n\n            .amount-number {\n                padding-right: 5px;\n                text-align: right;\n            }\n\n            .doc-ident {\n                float: right;\n                padding: 1px 10px;\n            }\n\n            .pay-num {\n                font-size: 11pt;\n            }\n\n            .centered {\n                text-align: center;\n            }\n\n            .exec-bank {\n                height: 15px;\n            }\n\n            div.doc-div-copied, div.for-service-info {\n                padding-top: 2em;\n            }\n\n            div table.serv-info-table {\n                font-weight: 600;\n                border-collapse: collapse;\n                border-top: 1px solid black;\n                border-left: 1px solid black;\n            }\n\n            div table.serv-info-table td {\n                border-right: 1px solid black;\n                border-bottom: 1px solid black;\n            }\n\n            div.ua_payment table.serv-info-table, div.ua_payment_request table.serv-info-table {\n                font-family: Serif, 'Times New Roman', serif;\n            }\n\n            table.payment-info td.recipient-name, table.payer td.payer-name,\n            table.payment-info td.recipient-title, table.payer td.payer-title {\n                vertical-align: top;\n                padding-top: 0 !important;\n            }\n\n            table.payment-info td.recipient-name, table.payer td.payer-name {\n                word-wrap: break-word;\n            }\n\n            div.bank_ua_payment_request td.doc-date div, div.ua_payment_request td.doc-date div {\n                font-size: 9pt;\n            }\n\n            div.bank_ua_payment_request .font8, div.ua_payment_request .font8  {\n                font-size: 8pt;\n            }\n\n            div.bank_ua_payment_request body table td, div.ua_payment_request body table td {\n                padding: 2px !important;\n            }\n\n            div.bank_ua_payment_request .sign-empty-cell, div.ua_payment_request .sign-empty-cell {\n                height: 20px;\n            }\n        </style>\n    </head>\n    <body>\n        <%= content_for_pdf %>\n    </body>\n</html>"}),define("apps/ua_payment/ua_payment_print",["jquery","underscore","bifit","printUtils","commons/base_object/document/document_print_processor","text!apps/ua_payment/templates/print/print_pdf.tmpl"],function(a,b,c,d,e,f){"use strict";function g(a,b,c,d){this.printTemplate=d,e.call(this,a,b,c,f)}return g.prototype=Object.create(e.prototype),g.prototype.constructor=g,g.prototype.renderDocument=function(a,c){c.append('<div id="doc-div-'+a.id+'" class="doc-div"></div>');var e=c.find("#doc-div-"+a.id);e.addClass(this.documentType).html(b.template(this.printTemplate)(a.toJSON()));var f=e.find("div.doc-print-content").clone(!0);f.attr("class","doc-div-copied").css("display","none"),e.append(f);var g=a.get("AMOUNT");e.find(".amount-number").html(g.replace(".",",")),e.find(".amount-words").html(d.amountToWords(g));var h=e.find(".doc-date");h.html("<div>від "+d.dateToWords(a.get("DATE_DOC"))+"</div>"+h.html());var i=a.get("PAYMENT_DETAILS");e.find(".payment_details").html(b.escape(i));var j=d.addDocumentAdditionalInfo(e[0],a).then(function(){"ua_payment"===this.documentType&&d.getPrintParam("two_copies")&&f.css("display","block")}.bind(this));this.printPromises.push(j)},function(a,b,c){d.createPrintFormForPdf().then(function(d){var e=a[0].type||"ua_payment",f=new g(d,e,c,b);f.run(a)})}}),define("text!apps/ua_payment/templates/print/print.tmpl",[],function(){return'<div class="doc-print-content">\n\n    <table>\n        <tbody>\n            <tr>\n                <td width="75%"></td>\n                <td class="border doc-ident">0410001</td>\n            </tr>\n        </tbody>\n    </table>\n    <table>\n        <tr>\n            <td width="10%"></td>\n            <td width="40%" class="header centered pay-num">ПЛАТІЖНЕ ДОРУЧЕННЯ N <%- NUM_DOC %></td>\n            <td colspan="2">&nbsp;</td>\n        </tr>\n        <tr>\n            <td></td>\n            <td class="header centered doc-date"/>\n            <td width="30%">&nbsp;</td>\n            <td width="20%" class="centered" nowrap>Одержано банком</td>\n            <td>&nbsp;</td>\n        </tr>\n        <tr>\n            <td colspan="3">&nbsp;</td>\n            <td class="bbordered centered in-bank">&nbsp;</td>\n            <td>&nbsp;</td>\n        </tr>\n    </table>\n    <table class="payer">\n        <tr>\n            <td width="10%" class="payer-title">Платник</td>\n            <td width="90%" class="header payer-name"><%- CLN_NAME %></td>\n        </tr>\n    </table>\n    <table cols="7" class="payment-info">\n        <colgroup>\n            <col width="10%"/>\n            <col width="20%"/>\n            <col width="16%"/>\n            <col width="12%"/>\n            <col width="7%"/>\n            <col width="20%"/>\n            <col width="16%"/>\n        </colgroup>\n        <tr>\n            <td width="10%">Код</td>\n            <td width="20%" class="header bordered"><%= CLN_OKPO %></td>\n            <td width="16%">&nbsp;</td>\n            <td colspan="4">&nbsp;</td>\n        </tr>\n        <tr>\n            <td colspan="3">Банк платника</td>\n            <td width="12%" class="centered">код банку</td>\n            <td width="7%" class="centered"></td>\n            <td width="20%" class="centered">ДЕБЕТ рах. N</td>\n            <td width="16%" class="centered">СУМА</td>\n        </tr>\n        <tr>\n            <td class="header bbordered" colspan="3"><%- CLN_BANK_NAME %></td>\n            <td class="header bordered centered"><%= CLN_BANK_MFO %></td>\n            <td></td>\n            <td class="header tbordered lbordered bbordered"><%= CLN_ACCOUNT %></td>\n            <td class="header bordered amount-number" rowspan="5" valign="top"></td>\n        </tr>\n        <tr>\n            <td class="recipient-title">Отримувач</td>\n            <td class="header recipient-name" colspan="3"><%- RCPT_NAME %></td>\n            <td>&nbsp;</td>\n        </tr>\n        <tr>\n            <td>Код</td>\n            <td class="header">\n                <table style="height: 100%;">\n                    <tr><td  width="100%" class="bordered"><%= RCPT_OKPO %></td></tr>\n                </table>\n            </td>\n            <td colspan="3">&nbsp;</td>\n            <td class="centered">КРЕДИТ рах. N</td>\n        </tr>\n        <tr>\n            <td colspan="3">Банк отримувача</td>\n            <td class="centered">код банку</td>\n            <td></td>\n            <td class="header tbordered lbordered pad4"><%= RCPT_ACCOUNT %></td>\n        </tr>\n        <tr>\n            <td class="header bbordered" colspan="3"><%- RCPT_BANK_NAME %></td>\n            <td class="header centered bordered"><%= RCPT_BANK_MFO %></td>\n            <td></td>\n            <td class="tbordered lbordered bbordered"></td>\n        </tr>\n        <tr>\n            <td colspan="2">Сума (словами)</td>\n            <td colspan="2"></td>\n            <td colspan="3"></td>\n        </tr>\n        <tr>\n            <td class="header amount-words" colspan="5"><br><br></td>\n            <td colspan="2">&nbsp;</td>\n        </tr>\n    </table>\n\n    <table class="details" cols="6" cellspacing="2mm">\n        <tr>\n            <td width="70%" class="tbordered" colspan="4">Призначення платежу</td>\n            <td width="10%">&nbsp;</td>\n            <td class="bordered" width="20%">\n                <% if (typeof CLN_COUNTRY_CODE !=\'undefined\' && CLN_COUNTRY_CODE) { %>\n                П <%- CLN_COUNTRY_CODE %>\n                <% } %>\n                <% if (typeof RCPT_COUNTRY_CODE !=\'undefined\' && RCPT_COUNTRY_CODE) { %>\n                О <%- RCPT_COUNTRY_CODE %>\n                <% } %>\n                &nbsp;\n            </td>\n        </tr>\n        <tr>\n            <td class="header" colspan="4"><%- PAYMENT_DETAILS %></td>\n            <td colspan="2">&nbsp;</td>\n        </tr>\n    </table>\n    <table cellspacing="2mm">\n        <tr>\n            <td class="padded" colspan="2" valign="top">ДР</td>\n            <td class="bordered" colspan="2">\n                <% if (typeof RCPT_OKPO != \'undefined\' && RCPT_OKPO && RCPT_OKPO === \'0000000000\' &&\n                typeof RCPT_PASSP_SER != \'undefined\' && typeof RCPT_PASSP_NUM != \'undefined\') { %>\n                <span>Серія і N пасп. отр.:</span><br>\n                <span class="header"><%- RCPT_PASSP_SER %>&nbsp;<%- RCPT_PASSP_NUM %></span>\n                <% } %>\n                &nbsp;\n            </td>\n            <td width="44%"></td>\n            <td width="1%"></td>\n            <td width="20%" class="centered" rowspan="3" nowrap valign="top">\n                <table>\n                    <tr>\n                        <td class="exec-bank-title">Проведено банком</td>\n                    </tr>\n                    <tr>\n                        <td class="exec-bank">\n                            <% if (typeof OPER_DATE != \'undefined\' && OPER_DATE) { %>\n                            <%= OPER_DATE %>\n                            <% } %>\n                        </td>\n                    </tr>\n                    <tr>\n                        <td class="tbordered">підпис банку</td>\n                    </tr>\n                </table>\n            </td>\n        </tr>\n        <tr>\n            <td width="5%" class="padded" valign="top">М.П.</td>\n            <td width="8%" valign="top">Підписи</td>\n            <td width="2%"></td>\n            <td width="20%" class="bbordered"></td>\n            <td width="44%" class="sign1"></td>\n            <td width="1%"></td>\n        </tr>\n        <tr>\n            <td colspan="3"></td>\n            <td width="20%" class="bbordered">&nbsp;</td>\n            <td width="44%" class="sign2"></td>\n            <td width="1%"></td>\n        </tr>\n    </table>\n    <div class="for-img" style="float: right"/>\n</div>\n<hr/>\n<div class="for-service-info"></div>\n'}),define("text!apps/ua_payment/css/print.css",[],function(){return"section.doc-print article div.ua_payment,section.doc-print div.ua_payment div,\nsection.doc-print div.ua_payment td,section.doc-print div.ua_payment span,section.doc-print div.ua_payment p,\nsection.doc-print div.ua_payment u{\nfont-family:'Courier New',Courier,'Lucida Console',monospace;\nfont-size:8pt;\n}\ndiv.ua_payment td.header,div.ua_payment td.header *{\nfont-weight:bold;\n}\ndiv.ua_payment td:not([class=\"padded\"]):first-child{\npadding-left:0;\n}\n.doc-date div.bbordered{\ndisplay:inline-block;\n}\ndiv.ua_payment .amount-number{\npadding-right:5px;\ntext-align:right;\n}\nbody table .bordered,body table .pad4{\npadding:4px !important;\n}\nbody table td{\npadding:2px !important;\n}\nsection.doc-print table{\npadding:0;\n}\n.border{\nborder:solid 1px #000000;\n}\ndiv.ua_payment .doc-ident{\nfloat:right;\npadding:1px 10px !important;\n}\ndiv.doc-div.ua_payment td.pay-num{\nfont-size:11pt;\n}\ndiv.ua_payment .centered{\ntext-align:center;\n}\ndiv.ua_payment .tbordered{\nborder-top:1px solid black;\n}\ndiv.ua_payment .lbordered{\nborder-left:1px solid black;\n}\ndiv.ua_payment .bbordered{\nborder-bottom:1px solid black;\n}\ndiv.ua_payment table{\nwidth:100%;\nborder-collapse:collapse;\nborder-spacing:0;\n}\ndiv.ua_payment .header{\nfont-weight:bold;\n}\nsection.doc-print table.payment-info,\nsection.doc-print table.payer{\ntable-layout:fixed;\n}\nsection.doc-print table.payment-info td.recipient-name,\nsection.doc-print table.payer td.payer-name{\nword-wrap:break-word;\n}\ndiv.ua_payment .exec-bank{\nheight:15px;\n}"}),define("text!apps/ua_payment/templates/print/print_sub_menu.tmpl",[],function(){return'<div class="popup-wrapper bottom sub-menu">\n    <span class="popup-arrow"></span>\n    <span class="popup-arrow-border"></span>\n    <ul class="popup" style="white-space: nowrap">\n        <li class="popup-li"><a href="#" data-action="PRINT_REGISTRY"><%- ua_payment_print_registry %></a></li>\n        <% if (isSelected) { %>\n            <li class="popup-li"><a href="#" data-action="PRINT_LIST_DOC"><%- ua_payment_print_docs %></a></li>\n        <% } %>\n    </ul>\n</div>'}),define("text!apps/ua_payment/templates/print/print_registry.tmpl",[],function(){return'<table id="page-number">\n    <tr><td>Сторінка <%- page_number %></td></tr>\n</table>\n<div id="content"></div>'}),define("text!apps/ua_payment/templates/print/print_registry_header.tmpl",[],function(){return'<style>\n    .header {\n        line-height: 1.5;\n        padding-bottom: 20px;\n        padding-top: 20px;\n    }\n    .header span {\n        font-size: 12pt;\n    }\n    #content {\n        padding-bottom: 30px;\n    }\n    #page-number tr td {\n        text-align: right;\n    }\n    .registry-item {\n        padding: 10px 20px 10px 25px;\n    }\n    .registry-item-row {\n        table-layout: fixed;\n        border-spacing: 1px;\n    }\n    .registry-item-row__block {\n        font-family: "Times_New_Roman", serif;\n        font-size: 13px;\n        line-height: 1.1;\n        padding: 0 !important;\n        word-wrap: break-word;\n        -ms-word-wrap: break-word;\n    }\n    .registry-item-row__indent {\n        width: 10px;\n    }\n    .registry-item-row__num-doc {\n        width: 220px;\n    }\n    .registry-item-row__date {\n        width: 100px;\n    }\n    .registry-item-row__amount {\n        width: 130px;\n    }\n    .registry-item-row__payer {\n        width: 80px;\n    }\n    .registry-item-row__mfo {\n        width: 45px;\n    }\n    .registry-item-row__edrpou {\n        width: 75px;\n    }\n    .registry-item-row__acc {\n        width: 100px;\n    }\n    .registry-item-row__cln-name {\n        width: 340px;\n    }\n    .registry-item-row__cln-name.passport {\n        width: 240px;\n    }\n    .registry-item-row__nomination {\n        width: 133px;\n    }\n    .registry-item-row__desc {\n        width: 550px;\n    }\n    .registry-item-row__passp-ser {\n        width: 27px;\n    }\n    .registry-item-row__passp-num {\n        width: 65px;\n    }\n</style>\n\n<div class="centered bold-text header" align="center" id="header">\n    <span><%- BNK_NAME %></span><br>\n    <span><%- CLN_NAME %></span><br>\n    <span>РЕЄСТР ДОКУМЕНТІВ</span><br>\n    <span>з <%- BD %> до <%- ED %></span>\n</div>'}),define("text!apps/ua_payment/templates/print/print_registry_footer.tmpl",[],function(){return'<div id="footer">\n    <table>\n        <tbody>\n            <tr>\n                <td width="60%"></td>\n                <td width="20%" align="right">Усього документів: </td>\n                <td><%- COUNT_DOC %><br></td>\n            </tr>\n             <tr>\n                 <td></td>\n                 <td align="right">На загальну суму: </td>\n                 <td><%- TOTAL_AMOUNT %></td>\n             </tr>\n        </tbody>\n    </table>\n    <div style="padding-top: 3em">\n        <table>\n            <tbody>\n                <tr>\n                    <td width="10%"></td>\n                    <td width="12%">Бухгалтер</td>\n                    <td class="bbordered" width="30%"></td>\n                    <td></td>\n                </tr>\n                <tr>\n                    <td></td>\n                    <td>Директор</td>\n                    <td class="bbordered"></td>\n                </tr>\n            </tbody>\n        </table>\n    </div>\n</div>\n'}),define("text!apps/ua_payment/templates/print/print_registry_item.tmpl",[],function(){return'<div class="registry-item">\n    <table class="registry-item-row">\n        <tr>\n            <td class="registry-item-row__block registry-item-row__num-doc" valign="top">Документ N <%- NUM_DOC %></td>\n            <td class="registry-item-row__block registry-item-row__date" valign="top">Дата: <%- DATE_DOC %></td>\n            <td class="registry-item-row__block registry-item-row__indent" valign="top"></td>\n            <td class="registry-item-row__block registry-item-row__amount" valign="top">Сума: <%- AMOUNT %></td>\n            <td class="registry-item-row__block registry-item-row__indent" valign="top"></td>\n            <td class="registry-item-row__block" valign="top">Статус: <%- status_desc_ua %></td>\n        </tr>\n    </table>\n\n    <table class="registry-item-row">\n        <tr>\n            <td class="registry-item-row__block registry-item-row__payer" valign="top">Платник:</td>\n            <td class="registry-item-row__block registry-item-row__mfo" valign="top"><%- CLN_BANK_MFO %></td>\n            <td class="registry-item-row__block registry-item-row__indent" valign="top"></td>\n            <td class="registry-item-row__block registry-item-row__edrpou" valign="top"><%- CLN_OKPO %></td>\n            <td class="registry-item-row__block registry-item-row__indent"></td>\n            <td class="registry-item-row__block registry-item-row__acc" valign="top"><%- CLN_ACCOUNT %></td>\n            <td class="registry-item-row__block registry-item-row__indent" valign="top"></td>\n            <td class="registry-item-row__block registry-item-row__cln-name" valign="top"><%- CLN_NAME %></td>\n        </tr>\n    </table>\n\n    <table class="registry-item-row">\n        <tr>\n            <td class="registry-item-row__block registry-item-row__payer" valign="top">Отримувач:</td>\n            <td class="registry-item-row__block registry-item-row__mfo" valign="top"><%- RCPT_BANK_MFO %></td>\n            <td class="registry-item-row__block registry-item-row__indent" valign="top"></td>\n            <td class="registry-item-row__block registry-item-row__edrpou" valign="top"><%- RCPT_OKPO %></td>\n            <td class="registry-item-row__block registry-item-row__indent" valign="top"></td>\n            <td class="registry-item-row__block registry-item-row__acc" valign="top"><%- RCPT_ACCOUNT %></td>\n            <td class="registry-item-row__block registry-item-row__indent" valign="top"></td>\n            <% if (RCPT_OKPO === \'0000000000\') { %>\n                <td class="registry-item-row__block registry-item-row__cln-name passport" valign="top"><%- RCPT_NAME %></td>\n                <td class="registry-item-row__block registry-item-row__indent" valign="top"></td>\n                <td class="registry-item-row__block registry-item-row__passp-ser" valign="top"><%- RCPT_PASSP_SER %></td>\n                <td class="registry-item-row__block registry-item-row__indent" valign="top"></td>\n                <td class="registry-item-row__block registry-item-row__passp-num" valign="top"><%- RCPT_PASSP_NUM %></td>\n            <% } else { %>\n                <td class="registry-item-row__block registry-item-row__cln-name" valign="top"><%- RCPT_NAME %></td>\n            <% } %>\n        </tr>\n    </table>\n\n    <table class="registry-item-row">\n        <tr>\n            <td class="registry-item-row__block registry-item-row__nomination" valign="top">Банк отримувача:</td>\n            <td class="registry-item-row__block registry-item-row__desc" valign="top"><%- RCPT_BANK_NAME %></td>\n        </tr>\n    </table>\n\n    <table class="registry-item-row">\n        <tr>\n            <td class="registry-item-row__block registry-item-row__nomination" valign="top">Призначення платежу:</td>\n            <td class="registry-item-row__block registry-item-row__desc" valign="top"><%- PAYMENT_DETAILS %></td>\n        </tr>\n    </table>\n\n    <% if (EXPENSE_ITEM) { %>\n        <table class="registry-item-row">\n            <tr>\n                <td class="registry-item-row__block registry-item-row__nomination" valign="top">Стаття витрат:</td>\n                <td class="registry-item-row__block registry-item-row__desc" valign="top"><%- EXPENSE_ITEM %> <%- description %></td>\n            </tr>\n        </table>\n    <% } %>\n    <br/>\n</div>'}),define("text!apps/ua_payment/templates/print/print_registry_pdf.tmpl",[],function(){return'<html>\n<head>\n    <style type="text/css">\n        body {\n            font-size: 10pt;\n            font-family: "Times_New_Roman", serif;\n        }\n        table {\n            border-spacing: 1px;\n        }\n        td {\n            font-size: 13px;\n            padding: 0 !important;\n        }\n        .header {\n            text-align: center;\n            font-weight: bold;\n            padding: 20px 0 0 0;\n        }\n        #content {\n            padding-bottom: 25px;\n        }\n        div.header span {\n            font-size: 10pt;\n        }\n        div.registry-item {\n            padding: 10px 5px 9px 25px;\n        }\n        #page-number {\n            width: 100%;\n        }\n        #page-number tr td {\n            text-align: right;\n        }\n        .bbordered {\n            border-bottom: 1px solid black;\n        }\n        #footer table td {\n            padding: 5px !important;\n        }\n    </style>\n</head>\n<body>\n<%= content_for_pdf %>\n</body>\n</html>'}),define("apps/ua_payment/ua_payment_print_list",["jquery","underscore","app","services/doc_statuses","collections/thesaurus","bifit","printUtils","text!apps/ua_payment/templates/print/print_registry.tmpl","text!apps/ua_payment/templates/print/print_registry_header.tmpl","text!apps/ua_payment/templates/print/print_registry_footer.tmpl","text!apps/ua_payment/templates/print/print_registry_item.tmpl","text!apps/ua_payment/templates/print/print_registry_pdf.tmpl","i18n!apps/ua_payment/nls/ua_payment"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){"use strict";return function(n,o,p){g.createPrintFormForPdf().then(function(q){function r(a,b){D.append(a),w.height()>x&&(w.find(b).last().remove(),v++,u+=D[0].outerHTML,u+='<div style="page-break-after: always"></div>',w.parent().append('<div id="doc-div" class="ua-payment-registry page">'+y({page_number:v})+"</div>"),w=q.find("div#doc-div.ua-payment-registry").last(),D=w.find("#content").append(a),u+=w.find("#page-number")[0].outerHTML)}var s=q.find(".print.to-printer"),t=q.find(".print.to-pdf");g.spinBtn(s),g.spinBtn(t);var u,v=1;q.find("h1.empty").html(m.ua_payment_print_registry_title);var w=q.find("#doc-div").addClass("ua-payment-registry page"),x=w.height(),y=b.template(h),z=0,A=n.options.data;t.parent().show(),t.bind("click",function(){var c="ua_payment_registry.pdf";a.ajax({url:localStorage.getItem("addr")+"/print_to_pdf;jsessionid="+f.getStoredItem("JSESSIONID"),type:"POST",contentType:"application/x-www-form-urlencoded; charset=UTF-8",data:{html:b.template(l,{content_for_pdf:u}).split("<br>").join("<br/>").split('"').join('"'),fileName:c},mimeType:"text/plain; charset=x-user-defined",success:function(a){g.createPdfFile(a,c,q[0])}})}),w.html(y({page_number:v}));var B=b.template(i,{BNK_NAME:o.name,CLN_NAME:c.isMultiClient()?"":p.name_cln,BD:A.bdate,ED:A.edate}),C=w.find("#page-number");u=C[0].outerHTML+B,C.append(B);var D=w.find("#content");e.getThesaurus("budget_codes",!1).fetch().done(function(a){b.each(n.models,function(c){var e;c.get("EXPENSE_ITEM")&&(e=(b.findWhere(a,{code:c.get("EXPENSE_ITEM")})||{}).description);var f=parseInt(c.get("status")),g=d.getLocalizedNameById(f,"uk");if(1===f){var h=c.get("status_desc");g+=" "+h.substr(h.indexOf("(")).split(m.of).join("з")}var i=b.template(k,b.extend({description:e||""},{status_desc_ua:g},c.toJSON()));z+=parseFloat(c.get("AMOUNT")),r(i,".registry-item")});var c=b.template(j,{COUNT_DOC:n.models.length,
TOTAL_AMOUNT:z.toFixed(2)});r(c,"#footer"),u+=D[0].outerHTML,g.stopBtn(s),g.stopBtn(t)})})}}),define("apps/ua_payment/base_ua_payment_controller",["jquery","underscore","backbone","bifit","app","charsets","appsPieces","customConstants","actionUtils","dialogUtils","thesaurusUtils","collections/thesaurus","collections/documents","collections/editabled_thesaurus","libs/multi_client_utils","models/reference","commons/base_object/document/group_opers_document_controller","apps/ua_payment/ua_payment_model","apps/ua_payment/ua_payment_confirm","apps/ua_payment/ua_payment_list_view","apps/ua_payment/ua_payment_filter_view","apps/ua_payment/ua_payment_view","apps/ua_payment/ua_payment_edit","apps/ua_payment/ua_payment_print","text!apps/ua_payment/templates/print/print.tmpl","text!apps/ua_payment/css/print.css","text!apps/ua_payment/templates/print/print_sub_menu.tmpl","apps/ua_payment/ua_payment_print_list","text!apps/ua_payment/templates/ua_payment_list_item.tmpl","i18n!apps/ua_payment/nls/ua_payment","i18n!nls/common","i18n!nls/document","i18n!commons/registry_docs/nls/registry_docs"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G){"use strict";var H=function(a){var c=a?a.mfo:0,d=b.findWhere(l.getThesaurus("bank_branches").array,{bik:c});return{CLN_ACCOUNT:a.account,CLN_BANK_MFO:a.mfo,CLN_BANK_NAME:d.name}},I=function(){var a=l.getThesaurus("accs_info").array;return a=b.filter(a,function(a){return"UAH"===a.currency&&a.permissions>0&&"2"===a.status&&b.contains(h.ACCOUNT_TYPES,a.type)}),b.sortBy(a,"account")},J=function(){var a=n.getThesaurus("ua_recipients"),b={error:function(a){c.Validation.invalidField(null,"RCPT_NAME",a)}};return a.loaded=!1,a.fetch(b)},K=function(){var a=l.getThesaurus("country"),b={error:function(a){c.Validation.invalidField(null,"RCPT_COUNTRY_CODE",a)}};return a.fetch(b)},L=null,M=null,N=function(a){if(a.length<12||a.length>18)return!1;var b=a.charAt(0);if("R"!==b&&"r"!==b)return!1;var c=parseInt(+a.substr(1,2),10);if(isNaN(c)||1>c||c>31)return!1;var d=parseInt(+a.substr(3,2),10);if(isNaN(d)||0>d||d>23)return!1;var e=parseInt(+a.substr(5,2),10);return!(isNaN(e)||0>e||e>59)},O=q.extend({tabsStatuses:{work:"0,1,2,3,4,6,21,22,3004",executed:"5",selectedTab:"work"},actionBarPrintSubMenu:null,ListView:t,listItemTemplate:C,Model:r,FilterView:u,View:v,Edit:w.extend({changedNls:D}),docType:"ua_payment",nls:D,maxArchiveDate:null,aliases:null,initialize:function(){this.maxArchiveDate=k.firstPropOf("documents.ua_payment.archive_temp_doc_date","documents.ua_payment.archive_max_doc_date"),e.isMultiClient()&&"ua_payment"===this.docType&&(this.tabsStatuses.for_consideration="13,14,15,16,17,18"),this.maxArchiveDate&&"ua_payment"===this.docType&&(this.tabsStatuses.archived="0,1,2,3,4,5,6,12,3004"),q.prototype.initialize.call(this)},addActions:function(){q.prototype.addActions.call(this),"ua_payment"===this.docType&&(this.actionsList?this.actionsList.push("PRINT_GROUP"):this.actionsList=["PRINT_GROUP"])},reloadDocumentsList:function(a){e.mainLayout.actionBar.show(this.createActionBar(this.actionsList)),"archived"===this.tabsStatuses.selectedTab&&(a.isArchive=!0,d.str2date(a.bdate)>d.str2date(this.maxArchiveDate)&&(a.bdate=this.maxArchiveDate),d.str2date(a.edate)>d.str2date(this.maxArchiveDate)&&(a.edate=this.maxArchiveDate),c.trigger("update-archive-dates",a.bdate,a.edate)),q.prototype.reloadDocumentsList.call(this,a)},documentReloadOptions:function(a){return a.exclude="links",q.prototype.documentReloadOptions.call(this,a)},createFilterView:function(){var a=new this.FilterView({collection:this.collection,tabsStatuses:this.tabsStatuses,docType:this.docType,maxArchiveDate:this.maxArchiveDate});return this.listenTo(a,"getExtFilterData",function(a){M=a}),this.listenTo(a,"reload",this.reloadDocumentsList),this.listenTo(a,"onSyncEnd",function(a){this.getPlannedRamainders(a).done(function(a){L=a}.bind(this))}),a},getPossibleActionsForItemView:function(a){return i.isArchive(a)?this.isAccountsForCreateAction()?[i.DocumentAction.COPY,i.DocumentAction.PRINT]:[i.DocumentAction.PRINT]:q.prototype.getPossibleActionsForItemView.call(this,a)},viewDocumentOptions:function(){return{model:new this.Model(this.preparedContent4View),plannedRemainders:L,maxArchiveDate:this.maxArchiveDate,selectedTab:this.tabsStatuses.selectedTab}},showItemView:function(c){if(this.canChooseItem!==!1){this.canChooseItem=!1;var d=this,f=function(){d.canChooseItem=!0,!b.isEmpty(L)&&b.has(L,c.attributes.CLN_ACCOUNT)?q.prototype.showItemView.call(d,c):d.updatePlannedRemainders().done(function(){q.prototype.showItemView.call(d,c)})};if(e.isMultiClient()){var g=o.loadSubClientData(c.get("owner_id"),c.get("CLN_NAME"));a.when(g).then(f).fail(function(){d.canChooseItem=!0})}else f()}},createItemView:function(a,b){var c=q.prototype.createItemView.call(this,a,b);return c.then(function(){m.options.document_type!==this.selectedModel.get("type")&&(this.stopListening(this.selectedModel,"destroy"),this.listenTo(this.selectedModel,"destroy",function(){this.itemViewInstance.goToPaySheet.call(this.itemViewInstance,this.selectedModel.get("id"))}.bind(this)),this.listenTo(this.itemViewInstance,"showList",this.showListView))}.bind(this))},getPlannedRamainders:function(d){var f={};if(e.isMultiClient()){var g=e.multiClient.currentSubClientId;d=new c.Collection(d.where({owner_id:g}))}b.each(l.getThesaurus("accs_info").array,function(a){"UAH"===a.currency&&(f[a.account]=parseFloat(a.remainder).toFixed(2))});var h=a.Deferred(),i=function(c){var d={},e=b.filter(c.models,function(b){var c=b.attributes.status;return a.inArray(c,["2","3","4"])>-1}),g=b.groupBy(e,function(a){return a.attributes.PAYER_ACCOUNT?a.attributes.PAYER_ACCOUNT:a.attributes.CLN_ACCOUNT}),h=f;return b.each(g,function(a){d[a[0].attributes.CLN_ACCOUNT]=b.reduce(a,function(a,b){return a+parseFloat(b.attributes.AMOUNT)},0),h[a[0].attributes.CLN_ACCOUNT]=parseFloat(f[a[0].attributes.CLN_ACCOUNT]-d[a[0].attributes.CLN_ACCOUNT]).toFixed(2)}),h};if(d)h.resolve(i(d));else{var j=m.clone();j.model=this.Model,j.fetch({document_type:"ua_payment",silent:!0,data:{exclude:"links"}}).done(function(){h.resolve(i(j))}.bind(this))}return h},updatePlannedRemainders:function(){var b=a.Deferred(),e=d.settings.server_addr+"/document/"+this.docType+";jsessionid="+d.getStoredItem("JSESSIONID");return a.ajax({url:e,type:"GET",data:{status:"0,1,2,3,4,6,21,22,3004",bdate:localStorage.getItem(this.docType+"_work_filter_bdate")||d.date2str(new Date),edate:localStorage.getItem(this.docType+"_work_filter_edate")||d.date2str(new Date),exclude:"links"}}).done(function(a){this.getPlannedRamainders(new c.Collection(a)).done(function(a){L=a,b.resolve(a)}.bind(this))}.bind(this)),b},showDocumentEdit:function(a,c){l.getThesaurus("account_alias",!1).fetch().done(function(d){this.aliases=d,!b.isEmpty(L)&&b.has(L,a.CLN_ACCOUNT)?q.prototype.showDocumentEdit.call(this,a,c):this.updatePlannedRemainders().done(function(){q.prototype.showDocumentEdit.call(this,a,c)}.bind(this))}.bind(this))},editDocumentOptions:function(){var a=q.prototype.editDocumentOptions.call(this);return g.removeDepositAccountsWithoutLinks(I()).then(function(b){return g.setAccountComments(b).then(function(b){return a.accounts=b,a.recipientList=J(),a.countryList=K(),a.getMfo=g.getMfo,a.getReference=g.getReference,a.getBankBranches=g.getBanks(),a.plannedRemainders=L,a.currentSubClientId=e.isMultiClient()?e.multiClient.currentSubClientId:null,a})})},prepareContent:function(c){var e=q.prototype.prepareContent.call(this,c);return e.then(function(c){var e=c.PAYMENT_DETAILS;e&&c.id&&(c.PAYMENT_DETAILS=this.getCorrectPaymentDetailsOld(e));var f=l.getThesaurus("clients").array[0];c.CLN_NAME=f.name_cln,c.CLN_OKPO=f.okpo,c.AMOUNT=c.AMOUNT?d.roundFloat(c.AMOUNT,2,2):"","0"===f.resident_flag&&(c.CLN_COUNTRY_CODE=f.country_code);var g=b.findWhere(l.getThesaurus("bank_branches").array,{bik:c.CLN_BANK_MFO});g&&(c.CLN_BANK_NAME=g.name);var h=c.RCPT_BANK_MFO,i="[0]=='"+h+"'",j=l.getThesaurus("ua_swift").fetch({data:{query:i,PAGE_NUMBER:0,PAGE_SIZE:1}});return a.when(j.then(function(a){return c.RCPT_BANK_NAME=a[0]?a[0].name:"",c}))}.bind(this))},prepareContent4Create:function(a){var c=q.prototype.prepareContent4Create.call(this,a);return c.then(function(a){return g.removeDepositAccountsWithoutLinks(I()).then(function(c){if(!a.CLN_ACCOUNT){var d=1===c.length?c[0]:b.findWhere(c,{account_id:this.getAccountIdFromLocalStorage()});d=d||(c.length>0?c[0]:{}),b.extend(a,H(d))}return a}.bind(this))}.bind(this))},getAccountIdFromLocalStorage:function(){return d.getStorageDocData("ua_payment_acc_id")},getContentFromForm:function(){var b=q.prototype.getContentFromForm.call(this);return b.EXPENSE_ITEM=a("#EXPENSE_ITEM").val(),b.AMOUNT=a("#AMOUNT").val(),b.RCPT_COUNTRY_CODE&&(b.RCPT_COUNTRY_CODE=b.RCPT_COUNTRY_CODE.split(" ")[0]),b.AMOUNT=d.removeThousandSeparator(b.AMOUNT),b},getWorkContent:function(a){var b=a.get("PAYMENT_DETAILS");return b&&(a.attributes.PAYMENT_DETAILS=this.getCorrectPaymentDetailsOld(b)),q.prototype.getWorkContent.call(this,a)},beforeSaveModel:function(b){if(b.attributes.planned_remainder=L[b.attributes.CLN_ACCOUNT],q.prototype.beforeSaveModel.call(this,b),a("input.add-rcpt").is(":checked")){var c=new p({refType:"ua_recipients"});c.set(this.getRecipientContent(b),{validate:!0}),n.getThesaurus("ua_recipients").create(c)}},getImportBankMap:function(){return{CLN_BANK_MFO:"CLN_BANK_NAME",RCPT_BANK_MFO:"RCPT_BANK_NAME"}},parseBankClientFile:function(c,g,h){var j=a.Deferred(),k=function(a){var k=new FileReader;k.onload=function(c){for(var k=[],l=f.cp866,m=new Uint8Array(c.target.result),n="",o=0;o<m.length;o++){var p=m[o];n+=String.fromCharCode(l[p])}var q=n.split("\r").join("").split("\n");q=b.compact(q);for(var r=function(a){return a.replace(/[\u0009]/g," ").trim()},s=0;s<q.length;s++){var t=q[s].split("·");if(t=b.map(t,r),t[1]!==("ua_payment"===h?"1":"11"))return void j.reject([g]);var u={NUM_DOC:t[2],CLN_BANK_MFO:t[4],CLN_ACCOUNT:t[6],AMOUNT:(parseFloat(+t[8])/100).toFixed(2),PAYMENT_DETAILS:t[11]},v="ua_payment"===h?"RCPT_":"PAYER_";u[v+"BANK_MFO"]=t[5],u[v+"ACCOUNT"]=t[7],u[v+"NAME"]=t[10],u[v+"OKPO"]=t[16];var w=t[3];w&&(u.DATE_DOC=w.substr(6,2)+"."+w.substr(4,2)+"."+w.substr(0,4));var x=t[12];x&&(u.VALUE_DATE=x.substr(6,2)+"."+x.substr(4,2)+"."+x.substr(0,4)),k.push(u)}if(e.isMultiClient()&&!i.isActionPermittedForClient("IMPORT",h,a)){this.importListView=this.showGroupList(F.group_view_import_h1,{actions:[i.DocumentAction.SAVE_IMPORT_RESULT]});var y=i.getDescriptionForPermittedActions(h,a),z=new this.Model(k,{silent:!0});this.addModelToGroup(z);var A=y?d.sprintf(G.only_rights,y):d.sprintf(G.no_rights,this.nls[this.docType]);return z.trigger("model:completeSync",z,E.error,A),this.importListView.addSummaryImportInfo(F),void this.toggleAllButtons(!1)}j.resolve(k)}.bind(this),k.readAsArrayBuffer(c)}.bind(this);return e.isMultiClient()?this.showSubClientsList.call(this,k,this.showListView):k(),j},identifyClientByContent:function(c,d){var e=a.Deferred(),f={data:{query:"[6]=='UAH'"}};return l.getThesaurus("maccs_info").fetch(f).done(function(a){var f={};return b.each(c,function(b){b.CLN_OKPO||b.CLN_NAME?this.identifyClientByOkpoOrName(b,d):this.identifyClientByAccount(f,b,a)}.bind(this)),e.resolve(c)}.bind(this)),e},identifyClientByAccount:function(a,c,d){var e=a[c.CLN_ACCOUNT+"-"+c.CLN_BANK_MFO]||b.findWhere(d,{account:c.CLN_ACCOUNT,mfo:c.CLN_BANK_MFO});c.owner_id=e?e.client_id:"",a[c.CLN_ACCOUNT+"-"+c.CLN_BANK_MFO]=c.owner_id,c.owner_id||(c.owner_error=F.client_not_found)},parseFile4Import:function(c){var d=a.Deferred(),f=N(c.name),g=f?this.parseBankClientFile(c,this.prepareIncorrectImportMessage(),this.docType):q.prototype.parseFile4Import.call(this,c);return g.done(function(c){var g=function(){m.options.document_type!==this.docType&&(e.navigate("document/list/ua_payment_request/work",{}),localStorage.setItem("request_selectedTab","work"));var g=[],h=b.keys(this.getImportBankMap()),j=function(a,b){g.push(a[b])};b.each(c,function(a){b.each(h,j.bind(null,a))});var k=b.unique(g),n="[0] IN ('"+k.join("', '")+"')",o=l.getThesaurus("ua_swift").fetch({data:{query:n,PAGE_NUMBER:0,PAGE_SIZE:k.length}}),p=l.getThesaurus("country").fetch();a.when(o.promise(),p.promise()).then(function(a){var e={};b.each(a,function(a){e[a.code]=a.name}),b.each(c,function(a){b.each(this.getImportBankMap(),function(b,c){a[b]=e[a[c]]||""})}.bind(this)),f&&i(),d.resolve(c)}.bind(this)).fail(d.reject)}.bind(this),h=0,i=function(){h<c.length&&this.prepareContent(c[h++]).done(function(){g()})}.bind(this);f?i():g()}.bind(this)).fail(d.reject),d},getImportFormats:function(){return[D.bank_client,"iBank2"]},getRecipientContent:function(a){return{name:a.get("RCPT_NAME"),inn:a.get("RCPT_OKPO"),requisites:[{id:"",bic:a.get("RCPT_BANK_MFO"),bill:a.get("RCPT_ACCOUNT"),comment:a.get("PAYMENT_DETAILS"),note:"",rcpt_bnk_name:a.get("RCPT_BANK_NAME")}]}},CONFIRM:function(){if(this.itemViewInstance){var a=this.actionBarInstance.$("button[data-action='CONFIRM']").parent(),b=new s({model:this.selectedModel});this.itemViewInstance.$el.prepend(b.render().$el),a.hide(),b.afterRender(),b.on("dispose",function(c){b.off("dispose"),b.dispose(),c?a.show():this.showItemView(this.selectedModel)}.bind(this))}},PRINT:function(){this.printDocs([this.selectedModel])},PRINT_GROUP:function(a){d.showSubMenu(a)},PRINT_REGISTRY:function(){var a=l.getThesaurus("bank_branches").array[0];B(this.collection,a,this.getClient())},PRINT_LIST_DOC:function(){this.printDocs(b.values(this.collection.selected))},printDocs:function(a){x(a,y,z)},getPrintSubMenu:function(){return b.template(A,b.extend(D,{isSelected:this.collection.selectedLength>0}))},getClient:function(){return l.getThesaurus("clients").array[0]},CONFIRM_GROUP:function(){var a=b.values(this.collection.selected),c=function(a,b){var c=F.group_view_confirm,e=a.get("NUM_DOC");b.add(a,d.sprintf(c,e,a.getFAmount()))},e=this.group(c,F.group_view_confirm_h1,a),f=new s({collection:a,silent_error:!0});e.$el.prepend(f.render().$el),f.afterRender(),f.on("dispose",function(a){f.off("dispose"),f.dispose(),a&&this.showListView()}.bind(this))},SIGN:function(a){q.prototype.SIGN.call(this,a),this.listenTo(this.selectedModel,"change:status",function(){var a=parseInt(this.selectedModel.attributes.status);a>1&&!b.contains([3004,21],a)&&this.isNotFiltered(this.selectedModel,M)&&(this.itemViewInstance.updatePlannedRemainders(this.selectedModel.attributes.AMOUNT),L[this.selectedModel.attributes.CLN_ACCOUNT]-=parseFloat(this.selectedModel.attributes.AMOUNT).toFixed(2))})},EDIT:function(a){this.toggleAllButtons(!0),this.selectedModel.fetch().done(function(){q.prototype.EDIT.call(this,a)}.bind(this))},isNotFiltered:function(a,c){var e=d.str2date(localStorage.getItem("ua_payment_work_filter_bdate")||d.date2str(new Date)).getTime(),f=d.str2date(localStorage.getItem("ua_payment_work_filter_edate")||d.date2str(new Date)).getTime(),g=d.str2date(a.attributes.DATE_DOC).getTime(),h=g>=e&&f>=g;if(!h)return!1;if(!c)return!0;var i={};b.each(c.models,function(a){i[a.attributes.id]=a.attributes.value||"","status"===a.attributes.id&&(i[a.attributes.id]=Object.keys(a.attributes.selection))});var j=a.attributes;if(i.AMOUNT_MIN&&parseFloat(j.AMOUNT)<parseFloat(i.AMOUNT_MIN))return!1;if(i.AMOUNT_MAX&&parseFloat(j.AMOUNT)>parseFloat(i.AMOUNT_MAX))return!1;if(i.CLN_ACCOUNT&&i.CLN_ACCOUNT!==j.CLN_ACCOUNT)return!1;if(i.RCPT_NAME&&i.RCPT_NAME!==d.escapeSpecialChars(j.RCPT_NAME))return!1;if(i.RCPT_ACCOUNT&&i.RCPT_ACCOUNT!==j.RCPT_ACCOUNT)return!1;if(i.RCPT_OKPO&&i.RCPT_OKPO!==j.RCPT_OKPO)return!1;if(i.PAYMENT_DETAILS&&i.PAYMENT_DETAILS!==j.PAYMENT_DETAILS)return!1;if(i.status&&!b.contains(i.status,j.status))return!1;if(i.LINK_TYPE){if("any"===i.LINK_TYPE&&b.isEmpty(j.links))return!1;if("no_links"===i.LINK_TYPE&&!b.isEmpty(j.links))return!1;if("doc/pay_sheet"===i.LINK_TYPE&&b.isEmpty(j.links)||"pay_sheet"!==j.links[0].type)return!1}return!0},getCorrectPaymentDetailsOld:function(a){return a.length>h.PAYMENT_DETAILS_LENGTH?a.slice(0,h.PAYMENT_DETAILS_LENGTH):a},CFC_REJECT:function(a){this.changeStatus("15",a)},CFC_CONFIRM:function(a){this.changeStatus("14",a)},CFC_REJECT_GROUP:function(){this.changeStatusGroup("15")},CFC_CONFIRM_GROUP:function(){this.changeStatusGroup("14")},changeStatus:function(a,b){var c=getTimeStamp(),d=this.signData(this.selectedModel),f=e.multiClient.defaultClientKeysByCID[this.selectedModel.get("owner_id")].ID,g={content:this.prepare4Sign(d,c),id:this.selectedModel.get("id"),timestamp:c,status:a};o.useKey(f).then(function(){SignPluginServices.signData(g.content).then(function(a){a.sign&&g.timestamp?(g.sign=a.sign,o.ajax({type:"POST",dataType:"json",url:this.collection.urlRoot+this.docType+"/"+g.id+"/change_status",data:JSON.stringify(g),currentSubClientKeyId:f,success:function(a){this.selectedModel.set(a),this.showItemView(this.selectedModel)}.bind(this),error:function(a){400!==a.status&&500!==a.status||j.alert(a.responseText),this.toggleEventButton(b.target,!1)}.bind(this)})):this.toggleEventButton(b.target,!1)}.bind(this))}.bind(this))},changeStatusGroup:function(a){var c=0,f=b.values(this.collection.selected),g=function(){if(c<f.length){var b=f[c++],d=this.signData(b),h=getTimeStamp(),i={content:this.prepare4Sign(d,h),id:b.get("id"),timestamp:h,status:a},j=e.multiClient.defaultClientKeysByCID[b.get("owner_id")].ID;o.useKey(j).then(function(){SignPluginServices.signData(i.content).then(function(a){a.sign&&i.timestamp?(i.sign=a.sign,o.ajax({type:"POST",dataType:"json",url:this.collection.urlRoot+this.docType+"/"+i.id+"/change_status",data:JSON.stringify(i),currentSubClientKeyId:j,success:function(a){b.set(a,{silent:!0}),b.trigger("model:completeSync",b,"Ok","",200),g()}.bind(this),error:function(a){b.trigger("model:completeSync",b,F.error,a.responseText,a.status),g()}.bind(this)})):this.toggleEventButton(event.target,!1)}.bind(this))}.bind(this))}}.bind(this);this.group(function(b,c){c.add(b,d.sprintf(F["14"===a?"group_view_confirm":"group_view_reject"],b.get("NUM_DOC"),b.get("AMOUNT"))),f.length===c.children.length&&g()},F["14"===a?"group_view_confirm_h1":"group_view_reject_h1"],f)},isAccountsForCreateAction:function(){return I().length>0},getNoAccErrorText:function(){return D.no_uah_accs}});return O.getAccounts=I,O}),define("apps/ua_payment/ua_payment_controller",["apps/ua_payment/base_ua_payment_controller","i18n!apps/ua_payment/nls/ua_payment"],function(a,b){"use strict";return a.extend({getImportFormats:function(){return[b.bank_client,"BM-RS","iBank2"]}})}),define("text!apps/ua_payment_request/templates/ua_payment_request_print.tmpl",[],function(){return'<div class="doc-print-content">\n    <table>\n        <tbody>\n            <tr>\n                <td width="75%"></td>\n                <td class="border doc-ident font8">0410007</td>\n            </tr>\n        </tbody>\n    </table>\n    <table>\n        <tr>\n            <td width="10%"></td>\n            <td colspan="3" class="header pay-num">ПЛАТІЖНА ВИМОГА-ДОРУЧЕННЯ N <%- NUM_DOC %></td>\n            <td colspan="2">&nbsp;</td>\n        </tr>\n        <tr>\n            <td></td>\n            <td width="3%"></td>\n            <td width="47%" class="doc-date header"></td>\n            <td width="22%">&nbsp;</td>\n            <td width="25%" class="centered" nowrap>Одержано банком</td>\n            <td>&nbsp;</td>\n        </tr>\n        <tr>\n            <td colspan="4">&nbsp;</td>\n            <td class="centered in-bank bbordered">&nbsp;</td>\n            <td>&nbsp;</td>\n        </tr>\n        <tr>\n            <td colspan="4">&nbsp;</td>\n            <td class="centered in-bank2 bbordered">&nbsp;</td>\n            <td>&nbsp;</td>\n        </tr>\n    </table>\n    <table cols="7" cellspacing="0">\n        <tr>\n            <td>Платник</td>\n            <td class="header" colspan="3"><%- PAYER_NAME %></td>\n            <td colspan="2">&nbsp;</td>\n        </tr>\n        <tr>\n            <td>Код</td>\n            <td class="header">\n                <table class="border" style="height: 100%;">\n                    <tbody>\n                        <tr><td width="100%" class="header"><%= PAYER_OKPO %></td></tr>\n                    </tbody>\n                </table>\n            </td>\n            <td colspan="3">&nbsp;</td>\n        </tr>\n        <tr>\n            <td colspan="3">Банк платника</td>\n            <td class="centered">код банку</td>\n            <td>&nbsp;</td>\n            <td width="20%" class="centered">ДЕБЕТ рах. N</td>\n            <td width="16%" class="centered">СУМА</td>\n        </tr>\n        <tr>\n            <td class="bbordered header" colspan="3"><%- PAYER_BANK_NAME %></td>\n            <td class="border centered header"><%= PAYER_BANK_MFO %></td>\n            <td>&nbsp;</td>\n            <td class="header tbordered lbordered bbordered"><%= PAYER_ACCOUNT %></td>\n            <td class="amount-number border header" rowspan="5" valign="top"></td>\n        </tr>\n        <tr>\n            <td width="10%">Отримувач</td>\n            <td class="header" colspan="3"><%- CLN_NAME %></td>\n            <td>&nbsp;</td>\n        </tr>\n        <tr>\n            <td>Код</td>\n            <td width="20%" class="header">\n                 <table class="border" style="height: 100%;">\n                     <tbody>\n                         <tr><td class="header" width="100%"><%= CLN_OKPO %></td></tr>\n                     </tbody>\n                 </table>\n            </td>\n            <td colspan="3">&nbsp;</td>\n            <td class="centered">КРЕДИТ рах. N</td>\n        </tr>\n        <tr>\n            <td colspan="3">Банк отримувача</td>\n            <td width="12%" class="centered">код банку</td>\n            <td width="7%" class="centered"></td>\n            <td class="header tbordered lbordered"><%= CLN_ACCOUNT %></td>\n        </tr>\n        <tr>\n            <td class="bbordered header" colspan="3"><%- CLN_BANK_NAME %></td>\n            <td class="border centered header"><%= CLN_BANK_MFO %></td>\n            <td class="bbordered">&nbsp;</td>\n            <td class="tbordered lbordered bbordered">&nbsp;</td>\n        </tr>\n        <tr>\n            <td colspan="2">Сума (словами)</td>\n            <td colspan="5">&nbsp;</td>\n        </tr>\n        <tr>\n            <td class="amount-words header" colspan="5"><br><br></td>\n            <td colspan="2">&nbsp;</td>\n        </tr>\n    </table>\n\n    <table class="details" cols="4" cellspacing="2mm">\n        <tr>\n            <td width="70%" class="tbordered">Призначення платежу</td>\n            <td width="10%">&nbsp;</td>\n            <td class="border" width="20%">\n                &nbsp;\n                <% if (typeof PAYER_COUNTRY_CODE !=\'undefined\' && PAYER_COUNTRY_CODE) { %>\n                П <%= PAYER_COUNTRY_CODE %>\n                <% } %>\n                &nbsp;\n                <% if (typeof CLN_COUNTRY_CODE !=\'undefined\' && CLN_COUNTRY_CODE) { %>\n                О <%= CLN_COUNTRY_CODE %>\n                <% } %>\n            </td>\n        </tr>\n        <tr>\n            <td class="header"><%- PAYMENT_DETAILS %></td>\n            <td colspan="2">&nbsp;</td>\n        </tr>\n    </table>\n    <table cellspacing="2mm">\n        <tr>\n            <td width="5%" class="padded" valign="top">М.П.</td>\n            <td width="10%" valign="top">Підписи</td>\n            <td width="20%" class="bbordered">&nbsp;</td>\n            <td width="44%" class="sign1"></td>\n            <td width="1%"></td>\n            <td width="20%" class="centered" rowspan="3" nowrap valign="top">\n                <table>\n                    <tr>\n                        <td class="exec-bank-title">Проведено банком</td>\n                    </tr>\n                    <tr>\n                        <td class="exec-bank"></td>\n                    </tr>\n                    <tr>\n                        <td class="tbordered">підпис банку</td>\n                    </tr>\n                </table>\n            </td>\n        </tr>\n        <tr>\n            <td colspan="2"></td>\n            <td width="20%" class="bbordered">&nbsp;</td>\n            <td width="44%" class="sign2" colspan="2"></td>\n        </tr>\n        <tr>\n           <td colspan="5" class="sign-empty-cell"></td>\n        </tr>\n    </table>\n    <div class="for-img" style="float: right"/>\n</div>\n<hr/>\n<div class="for-service-info"></div>\n'}),define("text!apps/ua_payment_request/css/print.css",[],function(){return"section.doc-print article,section.doc-print div,\nsection.doc-print td,section.doc-print span,section.doc-print p,\nsection.doc-print u{\nfont-family:'Courier New',Courier,'Lucida Console',monospace;\n}\nsection.doc-print td,\nsection.doc-print td *{\npadding:1px;\n}\nsection.doc-print td.header,\nsection.doc-print td.header *{\nfont-weight:bold;\n}\nsection.doc-print td:not([class=\"padded\"]):first-child{\npadding-left:0;\n}\ndiv.bank_ua_payment_request td.doc-date div,div.ua_payment_request td.doc-date div{\nfont-size:9pt;\n}\nsection.doc-print td.pay-num div{\npadding-left:28mm;\nfont-size:11pt;\n}\n.doc-date div.bbordered{\ndisplay:inline-block;\n}\ndiv.bank_ua_payment_request .amount-number,div.ua_payment_request .amount-number{\npadding-right:5px;\ntext-align:right;\n}\nbody table .bordered{\npadding:4px !important;\n}\nbody table td{\npadding:2px !important;\n}\nsection.doc-print div td,section.doc-print div span{\nfont-size:8pt;\n}\nsection.doc-print article div{\nfont-size:8pt;\n}\nsection.doc-print table{\npadding:0;\n}\n.border{\nborder:solid 1px #000000;\n}\ndiv.bank_ua_payment_request .doc-ident,div.ua_payment_request .doc-ident{\nfloat:right;\npadding:1px 10px !important;\n}\ndiv.bank_ua_payment_request .font8,div.ua_payment_request .font8{\nfont-size:8pt;\n}\ndiv.bank_ua_payment_request .centered,div.ua_payment_request .centered{\ntext-align:center;\n}\ndiv.bank_ua_payment_request td.pay-num,div.ua_payment_request td.pay-num{\nfont-size:11pt;\n}\ndiv.bank_ua_payment_request .tbordered,div.ua_payment_request .tbordered{\nborder-top:1px solid black;\n}\ndiv.bank_ua_payment_request .lbordered,div.ua_payment_request .lbordered{\nborder-left:1px solid black;\n}\ndiv.bank_ua_payment_request .bbordered,div.ua_payment_request .bbordered{\nborder-bottom:1px solid black;\n}\ndiv.bank_ua_payment_request table,div.ua_payment_request table{\nwidth:100%;\nborder-collapse:collapse;\nborder-spacing:0;\n}\ndiv.bank_ua_payment_request .header,div.ua_payment_request .header{\nfont-weight:bold;\n}\ndiv.bank_ua_payment_request .exec-bank,\ndiv.ua_payment_request .exec-bank{\nheight:15px;\n}\ndiv.bank_ua_payment_request .sign-empty-cell,\ndiv.ua_payment_request .sign-empty-cell{\nheight:20px;\n}"}),define("apps/ua_payment_request/ua_payment_request_controller",["jquery","underscore","bifit","app","collections/thesaurus","actionUtils","dialogUtils","charsets","commons/base_object/document/group_opers_document_controller","commons/base_object/document/document_state_filter_view","apps/ua_payment_request/ua_payment_request_ext_filter_view","apps/ua_payment_request/ua_payment_request_list_view","apps/ua_payment_request/ua_payment_request_view","apps/ua_payment_request/ua_payment_request_edit","apps/ua_payment_request/ua_payment_request_model","apps/ua_payment/ua_payment_controller","apps/ua_payment/ua_payment_print","views/tree","commons/access_denied_view","text!apps/ua_payment_request/templates/ua_payment_request_print.tmpl","text!apps/ua_payment_request/css/print.css","text!apps/ua_payment_request/templates/ua_payment_request_list_item.tmpl","i18n!apps/ua_payment_request/nls/ua_payment_request","i18n!apps/ua_payment/nls/ua_payment","i18n!nls/document","styles!apps/ua_payment_request/css/ua_payment_request"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y){"use strict";return w=b.extend(b.clone(x),{ua_payment:w.ua_payment_request,ua_payment_list:w.ua_payment_requests,ua_payment_request:w.ua_payment_request,bank_ua_payment_request:w.ua_payment_request,rcpt:x.rcpt,to_acc:x.from_acc,from_acc:x.to_acc}),p.extend({Model:o,nls:w,docType:"ua_payment_request",ListView:l,View:m,Edit:n,listItemTemplate:v,tabsStatuses:{inbox:"#/document/list/bank_ua_payment_request",work:"0,1,2,3,4,6,21,22,3004",executed:"5",selectedTab:"work"},FilterView:j.extend({ExtFilterComponent:k,documentTypeTitle:w.ua_payment_list,keyFromSelectedTab:"request"}),initialize:function(){p.prototype.initialize.apply(this,arguments),b.findWhere(e.getThesaurus(d.isMultiClient()?"mperms_doc":"perms_doc").array,{type:"doc/bank_ua_payment_request"})||(this.tabsStatuses={work:"0,1,2,3,4,6,21,22,3004",executed:"5",selectedTab:"work"})},showListView:function(a){(a&&"work"===a||"executed"===a)&&(this.tabsStatuses.selectedTab=a),p.prototype.showListView.apply(this,arguments)},showItemView:function(a){i.prototype.showItemView.call(this,a)},getListViewOptions:function(){var a=p.prototype.getListViewOptions.apply(this),c={nls:w};return b.extend(a,c)},prepareContent:function(b){var c=p.prototype.prepareContent.call(this,b);return c.then(function(b){var c=b.PAYER_BANK_MFO,d="[0]=='"+c+"'",f=e.getThesaurus("ua_swift").fetch({data:{query:d,PAGE_NUMBER:0,PAGE_SIZE:1}});return a.when(f.then(function(a){return b.PAYER_BANK_NAME=a[0]?a[0].name:"",b}))}.bind(this))},editDocumentOptions:function(){var c=a.Deferred();return a.when(p.prototype.editDocumentOptions.call(this)).done(function(a){a.nls=w,a.accounts=b.filter(a.accounts,function(a){return"1"===a.type}),c.resolve(a)}),c},viewDocumentOptions:function(){var a=p.prototype.viewDocumentOptions.apply(this);return a.nls=w,a},documentReloadOptions:function(a){return a.defaultTab=this.tabsStatuses.work,p.prototype.documentReloadOptions.call(this,a)},getImportBankMap:function(){return{CLN_BANK_MFO:"CLN_BANK_NAME",PAYER_BANK_MFO:"PAYER_BANK_NAME"}},getRecipientContent:function(){return{name:this.model.get("PAYER_NAME"),inn:this.model.get("PAYER_OKPO"),requisites:[{id:"",note:"",rcpt_bank_name:this.model.get("PAYER_BNK_NAME"),comment:this.model.get("PAYMENT_DETAILS"),bill:this.model.get("PAYER_ACCOUNT"),bic:this.model.get("PAYER_BANK_MFO")}]}},getContentFromForm:function(){var a=p.prototype.getContentFromForm.call(this);return delete a.VALUE_DATE,delete a.RCPT_BANK_NAME,delete a.RCPT_BANK_MFO,a},reloadDocumentsList:function(a){if(b.findWhere(e.getThesaurus(d.isMultiClient()?"mperms_doc":"perms_doc").array,{type:"doc/"+this.docType}))p.prototype.reloadDocumentsList.apply(this,arguments);else{var c=s.extend({message:y.fetch_error,text:y.fetch_error_text,docType:w.ua_payment});d.mainLayout.content.show(new c)}},getPrintSubMenu:function(){},PRINT_GROUP:function(){this.printDocs(b.values(this.collection.selected))},printDocs:function(a){q(a,c.replaceAll(t,"RCPT_","CLN_"),u)},isAccountsForCreateAction:function(){var a=b.filter(p.getAccounts(),function(a){return"1"===a.type});return a.length>0},getAccountIdFromLocalStorage:function(){return c.getStorageDocData("ua_payment_request_acc_id")}})}),define("apps/ua_payment_request/bank_ua_payment_request_view",["jquery","underscore","bifit","apps/ua_payment/ua_payment_view","text!apps/ua_payment_request/templates/ua_payment_request_edit.tmpl"],function(a,b,c,d,e){"use strict";return d.extend({className:"doc-wrapper ua_payment bank_ua_payment_request",template:b.template(c.replaceAll(c.replaceAll(e,"CLN_","PAYER_"),"RCPT_","CLN_")),okpoFieldTitle:"CLN_OKPO",templateHelpers:function(){return this.nls},initialize:function(a){d.prototype.initialize.apply(this,a),this.nls=a.nls,b.each(["VALUE_DATE","RCPT_BANK_NAME","RCPT_BANK_MFO"],function(a){this.model.unset(a)}.bind(this))},onRender:function(){d.prototype.onRender.call(this),this.$("div.comments-bar").addClass("only-bank")}})}),define("styles!apps/ua_payment_request/css/bank_ua_payment_request",[],function(){}),define("apps/ua_payment_request/bank_ua_payment_request_controller",["jquery","underscore","backbone","bifit","app","appsPieces","collections/thesaurus","actionUtils","services/doc_permissions","apps/ua_payment_request/bank_ua_payment_filter_view","commons/access_denied_view","apps/ua_payment_request/bank_ua_payment_request_list_view","apps/ua_payment_request/bank_ua_payment_request_model","apps/ua_payment_request/ua_payment_request_controller","apps/ua_payment/ua_payment_controller","apps/ua_payment_request/bank_ua_payment_request_view","apps/ua_payment/ua_payment_print","apps/ua_payment/ua_payment_edit","text!apps/ua_payment_request/templates/ua_payment_request_print.tmpl","text!apps/ua_payment_request/css/print.css","text!apps/ua_payment_request/templates/bank_ua_payment_request_list_item.tmpl","i18n!apps/ua_payment_request/nls/ua_payment_request","i18n!apps/ua_payment/nls/ua_payment","i18n!nls/document","styles!apps/ua_payment_request/css/bank_ua_payment_request"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x){
"use strict";return v=b.extend(b.clone(w),{ua_payment:v.ua_payment_request,ua_payment_list:v.ua_payment_requests,bank_ua_payment_request:v.ua_payment_request,rcpt:w.rcpt}),o.extend({Model:m,nls:v,docType:"bank_ua_payment_request",ListView:l,View:p,listItemTemplate:u,Edit:r.extend({changedNls:v}),tabsStatuses:{inbox:"11",work:"#/document/list/ua_payment_request/work",executed:"#/document/list/ua_payment_request/executed",selectedTab:"inbox"},FilterView:j,allowedAccounts:null,subClientPerms:{},initialize:function(){o.prototype.initialize.apply(this,arguments),b.findWhere(g.getThesaurus(e.isMultiClient()?"mperms_doc":"perms_doc").array,{type:"doc/ua_payment_request"})||(this.tabsStatuses={inbox:"11",selectedTab:"inbox"})},showListView:function(){a.when(this.getAllowedAccounts()).done(function(a){this.allowedAccounts=a,this.setUaPaymentRequestActions(),o.prototype.showListView.apply(this)}.bind(this))},loadSubClientDocPerms:function(b){return a.when(i.getSubClientDocPerms(b,this.docType),i.getSubClientDocPerms(b,"ua_payment")).then(function(a,b){this.subClientPerms[this.docType]=a,this.subClientPerms.ua_payment=b}.bind(this))},getAllowedAccounts:function(){var a="",c={},d={},f=null;return e.isMultiClient()?(a="maccs_info",d.type="[5] == 1",d.currency="[6] == 'UAH'",d.status="[7] == 2",d.permissions="[13] > 0",c.query=b.values(d).join(" && "),f=g.loadMultiClientThesaurus):(a="accs_info",f=g.loadClientThesaurus),f(a,c).then(function(a){return e.isMultiClient()||(a=b.filter(a,function(a){return"UAH"===a.currency&&a.permissions>0&&"2"===a.status&&"1"===a.type})),a})},getListViewOptions:function(){var a=o.prototype.getListViewOptions.apply(this),c={nls:v,allowedAccounts:this.allowedAccounts};return b.extend(a,c)},createItemView:function(a){var b=function(){"0"===a.get("readed")&&(a.set("readed","1",{silent:!0}),a.save({id:a.id},{emulateClientRequest:e.isMultiClient()}))};return o.prototype.createItemView.call(this,a,b)},showItemView:function(b){e.isMultiClient()?a.when(this.loadSubClientDocPerms(b.get("owner_id"))).then(function(){n.prototype.showItemView.call(this,b)}.bind(this)):n.prototype.showItemView.call(this,b)},viewDocumentOptions:function(){var a=o.prototype.viewDocumentOptions.apply(this);return a.nls=v,a},editDocumentOptions:function(){var a=o.prototype.editDocumentOptions.apply(this);return a.accounts=b.filter(a.accounts,function(a){return"1"===a.type}),a},documentReloadOptions:function(a){return a.defaultTab=this.tabsStatuses.inbox,o.prototype.documentReloadOptions.call(this,a)},getPossibleActionsForItemView:function(a){var c=o.prototype.getPossibleActionsForItemView.call(this,a);return this.hasActionsForPayerAccount(a)||(c=b.without(c,h.DocumentAction.APPLY.toString())),c},hasActionsForPayerAccount:function(a){var c=b.findWhere(this.allowedAccounts,{account:a.get("PAYER_ACCOUNT")});return c?e.isMultiClient()?this.subClientPerms[this.docType].isActionAllowed("APPLY")&&this.subClientPerms.ua_payment.isActionAllowed("CREATE"):i.isActionAllowed(this.docType,"APPLY")&&i.isActionAllowed("ua_payment","CREATE"):!1},CREATE:function(a,b){var c=new n;o.prototype.CREATE.call(c,a,b),e.navigate("document/list/ua_payment_request/work"),localStorage.setItem("request_selectedTab","work")},DO_IMPORT:function(a){var b=new n;o.prototype.DO_IMPORT.call(b,a)},PRINT:function(){this.printDocs([this.selectedModel])},PRINT_GROUP:function(){this.printDocs(b.values(this.collection.selected))},printDocs:function(a){q(a,d.replaceAll(s,"RCPT_","CLN_"),t)},getPrintSubMenu:function(){},APPLY:function(){var a=g.getThesaurus("clients").array[0],b={AMOUNT:this.selectedModel.get("AMOUNT"),RCPT_BANK_MFO:this.selectedModel.get("CLN_BANK_MFO"),RCPT_OKPO:this.selectedModel.get("CLN_OKPO"),RCPT_ACCOUNT:this.selectedModel.get("CLN_ACCOUNT"),RCPT_BANK_NAME:this.selectedModel.get("CLN_BANK_NAME"),RCPT_COUNTRY_CODE:this.selectedModel.get("CLN_COUNTRY_CODE"),RCPT_NAME:this.selectedModel.get("CLN_NAME"),RCPT_PASSP_SER:this.selectedModel.get("CLN_PASSP_SER"),RCPT_PASSP_NUM:this.selectedModel.get("CLN_PASSP_NUM"),PAYMENT_DETAILS:this.getCorrectPaymentDetailsOld(this.selectedModel.get("PAYMENT_DETAILS")),CLN_NAME:a.name_cln,CLN_OKPO:a.okpo,CLN_ACCOUNT:this.selectedModel.get("PAYER_ACCOUNT"),CLN_BANK_NAME:this.selectedModel.get("PAYER_BANK_NAME"),CLN_BANK_MFO:this.selectedModel.get("PAYER_BANK_MFO"),request_id:this.selectedModel.get("id")};c.history.navigate("document/list/ua_payment");var d=require("apps/ua_payment/ua_payment_controller"),h=new d;e.isMultiClient()&&!h.isOwnerDocMultiClient?f.loadPermsForSubclient("ua_payment",a.client_id).done(function(){h.CREATE(null,b,a.client_id)}):h.CREATE(null,b,a.client_id)},reloadDocumentsList:function(a){var c="";if(e.isMultiClient()?(c="mperms_doc",a.addedDocTypes=",ua_payment_request"):c="perms_doc",b.findWhere(g.getThesaurus(c).array,{type:"doc/"+this.docType}))o.prototype.reloadDocumentsList.apply(this,arguments);else{var d=k.extend({message:x.fetch_error,text:x.fetch_error_text,docType:v.ua_payment});e.mainLayout.content.show(new d)}},setUaPaymentRequestActions:function(){if(e.isMultiClient()||this.allowedAccounts&&this.allowedAccounts.length>0){var a=["CREATE","IMPORT"];b.each(a,function(a){i.isActionAllowed("ua_payment_request",a)&&this.actionsList.push(a)}.bind(this))}}})}),function(a){var b=document,c="appendChild",d="styleSheet",e=b.createElement("style");e.type="text/css",b.getElementsByTagName("head")[0][c](e),e[d]?e[d].cssText=a:e[c](b.createTextNode(a))}(".ua_payment_request table.list .check{\ndisplay:none !important;\n}\n.ua_payment_request table.list td.number{\npadding-left:2em;\n}\n.ua_payment_request table.list th.number{\npadding-left:2.35em;\n}\n.ua_payment_request input#PAYER_PASSP_SER{\nmargin-right:1.25em;\nwidth:75px;\n}\n.ua_payment_request input#PAYER_PASSP_NUM{\nwidth:125px;\n}\n.ua_payment_request form input#PAYER_NAME{\nwidth:100%;\n}\n.ua_payment_request form input#PAYER_BANK_NAME{\nwidth:27.4em;\n}\n.ua_payment_request div.num-doc input#NUM_DOC{\nwidth:8em;\n}\n.ua_payment_request input#PAYER_PASSP_SER.error + .error-tooltip{\nwidth:7.3em;\n}\n.ua_payment_request input#PAYER_PASSP_NUM.error + .error-tooltip{\nwidth:13em;\n}\n.ua_payment_request div.additional + div.container{\nmargin-top:0em;\n}\n.ua_payment_request div.date-doc{\nfloat:right;\nclear:none;\n}\n.ua_payment input#PAYER_COUNTRY_CODE{\nwidth:180px;\n}\n.ua_payment_request input#PAYER_PASSP_NUM,\n.ua_payment_request input#PAYER_PASSP_NUM.error + .error-tooltip{\nwidth:125px;\n}.ua_payment .okpo{\nfloat:left;\nmargin-bottom:0.5em;\n}\n.ua_payment div.country,.ua_payment div.passp{\nfloat:right;\n}\n.ua_payment .fleft{\nfloat:left;\n}\n.ua_payment div.details{\nclear:both;\nposition:relative;\n}\n.ua_payment div.group-box{\nfloat:right;\nmargin-top:0.5em;\n}\n.ua_payment a{\nfont-size:0.8125em;\ntext-decoration:none;\nfont-weight:600;\n}\n.expense-item a{\ndisplay:block;\nmargin-bottom:0.25em;\n}\n.ua_payment div.group-box a:not(:last-child){\nmargin-right:0.8em;\n}\n.ua_payment label[for='RCPT_ACCOUNT']{\nclear:both;\n}\n.ua_payment td.details{\nmax-width:400px;\n}\n.ua_payment label[for='PAYMENT_DETAILS']{\ndisplay:inline-block;\npadding-top:1em;\n}\nform#edit.ua_payment div.passp{\nwidth:210px;\n}\n.ua_payment input#RCPT_PASSP_SER{\nmargin-right:1.25em;\nwidth:75px;\n}\n.ua_payment input#RCPT_PASSP_NUM,\n.ua_payment input#RCPT_PASSP_NUM.error + .error-tooltip{\nwidth:90px;\n}\n.ua_payment input#RCPT_PASSP_SER.error + .error-tooltip{\nwidth:7.3em;\n}\n.ua_payment input#RCPT_COUNTRY_CODE{\nwidth:180px;\n}\n.ua_payment form input#RCPT_NAME{\nwidth:100%;\n}\n.ua_payment form input#RCPT_BANK_NAME{\nwidth:27.4em;\n}\n.ua_payment form div.additional > input#NUM_DOC{\nmargin-bottom:1em;\n}\n.ua_payment div.num-doc input#NUM_DOC{\nwidth:8em;\n}\n.ua_payment div#add{\ndisplay:none;\n}\n.ua_payment div.details label{\ndisplay:inline-block;\n}\n.ua_payment .container > div.rcpt-account{\nmargin-bottom:0;\n}\n.ua_payment div#add{\nmargin-top:0.75em;\n}\ndiv.modal div#budget_payment-editor{\nmargin-bottom:1.25em;\n}\ndiv.payment_kind_code span.error-tooltip{\nposition:absolute;\n}\ndiv.modal div#budget_payment-editor label{\ndisplay:block;\nmargin-bottom:0.25em;\n}\ndiv.modal div#budget_payment-editor > div{\nmargin-bottom:0.75em;\n}\ndiv.modal div#budget_payment-editor #PAYMENT_KIND_CODE{\nwidth:100%;\n}\ndiv.modal div#budget_payment-editor #DETAILS{\ndisplay:block;\nfont-size:0.675em;\nline-height:1.4em;\nheight:4.2em;\nmargin-top:-0.5em;\nmargin-bottom:2em;\n}\ndiv.modal div#budget_payment-editor textarea{\nheight:82px !important;\nwidth:100%;\n}\ndiv#budget-code-list{\nwidth:50em;\n}\ndiv#budget-code-list #filter{\nwidth:21em;\nmargin:0.3em 0;\n}\ndiv#budget-code-list .scrollbox{\nheight:25em;\nmargin-bottom:0.3em;\n}\ndiv#budget-code-list table{\ntable-layout:fixed;\nheight:auto;\n}\ndiv#budget-code-list .code-col{\nwidth:5em;\n}\ndiv#budget-code-list .descr-col{\nwidth:9em;\n}\ndiv#budget-code-list td,div.modal #budget-code-list th{\npadding:0.45em 0.857em;\n}\n.ua_payment:not(.ua_payment_request):not(.bank_ua_payment_request) .container div.amount{\nfloat:none;\n}\n.ua_payment:not(.ua_payment_request):not(.bank_ua_payment_request) .container div.amount input{\nwidth:12.8em;\nmargin-right:0.5em;\ndisplay:inline-block;\n}\n.ua_payment:not(.ua_payment_request):not(.bank_ua_payment_request) .container div.amount .nds-calc{\ndisplay:inline-block;\n}\n.ua_payment div.container div.acc{\nfloat:right;\n}\n.ua_payment:not(.ua_payment_request):not(.bank_ua_payment_request) .container div.acc,\n.ua_payment .container div.acc.with-type{\nmargin-left:0;\n}\n.ua_payment:not(.ua_payment_request):not(.bank_ua_payment_request) .container div.acc{\nfloat:none;\n}\n.ua_payment:not(.ua_payment_request):not(.bank_ua_payment_request) .container div.acc input,\n.ua_payment .container div.acc.with-type input{\nwidth:19.2em;\n}\n.ua_payment:not(.ua_payment_request):not(.bank_ua_payment_request) .container div.planned-remainder{\nfloat:right;\n}\n.container div.planned-remainder input{\nwidth:13em;\n}\n.ua_payment div.value-date{\nfloat:left;\nclear:none;\nmargin-left:3em;\n}\n.ua_payment div.date-doc{\nclear:none;\nfloat:left;\n}\n.ua_payment div.additional + div.container{\nmargin-top:0em;\n}\n.ua_payment .right{\nfloat:right;\n}\n.ua_payment .rcpt .bill{\nfloat:right;\nwidth:25%;\nmargin-right:1em;\ntext-align:right;\n}\n.ua_payment div.link_pay_sheet{\npadding-bottom:2em;\n}\n.ua_payment div.link_pay_sheet a{\npadding-right:1em;\nfont-weight:400;\nfont-size:1.1em;\n}\n.ua_payment div.link_pay_sheet li:last-child{\nfloat:left;\nborder-left:1px solid #D5D5D5;\npadding-left:1em;\n}\n.ua_payment div.link_pay_sheet li#payment a{\npointer-events:none;\ncursor:default;\ncolor:#888;\n}\n.ua_payment div.link_pay_sheet span{\ndisplay:inline-block;\nwidth:0.688em;\n}\n.ua_payment div.link_pay_sheet span:before{\ncontent:' \\25CF\\00a0 ';\nfont-size:1.1em;\n}\ndiv.filter div.archives-notification{\nfont-size:0.8125em;\npadding-top:0.8em;\ndisplay:block;\ncolor:#666666;\n}\n.ua_payment div.row.form-group label{\nmargin-bottom:0.25em !important;\n}.bank_ua_payment_request input#CLN_PASSP_SER{\nfloat:left;\nmargin-right:0.75em;\nwidth:75px;\n}\n.bank_ua_payment_request input#CLN_PASSP_NUM{\nfloat:right;\nwidth:125px;\n}\n.bank_ua_payment_request input#CLN_NAME{\nwidth:100%;\n}\n");
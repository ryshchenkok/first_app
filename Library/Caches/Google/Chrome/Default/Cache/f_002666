define("commons/base_object/reference/reference_import_item_view",["underscore","rivets","marionette","text!templates/views/group-item.tmpl","i18n!nls/reference"],function(a,b,c,d,e){"use strict";return c.ItemView.extend({nls:null,itemName:null,message:null,tagName:"tr",template:a.template(d),templateHelpers:function(){return{text:this.importActionText}},initialize:function(){this.message={text:this.model.get("error")||"",status:""},this.model.on("model:completeSync",this.onModelSync,this),this.importActionText=this.nls.import_rcpt+' "'+this.model.get(this.itemName)+'"'},onShow:function(){b.bind(this.el,{message:this.message})},onModelSync:function(a,b,c){var d=a.has("error");this.message.text=d?a.get("error"):c,this.message.status=d?e.error_title:b},getViewInfo:function(){return{text:this.importActionText,code:this.message.status,error:this.message.text}}})}),define("text!templates/actionbar/reference/list.tmpl",[],function(){return'<li><button type="button" class="action create primary" data-action="create"\n            data-toggle="tooltip" data-trigger="hover" data-placement="bottom" title="<%- create %>"><%- create %></button></li>\n<li><button type="button" class="action export" data-action="doExport"\n            data-toggle="tooltip" data-trigger="hover" data-placement="bottom" title="<%- exportData %>"><%- exportData %></button></li>\n<li>\n    <button type="button" class="action import"\n            data-toggle="tooltip" data-trigger="hover" data-placement="bottom" title="<%- importData %>"><%- importData %></button>\n    <input type="file" class="file-dialog" data-action="doImport"/>\n</li>\n'}),define("text!commons/base_object/reference/templates/export_sub_menu.tmpl",[],function(){return'<div class="popup-wrapper bottom sub-menu">\n    <span class="popup-arrow"></span>\n    <span class="popup-arrow-border"></span>\n    <ul class="popup" style="white-space: nowrap">\n        <li class="popup-li"><a href="#" data-action="EXPORT_FILTER"><%- export_filter %></a></li>\n        <li class="popup-li"><a href="#" data-action="EXPORT_ALL"><%- export_all %></a></li>\n    </ul>\n</div>'}),define("commons/base_object/reference/reference_list_controller",["underscore","jquery","app","bifit","backbone","marionette","commons/base_object/base_list_controller","collections/editabled_thesaurus","models/reference","commons/base_object/reference/reference_import_item_view","dialogUtils","bifit","actionUtils","libs/multi_client_utils","views/document/aside-left","views/tree","views/group","commons/group_view","text!templates/actionbar/reference/list.tmpl","text!commons/base_object/reference/templates/export_sub_menu.tmpl","i18n!nls/reference","i18n!nls/common"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){"use strict";return g.extend({modelType:null,exchange:null,modelItemName:null,nls:null,supportsGroupOpers:!1,getGroupDeleteMessage:null,FilterView:null,itemFilterView:null,actionsList:[m.DocumentAction.CREATE.toString(),m.DocumentAction.IMPORT.toString(),"EXPORT_GROUP"],actionBarExportSubMenu:a.template(t,u),showListView:function(){this.collection=h.getThesaurus(this.modelType,this.supportsGroupOpers),this.itemFilterView=this.createFilterView(),c.mainLayout.showRegions({filter:this.itemFilterView,left:new p}),this.itemFilterView.loadButtonView.reload()},showGroupList:function(a){var b=new o,d=new q({title:a});return this.listenTo(b,"action:doAction",this.showListView),c.mainLayout.showRegions({left:b,content:d}),d},reloadReferenceList:function(b){this.canChooseItem!==!1&&(this.canChooseItem=!1,c.mainLayout.content.options.expectedType=this.modelType,this.collection.loaded=!1,this.collection.fetch(this.referenceReloadOptions(b)).then(function(){c.mainLayout.content.options.expectedType===this.modelType&&(c.mainLayout.content.show(this.createListView()),c.mainLayout.content.trigger("content:reloaded")),this.canChooseItem=!0;var b=this.actionsList;a.isEmpty(this.collection.models)&&(b=a.without(this.actionsList,"EXPORT_GROUP")),c.mainLayout.actionBar.show(this.createActionBar(b))}.bind(this)))},createFilterView:function(){if(this.FilterView){var a=new this.FilterView({collection:this.collection});return this.listenTo(a,"reload",this.reloadReferenceList),a}},referenceReloadOptions:function(a){return{data:a||{PAGE_NUMBER:0,PAGE_SIZE:100},reset:!0,silent:!0}},addListViewListeners:function(a){g.prototype.addListViewListeners.call(this,a),this.listenTo(a,"update-actions",this.updateActions)},updateActions:function(a){c.mainLayout.actionBar.show(this.createActionBar(a))},SAVE_IMPORT_RESULT:function(){g.prototype.SAVE_IMPORT_RESULT(u)},DO_IMPORT:function(a){var b=new FileReader,c=h.createThesaurus(this.modelType),d=function(a){a&&this.saveImportedValidModels(a)}.bind(this),e=a.target.files[0];b.onload=function(a){var b=[m.DocumentAction.SAVE_IMPORT_RESULT];this.importGroupViewInstance=this.importGroupView(c,b,e.name),this.exchange.doImport(a.target.result,c,d)||this.showListView()}.bind(this),b.readAsText(e,"Windows-1251")},saveImportedValidModels:function(a){var b=h.createThesaurus(this.modelType),c={silent:!0,success:function(a){a.has("error")||this.collection.add(a)}.bind(this),error:function(){k.alert(l.sprintf(u.import_error,u[this.modelType]||this.modelType))}.bind(this)};b.add(a.filter(function(a){return a._isValid}));var d=0,e=function(){if(!this.importGroupViewInstance.operationFinished)if(d<b.length){var a=b.at(d++);a.save(null,c),a.on("model:completeSync",e)}else this.importGroupViewInstance.addSummaryImportInfo(u),this.importGroupViewInstance.operationFinished=!0,this.toggleAllButtons(!1)}.bind(this);e()},importGroupView:function(a,b,d){var e=r.extend({title:this.nls.import_title,fileName:d}),f=new e({collection:a,operationType:"import",entityType:"directory_records",childView:j.extend({nls:this.nls,itemName:this.modelItemName})}),g=new o;return c.mainLayout.showRegions({actionBar:this.createActionBar(b||[]),content:f,left:g}),g.on("action:doAction",function(){var a=f.getRunningOperation();a?k.confirm(a.stopMsg,function(){a.stopOperation(),this.showListView()}.bind(this)):this.showListView()}.bind(this)),f},EXPORT_GROUP:function(a){d.showSubMenu(a)},doExport:function(a){this.exchange.doExport(a).done(function(a){var b=this.showGroupList(v["export"]+" "+u[this.modelType]),c=new e.Model;b.add(c,l.sprintf(this.exchange.nls.export_success,a)),c.trigger("model:completeSync",c,"ok")}.bind(this))},EXPORT_FILTER:function(){this.doExport(this.collection)},EXPORT_ALL:function(){this.getAllReference().done(function(a){this.doExport(a)}.bind(this))},getAllReference:function(a){var f=b.Deferred(),g=d.settings.server_addr+"/reference/"+this.modelType+";jsessionid="+d.getStoredItem("JSESSIONID"),h={url:g,type:"GET",data:{}},j=this.itemFilterView.getFilterQuery();j&&(h.data.query=j);var k=c.isMultiClient()&&!a?n.ajax(h):b.ajax(h);return k.done(function(a){var b=new(e.Collection.extend({model:i}))(a);b.comparator=this.collection.comparator,b.sortedInfo=this.collection.sortedInfo,f.resolve(b.sort())}.bind(this)),f},DELETE_GROUP:function(){var b=this.collection.selected,c=function(){var a=function(a,b){return b.add(a,this.getGroupDeleteMessage(a)),a.destroy({success:function(){a.trigger("model:completeSync",a,"Ok")},error:function(b){a.trigger("model:completeSync",a,"error",b.responseText)}},{silent:!0}),a};this.group(a,this.nls.group_view_delete_h1,b)},d=1===a.keys(b).length?this.nls.confirm_delete:this.nls.confirm_delete_many;k.confirm(d,c,!1,this)}})}),define("text!commons/base_object/reference/templates/filter.tmpl",[],function(){return'<div class="filter">\n    <h1 class="doc-type"><%- refTitle %></h1>\n<% if (clientName !== \'\') { %>\n    <div class="row form-group">\n        <div class="col-xs-12">\n            <a id="client-name" href="#"><%- clientName %></a>\n        </div>\n    </div>\n<% } %>\n    <div class="row form-group">\n        <div class="col-xs-9">\n            <div>\n            <input id="filter_value" type="text" placeholder="<%- value_placeholder %>">\n            </div>\n        </div>\n        <div class="col-xs-3">\n            <div>\n                <span id="load_button_component"></span>\n            </div>\n        </div>\n    </div>\n    <div class="row">\n        <div class="col-xs-6">\n            <div class="pagination" id="paginator">\n                <button id="first">&laquo;</button>\n                <button id="previous">&lsaquo;</button>\n                <input type="text" id="current_page" disabled="disabled"/>\n                <button id="next">&rsaquo;</button>\n                <button id="last">&raquo;</button>\n            </div>\n        </div>\n        <div class="col-xs-6">\n            <div class="items-amount">\n            <label><%- pageSize %></label>\n                <a href=\'#\' data-action="100" class="current">100</a>\n                <label>|</label>\n                <a href=\'#\' data-action="500">500</a>\n                <label>|</label>\n                <a href=\'#\' data-action="1000">1000</a>\n            </div>\n        </div>\n    </div>\n</div>'}),define("nls/paginator",{root:{showedPage:"Страница {1} из {2}",showedItemsAmount:"Записи с {1} по {2} из {3}",pageSize:"Количество на странице",net_error:"Ошибка подключения к банковскому серверу"},uk:!0,en:!0}),define("nls/uk/paginator",{showedPage:"Сторінка {1} з {2}",showedItemsAmount:"Записи з {1} по {2} з {3}",pageSize:"Кількість на сторінці",net_error:"Помилка підключення до банківського сервера"}),define("nls/en/paginator",{showedPage:"Page {1} of {2}",showedItemsAmount:"Records from {1} to {2} of {3}",pageSize:"Records per page",net_error:"Failed to connect to bank server"}),define("styles!css/paginator",[],function(){}),define("commons/base_object/reference/reference_filter_view",["jquery","app","underscore","marionette","dialogUtils","bifit","appsPieces","libs/multi_client_utils","components/load_button/load_button_view","text!commons/base_object/reference/templates/filter.tmpl","i18n!nls/paginator","styles!css/paginator"],function(a,b,c,d,e,f,g,h,i,j,k){"use strict";return d.LayoutView.extend({className:"reference-filter",template:c.template(j),currentPage:1,totalPages:-1,totalItems:-1,templateHelpers:function(){return c.extend({refTitle:this.refTitle,clientName:this.clientName,value_placeholder:this.value_placeholder},k)},queryTemplate:"",sortingFields:{},refTitle:"",value_placeholder:"",nls:{},filterValueLength:0,clientName:"",regions:{loadButton:"#load_button_component",paginator:"#paginator"},ui:{filterValue:"#filter_value"},events:{"click div.pagination button":"handlePagination","click div.items-amount a":"changePageSize"},cache:{},initialize:function(a){this.collection=a.collection},onShow:function(){this.ui.filterValue.prop("maxlength",this.filterValueLength),this.loadButtonView=new i,this.loadButton.show(this.loadButtonView),this.listenTo(this.loadButtonView,"reload",this.reloadList),this.listenTo(this.collection,"sync",this.onSyncEnd),this.listenTo(this.collection,"error",this.onSyncEnd),this.listenTo(b.mainLayout.content,"content:reloaded",function(){g.highlightFoundText(this.ui.filterValue.val(),"td, span.cell"),this.renderPaginationInfo()}.bind(this)),this.cache.filterValue&&this.ui.filterValue.val(this.cache.filterValue),this.toggleAmountItemsRef(this.cache.pageSize)},getFilterQuery:function(a){return a?this.ui.filterValue.val(this.cache.filterValue):this.cache.filterValue=this.ui.filterValue.val(),this.cache.filterValue?f.sprintf(this.queryTemplate,f.escapeSpecialChars(this.cache.filterValue)):""},reloadList:function(a){var b={PAGE_NUMBER:this.currentPage-1,PAGE_SIZE:this.cache.pageSize,sorting_fields:this.getSortingFields()},c=this.getFilterQuery(a===!1);c&&(b.query=c),a!==!1?(this.currentPage=1,this.loadThesaurusSize().then(function(){this.trigger("reload",b)}.bind(this))):this.trigger("reload",b)},onSyncEnd:function(){this.loadButtonView.onSyncEnd()},getSortingFields:function(){return this.sortingFields[this.collection.sortedInfo.field.toUpperCase()]+","},changePageSize:function(a){this.currentPage=1,a.preventDefault(),this.cache.pageSize=+a.target.getAttribute("data-action"),this.toggleAmountItemsRef(this.cache.pageSize),this.loadButtonView.animateButton(),this.reloadList(!1)},toggleAmountItemsRef:function(b){a(".items-amount a").removeClass("current"),a('.items-amount a[data-action="'+b+'"]').addClass("current")},handlePagination:function(a){var b=a.target.id;switch(b){case"first":if(1===this.currentPage)return;this.currentPage=1;break;case"last":if(this.currentPage>=this.totalPages)return;this.currentPage=this.totalPages;break;case"previous":if(1===this.currentPage)return;this.currentPage-=1;break;case"next":if(this.currentPage>=this.totalPages)return;this.currentPage+=1}this.loadButtonView.animateButton(),this.reloadList(!1)},loadThesaurusSize:function(b){var c={},d=this.getFilterQuery(!1);return d&&(c.query=d),((b||{}).emulateClientRequest?h:a).ajax({type:"GET",dataType:"json",url:f.settings.server_addr+"/reference/size/"+this.modelType+";jsessionid="+f.getStoredItem("JSESSIONID"),data:c,success:function(a){this.totalItems=a,this.renderPaginationInfo()}.bind(this),error:function(a){400!==a.status&&500!==a.status||e.alert(k.net_error)}.bind(this)})},renderPaginationInfo:function(){this.totalPages=Math.ceil(this.totalItems/this.cache.pageSize),this.renderFooter(),a("#current_page").val(f.sprintf(k.showedPage,this.currentPage,this.totalItems<this.cache.pageSize?1:this.totalPages))},renderFooter:function(){var b=0===this.totalItems?0:(this.currentPage-1)*this.cache.pageSize+1,c=this.totalItems<this.cache.pageSize||this.totalItems<b+this.cache.pageSize-1?this.totalItems:b+this.cache.pageSize-1;a("tfoot.summary tr td").html(f.sprintf(k.showedItemsAmount,b,c,this.totalItems)).trigger("footer:change",1)}})}),define("text!apps/swift/templates/filter.tmpl",[],function(){return'<div class="filter">\n    <h1 class="doc-type"><%- refTitle %></h1>\n    <div class="row form-group">\n        <div class="col-xs-9">\n            <div>\n            <input id="filter_value" type="text" placeholder="<%- value_placeholder %>">\n            </div>\n        </div>\n        <div class="col-xs-3">\n            <div>\n                <span id="load_button_component"></span>\n            </div>\n        </div>\n    </div>\n    <div class="row">\n        <div class="col-xs-6">\n            <div class="pagination" id="paginator">\n                <button id="first">&laquo;</button>\n                <button id="previous">&lsaquo;</button>\n                <input type="text" id="current_page" disabled="disabled"/>\n                <button id="next">&rsaquo;</button>\n                <button id="last">&raquo;</button>\n            </div>\n        </div>\n        <div class="col-xs-6">\n            <div class="items-amount">\n            <label><%- pageSize %></label>\n                <a href=\'#\' data-action="500" class="current">500</a>\n                <label>|</label>\n                <a href=\'#\' data-action="1000">1000</a>\n                <label>|</label>\n                <a href=\'#\' data-action="5000">5000</a>\n            </div>\n        </div>\n    </div>\n</div>'}),define("apps/swift/nls/swift",{root:{swift_title:"Справочник SWIFT",swift:"SWIFT",swift_name:"Название",swift_city:"Город",swift_address:"Адрес",error_title:"Ошибка",empty_list:"Отсутствуют записи в справочнике SWIFT",value_placeholder:"Введите SWIFT, название, адрес или город"},uk:!0,en:!0}),define("apps/swift/nls/uk/swift",{swift_title:"Довідник SWIFT",swift:"SWIFT",swift_name:"Назва",swift_city:"Місто",swift_address:"Адреса",error_title:"Помилка",empty_list:"Відсутні записи у довіднику SWIFT",value_placeholder:"Введіть SWIFT, найменування, адресу або місто"}),define("apps/swift/nls/en/swift",{swift_title:"SWIFT directory",swift:"SWIFT",swift_name:"Name",swift_city:"City",swift_address:"Address",error_title:"Error",empty_list:"There are no records in the SWIFT directory",value_placeholder:"Enter SWIFT, name, address or city"}),define("apps/swift/swift_filter_view",["underscore","commons/base_object/reference/reference_filter_view","text!apps/swift/templates/filter.tmpl","i18n!apps/swift/nls/swift"],function(a,b,c,d){"use strict";return b.extend({template:a.template(c),sortingFields:{BIC:"0",NAME:"1",CITY:"2",ADDRESS:"3"},refTitle:d.swift_title,value_placeholder:d.value_placeholder,filterValueLength:255,queryTemplate:"([0] hasi '{1}' || [1] hasi '{1}' || [2] hasi '{1}' || [3] hasi '{1}')",cache:{pageSize:500}})}),define("apps/swift/base_swift_list_view",["jquery","commons/base_object/base_list_view"],function(a,b){"use strict";return b.extend({showCollection:function(){this.container=this.$(this.childViewContainer);var a="";this.childrenContainer=document.createElement("div"),this.collection.each(function(b){a+=this.childTemplate(b.attributes)},this),this.childrenContainer.className="row-group",this.childrenContainer.innerHTML=a,this.container.append(this.childrenContainer)},resortView:function(){this.childrenContainer&&this.childrenContainer.parentNode.removeChild(this.childrenContainer),this._renderChildren(),this.stopSpinner()}})}),define("text!apps/swift/templates/swift_list.tmpl",[],function(){return'<table id="swift" class="list">\n    <thead class="widescreen">\n    <tr>\n        <th>\n            <span class="sortable" data-field="bic"><%- swift %></span>\n        </th>\n        <th>\n            <span class="sortable" data-field="name"><%- swift_name %></span>\n        </th>\n        <th>\n            <span class="sortable" data-field="address"><%- swift_address %></span>\n        </th>\n        <th>\n            <span class="sortable" data-field="city"><%- swift_city %></span>\n        </th>\n    </tr>\n    </thead>\n    <tfoot class="summary">\n    <tr>\n        <td colspan="6"></td>\n    </tr>\n    </tfoot>\n</table>\n'}),define("text!apps/swift/templates/swift_list_item.tmpl",[],function(){return'<span class="table-row">\n    <span class="cell"><%- bic %></span>\n    <span class="widescreen cell"><%- name %></span>\n    <span class="widescreen cell"><%- address %></span>\n    <span class="widescreen cell"><%- city %></span>\n</span>'}),define("styles!apps/swift/css/swift",[],function(){}),define("apps/swift/swift_list_view",["underscore","apps/swift/base_swift_list_view","text!apps/swift/templates/swift_list.tmpl","text!apps/swift/templates/swift_list_item.tmpl","i18n!apps/swift/nls/swift","styles!apps/swift/css/swift"],function(a,b,c,d,e){"use strict";return b.extend({childViewContainer:"table#swift",template:a.template(c),templateHelpers:e,childTemplate:a.template(d)})}),define("apps/swift/swift_list_controller",["bifit","commons/base_object/reference/reference_list_controller","commons/empty_list_view","apps/swift/swift_filter_view","apps/swift/swift_list_view","i18n!apps/swift/nls/swift"],function(a,b,c,d,e,f){"use strict";return b.extend({actionsList:[],ListView:e,FilterView:d.extend({modelType:"swift"}),EmptyView:c.extend({message:f.empty_list}),modelType:"swift",modelItemName:"name",nls:f,supportsGroupOpers:!1,showItemView:function(){}})}),function(a){var b=document,c="appendChild",d="styleSheet",e=b.createElement("style");e.type="text/css",b.getElementsByTagName("head")[0][c](e),e[d]?e[d].cssText=a:e[c](b.createTextNode(a))}(".pagination{\nborder:1px solid #CDCDCD;\nborder-radius:3px;\nmargin-top:1em;\n}\n.pagination button{\nfloat:left;\nwidth:40px;\nheight:20px;\nline-height:2px;\nborder-right:1px solid #CDCDCD;\nborder-left:1px solid #CDCDCD;\nborder-bottom:none;\nborder-top:none;\ncolor:#555555;\n}\n.pagination button:first-child{\nborder:none;\n}\n.pagination button#last{\nborder:none;\n}\n.pagination input#current_page{\nfloat:left;\nwidth:150px;\nheight:20px;\nline-height:1em;\ntext-align:center;\nbackground-color:white;\n}\ndiv.items-amount a{\nmargin:0.25em;\n}\ndiv.items-amount label:not(:first-child){\nvertical-align:top;\n}\ndiv.items-amount a.current{\ncolor:#000000;\n}\ndiv.items-amount{\nmargin-top:1em;\n}table#swift.list div.row-group{\ncursor:default;\n}");
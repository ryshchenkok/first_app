define("commons/base_object/reference/reference_edit_controller",["underscore","app","backbone","marionette","bifit","dialogUtils","commons/base_object/base_controller","collections/editabled_thesaurus","models/reference","i18n!nls/common"],function(a,b,c,d,e,f,g,h,i,j){"use strict";return g.extend({ItemEditView:null,modelType:null,actionsList:["SAVE","CANCEL"],showEditView:function(b){this.reference=h.getThesaurus(this.modelType),this.reference.fetch({success:function(){this.model=new i(a.extend({refType:this.modelType},this.reference.get(b).attributes)),this.renderViews()}.bind(this)})},showCopyView:function(b){this.reference=h.getThesaurus(this.modelType),this.reference.fetch({success:function(){var c=this.prepareContent4Copy(this.reference.get(b).attributes);this.model=new i(a.extend({refType:this.modelType},c)),this.renderViews()}.bind(this)})},showCreateView:function(){this.model=new i({refType:this.modelType}),this.prepareModel4Create(),this.renderViews()},prepareModel4Create:function(){},prepareContent4Copy:function(a){return delete a.id,delete a.idd,a},renderViews:function(){this.model.enableValidation(),b.mainLayout.showRegions({actionBar:this.createActionBar(this.actionsList),content:this.createItemView()})},createItemView:function(){return new this.ItemEditView({model:this.model})},getContentFromForm:function(){return e.fromForm("form")},viewDocument:function(a){},SAVE:function(a){if(this.model.set(this.getContentFromForm(),{silent:!0}),this.validate()){this.toggleAllButtons(!0);var b=this;if(this.model.isNew())h.getThesaurus(this.modelType).create(this.model,{success:function(){this.viewDocument(b.model.id)}.bind(this)});else{var c=this.model.get("idd");this.model.save({id:c},{wait:!0,success:function(){this.reference.remove(c),this.reference.add(this.model),this.viewDocument(this.model.id)}.bind(this),error:function(a){a.revert()}})}}},validate:function(){return this.model.validateModel()},toList:function(){},isModelHasChanged:function(){return!a.isEqual(this.model._savedAttributes,this.model.attributes)},CANCEL:function(a){this.toggleAllButtons(!0),!this.model.isNew()&&this.isModelHasChanged()?(f.confirm(j.confirm_losing_changes_msg,function(){this.viewDocument(this.model.id)}.bind(this),null,this),this.toggleAllButtons(!1)):this.model.isNew()?(f.confirm(j.confirm_losing_changes_msg,function(){this.toList()}.bind(this),null,this),this.toggleAllButtons(!1)):this.viewDocument(this.model.id)}})}),define("text!apps/overturns/templates/overturns_filter.tmpl",[],function(){return'<div class="toolbar-container">\n    <div class="form-group">\n        <h1 class="doc-type"><%- overturns %></h1>\n        <span id="data_actual" class="period" style="display: none"></span>\n    </div>\n    \n    <div class="mfo">\n        <input type="text" id="mfo" placeholder="<%- mfo %>" autocomplete="off" maxlength="6"/>\n    </div>\n    <div class="accounts">\n        <input type=\'text\' id="accounts" placeholder="<%- h_acc %>" autocomplete="off" maxlength="14"/>\n    </div>\n    <div class="period-filter">\n        <span id="date_period_component"></span>\n        <span id="load_button_component"></span>\n    </div>\n    <div class="checkbox" id="group_by_account_container">\n        <input id="group_by_account" type="checkbox" <% if (checkedGroupByAccount) { %>checked<% } %>>\n        <span class="checkbox"></span>\n        <label for="group_by_account"><%- group_by_account %></label>\n    </div>\n</div>\n'}),define("apps/overturns/nls/overturns",{root:{overturns:"Обороты",period_from:"за период с",period_to:"по",getdocs:"Получить",loading_overturns:"Получение",mfo:"МФО",ir:"Вх.остаток",c:"Обороты Кт.",d:"Обороты Дт.",or:"Исх.остаток",date:"Дата",empty_list_header:"Отсутствуют обороты, удовлетворяющие условиям фильтрации.",empty_list_msg:"Попытайтесь осуществить поиск оборотов по другим условиям.",data_actual:"Данные актуальны на",incorrect_filter_date:"Дата окончания интервала для получения отчета ранее даты начала интервала",footer_s_template_p1:"Всего оборотов: дебет ",footer_s_template_p2:", кредит ",footer_s_template_p3:".",export_result_title:"Экспорт оборотов",export_success:"Оборотно-сальдовая ведомость {1} за период с <b>{2}</b> по <b>{3}</b> успешно экспортирована в файл <br/><b>{4}</b>",export_by_account:"по счету <b>{1}</b>",export_by_several_account:"по нескольким счетам",export_by_all_account:"по всем счетам",export_by_overturn:"Оборот за {1} по счету {2}",export_by_moverturn:"Оборот по счету {1}",print_report:"Печать отчета",h_data:"Дата оборота",h_acc:"Счет",h_curr:"Валюта",h_inner:"Входящий остаток",h_uah:"Гривневое покрытие",h_dover:"Обороты ДТ",h_kover:"Обороты КТ",h_outer:"Исходящий остаток",h_bank:"Банк",group_by_account:"Группировать по счетам",several:"Выбрано счетов: {1}",all:"Все",client:"Клиент",in_currency:"в валюте"},uk:!0,en:!0}),define("apps/overturns/nls/uk/overturns",{overturns:"Обороти",period_from:"за період з",period_to:"по",getdocs:"Отримати",loading_overturns:"Отримання",ir:"Вх.залишок",c:"Обороти Кт.",d:"Обороти Дт.",or:"Вих.залишок",date:"Дата",empty_list_header:"Жоден оборот не відповідає умовам фільтрації.",empty_list_msg:"Спробуйте здійснити пошук обороту за іншими умовами.",data_actual:"Дані актуальні на",incorrect_filter_date:"Дата завершення інтервалу для отримання звiту раніше дати початку інтервалу",footer_s_template_p1:"Разом оборотів: дебет ",footer_s_template_p2:", кредит ",footer_s_template_p3:".",export_result_title:"Експорт оборотів",export_success:"Оборотно-сальдова відомість {1} за період з <b>{2}</b> по <b>{3}</b> успішно експортована в файл <br/><b>{4}</b>",export_by_account:"по рахунку <b>{1}</b>",export_by_several_account:"по декількох рахунках",export_by_all_account:"за всіма рахунками",export_by_overturn:"Оборот за {1} по рахунку {2}",export_by_moverturn:"Оборот по рахунку {1}",print_report:"Друк звіту",h_data:"Дата обороту",h_acc:"Рахунок",h_curr:"Валюта",h_inner:"Вхідний залишок",h_uah:"Гривневе покриття",h_dover:"Обороти ДТ",h_kover:"Обороти КТ",h_outer:"Вихідний залишок",h_bank:"Банк",group_by_account:"Групувати за рахунком",several:"Обрано рахунків: {1}",all:"Всі",client:"Клієнт",in_currency:"у валюті"}),define("apps/overturns/nls/en/overturns",{overturns:"Turnovers",period_from:"for a period from",period_to:"to",getdocs:"Receive",loading_overturns:"Loading",mfo:"MFO",ir:"Inc. balance",c:"Turnovers Ct.",d:"Turnovers Dt.",or:"Out. balance",date:"Date",empty_list_header:"There are no turnovers that satisfy the filter conditions.",empty_list_msg:"Try searching the turnovers by other conditions.",data_actual:"Data relevant on",incorrect_filter_date:"Interval final date for receiving the turnover is earlier than its initial one",footer_s_template_p1:"Total turnovers: debit ",footer_s_template_p2:", credit ",footer_s_template_p3:".",export_result_title:"Export turnovers",export_success:"Turnovers balance sheet {1} for the period since <b>{2}</b> till <b>{3}</b> has been successfully exported to file <br/><b>{4}</b>",export_by_account:"of account <b>{1}</b>",export_by_several_account:"of several accounts",export_by_all_account:"of all accounts",export_by_overturn:"Turnover since {1} of account {2}",export_by_moverturn:"Turnover of account {1}",print_report:"Print report",h_data:"Turnover date",h_acc:"Account",h_curr:"Currency",h_inner:"Incoming balance",h_uah:"Hryvnia coverage",h_dover:"Turnover DT",h_kover:"Turnover CT",h_outer:"Outgoing balance",h_bank:"Bank",group_by_account:"Group by account",several:"Selected accounts: {1}",all:"All",client:"Client",in_currency:"in currency"}),define("apps/overturns/overturns_filter_view",["jquery","underscore","backbone","marionette","bifit","appsPieces","chosen","dialogUtils","components/date_period/date_period","components/load_button/load_button_view","text!apps/overturns/templates/overturns_filter.tmpl","i18n!apps/overturns/nls/overturns"],function(a,b,c,d,e,f,g,h,i,j,k,l){"use strict";var m=i.extend({templateHelpers:b.pick(l,"period_from","period_to")});return d.LayoutView.extend({accounts:null,selectedMfo:null,selectedAccountsIds:null,datePeriodComponent:null,docType:"overturn",template:b.template(k),tagName:"div",className:"filter overturn",events:{"chosen:select @ui.mfo":"mfoSelect","change @ui.groupReport":"changeGroupState"},regions:{datePeriod:"#date_period_component",loadButton:"#load_button_component"},ui:{accounts:"input#accounts",dataActual:"#data_actual",mfo:"#mfo",groupReport:"#group_by_account",groupReportContainer:"#group_by_account_container",tooltips:'[data-toggle="tooltip"]'},initialize:function(a){this.accounts=f.addAccountTypeDescription(a.accounts),this.checkedGroupByAccount=a.checkedGroupByAccount||!1,this.accountsByMfo=b.groupBy(this.accounts,"mfo");var c=e.getStorageData(this.docType+"_filter"),d=c?JSON.parse(c):{},g=(a.selectedAccountsIds||d.selectedAccountsIds||"").split(";"),h=b.filter(this.accounts,function(a){return b.contains(g,String(a.account_id))});if(h.length)h=b.chain(h).groupBy("mfo").values().first().value(),this.selectedMfo=b.first(h).mfo,g=b.pluck(h,"account_id"),h.length>1&&this.accountsByMfo[this.selectedMfo].length===h.length&&g.push("all");else{var i=b.keys(this.accountsByMfo);this.selectedMfo=d.selectedMfo&&b.contains(i,d.selectedMfo)?d.selectedMfo:b.first(i),g=[b.first(this.accountsByMfo[this.selectedMfo]).account_id]}this.selectedAccountsIds=b.object(g,b.map(g,function(){return!0})),this.loadReport=a.loadReport,this.templateHelpers=b.extend({},l,{checkedGroupByAccount:this.checkedGroupByAccount}),this.listenTo(this.model,"sync",this.onSyncEnd),this.on("reset",function(){this.ui.dataActual.html("")})},onShow:function(){var a=this.initUi();this.listenTo(this.model,"sync",this.showActualDate),this.loadReport&&!b.isEmpty(a)&&this.reload(),this.ui.tooltips.tooltip()},initButtonAndPeriodComponents:function(){this.loadButtonView=new j,this.loadButton.show(this.loadButtonView),this.listenTo(this.loadButtonView,"reload",this.reload);var a=this.getMinCreatedDateFromSelectedAccounts();this.datePeriodComponent=new m({minDate:a,bdate:this.initDate("bdate"),edate:this.initDate("edate"),docType:this.docType,incorrectFilterDatesMsg:l.incorrect_filter_date}),this.datePeriod.show(this.datePeriodComponent)},initUi:function(){var a={};this.initButtonAndPeriodComponents(),this.ui.accounts.chosen({searchable:!0,accType:!0,data:{array:[],id:"account_id",text:["account","currency"],selection:{},all:l.all},renderInput:function(a,c){var d=b.size(c.selection),f="";if(1===d){var g=b.findWhere(c.array,{account_id:b.first(b.keys(c.selection))})||{};f=g.account+" "+g.currency}else f=c.selection.all?l.all:e.sprintf(l.several,d),d>1&&this.ui.groupReportContainer.show();a.val(f)}.bind(this)}),this.ui.accounts.on("group:itemSelected",function(c,d,e){"all"!==d&&(e.selection[d]?b.size(e.selection)===e.array.length-1&&(e.selection.all=!0):delete e.selection.all),e.selection.all||b.size(e.selection)>1?this.ui.groupReportContainer.show():this.ui.groupReportContainer.hide(),this.loadButtonView.ui.period.attr("disabled",b.isEmpty(e.array)||b.isEmpty(e.selection)),this.datePeriodComponent.updateView(this.getMinCreatedDateFromSelectedAccounts()),b.size(a)===b.size(e.selection)&&b.isEmpty(b.difference(b.keys(a),b.keys(e.selection)))||(a=b.extend({},e.selection),this.trigger("reset")),this.trigger("account_selection:changed")}.bind(this));var c=b.keys(this.accountsByMfo);this.ui.mfo.chosen({searchable:!1,data:{array:c}});var d=this.selectedMfo&&b.contains(c,this.selectedMfo)?this.selectedMfo:b.first(c);return this.ui.mfo.trigger("chooseById",d),this.ui.accounts.trigger("choose:group",this.selectedAccountsIds),this.getSelectedAccounts()},getMinCreatedDateFromSelectedAccounts:function(){var a=this.getSelectedAccounts();return(b.min(a,function(a){return e.str2date(a.create_date).getTime()})||{}).create_date||""},getSelectedAccounts:function(){var a=this.ui.mfo.val(),c=a?this.accountsByMfo[a]||[]:this.accounts,d=b.keys(this.selectedAccountsIds);return"all"===b.first(d)?c:b.filter(c,function(a){return b.contains(d,a.account_id)})},showActualDate:function(){var a=b.size(this.model.attributes)?b.chain(this.model.attributes).values().first().value().OLLD:null;a?(this.ui.dataActual.html(l.data_actual+" "+a),this.ui.dataActual.css("display","inline-block")):this.ui.dataActual.hide()},initDate:function(a){return this.model.options&&this.model.options.data&&void 0!==this.model.options.data[a]?this.model.options.data[a]:void 0},mfoSelect:function(a,c){this.selectedMfo=c;var d=c?this.accountsByMfo[c]:this.accounts.slice();this.ui.accounts.trigger("refresh",{array:d.slice()}),this.ui.accounts.trigger("chooseById",b.first(d).account_id),this.ui.accounts.attr("disabled",1===d.length),this.trigger("reset")},changeGroupState:function(b){this.trigger("changeGroupState",{isGroup:a(b.target).is(":checked")})},reload:function(a){a=a||{},this.cacheFilterSelection(),b.extend(a,{bdate:this.datePeriodComponent.getBeginDate(),edate:this.datePeriodComponent.getEndDate(),acc_id:b.pluck(this.getSelectedAccounts(),"account_id").join(";")}),this.datePeriodComponent.updateDate("bdate",a.bdate),this.datePeriodComponent.updateDate("edate",a.edate),this.lastLoadFilterData=a,this.trigger("reload",a,this.onSyncEnd.bind(this))},cacheFilterSelection:function(){var a={selectedMfo:this.selectedMfo,selectedAccountsIds:b.keys(this.selectedAccountsIds).join(";")};e.setStorageData(this.docType+"_filter",JSON.stringify(a))},onSyncEnd:function(){this.restoreLastLoadFilterData(),this.loadButtonView.onSyncEnd()},restoreLastLoadFilterData:function(){this.datePeriodComponent.updateDate("bdate",this.lastLoadFilterData.bdate),this.datePeriodComponent.updateDate("edate",this.lastLoadFilterData.edate),this.datePeriodComponent.validateDates()},onBeforeDestroy:function(){this.ui.accounts.disposeChosen()}})}),define("text!commons/base_object/document/templates/document_ext_filter_minimized_item.tmpl",[],function(){return"<label><%- (label ? label + ': ' : '') %></label>\n<span class=\"value <%- id %>\"><%- displayValue %></span>\n<span class=\"delete-filter-item\">&#10005;</span>"}),define("nls/document-filter",{root:{status_all:"Все",period_from:"Период с",period_to:"по",getdocs:"Получить",loading_docs:"Получение",incorrect_filter_date:"Дата окончания интервала для получения документов ранее даты начала интервала",ua_payment:"Гривневые поручения",bank_ua_payment_request:"Гривневые требования",ua_payment_request:"Гривневые требования",ua_currency_purchase:"Покупка валюты",ua_currency_sale:"Продажа валюты",ua_currency_convert:"Конвертация валюты",ua_currency_payment:"Валютные поручения",pay_sheet:"Зарплатные ведомости",letter:"Письма",inStatus:"В статусе",any:"Все",several:"Выбрано статусов: {1}",num_doc:"Номер документа",currency:"Валюта",amount:"Сумма",from:"от",to:"до",amount_from:"Сумма от",amount_to:"Сумма до",payer:"Плательщик",recipient:"Получатель",account:"Счет",start_entering:"Начинайте вводить",start_entering_acc:"Начинайте вводить номер счета",start_entering_name:"Начинайте вводить наименование",all:"Все",amountError:"Максимальная сумма должна быть больше минимальной"},uk:!0,en:!0}),define("nls/uk/document-filter",{status_all:"Всі",period_from:"Перiод від",period_to:"до",getdocs:"Отримати",loading_docs:"Отримання",incorrect_filter_date:"Дата завершення інтервалу для отримання документів раніше дати початку інтервалу",ua_payment:"Гривневі доручення",bank_ua_payment_request:"Гривневі вимоги",ua_payment_request:"Гривневі вимоги",ua_currency_purchase:"Купівля валюти",ua_currency_sale:"Продаж валюти",ua_currency_payment:"Валютні доручення",ua_currency_convert:"Конвертація валюти",pay_sheet:"Зарплатні відомості",letter:"Листи",inStatus:"У статусі",any:"Всі",several:"Обрано статусів: {1}",num_doc:"Номер документа",currency:"Валюта",amount:"Сума",from:"від",to:"до",amount_from:"Сума від",amount_to:"Сума до",payer:"Платник",recipient:"Отримувач",account:"Рахунок",start_entering:"Починайте вводити",start_entering_acc:"Починайте вводити номер рахунку",start_entering_name:"Починайте вводити найменування",all:"Всі",amountError:"Максимальна сума повинна бути більше ніж мінімальна"}),define("nls/en/document-filter",{status_all:"All",period_from:"Period from",period_to:"to",getdocs:"Receive",loading_docs:"Loading",incorrect_filter_date:"Interval final date for receiving the statement is earlier than its initial one",ua_payment:"Hryvnia Payment orders",bank_ua_payment_request:"Hryvnia Payment requests",ua_payment_request:"Hryvnia Outgoing Payment Request-Orders",ua_currency_purchase:"Currency purchase",ua_currency_sale:"Currency sale",ua_currency_convert:"Currency conversion",ua_currency_payment:"Currency payments",pay_sheet:"Salary sheets",letter:"Letters",inStatus:"In status",any:"Any",several:"Selected statuses: {1}",num_doc:"Document number",currency:"Currency",amount:"Amount",from:"from",to:"to",amount_from:"Amount from",amount_to:"Amount to",payer:"Payer",recipient:"Recipient",account:"Account",start_entering:"Start typing",start_entering_acc:"Start typing the account",start_entering_name:"Start typing the name",all:"All",amountError:"The maximum amount should be more than the minimum"}),define("commons/base_object/document/document_ext_filter_view",["underscore","backbone","marionette","app","bifit","collections/thesaurus","dialogUtils","text!commons/base_object/document/templates/document_ext_filter_minimized_item.tmpl","i18n!nls/document-filter"],function(a,b,c,d,e,f,g,h,i){"use strict";return c.CompositeView.extend({template:a.template('<div id="expanded-view"></div><div id="minimized-view"></div>'),templateHelpers:{isMultiClient:d.isMultiClient},ui:{expanded:"#expanded-view",minimized:"#minimized-view"},events:{"chosen:select #client":"onClientSelected"},fieldsMeta:{},childView:c.ItemView.extend({template:a.template(h),tagName:"span",id:function(){return this.model.id},triggers:{"click .delete-filter-item":"deleteFilterItem"}}),selectedClient:null,childViewContainer:"#minimized-view",childEvents:{deleteFilterItem:"deleteFilterItem"},isExpanded:!0,isFieldsOrder:!1,getExtFilterData:function(){if(this.isExpanded&&this.resetFilterCollection(),this.isValidFilterData()){var b={};return a.extend(b,this.getQueryFilter()),a.extend(b,this.getAdditionalFilter()),a.extend(b,this.getClientIdFilter()),b}},toggleMode:function(){this.isExpanded?this.isValidFilterData()&&(this.ui.expanded.hide(),this.ui.minimized.show(),this.resetFilterCollection()):(this.ui.expanded.show(),this.ui.minimized.hide(),this.restoreFilter()),this.isExpanded=!this.isExpanded,this.trigger("filter:resized")},resetFilter:function(){this.clearForm(),this.setDefaults(),!this.isExpanded&&this.collection.length&&(this.collection.reset(),this.trigger("filter:changed"),this.trigger("filter:resized"))},clearForm:function(){this.ui.expanded.find("input:text:not([readonly])").val("").change().trigger("empty")},setDefaults:function(){},initialize:function(){},onShow:function(){this.initForm(),this.ui.client&&this.ui.client.length&&this.initClientChosen(),this.collection.length&&this.restoreFilter()},initForm:function(){},restoreFilter:function(){this.restoreQueryFields(),this.restoreAdditionalFields()},restoreQueryFields:function(){a.each(this.fieldsMeta,function(a,b){var c=this.collection.get(b);if(0!==this.ui[b].length){var d=c?c.get("displayValue"):"";this.ui[b].val(d),d||this.ui[b].trigger("empty"),this.ui[b].change()}}.bind(this))},restoreAdditionalFields:function(){},resetFilterCollection:function(){var b=a.union(this.collectQueryData(),this.collectAdditionalData());this.isFieldsOrder&&b.sort(function(b,c){return a.has(b,"order")&&a.has(c,"order")?b.order-c.order:0}),this.collection.reset(b)},collectQueryData:function(){var b=[];return a.each(this.fieldsMeta,function(c,d){var e=this.getFilterValue(d);if(e){var f={id:d,idx:c.idx,order:c.order,value:e,type:c.type,operation:c.operation,displayValue:this.getDisplayValue(d),label:"<="===c.operation&&a.findWhere(b,{idx:c.idx})?c.shortLabel:c.label};"client"===c.type&&this.selectedClient&&this.selectedClient.name_cln===f.value&&(f.client_id=this.selectedClient.client_id),b.push(f)}}.bind(this)),b},collectAdditionalData:function(){return[]},getQueryFilter:function(){var b="";return a.each(this.fieldsMeta,function(a,c){var d=this.collection.get(c);if(d){var e=this.getQueryPart(d);e&&(b+=(b?" && ":"")+e)}}.bind(this)),b?{query:b}:{}},getQueryPart:function(a){var b=a.get("type");return"amount"===b?this.getAmountQuery(a):"client"===b?this.getClientQuery(a):"number"===b?this.getNumberQuery(a):this.getStringQuery(a)},getAdditionalFilter:function(){return{}},getClientIdFilter:function(){var a=this.collection.get("client");if(a){var b=a.get("client_id");if(b)return{clients:b}}},isValidFilterData:function(){return this.hasAmountFields()?this.isAmountValid():!0},hasAmountFields:function(){return!!a.findWhere(this.fieldsMeta,{type:"amount"})},isAmountValid:function(){var a=+this.ui.AMOUNT_MIN.getUnformattedValue(),b=+this.ui.AMOUNT_MAX.getUnformattedValue();return!(b>0&&a>b)},clearInvalidFields:function(){this.hasAmountFields()&&!this.isAmountValid()&&this.clearAmountFields()},clearAmountFields:function(){this.ui.AMOUNT_MIN.val(""),this.ui.AMOUNT_MAX.val(""),b.Validation.callbacks.valid(null,"AMOUNT_MIN")},validateFilterAmount:function(){this.isAmountValid()?b.Validation.callbacks.valid(null,"AMOUNT_MIN"):b.Validation.invalidField(this,"AMOUNT_MIN",i.amountError)},getFilterValue:function(a){var b=this.ui[a].getUnformattedValue();return this.fieldsMeta[a]&&("amount"===this.fieldsMeta[a].type||"number"===this.fieldsMeta[a].type)&&0>=b?null:b?b.trim():null},getDisplayValue:function(a){return this.ui[a].val().trim()},deleteFilterItem:function(b,c){var d=c.model.id,e=this.fieldsMeta[d];if(e&&">="===e.operation){var f;a.each(this.fieldsMeta,function(a,b){e.idx===a.idx&&b!==d&&"<="===a.operation&&(f=b)}),f&&this.collection.get(f)&&this.ui.minimized.find("#"+f).find("label").html(this.fieldsMeta[f].label+":")}this.collection.remove(c.model),this.ui[d].trigger("empty"),this.trigger("filter:changed"),this.trigger("filter:resized")},onClientSelected:function(a,b){this.selectedClient=b},initClientChosen:function(){this.ui.client.chosen({data:{array:f.getThesaurus("sub_clients").array,id:"client_id",text:"name_cln"}})},getStringQuery:function(a){return"["+a.get("idx")+"] hasi '"+e.escapeSpecialChars(a.get("value"))+"'"},getAmountQuery:function(a){return"["+a.get("idx")+"] "+a.get("operation")+" "+a.get("value")},getNumberQuery:function(a){return"["+a.get("idx")+"] has '"+a.get("value")+"'"},getClientQuery:function(a){return a.get("client_id")?"":this.getStringQuery(a)},onBeforeDestroy:function(){this.ui.client&&this.ui.client.length&&this.ui.client.disposeChosen()}})}),define("text!apps/statement/templates/statement_ext_filter.tmpl",[],function(){return'<div id="expanded-view">\n    <div class="data-row">\n        <div class="row">\n            <label class="col-xs-2"><%- oper_type %></label>\n            <label class="col-xs-2"><%- num_doc %></label>\n            <div class="col-xs-8">\n                <div class="row">\n                    <label class="col-xs-7"><%- amount %></label>\n                    <label class="col-xs-5"><%- h_detail %></label>\n                </div>\n            </div>\n        </div>\n        <div class="row">\n            <div class="col-xs-2">\n                <input id="oper_type">\n            </div>\n            <div class="col-xs-2">\n                <input id="num_doc" maxlength="20" autocomplete="off">\n            </div>\n            <div class="col-xs-8">\n                <div class="row">\n                    <div class="col-xs-7 amount-filter">\n                        <input id="amount_from" class="sum" autocomplete="off" placeholder="<%- from %>">\n                        <label class="amount-to">-</label>\n                        <input id="amount_to" class="sum" autocomplete="off" placeholder="<%- to %>">\n                    </div>\n                    <div class="col-xs-5">\n                        <input id="payment_details" maxlength="160" autocomplete="off">\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n    <div class="data-row">\n        <div class="row">\n            <label class="col-xs-6"><%- h_korr %></label>\n            <label class="col-xs-3"><%- okpo %></label>\n            <label class="col-xs-3"><%- corr_acc %></label>\n        </div>\n        <div class="row">\n            <div class="col-xs-6">\n                <input id="corr_name" maxlength="40" autocomplete="off" placeholder="<%- start_entering %>">\n            </div>\n            <div class="col-xs-3">\n                <input id="corr_inn" maxlength="10" autocomplete="off" placeholder="<%- entering_placeholder %>">\n            </div>\n            <div class="col-xs-3">\n                <input id="corr_acc" maxlength="14" autocomplete="off" placeholder="<%- entering_placeholder %>">\n            </div>\n        </div>\n    </div>\n</div>\n<div id="minimized-view"></div>\n'}),define("apps/statement/nls/statement_base",{root:{document:"Документ",last_oper_date:"Предыдущая операция",date:"Дата",ib:"Вх.остаток",ob:"Исх.остаток",equivalent:"Грн.эквивалент",np:"Назначение",oper_type:"Тип операции",amount:"Сумма",from:"от",amount_from:"Сумма от",to:"до",amount_to:"Сумма до",amountError:"Максимальная сумма должна быть больше минимальной",start_entering:"Начинайте вводить наименование",entering_placeholder:"Начинайте вводить",payment_details:"Назначение платежа",corr_name:"Корреспондент",corr_inn:"ЕГРПОУ",corr_acc:"Счет",num_doc:"Номер документа",DOC_NUM:"Номер документа",OPER_DATE:"Дата операции",DATE_DOC:"Дата документа",AMOUNT:"Сумма операции",ACCOUNT:"Счет",VALUE_DATE:"Дата валютир.",TRANSACTION_DATE:"Дата списания",UAH_CONV:"Эквивалент",CORR_NAME:"Корреспондент",OKPO:"ЕГРПОУ",MFO:"Банк",DOCUMENT_INFO:"Назначение платежа",BUDGET_CODE:"Статья расходов",BUDGET_CODE_DESCRIPTION:"Наименование",no_filter:"Выбрать всё",debet:"Дебет",debet_oper:"Дебетовая операция",credit:"Кредит",credit_oper:"Кредитовая операция",COUNTRY_CODE:"Код страны",operation:"Операция",oper_code:"Информационный документ",rcpt:"Корреспондент",name:"Наименование",to_acc:"по счету",to_card:"карта",okpo:"ЕГРПОУ",data_actual:"Данные актуальны на",last_op:"Дата предыдущей операции:",no_op:"операции отсутствуют",incorrect_filter_date:"Дата окончания интервала для получения выписки ранее даты начала интервала",statements:"Выписка",getdocs:"Получить",loading_statement:"Получение",expand_filter:"Больше параметров фильтра",minimize_filter:"Скрыть фильтр",reset_filter:"Установить значения по умолчанию",print_statement_brief:"Сокращенная",print_statement_standart:"Стандартная",print_statement_extended:"Расширенная",print_statement_extended_album:"Расширенная (альбомная)",print_report:"Печать отчета",print_debit_registry:"Реестра по дебету",print_credit_registry:"Реестра по кредиту",print_debit_registry_title:"Печать реестра по дебету",print_credit_registry_title:"Печать реестра по кредиту",export_title:"Выберите директорию для сохранения файла экспорта",export_report_types:"Файл с разделителями(*.сsv)",export_client_bank:"Банк-Клиент",export_bmrs:"BMRS",export_ibis:"ИБИС",export_csv:"Файл с разделителями (.csv)",empty_list_header:"Отсутствуют операции, удовлетворяющие условиям фильтрации.",empty_list_msg:"Попытайтесь осуществить поиск операций по другим условиям.",footer_s_template_p1:"Остатки: вх. ",footer_s_template_p2:", исх. ",footer_s_template_p3:".  Всего оборотов: дебет ",footer_s_template_p4:", кредит ",footer_s_template_p5:".",h_okpo:"ЕГРПОУ",h_mfo:"МФО",h_acc:"Счет",h_cur:"Валюта",h_odate:"Дата операции",h_code:"Код операции",h_bmfo:"МФО банка",h_bname:"Название банка",h_kacc:"Счет корреспондента",h_kokpo:"ЕГРПОУ корреспондента",h_korr:"Корреспондент",h_dnum:"Документ",h_ddate:"Дата документа",h_debt:"Дебет",h_cred:"Кредит",h_detail:"Назначение платежа",h_uah:"Гривневое покрытие",h_amount:"Сумма",h_client:"Клиент",h_corp_bmfo:"МФО банка кореспондента",h_corp_bname:"Название банка корреспондента",h_corp_oper_date:"Дата операции",h_corp_oper_time:"Время операции",h_corp_transaction_value_date:"Дата расчета/валютирования",h_corp_card:"Номер карты",h_corp_oper_amount:"Сумма в валюте операции",h_corp_oper_cur:"Валюта операции",h_corp_debt:"Дебет в валюте счета",h_corp_cred:"Кредит в валюте счета",h_corp_oper_desc:"Описание операции",h_corp_oper_type:"Тип операции",show_docs:"Показать список",hide_docs:"Скрыть",recipient_success:"Корреспондент успешно добавлен в Справочник Корреспондентов",recipient_exists:"Такой корреспондент уже существует в справочнике",recipient_error:"Ошибка добавления корреспондента в справочник",invalid_recipient:"Некорректные данные корреспондента",no_overturns:"Отсутствуют обороты за данный период",export_result_title:"Экспорт выписки",export_element_title:"Операция №{1} за {2} по счету {3}",export_error:"Ошибка",export_error_text:'Значение поля "{1}" - некорректно',export_warning_text:'Значение поля "{1}" уменьшено до {2} символов',export_by_account:"по счету <b>{1}</b>",export_by_several_account:"по нескольким счетам",export_by_all_account:"по всем счетам",export_success_csv:"Выписка {1} за период с <b>{2}</b> по <b>{3}</b> успешно экспортирована в файл <br/><b>{4}</b>",export_element_title_brms:"Экспорт операций за {1} в файл {2}",group_by_account:"Группировать по счетам",for_the_date:"за дату",all:"Все",several_clients:"несколько клиентов",all_clients:"все клиенты",several_mfo:"МФО: {1}",no_uah_accs:"Невозможно создать документ. Отсутствует текущий счет в национальной валюте."},uk:!0,en:!0}),define("apps/statement/nls/statement",["underscore","apps/statement/nls/statement_base"],function(a,b){return{root:a.extend({},b.root),uk:!0,en:!0}}),define("apps/statement/nls/uk/statement_base",{document:"Документ",last_oper_date:"Попередня операція",date:"Дата",ib:"Вх.залишок",ob:"Вих.залишок",equivalent:"Грн.еквівалент",np:"Призначення",oper_type:"Тип операції",amount:"Сума",from:"від",amount_from:"Сума від",to:"до",amount_to:"Сума до",amountError:"Максимальна сума повинна бути більше ніж мінімальна",start_entering:"Починайте вводити найменування",entering_placeholder:"Починайте вводити",payment_details:"Призначення платежу",corr_name:"Кореспондент",corr_inn:"ЄДРПОУ",corr_acc:"Рахунок",num_doc:"Номер документа",ACCOUNT:"Рахунок",DOC_NUM:"Номер документа",OPER_DATE:"Дата операції",DATE_DOC:"Дата документа",AMOUNT:"Сума операції",VALUE_DATE:"Дата валютув.",TRANSACTION_DATE:"Дата списання",UAH_CONV:"Еквівалент",CORR_NAME:"Кореспондент",OKPO:"ЄДРПОУ",MFO:"Банк",DOCUMENT_INFO:"Призначення платежу",BUDGET_CODE:"Стаття витрат",BUDGET_CODE_DESCRIPTION:"Найменування",no_filter:"Вибрати всі",debet:"Дебет",debet_oper:"Дебетова операція",credit:"Кредит",credit_oper:"Кредитова операція",COUNTRY_CODE:"Код краіни",operation:"Операція",oper_code:"Інформаційний документ",rcpt:"Кореспондент",name:"Найменування",to_acc:"за рахунком ",to_card:"карта",okpo:"ЄДРПОУ",mfo:"МФО",data_actual:"Дані актуальні на",last_op:"Дата попередньої операції:",no_op:"операції відсутні",incorrect_filter_date:"Дата завершення інтервалу для отримання виписки раніше дати початку інтервалу",statements:"Виписка",getdocs:"Отримати",loading_statement:"Отримання",expand_filter:"Більше параметрів фільтра",minimize_filter:"Сховати фільтр",reset_filter:"Встановити значення за замовчуванням",print_statement_brief:"Скорочена",print_statement_standart:"Стандартна",print_statement_extended:"Розширена",print_statement_extended_album:"Розширена (альбомна)",print_report:"Друк звіту",print_debit_registry:"Реєстру по дебету",print_credit_registry:"Реєстру по кредиту",print_debit_registry_title:"Друк реєстру по дебету",print_credit_registry_title:"Друк реєстру по кредиту",export_title:"Оберіть директорію для збереження файла експорту",export_report_types:"Файл з роздільниками(*.сsv)",export_client_bank:"Банк-Клієнт",export_bmrs:"BMRS",export_ibis:"ІБІС",export_csv:"Файл с роздільниками (.csv)",
empty_list_header:"Жодна операція не відповідає умовам фільтрації.",empty_list_msg:"Спробуйте здійснити пошук операції за іншими умовами.",footer_s_template_p1:"Залишки: вх. ",footer_s_template_p2:", вих. ",footer_s_template_p3:".  Разом оборотів: дебет ",footer_s_template_p4:", кредит ",footer_s_template_p5:".",h_okpo:"ЄДРПОУ",h_mfo:"МФО",h_acc:"Рахунок",h_cur:"Валюта",h_odate:"Дата операції",h_code:"Код операції",h_bmfo:"МФО банка",h_bname:"Назва банка",h_kacc:"Рахунок кореспондента",h_kokpo:"ЄДРПОУ кореспондента",h_korr:"Кореспондент",h_dnum:"Документ",h_ddate:"Дата документа",h_debt:"Дебет",h_cred:"Кредит",h_detail:"Призначення платежу",h_uah:"Гривневе покриття",h_amount:"Сума",h_client:"Клієнт",h_corp_bmfo:"МФО банка кореспондента",h_corp_bname:"Назва банка корреспондента",h_corp_oper_date:"Дата операції",h_corp_oper_time:"Час операції",h_corp_transaction_value_date:"Дата розрахунку/валютування",h_corp_card:"Номер карти",h_corp_oper_amount:"Сумма у валюті операції",h_corp_oper_cur:"Валюта операції",h_corp_debt:"Дебет у валюті рахунку",h_corp_cred:"Кредит у валюті рахунку",h_corp_oper_desc:"Опис операції",h_corp_oper_type:"Тип операции",show_docs:"Показати список",hide_docs:"Сховати",recipient_success:"Кореспондент успішно доданий до Довідника Кореспондентів",recipient_exists:"Такий кореспондент вже існує у довіднику",recipient_error:"Помилка при додаванні кореспондента у довідник",invalid_recipient:"Невірні дані кореспондента",no_overturns:"Відсутні обороти за даний період",export_result_title:"Експорт виписки",export_element_title:"Операція №{1} за {2} за рахунком {3}",export_error:"Помилка",export_error_text:'Значення поля "{1}" - некоректне',export_warning_text:'Значення поля "{1}" зменшено до {2} символів',export_by_account:"по рахунку <b>{1}</b>",export_by_several_account:"по декількох рахунках",export_by_all_account:"за всіма рахунками",export_success_csv:"Виписка {1} за період з <b>{2}</b> по <b>{3}</b> успішно експортована в файл <br/><b>{4}</b>",export_element_title_brms:"Експорт операцій за {1} у файл {2}",group_by_account:"Групувати за рахунком",for_the_date:"за дату",all:"Всі",several_clients:"декілька клієнтів",all_clients:"всі клієнти",several_mfo:"МФО: {1}",no_uah_accs:"Неможливо створити документ. Відсутній поточний рахунок в національній валюті."}),define("apps/statement/nls/uk/statement",["underscore","apps/statement/nls/uk/statement_base"],function(a,b){return a.extend({},b)}),define("apps/statement/nls/en/statement_base",{document:"Document",last_oper_date:"Previous operation",date:"Date",ib:"Inc. balance",ob:"Out. balance",equivalent:"Hryv. equivalent",np:"Details",oper_type:"Operation type",amount:"Amount",from:"from",amount_from:"Amount from",to:"to",amount_to:"Amount to",amountError:"The maximum amount should be more than the minimum",start_entering:"Start typing the name",entering_placeholder:"Start typing",payment_details:"Payment details",corr_name:"Correspondent",corr_inn:"EDRPOU",corr_acc:"Account",num_doc:"Document number",DOC_NUM:"Document number",OPER_DATE:"Operation date",DATE_DOC:"Document date",AMOUNT:"Amount of operation",ACCOUNT:"Account",VALUE_DATE:"Value date",UAH_CONV:"Equivalent",TRANSACTION_DATE:"Transaction date",CORR_NAME:"Correspondent",OKPO:"EDRPOU",MFO:"Bank",DOCUMENT_INFO:"Payment details",BUDGET_CODE:"Costs item",BUDGET_CODE_DESCRIPTION:"Name",no_filter:"Select all",debet:"Debit",debet_oper:"Debit operation",credit:"Credit",credit_oper:"Credit operation",COUNTRY_CODE:"Country code",operation:"Operation",oper_code:"Informational document",rcpt:"Correspondent",name:"Name",to_acc:"by account",okpo:"EDRPOU",to_card:"card",data_actual:"Data relevant on",last_op:"Previous operation date:",no_op:"no operations",incorrect_filter_date:"Interval final date for receiving the statement is earlier than its initial one",statements:"Statement",getdocs:"Receive",loading_statement:"Loading",expand_filter:"More filter options",minimize_filter:"Hide filter",reset_filter:"Set default values",print_statement_brief:"Brief",print_statement_standart:"Standard",print_statement_extended:"Extended",print_statement_extended_album:"Extended (landscape)",print_report:"Print report",print_debit_registry:"Debit list",print_credit_registry:"Credit list",print_debit_registry_title:"Print a debit list",print_credit_registry_title:"Print a credit list",export_title:"Select the directory for saving export file",export_report_types:"Comma-Separated Values file (*.csv)",export_client_bank:"Bank-Client",export_bmrs:"BMRS",export_ibis:"IBIS",export_csv:"Comma-Separated Values file (*.csv)",empty_list_header:"There are no operations that satisfy the filter conditions.",empty_list_msg:"Try searching the operations by other conditions.",footer_s_template_p1:"Balance: in. ",footer_s_template_p2:", out. ",footer_s_template_p3:". Total turnovers: debit ",footer_s_template_p4:", credit ",footer_s_template_p5:".",h_okpo:"EDRPOU",h_mfo:"MFO",h_acc:"Account",h_cur:"Currency",h_odate:"Operation date",h_code:"Operation code",h_bmfo:"Bank MFO",h_bname:"Bank name",h_kacc:"Correspondent's account",h_kokpo:"EDRPOU correspondent",h_korr:"Correspondent",h_dnum:"Document",h_ddate:"Document date",h_debt:"Debit",h_cred:"Credit",h_detail:"Payment details",h_uah:"Hryvnia coverage",h_amount:"Amount",h_client:"Client",show_docs:"Show list",h_corp_bmfo:"Correspondent's bank MFO",h_corp_bname:"Correspondent's bank name",h_corp_oper_date:"Transaction date",h_corp_oper_time:"Transaction time",h_corp_transaction_value_date:"Transaction/value date",h_corp_card:"Card number",h_corp_oper_amount:"Currency transaction amount",h_corp_oper_cur:"Transaction currency",h_corp_debt:"Debit",h_corp_cred:"Credit",h_corp_oper_desc:"Transaction description",h_corp_oper_type:"Transaction type",hide_docs:"Hide",recipient_success:"Correspondent has been successfully added to Correspondents Directory",recipient_exists:"This correspondent already exists in the reference",recipient_error:"Correspondent adding to directory error",invalid_recipient:"Invalid correspondent's data",no_overturns:"No turnovers for this period",export_result_title:"Export statement",export_element_title:"Operation No {1} for {2} by account {3}",export_error:"Error",export_error_text:'Invalid value in field "{1}"',export_warning_text:'Field value "{1}" is reduced to {2} characters',export_by_account:"of account <b>{1}</b>",export_by_several_account:"of several accounts",export_by_all_account:"of all accounts",export_success_csv:"Statement {1} for the period since <b>{2}</b> till <b>{3}</b> has been successfully exported to file <br/><b>{4}</b>",export_element_title_brms:"Export operations for {1} to file {2}",group_by_account:"Group by account",for_the_date:"for the date",all:"All",several_clients:"several clients",all_clients:"all clients",several_mfo:"MFO: {1}",no_uah_accs:"Unable to create a document. Current account in national currency is missing."}),define("apps/statement/nls/en/statement",["underscore","apps/statement/nls/en/statement_base"],function(a,b){return a.extend({},b)}),define("apps/statement/statement_ext_filter_view",["underscore","backbone","marionette","app","bifit","collections/thesaurus","appsPieces","commons/base_object/document/document_ext_filter_view","text!apps/statement/templates/statement_ext_filter.tmpl","i18n!apps/statement/nls/statement"],function(a,b,c,d,e,f,g,h,i,j){"use strict";var k=["oper_type","num_doc","amount_from","amount_to","payment_details","corr_name","corr_inn","corr_acc"],l=new b.Collection;return h.extend({template:a.template(i),templateHelpers:j,ui:a.defaults({oper_type:"#oper_type",num_doc:"#num_doc",amount_from:"#amount_from",amount_to:"#amount_to",payment_details:"#payment_details",corr_name:"#corr_name",corr_inn:"#corr_inn",corr_acc:"#corr_acc"},h.prototype.ui),events:{"blur @ui.amount_from":"validateFilterAmount","blur @ui.amount_to":"validateFilterAmount","blur @ui.corr_name":"onCorrespondentChanged","blur @ui.corr_inn":"onCorrespondentChanged","chosen:select @ui.oper_type":"onSelectOperType","chosen:select @ui.corr_name":"onCorrespondentSelected","chosen:select @ui.corr_inn":"onCorrespondentSelected","chosen:select @ui.corr_acc":"onCorrespondentAccountSelected"},initialize:function(){this.collection=l,h.prototype.initialize.call(this)},initForm:function(){this.initChosens(),this.fillRcptChosens(),this.addFormatters(),this.listenTo(d.mainLayout.content,"content:reloaded",this.highlightFoundText),this.on("decimal_length:changed",this.changeAmountDecimals)},initChosens:function(){var b=[{id:"0",text:j.no_filter},{id:"-1",text:j.debet},{id:"1",text:j.credit}];this.ui.oper_type.chosen({searchable:!1,data:{array:b,id:"id",text:"text"}}),a.each({corr_name:"name",corr_inn:"inn",corr_acc:"bill"},function(a,b){var c=this.ui[b];c.chosen({data:{id:"id",array:[],text:a}})}.bind(this))},fillRcptChosens:function(){var a=d.isMultiClient()?f.loadMultiClientThesaurus("ua_recipients"):f.loadClientThesaurus("ua_recipients");a.done(function(a){this.correspondents=a,this.fillCorrAccountsChosen(),this.fillCorrNameChosen(a),this.fillCorrInnChosen(a)}.bind(this))},fillCorrAccountsChosen:function(){if(this.correspondents.length)if(this.ui.corr_acc.val()&&this.ui.corr_name.val()&&this.ui.corr_inn.val()){var b=a.findWhere(this.correspondents,{name:this.ui.corr_name.val(),inn:this.ui.corr_inn.val()});b&&this.ui.corr_acc.trigger("refresh",{array:b.requisites})}else this.fillAllCorrAccountsChosen()},fillAllCorrAccountsChosen:function(){if(this.correspondents&&this.correspondents.length){var b=a.flatten(a.pluck(this.correspondents,"requisites"));this.ui.corr_acc.trigger("refresh",{array:b})}},fillCorrNameChosen:function(a){this.ui.corr_name.trigger("refresh",{array:a})},fillCorrInnChosen:function(a){this.ui.corr_inn.trigger("refresh",{array:a})},addFormatters:function(){this.ui.amount_from.formatter("amount"),this.ui.amount_to.formatter("amount"),this.ui.corr_inn.formatter("number"),this.ui.corr_acc.formatter("number")},collectAdditionalData:function(){var b=[];a.each(k,function(a){var c=this.getFilterValue(a);c&&(0!==a.indexOf("amount")||c>0)&&b.push({id:a,value:c,displayValue:this.getDisplayValue(a),label:j[a]})}.bind(this));var c=a.findWhere(b,{id:"amount_to"});return c&&a.findWhere(b,{id:"amount_from"})&&(c.label=j.to),b},restoreAdditionalFields:function(){a.each(a.without(k,"oper_type"),function(a){var b=this.collection.get(a),c=b?b.get("value"):"";this.ui[a].val(c),this.ui[a].change()}.bind(this)),this.restoreOperType()},getFilterValue:function(a){return"oper_type"===a?+this.operType||"":h.prototype.getFilterValue.call(this,a)},restoreOperType:function(){var a=this.collection.get("oper_type"),b=a?a.get("value"):"0";this.ui.oper_type.trigger("chooseById",b)},getAdditionalFilter:function(){var a={};return this.collection.each(function(b){var c=b.get("value");a[b.id]="oper_type"===b.id||0===b.id.indexOf("amount")?c:"*"+c+"*"}),a},validateFilterAmount:function(){this.isAmountValid()?b.Validation.callbacks.valid(null,"amount_from"):b.Validation.invalidField(this,"amount_from",j.amountError)},isAmountValid:function(){var a=+this.ui.amount_from.getUnformattedValue(),b=+this.ui.amount_to.getUnformattedValue();return!(b>0&&a>b)},hasAmountFields:function(){return!0},clearAmountFields:function(){this.ui.amount_from.val(""),this.ui.amount_to.val(""),b.Validation.callbacks.valid(null,"amount_from")},onSelectOperType:function(a,b){this.operType=b.id},onCorrespondentSelected:function(a,b){this.ui.corr_name.val(e.getContent(b,"name")).change(),this.ui.corr_acc.trigger("refresh",{array:b.requisites,value:e.getContent(b.requisites[0],"bill")}),this.ui.corr_inn.val(e.getContent(b,"inn")).change(),this.ui.payment_details.val(e.getContent(b.requisites[0],"comment"))},onCorrespondentAccountSelected:function(a,b){this.fillCorrFields(b)},fillCorrFields:function(a){var b=this.findCorrByRequisite(a);b&&(this.ui.corr_acc.trigger("refresh",{array:b.requisites,value:e.getContent(a,"bill")}),this.ui.corr_name.val(e.getContent(b,"name")),this.ui.corr_inn.val(e.getContent(b,"inn")),this.ui.payment_details.val(a.comment))},findCorrByRequisite:function(a){if(this.correspondents.length)for(var b,c=0;c<this.correspondents.length;c++){b=this.correspondents[c].requisites;for(var d=0;d<b.length;d++)if(b[d].id===a.id)return this.correspondents[c]}},onCorrespondentChanged:function(){this.ui.corr_name.val()||this.ui.corr_inn.val()||(this.ui.corr_acc.val(""),this.fillCorrAccountsChosen())},highlightFoundText:function(){var a=this.collection.get("num_doc");a&&g.highlightFoundText(a.get("value"),"td.doc-number");var b=this.collection.get("corr_name");b&&g.highlightFoundText(b.get("value"),"td.recipient");var c=this.collection.get("payment_details");c&&g.highlightFoundText(c.get("value"),"td.details")},setDefaults:function(){this.ui.oper_type.trigger("chooseById","0"),this.fillAllCorrAccountsChosen()},changeAmountDecimals:function(a){this.setFormattedAmount("amount_from",a),this.setFormattedAmount("amount_to",a)},setFormattedAmount:function(a,b){if(this.ui[a].formatter("amount",{decimallength:b}),this.ui[a].val()){var c=parseFloat(this.ui[a].getUnformattedValue()).toFixed(b);this.ui[a].val(c).trigger("paste")}},onBeforeDestroy:function(){this.ui.oper_type.disposeChosen(),this.ui.corr_name.disposeChosen(),this.ui.corr_inn.disposeChosen(),this.ui.corr_acc.disposeChosen()}})}),define("text!apps/statement/templates/statement_filter.tmpl",[],function(){return'<div class="toolbar-container">\n    <div class="form-group">\n        <h1 class="doc-type"><%- statements %></h1>\n        <span id="data_actual" class="period" style="display: none"></span>\n        <span id="last_op_date" class="period"></span>\n    </div>\n\n    <% if (typeof clientName !== \'undefined\') { %>\n    <div class="form-group">\n        <a id="client-name" href="#"><%- clientName %></a>\n    </div>\n    <% } %>\n    <div class="mfo">\n        <input type="text" id="mfo" placeholder="<%- h_mfo %>" autocomplete="off" maxlength="6"/>\n    </div>\n    <div class="accounts">\n        <input type=\'text\' id="accounts" placeholder="<%- h_acc %>" autocomplete="off" maxlength="14"/>\n    </div>\n    <div class="period-filter">\n        <span id="date_period_component"></span>\n        <span id="load_button_component"></span>\n    </div>\n    <div class="ext-filter-button minimized" data-toggle="tooltip" data-trigger="hover" data-placement="bottom"\n         data-trigger="hover" title="<%- expand_filter %>">&nbsp;</div>\n    <div class="ext-filter-clear-button" data-toggle="tooltip" data-trigger="hover" data-placement="bottom"\n         title="<%- reset_filter %>">&nbsp;</div>\n    <div class="ext-filter" id="ext_filter"></div>\n    <div class="checkbox" id="group_by_account_container">\n        <input id="group_by_account" type="checkbox" <% if (checkedGroupByAccount) { %>checked<% } %>>\n        <span class="checkbox"></span>\n        <label for="group_by_account"><%- group_by_account %></label>\n    </div>\n</div>\n'}),define("apps/statement/statement_filter_view",["underscore","collections/thesaurus","apps/overturns/overturns_filter_view","apps/statement/statement_ext_filter_view","text!apps/statement/templates/statement_filter.tmpl","i18n!apps/statement/nls/statement"],function(a,b,c,d,e,f){"use strict";return c.extend({initialize:function(b){c.prototype.initialize.call(this,b),this.templateHelpers=a.extend({},this.templateHelpers,f),this.on("reset",function(){this.ui.lastOperDateContainer.html(""),this.ui.dataActual.html("")})},template:a.template(e),docType:"statement",className:"filter overturn statement",ui:a.extend({expandExtFilterBtn:".ext-filter-button",clearExtFilterBtn:".ext-filter-clear-button",lastOperDateContainer:"#last_op_date"},c.prototype.ui),events:a.extend({"click .ext-filter-button":"handleExtFilterBtn"},c.prototype.events),regions:a.extend({extFilter:"#ext_filter"},c.prototype.regions),cache:{},onShow:function(){var b=this.initUi();this.listenTo(this.model,"sync",function(){this.showLastOpDate(),this.showActualDate()}),this.selectedMfo&&this.ui.mfo.trigger("choose",this.selectedMfo),a.isEmpty(b)||this.loadReport&&this.reload(),this.extFilterView.isExpanded&&this.toggleExtFilterView(),this.ui.tooltips.tooltip()},initExtFilter:function(){this.extFilterView=new d,this.extFilter.show(this.extFilterView),this.loadReport||this.extFilterView.resetFilter(),this.loadButtonView.listenTo(this.extFilterView,"filter:changed",this.loadButtonView.reload),this.ui.clearExtFilterBtn.on("click",this.extFilterView.resetFilter.bind(this.extFilterView)),this.listenTo(this.extFilterView,"filter:resized",this.trigger.bind(this,"filter:resized"))},initUi:function(){var a=c.prototype.initUi.call(this);return this.initExtFilter(),this.on("account_selection:changed",this.handleAccountSelection),this.handleAccountSelection(),a},showLastOpDate:function(){if(1===a.size(this.model.attributes)){var b=a.chain(this.model.attributes).values().first().value().LOD;this.ui.lastOperDateContainer.html(f.last_op+" "+(b||f.no_op))}else this.ui.lastOperDateContainer.html("")},handleExtFilterBtn:function(){return this.ui.expandExtFilterBtn.tooltip("show"),this.extFilterView.isExpanded&&(this.extFilterView.clearInvalidFields(),this.haveSelectedAccounts())?void this.loadButtonView.reload():void this.toggleExtFilterView()},toggleExtFilterView:function(){this.extFilterView.toggleMode(),this.extFilterView.isExpanded?(this.ui.expandExtFilterBtn.removeClass("minimized"),this.ui.expandExtFilterBtn.addClass("expanded"),this.ui.expandExtFilterBtn.attr("title",f.minimize_filter).tooltip("fixTitle")):(this.ui.expandExtFilterBtn.removeClass("expanded"),this.ui.expandExtFilterBtn.addClass("minimized"),this.ui.expandExtFilterBtn.attr("title",f.expand_filter).tooltip("fixTitle"))},reload:function(b){if(this.extFilterView.isExpanded){if(!this.extFilterView.isValidFilterData())return void this.onSyncEnd();this.toggleExtFilterView()}b=a.extend(b||{},this.extFilterView.getExtFilterData()),c.prototype.reload.call(this,b)},handleAccountSelection:function(){this.haveSelectedAccounts()&&this.extFilterView.trigger("decimal_length:changed",this.getMaxDecimalLength())},haveSelectedAccounts:function(){return!a.isEmpty(this.selectedAccountsIds)},getMaxDecimalLength:function(){var c=b.getThesaurus("currency").array;return a.reduce(this.getSelectedAccounts(),function(b,d){var e=a.findWhere(c,{currency:d.currency});return Math.max(b,e.decimals)},0)}})}),define("apps/statement/statement_report_model",["jquery","underscore","models/base_model","collections/thesaurus","bifit","i18n!apps/statement/nls/statement"],function(a,b,c,d,e,f){"use strict";return c.extend({name:"statementModel",idAttribute:"ACID",parse:function(a){var c,g=["CV","DV","IB","OB"];if(a.operations&&a.operations.length){for(var h=a.operations[0].CUR,i=b.findWhere(d.getThesaurus("currency").array,{currency:h})||{},j=i.decimals||2,k=0;k<g.length;k++)a[g[k]]=e.formatAmount(a[g[k]],{decimallength:j}),c=g[k]+"N",a[c]=e.formatAmount(a[c]);b.each(a.operations,function(c){c.D=e.formatAmount(c.D,{decimallength:j}),c.C=e.formatAmount(c.C,{decimallength:j}),c.RP=e.formatAmount(c.RP),c.id=b.uniqueId("operation"),c.ACID=a.ACID;var d=c.D;d?(c.amount=d,c.type=f.debet):(c.amount=c.C,c.type=f.credit)})}return a}})}),define("apps/statement/statement_collection",["jquery","underscore","bifit","backbone"],function(a,b,c,d){"use strict";var e=d.Collection.extend({model:d.Model.extend({}),initialize:function(a,b){this.sortedInfo=b.sortedInfo,this.isGroupByAccount=b.isGroupByAccount,this.fieldsOrder=this.isGroupByAccount?["OD","CUR","ND","CN","D","C"]:["OD","AC","CUR","ND","CN","D","C"]},getParseRuleForField:function(d){switch(d){case"ND":return function(b){if(!b)return-(1/0);var c=b.match(/(\d+|.+)/g),d=a.isNumeric(c[0])?c[0]+".":".";if(!a.isNumeric(c[0])||1!==c.length)for(var e=c.length-1,f=c[e].length,g=0;f>g;g++)d+=c[e].charCodeAt(g);return parseFloat(d)};case"amount":return function(a){return parseFloat((a||"0.00").split(" ").join(""))};case"OD":return function(a){return c.str2dateTime(a+":00").getTime()};default:return b.identity}},compareValues:function(a,b){return"string"==typeof a?a.localeCompare(b):b>a?-1:a>b?1:0},getValueForCompare:function(a,b){var c=this.getParseRuleForField(b);return"amount"===b?c(a.get("C"))||-c(a.get("D")):c(a.get(b))},compareFields:function(a,b,c){var d=this.getValueForCompare(b,a),e=this.getValueForCompare(c,a);return this.compareValues(d,e)},comparator:function(a,c){for(var d=this.sortedInfo.field,e=this.compareFields(d,a,c),f=b.without(this.fieldsOrder,d),g=0;g<f.length&&0===e;g++)d=f[g],e=this.compareFields(d,a,c);return"desc"===this.sortedInfo.order?-e:e}});return e}),define("text!apps/statement/templates/statement_list.tmpl",[],function(){return'<table class="list" id="statements">\n<thead class=\'widescreen\'>\n<tr>\n    <% if (typeof isSeveralClients !== "undefined" && isSeveralClients) { %>\n    <th class="cln_name">\n        <span class="sortable" data-field="cln_name"><%- h_client %></span>\n    </th>\n    <% } %>\n    <% if (typeof isSeveralMfo !== "undefined" && isSeveralMfo) { %>\n    <th class="mfo">\n        <span class="sortable" data-field="acc_mfo"><%- h_mfo %></span>\n    </th>\n    <% } %>\n    <% if(!isGroupByAccount && isMultiReport) { %>\n        <th class="account">\n            <span class="sortable" data-field="AC"><%- h_acc %></span>\n        </th>\n        <th class="account-cur">\n            <span class="sortable" data-field="CUR"><%- h_cur %></span>\n        </th>\n    <% } %>\n    <th class="doc-number">\n        <span class="sortable" data-field="ND"><%- h_dnum %></span>\n    </th>\n    <th class="date">\n        <span class="sortable" data-field="OD"><%- h_odate %></span>\n    </th>\n    <th class="recipient">\n        <span class="sortable" data-field="CN"><%- h_korr %></span>\n    </th>\n    <th class="amount">\n        <span class="sortable" data-field="amount"><%- h_amount %></span>\n    </th>\n    <th class="details">\n        <span class="sortable" data-field="NP"><%- np %></span>\n    </th>\n</tr>\n</thead>\n</table>\n'}),define("text!apps/statement/templates/statement_report_for_account.tmpl",[],function(){return'<% if(isGroupByAccount && isMultiReport) { %>\r\n<tr class="report-header">\r\n    <% reportHeaderTdClass = collapsed ? \'collapsed\' : \'\'%>\r\n    <td colspan="7"\r\n        data-toggle="collapse"\r\n        data-target="#<%- ACID %>"\r\n        aria-expanded="<%- collapsed %>"\r\n        class="<%- reportHeaderTdClass %>">\r\n        <% chevronArrow = collapsed ? \'right\' : \'down\'%>\r\n        <div class="chevron chevron-<%- chevronArrow %>">\r\n            <%- AC %>&nbsp;&nbsp;<%- CUR %>\r\n        </div>\r\n    </td>\r\n</tr>\r\n<tr class="nested-list">\r\n    <td colspan="7">\r\n        <% collapsedIn = collapsed ? \'\' : \'in\' %>\r\n        <div class="collapse <%- collapsedIn %>" id="<%- ACID %>">\r\n            <table class="list">\r\n                <tbody>\r\n                </tbody>\r\n                <tfoot>\r\n                <tr class="report-footer">\r\n                    <td colspan="7">\r\n                        <%- footer_s_template_p1 %><span class="amount"><%- IB %></span>\r\n                        <%- footer_s_template_p2 %><span class="amount"><%- OB %></span>\r\n                        <%- footer_s_template_p3 %><span class="amount"><%- DV %></span>\r\n                        <%- footer_s_template_p4 %><span class="amount"><%- CV %></span>\r\n                        <%- footer_s_template_p5 %>\r\n                    </td>\r\n                </tr>\r\n                </tfoot>\r\n            </table>\r\n        </div>\r\n    </td>\r\n</tr>\r\n<% } %>\r\n\r\n<% if(!isMultiReport) { %>\r\n<tr class="report-footer">\r\n    <td colspan="7">\r\n        <%- footer_s_template_p1 %><span class="amount"><%- IB %></span>\r\n        <%- footer_s_template_p2 %><span class="amount"><%- OB %></span>\r\n        <%- footer_s_template_p3 %><span class="amount"><%- DV %></span>\r\n        <%- footer_s_template_p4 %><span class="amount"><%- CV %></span>\r\n        <%- footer_s_template_p5 %>\r\n    </td>\r\n</tr>\r\n<% } %>\r\n'}),define("text!apps/statement/templates/statement_item.tmpl",[],function(){return'<%\naddclass = \'\';\nif (OC == \'I\') { addclass = \'info-doc\' };\n%>\n\n<% if (typeof isSeveralClients !== \'undefined\' && isSeveralClients) { %>\n<td class="<%- addclass %> cln_name widescreen ellipsis">\n    <div data-toggle="tooltip" data-placement="bottom" data-trigger="hover" title="<%- cln_name %>" class="ellipsis">\n        <%- cln_name %>\n    </div>\n</td>\n<% } %>\n<% if (typeof isSeveralMfo !== \'undefined\' && isSeveralMfo) { %>\n<td class="<%- addclass %> mfo widescreen">\n    <%- acc_mfo %>\n</td>\n<% } %>\n<% if ((typeof isGroupByAccount !=\'undefined\' && typeof isMultiReport !=\'undefined\' ) && !isGroupByAccount && isMultiReport) { %>\n<td class="<%- addclass %> account widescreen">\n    <%- AC %>\n</td>\n<td class="<%- addclass %> account-cur widescreen">\n    <%- CUR %>\n</td>\n<% } %>\n<td class="<%- addclass %> doc-number widescreen"><%- ND %></td>\n<td class="<%- addclass %> date widescreen"><%- OD %></td>\n<td class="<%- addclass %> recipient widescreen ellipsis">\n    <div data-toggle="tooltip" data-placement="bottom" data-trigger="hover" title="<%- CN %>" class="ellipsis">\n        <%- CN %>\n    </div>\n</td>\n<td class="<%- addclass %> amount <%- D ? \'debit\' : \'credit\' %> widescreen">\n    <%- D ? \'- \' + D : C %>\n</td>\n<td class="<%- addclass %> details widescreen ellipsis">\n    <div data-toggle="tooltip" data-placement="bottom" data-trigger="hover" title="<%- NP %>" class="ellipsis">\n        <%- NP %>\n    </div>\n</td>\n    <% if (contentAlign === "left") { %>\n        <% if (!isGroupByAccount && isMultiReport) { %>\n            <td colspan="9" class="<%- addclass %> mobile">\n        <% } else { %>\n            <td colspan="7" class="<%- addclass %> mobile">\n        <% } %>\n                <div class="info-doc-container">\n                    <div class="info-doc">\n                        <div class="date"><%- OD %></div>\n                        <% if  (typeof isMultiReport !=\'undefined\' && isMultiReport) { %>\n                            <div class="account"><%- AC %>&nbsp;<%- CUR %></div>\n                        <% } %>\n                        <div class="rcpt ellipsis"><%- CN %></div>\n                        <div class="amount"><%- type %>&nbsp;<%- D || C %></div>\n                        <div class="ellipsis"><%- NP %></div>\n                    </div>\n                </div>\n            </td>\n    <% } %>\n    <% if (contentAlign === "justify") { %>\n        <td colspan="7" class="<%- addclass %> mobile">\n            <span class="date statement"><%- OD %></span>\n            <span class="rcpt ellipsis"><%- CN %></span>\n            <% if (OT === "1") { %>\n                <span class="amount credit"><%- amount %> <%- CUR %></span>\n            <% } else { %>\n                <span class="amount debit"><%- amount %> <%- CUR %></span>\n            <% } %>\n        </td>\n    <% } %>\n'}),define("apps/statement/statement_report_view",["jquery","underscore","marionette","bifit","commons/base_object/base_list_view","apps/statement/statement_collection","text!apps/statement/templates/statement_list.tmpl","text!apps/statement/templates/statement_report_for_account.tmpl","text!apps/statement/templates/statement_item.tmpl","i18n!apps/statement/nls/statement"],function(a,b,c,d,e,f,g,h,i,j){"use strict";var k=c.ItemView.extend({initialize:function(a){this.templateHelpers=b.extend({},j,{isMultiReport:a.isMultiReport,isGroupByAccount:a.isGroupByAccount,formatter:d.formatAmount,contentAlign:"left",isSeveralClients:Boolean(a.isSeveralClients),isSeveralMfo:Boolean(a.isSeveralMfo)})},tagName:"tr",template:b.template(i),triggers:{click:"selectStatement"},onShow:function(){this.$el.find('[data-toggle="tooltip"]').tooltip({template:'<div class="tooltip" role="tooltip"><div class="tooltip-inner"></div></div>'}),this.$el[0].rowIndex%2===0?this.$el.addClass("even"):this.$el.addClass("odd")},attachElContent:function(a){return this.el.innerHTML=a,this}}),l=c.CompositeView.extend({initialize:function(a){this.isMultiReport=a.isMultiReport,this.isGroupByAccount=a.isGroupByAccount,this.isSeveralClients=a.isSeveralClients,this.isSeveralMfo=a.isSeveralMfo,this.collapsed=!1,this.collection=new f(this.model.get("operations"),{sort:!0,sortedInfo:a.sortedInfo,isGroupByAccount:a.isGroupByAccount}),this.templateHelpers=b.extend({},j,{isMultiReport:a.isMultiReport,isGroupByAccount:a.isGroupByAccount,isSeveralClients:this.isSeveralClients,isSeveralMfo:this.isSeveralMfo})},tagName:"tbody",template:b.template(h),childView:k,childEvents:{selectStatement:"selectStatement"},events:{"click [data-toggle=collapse]":"onToggleEvents"},onBeforeRender:function(){b.extend(this.templateHelpers,{collapsed:this.collapsed})},onToggleEvents:function(){this.collapsed=!this.collapsed,this.$el.find(".chevron").toggleClass("chevron-right").toggleClass("chevron-down")},childViewOptions:function(){return{isMultiReport:this.isMultiReport,isGroupByAccount:this.isGroupByAccount,isSeveralClients:this.isSeveralClients,isSeveralMfo:this.isSeveralMfo}},attachBuffer:function(a,b){if(this.isGroupByAccount&&this.isMultiReport){var c=a.$el.find("tbody");c.append("<tr></tr>"),c.append(b)}else a.$el.append(b)},selectStatement:function(a,b){this.trigger("selectStatement",b)},sortCollection:function(b,c){return this.sortDeferred=a.Deferred(),this.collection.sortedInfo.field=b,this.collection.sortedInfo.order=c,this.collection.sort(),this.sortDeferred},_sortViews:function(){c.CompositeView.prototype._sortViews.call(this),this.sortDeferred.resolve(!0)}});return c.CompositeView.extend({initialize:function(a){this.isMultiReport=a.isMultiReport,this.isGroupByAccount=a.isGroupByAccount,this.isSeveralClients=Boolean(a.isSeveralClients),this.isSeveralMfo=Boolean(a.isSeveralMfo),this.templateHelpers=b.extend({},j,{isMultiReport:a.isMultiReport,isGroupByAccount:a.isGroupByAccount,isSeveralClients:this.isSeveralClients,isSeveralMfo:this.isSeveralMfo})},className:"statements-report",template:b.template(g),childView:l,sortedInfo:{field:"OD",order:"desc"},behaviors:{SortableTableBehavior:{},StaticReportElementBehavior:{staticFooter:"tr.report-footer"}},ui:{header:"thead"},childViewOptions:function(){return{isMultiReport:this.isMultiReport,isGroupByAccount:this.isGroupByAccount,sortedInfo:this.getSortedInfo(),isSeveralClients:this.isSeveralClients,isSeveralMfo:this.isSeveralMfo}},childEvents:{selectStatement:"selectStatement"},selectStatement:function(a,b){this.trigger("selectStatement",b.model)},attachBuffer:function(a,b){this.ui.header.after(b)},getSortedInfo:function(){return this.sortedInfo},isFixedFooter:function(){return!this.isMultiReport},sortCollection:function(b,c){this.sortedInfo.field=b,this.sortedInfo.order=c;var d=this.children.invoke("sortCollection",b,c);return a.when.apply(a,d)}})}),define("text!apps/statement/templates/print_statement_report_header.tmpl",[],function(){return'<div class="bold-text header">\r\n    <%- BNK_NAME %> <%- CITY %>, код банку <%- MFO %> <br>\r\n    <%- CLN_NAME %>, ЄДРПОУ <%- CLN_OKPO %> <br>\r\n    Виписка по рахунку N <span class="statements-normal-text"><%- ACCOUNT_NUMBER %></span> з\r\n    <span class="statements-normal-text"><%- BD %></span> до <span class="statements-normal-text"><%- ED %></span>\r\n    <% if(withExtendFilter) {%> <span class="statements-normal-text">(вик. фільтр)</span><% } %><br>\r\n    Валюта рахунка: <span class="statements-normal-text"><%- ACCOUNT_CUR %></span><br>\r\n    <% if(!withExtendFilter) {%>\r\n    Дата попередньої операції: <span class="statements-normal-text"><%- LAST_OPER_DATE%></span><br>\r\n    <div class="inline-block">\r\n        Вхідний залишок:<span class="statements-normal-text">&nbsp;<%- IN_REMAINDER %><% if(!isUAH && !isBrief) {%>&nbsp;&nbsp;&nbsp;еквівалент:&nbsp;<%- IN_REMAINDER_UAH %><% } %></span>\r\n    </div>\r\n    <% } %>\r\n</div>\r\n\r\n\r\n';
}),define("text!apps/statement/templates/print_statement_table_standart.tmpl",[],function(){return'<%\r\n    rowspan = \'\';\r\n    addclass = \'\';\r\n    if (typeof isUAH != \'undefined\' && isUAH) {\r\n        rowspan = \'rowspan=2\';\r\n        addclass = \'uah\';\r\n    };\r\n    if (typeof isBudget != \'undefined\' && isBudget) {\r\n        addclass = \'budget-payment\';\r\n    };\r\n%>\r\n\r\n<table class="bordered" width="719px">\r\n    <tbody>\r\n        <% if(isBudget) {%>\r\n            <colgroup>\r\n                <col width="74px">\r\n                <col width="51px">\r\n                <col width="108px">\r\n                <col width="108px">\r\n                <col width="59px">\r\n                <col width="110px">\r\n                <col width="107px">\r\n                <col width="103px">\r\n            </colgroup>\r\n        <% } else if (isUAH) { %>\r\n            <colgroup>\r\n                <col width="74px">\r\n                <col width="51px">\r\n                <col width="108px">\r\n                <col width="108px">\r\n                <col width="59px">\r\n                <col width="160px">\r\n                <col width="160px">\r\n            </colgroup>\r\n        <% } else { %>\r\n            <colgroup>\r\n                <col width="74px">\r\n                <col width="108px">\r\n                <col width="108px">\r\n                <col width="108px">\r\n                <col width="161px">\r\n                <col width="161px">\r\n            </colgroup>\r\n        <% } %>\r\n\r\n        <tr class="header">\r\n\r\n            <td class="centered bold-text date-time <%- addclass %>" <%- rowspan %>>\r\n                <% if(typeof isFutureOperation !=\'undefined\' && isFutureOperation) {%>\r\n                    Дата валют.\r\n                <% } else { %>\r\n                    Дата опер.\r\n                <% } %>\r\n            </td>\r\n\r\n            <% if(isUAH) {%>\r\n                <td class="centered bold-text doc-num fix-wrap <%- addclass %>" <%- rowspan %>>Номер док.</td>\r\n            <% } %>\r\n\r\n            <td class="centered bold-text amount <%- addclass %>" <%- rowspan %>>Дебет</td>\r\n            <td class="centered bold-text amount <%- addclass %>" <%- rowspan %>>Кредит</td>\r\n\r\n            <% if(isUAH) {%>\r\n               <td class="centered bold-text correspondent-info <%- addclass %>" colspan="2">Реквізити кореспондента</td>\r\n            <% } else { %>\r\n               <td class="centered bold-text amount <%- addclass %>">Гривневе покриття</td>\r\n               <td class="centered bold-text correspondent <%- addclass %>">Найменування кореспондента</td>\r\n            <% } %>\r\n\r\n            <td class="centered bold-text payment-details <%- addclass %>" <%- rowspan %>>Призначення платежу</td>\r\n\r\n            <% if(isBudget) {%>\r\n                <td class="centered bold-text budget-code" <%- rowspan %>>Стаття витрат</td>\r\n            <% } %>\r\n\r\n        </tr>\r\n\r\n        <% if(isUAH) {%>\r\n            <tr class="header">\r\n                <td class="centered bold-text bank-code <%- addclass %>">Код банку</td>\r\n                <td class="centered bold-text correspondent <%- addclass %>">Найменування</td>\r\n            </tr>\r\n        <% } %>\r\n    </tbody>\r\n\r\n    <tbody></tbody>\r\n\r\n</table>'}),define("text!apps/statement/templates/print_statement_table_extended.tmpl",[],function(){return'<%\n    rowspan = \'\';\n    addclass = \'\';\n    if (typeof isUAH != \'undefined\' && isUAH) {\n        rowspan = \'rowspan=2\';\n        addclass = \'uah\';\n    };\n    if (typeof isBudget != \'undefined\' && isBudget) {\n        addclass = \'budget-payment\';\n    };\n%>\n\n<table class="bordered">\n    <tbody>\n        <tr>\n            <td class="centered bold-text date-time" <%- rowspan %>>\n                <% if(typeof isFutureOperation !=\'undefined\' && isFutureOperation) {%>\n                    Дата валют.\n                <% } else { %>\n                    Дата опер.\n                <% } %>\n            </td>\n\n            <% if(isUAH) {%>\n                <td class="centered bold-text doc-num fix-wrap" rowspan="2">Номер док.</td>\n            <% } %>\n\n            <td class="centered bold-text amount <%- addclass %>" <%- rowspan %>>Дебет</td>\n            <td class="centered bold-text amount <%- addclass %>" <%- rowspan %>>Кредит</td>\n\n            <% if(isUAH) {%>\n                <td class="centered bold-text" colspan="2">Реквізити кореспондента</td>\n            <% } else { %>\n                <td class="centered bold-text amount <%- addclass %>">Гривневе покриття</td>\n                <td class="centered bold-text correspondent <%- addclass %>">Реквізити кореспондента</td>\n            <% } %>\n\n            <td class="centered bold-text payment-details <%- addclass %>" <%- rowspan %>>Призначення платежу</td>\n\n            <% if(isBudget) {%>\n                <td class="centered bold-text budget-code" rowspan="2">Стаття витрат</td>\n            <% } %>\n        </tr>\n\n        <tr>\n            <% if(isUAH) {%>\n                <td class="centered bold-text bank-info <%- addclass %>">Банк</td>\n                <td class="centered bold-text correspondent <%- addclass %>">Найменування</td>\n            <% } %>\n        </tr>\n    </tbody>\n\n    <tbody></tbody>\n\n</table>'}),define("text!apps/statement/templates/print_statement_table_brief.tmpl",[],function(){return'<%\n    addclass = \'\';\n    if (typeof isUAH != \'undefined\' && isUAH) {\n        addclass = \'uah\';\n    }\n%>\n<table class="bordered" width="719px">\n    <tbody>\n        <% if(isUAH) {%>\n            <colgroup>\n                <col width="74px">\n                <col width="51px">\n                <col width="108px">\n                <col width="108px">\n                <col width="59px">\n                <col width="120px">\n                <col width="200px">\n            </colgroup>\n        <% } else { %>\n            <colgroup>\n                <col width="74px">\n                <col width="51px">\n                <col width="108px">\n                <col width="108px">\n                <col width="120px">\n                <col width="259px">\n            </colgroup>\n        <% } %>\n\n        <tr class="header">\n            <td class="centered bold-text date-time" rowspan="2">\n                <% if(typeof isFutureOperation !=\'undefined\' && isFutureOperation) {%>\n                Дата валют.\n                <% } else { %>\n                Дата опер.\n                <% } %>\n            </td>\n            <td class="centered bold-text doc-num fix-wrap <%- addclass %>" rowspan="2">Номер док.</td>\n            <td class="centered bold-text amount <%- addclass %>" rowspan="2">Дебет</td>\n            <td class="centered bold-text amount <%- addclass %>" rowspan="2">Кредит</td>\n\n            <% if(isUAH) {%>\n            <td class="centered bold-text" colspan="3">Реквізити кореспондента</td>\n            <% } else { %>\n            <td class="centered bold-text" colspan="2">Реквізити кореспондента</td>\n            <% } %>\n        </tr>\n\n        <tr class="header">\n            <% if(isUAH) {%>\n            <td class="centered bold-text bank-code uah">Код банку</td>\n            <td class="centered bold-text account uah">Рахунок</td>\n            <td class="centered bold-text correspondent uah">Найменування</td>\n            <% } else { %>\n            <td class="centered bold-text account">Рахунок</td>\n            <td class="centered bold-text correspondent">Найменування</td>\n            <% } %>\n        </tr>\n    </tbody>\n\n    <tbody></tbody>\n\n</table>'}),define("text!apps/statement/templates/print_statement_item_standart.tmpl",[],function(){return'<%\r\n    addclass = \'\';\r\n    if (typeof isUAH != \'undefined\' && isUAH) { addclass = \'uah\' };\r\n    if (typeof isBudget != \'undefined\' && isBudget) { addclass = \'budget-payment\' };\r\n%>\r\n\r\n<tr>\r\n    <td valign="top" class="centered date-time <%- addclass %>">\r\n        <% if(OC === \'I\') {%>\r\n        <%- VD %>\r\n        <% } else { %>\r\n        <%- OD %>\r\n        <% } %>\r\n    </td>\r\n    <% if(isUAH) {%>\r\n        <td valign="top" class="centered doc-num <%- addclass %>"><%- ND %></td>\r\n    <% } %>\r\n    <td valign="top" class="amount onright <%- addclass %>"><% if (typeof D !=\'undefined\' && D) { %><%- D %><% } %></td>\r\n    <td valign="top" class="amount onright <%- addclass %>"><% if (typeof C !=\'undefined\' && C) { %><%- C %><% } %></td>\r\n\r\n    <% if(isUAH) {%>\r\n        <td valign="top" class="bank-code <%- addclass %>"><%- CBB %></td>\r\n        <td valign="top" class="correspondent <%- addclass %>">\r\n            <div>ЄДРПОУ: </div>\r\n            <div><%- CI %></div>\r\n            <div>Рахунок: </div>\r\n            <div><%- CA %> <%- CN %></div>\r\n        </td>\r\n        <td valign="top" class="payment-details <%- addclass %>"><%- NP %></td>\r\n    <% } else { %>\r\n        <td valign="top" class="centered amount onright <%- addclass %>"><%- RP %></td>\r\n        <td valign="top" class="correspondent <%- addclass %>">\r\n            <div>Рахунок: </div>\r\n            <div><%- CA %></div>\r\n            <div>ЄДРПОУ: <%- CI %></div>\r\n            <div><%- CN %></div>\r\n        </td>\r\n        <td valign="top" class="payment-details <%- addclass %>">\r\n            <div>Номер док-та: <%- ND %></div>\r\n            <div><%- NP %></div>\r\n        </td>\r\n    <% } %>\r\n\r\n    <% if(isBudget) {%>\r\n        <td valign="top" class="centered bold-text budget-code <%- addclass %>"><%- BC %></td>\r\n    <% } %>\r\n</tr>\r\n'}),define("text!apps/statement/templates/print_statement_item_extended.tmpl",[],function(){return'<%\n    addclass = \'\';\n    if (typeof isUAH != \'undefined\' && isUAH) {\n        addclass = \'uah\';\n    };\n    if (typeof isBudget != \'undefined\' && isBudget) {\n        addclass = \'budget-payment\';\n    };\n%>\n<tr>\n    <td valign="top" class="centered date-time">\n        <% if(OC === \'I\') {%>\n        <%- VD %>\n        <% } else { %>\n        <%- OD %>\n        <% } %>\n    </td>\n    <% if(isUAH) {%>\n    <td valign="top" class="centered doc-num"><%- ND %></td>\n    <% } %>\n    <td valign="top" class="amount onright <%- addclass %>"><% if (typeof D !=\'undefined\' && D) { %><%- D %><% } %></td>\n    <td valign="top" class="amount onright <%- addclass %>"><% if (typeof C !=\'undefined\' && C) { %><%- C %><% } %></td>\n\n    <% if(isUAH) {%>\n    <td valign="top" class="bank-info <%- addclass %>">\n        <% if (typeof CBB !=\'undefined\' && CBB) { %>Код банку <%- CBB %><br><% } %>\n        <% if (typeof CBN !=\'undefined\' && CBN) { %> <%- CBN %><% } %>\n    </td>\n    <td valign="top" class="correspondent <%- addclass %>">ЄДРПОУ <%- CI %><br>Рахунок <%- CA %> <br><%- CN %></td>\n    <td valign="top" class="payment-details <%- addclass %>"><%- NP %></td>\n    <% } else { %>\n    <td valign="top" class="centered amount onright <%- addclass %>"><%- RP %></td>\n    <td valign="top" class="correspondent <%- addclass %>">\n        <% if (typeof CBN !=\'undefined\' && CBN) { %><%- CBN %><% } %>\n        <% if (typeof CBB !=\'undefined\' && CBB) { %>, код банку <%- CBB %><% } %>\n        <br>\n        Рахунок <%- CA %><br>ЄДРПОУ <%- CI %><br><%- CN %>\n    </td>\n    <td valign="top" class="payment-details <%- addclass %>">Номер док-та: <%- ND %><br><%- NP %></td>\n    <% } %>\n\n    <% if(isBudget) {%>\n    <td valign="top" class="centered bold-text budget-code"><%- BC %></td>\n    <% } %>\n</tr>\n'}),define("text!apps/statement/templates/print_statement_item_brief.tmpl",[],function(){return'<%\n    addclass = \'\';\n    if (typeof isUAH != \'undefined\' && isUAH) {\n        addclass = \'uah\';\n    }\n%>\n<tr>\n    <td valign="top" class="centered date-time">\n        <% if(OC === \'I\') {%>\n        <%- VD %>\n        <% } else { %>\n        <%- OD %>\n        <% } %>\n    </td>\n\n    <td valign="top" class="centered doc-num <%- addclass %>"><%- ND %></td>\n    <td valign="top" class="amount onright <%- addclass %>"><% if (typeof D !=\'undefined\' && D) { %><%- D %><% } %></td>\n    <td valign="top" class="amount onright <%- addclass %>"><% if (typeof C !=\'undefined\' && C) { %><%- C %><% } %></td>\n\n    <% if(isUAH) {%>\n    <td valign="top" class="bank-code uah"><%- CBB %></td>\n    <td valign="top" class="account uah"><%- CA %></td>\n    <td valign="top" class="correspondent uah"><%- CN %></td>\n    <% } else { %>\n    <td valign="top" class="account"><%- CA %></td>\n    <td valign="top" class="correspondent"><%- CN %></td>\n    <% } %>\n</tr>\n'}),define("text!apps/statement/templates/print_statement_table_footer.tmpl",[],function(){return'<%\r\n    addclass = \'\';\r\n    if (typeof isUAH != \'undefined\' && isUAH) { addclass = \'uah\' };\r\n%>\r\n\r\n<table class="table-footer <%- addclass %>">\r\n    <tr>\r\n        <td class="first-column">\r\n            <table>\r\n                <tr>\r\n                    <td class="bold-text total-text"><%- firstLineText %></td>\r\n                    <td class="amount onright"><%- debit %></td>\r\n                    <td class="amount onright"><%- credit %></td>\r\n                </tr>\r\n            </table>\r\n            <% if (!withExtendFilter && typeof remainder != \'undefined\' && remainder) { %>\r\n            <table>\r\n                <tr>\r\n                    <td class="bold-text second-line-text"><%- secondLineText %></td>\r\n                    <td class="remainder"><%- remainder %></td>\r\n                </tr>\r\n            </table>\r\n            <% } %>\r\n        </td>\r\n        <td class="second-column">\r\n            <% if (!isUAH && !isBrief) { %>\r\n                <table>\r\n                    <tr>\r\n                        <td class="equivalent">еквiвалент: <%- debitUa %></td>\r\n                        <td class="credit-ua"><%- creditUa %></td>\r\n                    </tr>\r\n                </table>\r\n                <% if (!withExtendFilter && typeof remainderUa != \'undefined\' && remainderUa) { %>\r\n                    <table>\r\n                        <tr>\r\n                            <td  width="436px" class="equivalent"> еквiвалент: <%- remainderUa %> </td>\r\n                        </tr>\r\n                    </table>\r\n                <% } %>\r\n            <% } %>\r\n        </td>\r\n    </tr>\r\n</table>\r\n'}),define("text!apps/statement/templates/print_statement_report_footer.tmpl",[],function(){return'<div class="report-footer">\r\n    <table class="report-footer-table">\r\n        <tr>\r\n            <td class="autograph-column"></td>\r\n            <td class="stamp-column">\r\n                <div class="inline-block stamp-place">\r\n                </div>\r\n            </td>\r\n        </tr>\r\n    </table>\r\n    <div class="for-img"></div>\r\n</div>\r\n'}),define("text!apps/statement/templates/print_statement_report_autograph.tmpl",[],function(){return'<table class="autograph-place">\r\n    <tr>\r\n        <td class="m-p-block bold-text" rowspan="2">М. П.</td>\r\n        <td class="autograph-label bold-text">Керівник</td>\r\n        <td class="autograph"></td>\r\n    </tr>\r\n    <tr>\r\n        <td class="autograph-label bold-text">Бухгалтер</td>\r\n        <td class="autograph"></td>\r\n    </tr>\r\n</table>'}),define("text!apps/statement/templates/print_statement_pdf.tmpl",[],function(){return'<html>\r\n<head>\r\n    <style>\r\n        div.statements {\r\n            padding-left: 10px;\r\n            page-break-after: always;\r\n        }\r\n\r\n        div.statements div.header {\r\n            line-height: 1.3;\r\n            font-size: 10pt;\r\n        }\r\n\r\n        div.statements, div.statements td, div.statements th {\r\n            font-family: \'Times Roman\', \'Times New Roman\', Georgia, serif;\r\n            font-size: 13.1px;\r\n            position: relative;\r\n            line-height: 1;\r\n        }\r\n\r\n        div.statements table {\r\n            border-collapse: collapse;\r\n            border-spacing: 0;\r\n            border-top: 1px solid black;\r\n            border-left: 1px solid black;\r\n            width: 719px;\r\n            margin-top: 5px;\r\n        }\r\n\r\n        div.statements table td {\r\n            border-collapse: collapse;\r\n            border-spacing: 0;\r\n            border-right: 1px solid black;\r\n            border-bottom: 1px solid black;\r\n            padding: 6px 5px;\r\n        }\r\n\r\n        div.statements .bold-text {\r\n            font-weight: bold;\r\n        }\r\n\r\n        div.statements .statements-normal-text {\r\n            font-weight: normal;\r\n        }\r\n\r\n        div.statements .centered {\r\n            text-align: center;\r\n        }\r\n\r\n        div.statements .onright {\r\n            text-align: right;\r\n        }\r\n\r\n        div.statements .page-number {\r\n            font-size: 8pt;\r\n            text-align: right;\r\n            padding: 0 10px 0 0;\r\n        }\r\n\r\n\r\n        /* для всех таблиц отчета START */\r\n        div.statements table td.date-time {\r\n            width: 64px;\r\n        }\r\n\r\n        div.statements td.doc-num {\r\n            width: 38px;\r\n            padding: 5px 8px;\r\n        }\r\n\r\n        div.statements table td.amount {\r\n            width: 98px;\r\n        }\r\n\r\n        div.statements td.bank-code {\r\n            width: 49px;\r\n        }\r\n\r\n        div.statements td.budget-code {\r\n            width: 93px;\r\n        }\r\n\r\n        div.statements table td.correspondent,\r\n        div.statements table td.payment-details {\r\n            width: 151px;\r\n        }\r\n\r\n        div.statements table td.correspondent.uah,\r\n        div.statements table td.payment-details.uah {\r\n            width: 150px;\r\n        }\r\n\r\n        div.statements table td.correspondent.budget-payment {\r\n            width: 100px;\r\n        }\r\n\r\n        div.statements table td.payment-details.budget-payment {\r\n            width: 97px;\r\n        }\r\n        /* для всех таблиц отчета END */\r\n\r\n\r\n        /* Футер таблицы START */\r\n        div.statements table.table-footer td.total-text {\r\n            width: 69px;\r\n        }\r\n\r\n        div.statements table.table-footer td.amount {\r\n            width: 103px;\r\n        }\r\n\r\n        div.statements table.table-footer td.first-column {\r\n            width: 290px;\r\n        }\r\n\r\n        div.statements table.table-footer td.second-column {\r\n            width: 429px;\r\n        }\r\n\r\n        div.statements table.table-footer td.second-line-text {\r\n            width: 145px;\r\n        }\r\n\r\n        div.statements table.table-footer td.remainder {\r\n            width: 145px;\r\n        }\r\n\r\n        div.statements table.table-footer table td.equivalent {\r\n            padding-left: 65px;\r\n            width: 210px;\r\n        }\r\n\r\n        div.statements table.table-footer.uah td.total-text {\r\n            width: 120px;\r\n        }\r\n\r\n        div.statements table.table-footer.uah td.first-column {\r\n            width: 341px;\r\n        }\r\n\r\n        div.statements table.table-footer.uah td.second-column {\r\n            width: 378px;\r\n        }\r\n\r\n        div.statements table.table-footer.uah td.remainder {\r\n            width: 196px;\r\n        }\r\n\r\n        div.statements table.table-footer.uah table td.equivalent {\r\n            width: 159px;\r\n        }\r\n\r\n        div.statements table.table-footer td.credit-ua {\r\n            width: 220px;\r\n        }\r\n\r\n        div.statements table.table-footer td {\r\n            border-right: 0;\r\n            border-bottom: 0;\r\n            padding: 2px 0 5px 0;\r\n        }\r\n\r\n        div.statements table.table-footer td.first-column table td {\r\n            padding-right: 5px;\r\n        }\r\n\r\n        div.statements table.table-footer,\r\n        div.statements table.table-footer tr td table {\r\n            border-top: 0;\r\n            border-left: 0;\r\n        }\r\n\r\n        div.statements table.table-footer table {\r\n            margin: 0;\r\n        }\r\n\r\n        div.statements table.table-footer {\r\n            margin: 0 0 10px 0;\r\n        }\r\n        /* Футер таблицы END */\r\n\r\n\r\n        /* для формата печати "Сокращенная" START*/\r\n        div.statements.brief table.bordered td {\r\n            padding: 6px 5px 5px 5px;\r\n        }\r\n\r\n        div.statements.brief table td.account {\r\n            width: 110px;\r\n        }\r\n\r\n        div.statements.brief table td.correspondent {\r\n            width: 249px;\r\n        }\r\n\r\n        div.statements.brief table td.correspondent.uah {\r\n            width: 190px;\r\n        }\r\n\r\n        div.statements.brief table.table-footer td.first-column {\r\n            width: 341px;\r\n        }\r\n\r\n        div.statements.brief table.table-footer td.second-column {\r\n            width: 378px;\r\n        }\r\n\r\n        div.statements.brief table.table-footer td.total-text {\r\n            width: 120px;\r\n        }\r\n\r\n        div.statements.brief table.table-footer td.remainder {\r\n            width: 201px;\r\n        }\r\n\r\n        div.statements.brief table.table-footer.uah td.remainder {\r\n            width: 196px;\r\n        }\r\n        /* для формата печати "Сокращенная" END*/\r\n\r\n\r\n        /* для формата печати "Расширенная" START*/\r\n        div.statements.extended table td.budget-code,\r\n        div.statements.extended table td.amount.budget-payment,\r\n        div.statements.budget.extended table.table-footer td.amount {\r\n            width: 85px;\r\n        }\r\n\r\n        div.statements.extended table td.bank-info.budget-payment {\r\n            width: 92px;\r\n        }\r\n\r\n        div.statements.extended table td.payment-details.budget-payment,\r\n        div.statements.extended table td.correspondent.budget-payment {\r\n            width: 93px;\r\n        }\r\n\r\n        div.statements.extended table td.bank-info.uah {\r\n            width: 115px;\r\n        }\r\n\r\n        div.statements.extended table td.payment-details.uah,\r\n        div.statements.extended table td.correspondent.uah {\r\n            width: 116px;\r\n        }\r\n\r\n        div.statements.budget.extended table.table-footer td.first-column {\r\n            width: 315px;\r\n        }\r\n\r\n        div.statements.budget.extended table.table-footer td.second-column {\r\n            width: 404px;\r\n        }\r\n        /* для формата печати "Расширенная" END*/\r\n\r\n\r\n        /* для формата печати "Расширенная" альбомная START*/\r\n        div.statements.extended.album table,\r\n        div.statements.extended.album table.table-footer {\r\n            width: 99%;\r\n        }\r\n\r\n        div.statements.extended.album table td.amount {\r\n            width: 100px;\r\n        }\r\n\r\n        div.statements.extended.album table td.correspondent {\r\n            width: 217px;\r\n        }\r\n\r\n        div.statements.extended.album table td.payment-details {\r\n            width: 406px;\r\n        }\r\n\r\n        div.statements.extended.album table td.correspondent.uah,\r\n        div.statements.extended.album table td.bank-info.uah,\r\n        div.statements.extended.album table td.payment-details.uah {\r\n            width: 224px;\r\n        }\r\n\r\n        div.statements.budget.extended.album table td.correspondent,\r\n        div.statements.budget.extended.album table td.bank-info {\r\n            width: 167px;\r\n        }\r\n\r\n        div.statements.budget.extended.album table td.payment-details {\r\n            width: 168px;\r\n        }\r\n\r\n        div.statements.budget.extended.album table td.budget-code {\r\n            width: 160px;\r\n        }\r\n\r\n        div.statements.extended.album table.table-footer td.first-column {\r\n            width: 299px;\r\n        }\r\n\r\n        div.statements.extended.album table.table-footer td.second-column {\r\n            width: 749px;\r\n        }\r\n\r\n        div.statements.extended.album table.table-footer td.amount {\r\n            width: 105px;\r\n        }\r\n\r\n        div.statements.extended.album table.table-footer.uah td.first-column {\r\n            width: 350px;\r\n        }\r\n\r\n        div.statements.extended.album table.table-footer.uah td.second-column {\r\n            width: 698px;\r\n        }\r\n\r\n        div.statements.extended.album table.table-footer td.equivalent {\r\n            width: 225px;\r\n        }\r\n\r\n        div.statements.extended.album table.table-footer td.credit-ua {\r\n            width: 528px;\r\n        }\r\n        /* для формата печати "Расширенная" альбомная END*/\r\n\r\n\r\n        /* Футер отчета START */\r\n        div.statements .report-footer-table td.stamp-column {\r\n            height: 169px;\r\n        }\r\n\r\n        div.statements .report-footer table,\r\n        div.statements .report-footer table td {\r\n            border-width: 0;\r\n        }\r\n\r\n        div.statements .report-footer table td.autograph-column {\r\n            width: 430px;\r\n        }\r\n\r\n        div.statements .report-footer table td.stamp-column {\r\n            width: 270px;\r\n            padding-left: 60px;\r\n        }\r\n\r\n        div.statements .report-footer table.autograph-place {\r\n            width: 450px;\r\n            border-width: 0;\r\n            margin-bottom: 50px;\r\n        }\r\n\r\n        div.statements .report-footer table.autograph-place td {\r\n            font-size: 11pt;\r\n            padding: 30px 0 0 0;\r\n            border-width: 0;\r\n        }\r\n\r\n        div.statements .report-footer table.autograph-place td.m-p-block {\r\n            width: 140px;\r\n            text-align: center;\r\n        }\r\n\r\n        div.statements .report-footer table.autograph-place td.autograph-label {\r\n            width: 100px;\r\n        }\r\n\r\n        div.statements .report-footer table.autograph-place td.autograph {\r\n            border-bottom: 1px solid black;\r\n            width: 210px;\r\n        }\r\n\r\n        div.statements .report-footer div.for-img {\r\n            padding-right: 10px;\r\n            float: right;\r\n        }\r\n        /* Футер отчета END */\r\n\r\n    </style>\r\n</head>\r\n<body>\r\n    <%= content_for_pdf %>\r\n</body>\r\n</html>\r\n'}),define("text!apps/statement/templates/print_statement_style.tmpl",[],function(){return'<style>\r\n    section.doc-print div.statements {\r\n        position: relative;\r\n        font-size: 12pt;\r\n        line-height: 1;\r\n    }\r\n\r\n    section.doc-print div.inline-block {\r\n        display: inline-block;\r\n    }\r\n\r\n    section.doc-print div.statements table {\r\n        border-collapse: collapse;\r\n    }\r\n\r\n    section.doc-print table td {\r\n        word-wrap: break-word;\r\n        -ms-word-wrap: break-word;\r\n        overflow-wrap: break-word;\r\n    }\r\n\r\n    section.doc-print div.statements table {\r\n        margin-top: 10px;\r\n        table-layout: fixed\r\n    }\r\n\r\n    section.doc-print article div.statements div.header {\r\n        line-height: 1.3;\r\n        font-size: 10pt;\r\n        padding-top: 5px;\r\n    }\r\n\r\n    section.doc-print div span.statements-normal-text {\r\n        font-size: 100%;\r\n        font-weight: normal;\r\n    }\r\n\r\n    section.doc-print div.statements div.page-number {\r\n        font-size: 8pt;\r\n        text-align: right;\r\n        padding-top: 12px;\r\n    }\r\n\r\n\r\n    /* для всех таблиц отчета START */\r\n    section.doc-print thead .doc-num {\r\n        word-break: normal;\r\n    }\r\n\r\n    section.doc-print tr.header td {\r\n        vertical-align: middle;\r\n    }\r\n\r\n    section.doc-print tr.header td.date-time {\r\n        padding: 5px 4px !important;\r\n    }\r\n\r\n    section.doc-print td.fix-wrap {\r\n        overflow-wrap: normal;\r\n        word-wrap: normal;\r\n        -ms-word-wrap: normal;\r\n    }\r\n\r\n    section.doc-print td.doc-num {\r\n        padding: 5px 6px !important;\r\n    }\r\n\r\n    section.doc-print table.without-header .payment-details,\r\n    section.doc-print table.without-header .correspondent {\r\n        width: 161px;\r\n    }\r\n\r\n    section.doc-print table.without-header .date-time {\r\n        width: 74px;\r\n    }\r\n\r\n    section.doc-print table.without-header .doc-num {\r\n        width: 51px;\r\n    }\r\n\r\n    section.doc-print table.without-header .amount {\r\n        width: 108px;\r\n    }\r\n    /* для всех таблиц отчета END */\r\n\r\n\r\n    /* для формата печати "Сокращенная" START*/\r\n    section.doc-print div.statements.brief table.without-header .account {\r\n        width: 120px;\r\n    }\r\n\r\n    section.doc-print div.statements.brief table.without-header .correspondent.uah {\r\n        width: 199px;\r\n    }\r\n\r\n    section.doc-print div.statements.brief table.without-header .correspondent {\r\n        width: 258px;\r\n    }\r\n\r\n    section.doc-print div.brief table.table-footer td.first-column {\r\n        width: 336px;\r\n    }\r\n\r\n    section.doc-print div.brief table.table-footer td.total-text {\r\n        width: 120px;\r\n    }\r\n\r\n    section.doc-print div.brief table.table-footer td.second-column {\r\n        width: 382px;\r\n    }\r\n    /* для формата печати "Сокращенная" END*/\r\n\r\n\r\n   /* для формата печати "Расширенная" альбомная START*/\r\n\r\n    section.doc-print div.extended.album .amount, section.doc-print div.budget.extended.album .amount {\r\n        width: 110px;\r\n    }\r\n\r\n    section.doc-print div.extended.album .date-time, section.doc-print div.budget.extended.album .date-time {\r\n        width: 74px;\r\n    }\r\n\r\n    section.doc-print div.extended.album .doc-num, section.doc-print div.budget.extended.album .doc-num {\r\n        width: 51px;\r\n    }\r\n\r\n    section.doc-print div.extended.album .correspondent, section.doc-print div.budget.extended.album .correspondent {\r\n        width: 227px;\r\n    }\r\n\r\n    section.doc-print div.extended.album table.without-header .payment-details {\r\n        width: 416px;\r\n    }\r\n\r\n    section.doc-print div.extended.album .bank-info, section.doc-print div.budget.extended.album .bank-info {\r\n        width: 170px;\r\n    }\r\n    section.doc-print div.extended.album .budget-code, section.doc-print div.budget.extended.album .budget-code {\r\n        width: 170px;\r\n    }\r\n\r\n    section.doc-print div.extended.album table.table-footer.uah td.first-column {\r\n        width: 340px;\r\n    }\r\n\r\n    section.doc-print div.extended.album table.table-footer.uah td.second-column {\r\n        width: 708px;\r\n    }\r\n\r\n    section.doc-print div.extended.album table.table-footer td.first-column {\r\n        width: 290px;\r\n    }\r\n\r\n    section.doc-print div.extended.album table.table-footer td.second-column {\r\n        width: 758px;\r\n    }\r\n    /* для формата печати "Расширенная" альбомная END*/\r\n\r\n\r\n    /* для формата печати "Расширенная" START*/\r\n\r\n    section.doc-print div.extended .date-time {\r\n        width: 74px;\r\n    }\r\n\r\n    section.doc-print div.extended .doc-num {\r\n        width: 51px;\r\n    }\r\n\r\n    section.doc-print div.extended .amount  {\r\n        width: 108px;\r\n    }\r\n\r\n    section.doc-print div.budget.extended .amount  {\r\n        width: 95px;\r\n    }\r\n\r\n    section.doc-print div.budget.extended .correspondent {\r\n        width: 110px;\r\n    }\r\n    section.doc-print div.budget.extended .bank-info {\r\n        width: 110px;\r\n    }\r\n    section.doc-print div.budget.extended .budget-code {\r\n        width: 95px;\r\n    }\r\n\r\n    section.doc-print div.budget.extended table.table-footer.uah td.first-column {\r\n        width: 291px;\r\n    }\r\n    /* для формата печати "Расширенная" END*/\r\n\r\n\r\n    /* Футер таблицы START */\r\n    section.doc-print .table-footer div.inline-block {\r\n        padding-right: 10px;\r\n    }\r\n\r\n    section.doc-print article .statements .table-footer {\r\n        padding: 0 0 10px 0;\r\n        line-height: 1.2;\r\n    }\r\n\r\n\r\n    section.doc-print table.table-footer td {\r\n        padding: 0 !important;\r\n    }\r\n\r\n    section.doc-print div.statements table.table-footer {\r\n        margin: 0 0 20px 0;\r\n    }\r\n\r\n    section.doc-print table.table-footer table {\r\n        margin: 0;\r\n    }\r\n\r\n    section.doc-print table.table-footer td.total-text {\r\n        width: 68px;\r\n    }\r\n\r\n    section.doc-print table.table-footer.uah td.total-text {\r\n        width: 120px;\r\n    }\r\n\r\n    section.doc-print table.table-footer td.first-column {\r\n        width: 284px;\r\n    }\r\n\r\n    section.doc-print table.table-footer.uah td.first-column {\r\n        width: 336px;\r\n    }\r\n\r\n    section.doc-print table.table-footer td.second-column {\r\n        width: 436px;\r\n    }\r\n\r\n    div.statements table.table-footer.uah td.second-column {\r\n        width: 384px;\r\n    }\r\n\r\n    div.statements table.table-footer td.second-line-text {\r\n        width: 160px;\r\n    }\r\n\r\n    section.doc-print table.table-footer td.equivalent {\r\n        padding-left: 65px !important;\r\n        width: 245px;\r\n    }\r\n    /* Футер таблицы END */\r\n\r\n\r\n    /* Футер отчета START */\r\n    section.doc-print .report-footer-table {\r\n        height: 169px;\r\n    }\r\n\r\n    section.doc-print .report-footer {\r\n        font-weight: bold;\r\n    }\r\n\r\n    section.doc-print .report-footer td.autograph-column {\r\n        width: 410px;\r\n    }\r\n\r\n    section.doc-print .report-footer td.stamp-column {\r\n        width: 310px;\r\n        padding-left: 50px !important;\r\n    }\r\n\r\n    section.doc-print .report-footer table.autograph-place {\r\n        width: 410px;\r\n    }\r\n    section.doc-print .report-footer table.autograph-place td {\r\n        font-size: 11pt;\r\n        padding: 30px 0 0 0 !important;\r\n    }\r\n    section.doc-print .report-footer table.autograph-place td.m-p-block {\r\n        width: 120px;\r\n        text-align: center;\r\n    }\r\n    section.doc-print .report-footer table.autograph-place td.autograph-label {\r\n        width: 100px;\r\n    }\r\n    section.doc-print .report-footer table.autograph-place td.autograph {\r\n        border-bottom: 1px solid black;\r\n        width: 190px\r\n    }\r\n\r\n    section.doc-print .report-footer .stamp-place {\r\n        vertical-align: middle;\r\n        height: 150px;\r\n    }\r\n\r\n    section.doc-print .report-footer div.for-img {\r\n        display: none;\r\n        position: relative;\r\n        float: right;\r\n    }\r\n    /* Футер отчета END */\r\n\r\n\r\n    /* создаем отступ для нижнего колонтитула */\r\n    section.doc-print table:last-child {\r\n        margin-bottom: 9mm;\r\n    }\r\n\r\n    section.doc-print div#doc-div .current-time {\r\n        position: absolute;\r\n        bottom: 7.8mm;\r\n        right: 10mm;\r\n        font-size: 8pt;\r\n    }\r\n\r\n</style>\r\n';
}),define("apps/statement/statement_print",["jquery","bifit","underscore","marionette","backbone","printUtils","appsPieces","app","collections/thesaurus","thesaurusUtils","apps/statement/statement_collection","text!apps/statement/templates/print_statement_report_header.tmpl","text!apps/statement/templates/print_statement_table_standart.tmpl","text!apps/statement/templates/print_statement_table_extended.tmpl","text!apps/statement/templates/print_statement_table_brief.tmpl","text!apps/statement/templates/print_statement_item_standart.tmpl","text!apps/statement/templates/print_statement_item_extended.tmpl","text!apps/statement/templates/print_statement_item_brief.tmpl","text!apps/statement/templates/print_statement_table_footer.tmpl","text!apps/statement/templates/print_statement_report_footer.tmpl","text!apps/statement/templates/print_statement_report_autograph.tmpl","text!apps/statement/templates/print_statement_pdf.tmpl","text!apps/statement/templates/print_statement_style.tmpl","i18n!apps/statement/nls/statement"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x){"use strict";var y=function(a){return a?Number(b.roundFloat(a.replace(/\s/g,""),2,2)):0},z=function(a){return b.formatAmount(a)||"0.00"},A=function(a){this.deb=0,this.debUah=0,this.cred=0,this.credUah=0,this.sum=y(String((a||{}).sum)),this.iterate=function(a){var b=y(a.D),c=y(a.C),d=y(a.RP);this.deb+=b,this.cred+=c,this.sum+=c-b,"-1"===a.OT?this.debUah+=d:this.credUah+=d},this.addSummary=function(a){this.deb+=a.deb,this.debUah+=a.debUah,this.cred+=a.cred,this.credUah+=a.credUah,this.sum+=a.cred-a.deb}};return d.Object.extend({initialize:function(a){this.sortedInfo=a.sortInfo,this.APPROXIMATE_COUNT_OF_STATEMENTS_PER_PAGE=17,this.accountsInfoPromise=a.accountsInfoPromise,this.client=a.client,this.overturnsReportCollectionPromise=a.overturnsReportCollectionPromise,this.statementsReportCollection=a.statementsReportCollection,this.budgetCodesPromise=a.budgetCodesPromise,this.selectedAccounts=a.selectedAccounts,this.isBrief="BRIEF"===a.print_type,this.isExtended="EXTENDED"===a.print_type||"EXTENDED_ALBUM"===a.print_type,this.isAlbum="EXTENDED_ALBUM"===a.print_type,this.withExtendFilter=a.withExtendFilter;var d="",e="";this.isExtended?(d=n,e=q):this.isBrief?(d=o,e=r):(d=m,e=p),this.reportHeaderTemplate=c.template(l),this.reportTableTemplate=c.template(d),this.statementItemTemplate=c.template(e),this.statementTableFooterTemplate=c.template(s),this.statementReportFooterTemplate=c.template(t),this.statementReportAutographTemplate=c.template(u),this.pageNumberTemplate=c.template('<div class="page-number">Сторінка <%- page_number %></div>'),this.docDivTemplate=c.template('<div id="doc-div" class="<%- classes %>"><div class="current-time">Виписка сформована:&nbsp;<%- date %></div></div>'),this.statementsCreateDate=b.dateTime2str(new Date,!1);var f=j.firstPropOf("gate.balanceloader.max_date"),g=j.firstPropOf("statements.date_on_stamp");if(this.showDateOnStamp=c.isEmpty(g)||"true"===g.toLowerCase(),f&&b.checkDateMatch(f)){var h=c.flatten(this.statementsReportCollection.pluck("operations")),i=c.max(h,function(a){var c=((a||{}).OD||"").substr(0,10);return c?b.str2date(c):0}),k=((i||{}).OD||"").substr(0,10);c.isEmpty(k)&&(k=c.max(this.statementsReportCollection.pluck("ED"),function(a){return a?b.str2date(a):0})),this.needPrintStamp=k?b.str2date(k)<b.str2date(f):!1}else this.needPrintStamp=!0},preparePrintReportInfo:function(a){var b=c.findWhere(this.accounts,{account_id:a.id}),d=c.findWhere(this.banks,{code:b.mfo}),e="UAH"===b.currency,f=c.reduce(a.get("operations"),function(a,b){return a["I"===b.OC?"future":"current"].push(b),a},{future:[],current:[]}),g=this.getClient(b.client_id);return{BD:a.get("BD"),ED:a.get("ED"),ACCOUNT_CUR:b.currency,ACCOUNT_NUMBER:b.account,BNK_NAME:d.name,CITY:this.accountsToCities[b.account_id],MFO:b.mfo,CLN_NAME:g.name_cln,CLN_OKPO:g.okpo,LAST_OPER_DATE:a.get("LOD")||"операції відсутні",IN_REMAINDER:z(a.get("IB")),IN_REMAINDER_UAH:z(a.get("IBN")),OUT_REMAINDER:z(a.get("OB")),OUT_REMAINDER_UAH:z(a.get("OBN")),ALL_DEBIT:z(a.get("DV")),ALL_CREDIT:z(a.get("CV")),ALL_DEBIT_UAH:z(a.get("DVN")),ALL_CREDIT_UAH:z(a.get("CVN")),isUAH:e,isBudget:"1"===b.comments,futureOperations:f.future,operations:f.current,withExtendFilter:this.withExtendFilter,isBrief:this.isBrief,isExtended:this.isExtended,isAlbum:this.isAlbum}},render:function(){var d={isLandscapeOriented:this.isAlbum,docHeader:x.print_report};f.createPrintFormForPdf(d).then(function(d){this.printForm=d,this.printForm.find("h1.empty").html(x.print_report),this.printButton=this.printForm.find(".print.to-printer"),this.printPdfButton=this.printForm.find(".print.to-pdf"),f.spinBtn(this.printButton),f.spinBtn(this.printPdfButton);var e=this.printForm.find("input[type=checkbox]");e.prop("disabled",!0);var h=this.printForm.find("#doc-div");this.docDivParent=h.parent(),this.maxDivHeight=h.height(),this.docDivParent.append(w),this.printPdfButton.parent().show(),this.printPdfButton.bind("click",function(){var e=d.find("article.main").clone(!0);e.find("h1.empty").remove(),e.find("style").remove(),e.find("colgroup").remove(),e.find("div.page_number").remove(),e.find("div.current-time").remove(),e.find("div.date-on-stamp").remove(),e.find("img").remove(),(d.find("#bank_stamp_each_page").is(":checked")||d.find("#bank_stamp_last_page").is(":checked"))&&e.find(".for-img").append("<stamp/>"),a.ajax({url:localStorage.getItem("addr")+"/print_to_pdf;jsessionid="+b.getStoredItem("JSESSIONID"),type:"POST",contentType:"application/x-www-form-urlencoded; charset=UTF-8",mimeType:"text/plain; charset=x-user-defined",data:{html:c.template(v,{content_for_pdf:e[0].outerHTML}).split("<br>").join("<br/>").split('"').join('"'),fileName:"statement.pdf",isLandscape:this.isAlbum,footerText:d.find("div.current-time")[0].innerHTML.replace(/&nbsp;/g,""),stampDate:this.showDateOnStamp?this.statementsCreateDate.slice(0,10):"",stampAbsolutePosition:!0},success:function(a){f.createPdfFile(a,"statement.pdf",d[0])}})}.bind(this));var j=this.needPrintStamp?f.createReportLeftMenu(d,"statements"):"";a.when(this.accountsInfoPromise,this.overturnsReportCollectionPromise,this.budgetCodesPromise,j).then(function(b,d,j){var k=this.printForm.find("#bank_stamp_each_page"),l=this.printForm.find("#bank_stamp_last_page");this.isStampOnEachPageMode=this.needPrintStamp&&k.is(":checked"),this.overturnsReportCollection=d,this.budgetCodes=j,g.getUaSwiftForAccounts(this.selectedAccounts).then(function(d){this.banks=d,this.accounts=c.map(this.selectedAccounts,function(a){return c.extend({},a,{comments:c.findWhere(b,{id:a.account_id}).comments})}),this.accountsToCities=c.reduce(this.accounts,function(a,b){var d=c.findWhere(i.getThesaurus("bank_branches").array,{bik:b.mfo});return a[b.account_id]=d.city||"",a},{}),k[0].addEventListener("click",function(b){l.prop("checked",!1),this.isStampOnEachPageMode=a(b.target).is(":checked"),this.rePrintReports()}.bind(this),!1),l[0].addEventListener("click",function(b){k.is(":checked")?(k.prop("checked",!1),this.isStampOnEachPageMode=!1,this.rePrintReports()):this.printForm.find("div.for-img").css("display",a(b.target).is(":checked")?"block":"none")}.bind(this),!1),setTimeout(function(){h.remove();for(var a=this.statementsReportCollection.models,b=0;b<a.length;b++)this.printReport(a[b]);if(this.isStampOnEachPageMode&&this.moveReportFooterToEndOfThePage(),this.needPrintStamp){var c=this.showDateOnStamp?this.statementsCreateDate.slice(0,10):"";f.addStamp(this.printForm[0],"statements",c)}e.prop("disabled",!1),f.stopBtn(this.printButton),f.stopBtn(this.printPdfButton)}.bind(this),50)}.bind(this))}.bind(this))}.bind(this))},rePrintReports:function(){f.spinBtn(this.printButton),f.spinBtn(this.printPdfButton);var a=this.printForm.find("input[type=checkbox]");a.prop("disabled",!0),setTimeout(function(){this.printForm.find(".statements").remove();for(var b=this.statementsReportCollection.models,c=0;c<b.length;c++)this.printReport(b[c]);if(this.isStampOnEachPageMode&&this.moveReportFooterToEndOfThePage(),this.needPrintStamp){var d=this.showDateOnStamp?this.statementsCreateDate.slice(0,10):"";f.addStamp(this.printForm[0],"statements",d)}a.prop("disabled",!1),f.stopBtn(this.printButton),f.stopBtn(this.printPdfButton)}.bind(this),50)},printReport:function(a){this.pageNumber=1;var b=a.id;this.overturnsModel=this.overturnsReportCollection.get(b),this.reportPrintInfo=this.preparePrintReportInfo(a),this.currentDiv=this.createDocDiv(),this.currentDiv.append(this.reportHeaderTemplate(this.reportPrintInfo));var d=new k(this.reportPrintInfo.operations,{sort:!0,sortedInfo:this.sortedInfo}).models;c.isEmpty(d)||this.currentDiv.append(this.pageNumberTemplate({page_number:this.pageNumber}));var e=new k(this.reportPrintInfo.futureOperations,{sort:!0,sortedInfo:this.sortedInfo}).models,f={firstLineText:"ВСЬОГО: ",secondLineText:"Вихідний залишок: ",isUAH:this.reportPrintInfo.isUAH,withExtendFilter:this.reportPrintInfo.withExtendFilter,debit:this.reportPrintInfo.ALL_DEBIT,credit:this.reportPrintInfo.ALL_CREDIT,remainder:this.reportPrintInfo.OUT_REMAINDER,debitUa:this.reportPrintInfo.ALL_DEBIT_UAH,creditUa:this.reportPrintInfo.ALL_CREDIT_UAH,remainderUa:this.reportPrintInfo.OUT_REMAINDER_UAH,isBrief:this.isBrief,isExtended:this.isExtended,isAlbum:this.isAlbum};this.reportPrintInfo.isUAH?this.printUAHStatements(d,f):this.printCurrencyStatements(d,f),this.printFutureStatements(e),c.isEmpty(e)&&c.isEmpty(d)&&this.addReportFooter(!0)},printCurrencyStatements:function(a,b){var d;if(a.length){var e,f,g=this.prepareCurrencyStatements(a);b.debit=g.totalInfo.debit,b.debitUa=g.totalInfo.debitUa,b.credit=g.totalInfo.credit,b.creditUa=g.totalInfo.creditUa;for(var h,i=g.statementsByDayInfo,j=g.daysOrder,k=this.reportPrintInfo.futureOperations||[],l=0;l<j.length;l++){h=0===l?this.reportTableTemplate(this.reportPrintInfo):'<table class="bordered without-header"><tbody></tbody></table>';var m=j[l],n=i[m].operationsByDay;this.currentDiv.append(h);var o=c.findWhere(this.overturnsModel.get("balance"),{SD:m});if(d=c.extend({firstLineText:"Обороти:",secondLineText:"Залишок на кінець дня:",isUAH:this.reportPrintInfo.isUAH,withExtendFilter:this.reportPrintInfo.withExtendFilter,remainder:o.OR,remainderUa:o.ORN,isBrief:this.isBrief,isExtended:this.isExtended,isAlbum:this.isAlbum},i[m].dayTotalInfo),j.length-1===l){var p=[this.addTableFooter.bind(this,b),this.addTableFooter.bind(this,d)],q=[this.removeTableFooter.bind(this),this.removeTableFooter.bind(this)];k.length||(p.unshift(this.addReportFooter.bind(this,!0)),q.unshift(this.removeReportFooter)),e=c.compose.apply(c,p),f=c.compose.apply(c,q)}else e=this.addTableFooter.bind(this,d),f=this.removeTableFooter;this.printStatements(n,e,f)}}else d=c.defaults({firstLineText:"Обороти:",secondLineText:"Залишок на кінець дня:",remainderUa:this.reportPrintInfo.IN_REMAINDER_UAH,isBrief:this.isBrief,isExtended:this.isExtended,isAlbum:this.isAlbum},b),this.addTableFooter(d),this.addTableFooter(b)},prepareCurrencyStatements:function(a){for(var d={totalInfo:{debit:0,debitUa:0,credit:0,creditUa:0},statementsByDayInfo:{},daysOrder:[]},e=new A({sum:this.reportPrintInfo.IN_REMAINDER}),f=c.groupBy(a,function(a){return a.attributes.OD.substr(0,10)}),g=c.sortBy(c.clone(c.keys(f)),function(a){return b.str2date(a).getTime()}),h=0;h<g.length;h++){var i=g[h];d.statementsByDayInfo[i]={};for(var j=f[i],k=new A(e),l=0;l<j.length;l++)k.iterate(j[l].attributes);e.addSummary(k),d.statementsByDayInfo[i].dayTotalInfo={debit:z(k.deb),debitUa:z(k.debUah),credit:z(k.cred),creditUa:z(k.credUah)},d.statementsByDayInfo[i].operationsByDay=j}return d.totalInfo.debit=z(e.deb),d.totalInfo.debitUa=z(e.debUah),d.totalInfo.credit=z(e.cred),d.totalInfo.creditUa=z(e.credUah),"OD"===this.sortedInfo.field&&"desc"===this.sortedInfo.order&&g.reverse(),d.daysOrder=g,d},printUAHStatements:function(a,b){if(a.length){var d=new A({sum:this.reportPrintInfo.IN_REMAINDER});c.forEach(a,function(a){d.iterate(a.attributes)}),b.debit=z(d.deb),b.debitUa=z(d.debUah),b.credit=z(d.cred),b.creditUa=z(d.credUah);var e=this.reportPrintInfo.futureOperations||[];this.currentDiv.append(this.reportTableTemplate(this.reportPrintInfo));var f=[this.addTableFooter.bind(this,b)],g=[this.removeTableFooter.bind(this)];e.length||(f.unshift(this.addReportFooter.bind(this,!0)),g.unshift(this.removeReportFooter));var h=c.compose.apply(c,f),i=c.compose.apply(c,g);this.printStatements(a,h,i)}else this.addTableFooter(b)},printStatements:function(a,b,c){var d=a.length;for(this.countWrittenStatements=0;this.countWrittenStatements<d;)this.addStatements(a,this.countWrittenStatements,Math.min(this.APPROXIMATE_COUNT_OF_STATEMENTS_PER_PAGE,d-this.countWrittenStatements)),this.checkHeight(a),this.countWrittenStatements<d?this.createNewPage():(b.call(this),this.currentDiv.height()>this.maxDivHeight&&(c.call(this),this.removeStatements(1),0===this.countWrittenStatements&&0===this.currentDiv.find("tbody").last().find("tr").length&&this.currentDiv.find("table").last().remove(),this.createNewPage()))},printFutureStatements:function(a){if(a.length){var b=new A;c.forEach(a,function(a){b.iterate(a.attributes)});var d={firstLineText:"ВСЬОГО:",secondLineText:"Вихідний залишок: ",isUAH:this.reportPrintInfo.isUAH,withExtendFilter:this.reportPrintInfo.withExtendFilter,isBrief:this.isBrief,isExtended:this.isExtended,isAlbum:this.isAlbum,debit:z(b.deb),credit:z(b.cred),debitUa:z(b.debUah),creditUa:z(b.credUah)},e=c.compose(this.addReportFooter.bind(this,!0),this.addTableFooter.bind(this,d)),f=c.compose(this.removeReportFooter,this.removeTableFooter);this.addFutureTableHeader(),this.addStatements(a,0,1),1===a.length&&e.call(this),this.currentDiv.height()>this.maxDivHeight?(1===a.length&&f.call(this),this.removeStatements(1),this.removeFutureTableHeader(),this.pageNumber++,this.currentDiv=this.createDocDiv(),this.addFutureTableHeader()):a=a.slice(1),this.printStatements(a,e,f)}},createNewPage:function(){return this.pageNumber++,this.currentDiv=this.createDocDiv(),this.currentDiv.append(this.pageNumberTemplate({page_number:this.pageNumber})),this.currentDiv.append(this.reportTableTemplate(this.reportPrintInfo)),this.currentDiv},checkHeight:function(a){for(var b,c=a.length,d=!1,e=this.APPROXIMATE_COUNT_OF_STATEMENTS_PER_PAGE;this.currentDiv.height()>this.maxDivHeight&&this.countWrittenStatements>0;)if(b=this.removeStatements(1),d=!0,e--,0===b){this.currentDiv.find("table").last().remove();break}d?(this.approximateCountOfStatementsPerPageMin=5,this.APPROXIMATE_COUNT_OF_STATEMENTS_PER_PAGE=Math.max(e+1,this.approximateCountOfStatementsPerPageMin)):this.countWrittenStatements<c&&(this.APPROXIMATE_COUNT_OF_STATEMENTS_PER_PAGE++,this.addStatements(a,this.countWrittenStatements,1),this.checkHeight(a))},addStatements:function(a,b,d){for(var e,f="",g={isUAH:this.reportPrintInfo.isUAH,isBudget:this.reportPrintInfo.isBudget},h=b;d+b>h;h++){this.countWrittenStatements++;var i=a[h].attributes;e={},this.reportPrintInfo.isBudget&&(e.BC=this.getBudgetInfo(i)),c.defaults(e,g,i),this.isBrief&&(e.OD=e.OD.slice(0,10),e.VD=e.VD.slice(0,10)),f+=this.statementItemTemplate(e)}this.currentDiv.find("tbody").last().append(f)},getBudgetInfo:function(a){var b=(c.findWhere(this.budgetCodes,{code:a.BC})||{}).description||"";return a.BC+" "+b},removeStatements:function(a){for(var b=this.currentDiv.find("tbody").last(),c=0;a>c;c++)this.countWrittenStatements--,b.children().last().remove();return b.children().length},createDocDiv:function(){this.isStampOnEachPageMode&&this.moveReportFooterToEndOfThePage();var a="statements"+(this.reportPrintInfo.isBudget?" budget":"");return a+=this.isExtended?" extended":"",a+=this.isBrief?" brief":"",a+=this.isAlbum?" album":"",this.docDivParent.append(this.docDivTemplate({classes:a,page_number:this.pageNumber,date:this.statementsCreateDate})),this.isStampOnEachPageMode&&this.addReportFooter(!1),this.docDivParent.children().last()},addReportFooter:function(a){var b=this.docDivParent.children().last();this.isStampOnEachPageMode?a?b.find(".autograph-column").append(this.statementReportAutographTemplate()):b.append(this.statementReportFooterTemplate()):(b.append(this.statementReportFooterTemplate()),b.find(".autograph-column").append(this.statementReportAutographTemplate()))},moveReportFooterToEndOfThePage:function(){var a=this.docDivParent.children().last(),b=a.find(".report-footer");if(b.length>0){var c=b[0].outerHTML;b.remove(),a.append(c)}},removeReportFooter:function(){this.currentDiv.find(".report-footer").last().remove()},addFutureTableHeader:function(){this.currentDiv.append('<h3 id="future-header" class="bold-text header"><br><br><span>Очікувані операції (дата валютування перевищує дату отримання виписки):</span><br><br></h3>'),this.currentDiv.append(this.reportTableTemplate(c.extend({isFutureOperation:!0},this.reportPrintInfo)))},removeFutureTableHeader:function(){this.currentDiv.find("#future-header").last().remove(),this.currentDiv.find("table").last().remove()},addTableFooter:function(a){this.currentDiv.append(this.statementTableFooterTemplate(a))},removeTableFooter:function(){this.currentDiv.find(".table-footer").last().remove()},getClient:function(a){return h.isMultiClient()?c.findWhere(i.getThesaurus("sub_clients").array,{client_id:a}):this.client}})}),define("text!apps/statement/templates/statement.tmpl",[],function(){return'<div class="grey-container">\n    <% if(OC === \'I\'){ %> <h4><%- oper_code %></h4> <% } %>\n    <h1>\n        <% if (typeof D !=\'undefined\' && D) { %>\n        <%- debet_oper %>\n        <% } else { %>\n        <%- credit_oper %>\n        <% }; %>\n    </h1>\n    <h2><%- to_acc %>&nbsp;<%- AC %>&nbsp;<%- CUR %> <%- for_the_date %> <%- OD %></h2>\n</div>\n\n<div class="grey-container">\n    <div class="first form-group">\n        <label for="ND"><%- DOC_NUM %></label>\n        <input type="text" id="ND" disabled=\'disabled\' value="<%- ND %>"/>\n    </div>\n\n    <div class="right form-group">\n        <div class="date-doc">\n            <label for="DD"><%- DATE_DOC %></label>\n            <input type="text" id="DD" class="date" disabled=\'disabled\' value="<%- DD %>"/>\n        </div>\n        <div class="value-date">\n            <label form="VD"><%- VALUE_DATE %></label>\n            <input type="text" id="VD" name="VD" disabled=\'disabled\' value="<%- VD %>" class="date"/>\n        </div>\n    </div>\n\n    <div class="first" data-curr="<%- CUR %>">\n        <label><%- amount %></label>\n        <input type="text" id="D" disabled=\'disabled\' value="<% if(D) {%> <%- D %> <% } else {%> <%- C %> <% } %>&nbsp;<%- CUR %>"/>\n    </div>\n\n    <% if (typeof RP != \'undefined\' && CUR !== \'UAH\') { %>\n    <div class="last">\n        <label form="RP"><%- UAH_CONV %></label>\n        <input type="text" id="RP" disabled=\'disabled\' value="<%- RP %>&nbsp;UAH"/>\n    </div>\n    <% } %>\n\n\n    <div class="rcpt form-group">\n        <label for="RCPT_NAME"><span class="rcpt-name"><%- rcpt %></span></label>\n        <input class="recipient_name" type="text" disabled=\'disabled\' id="RCPT_NAME" value="<%- CN %>"/>\n    </div>\n\n    <div class="bank form-group">\n        <label for="RCPT_BANK_MFO"><%- MFO %></label>\n        <input type="text" id="RCPT_BANK_MFO" value="<%- CBB %>" class="mfo" disabled=\'disabled\'/>\n        <input type="text" class="name" id="RCPT_BANK_NAME" value="<%- CBN %>" disabled=\'disabled\'/>\n    </div>\n\n    <div class="half">\n        <label for="RCPT_ACCOUNT"><%- ACCOUNT %></label>\n        <input type="text" id="RCPT_ACCOUNT" value="<%- CA %>" disabled=\'disabled\'/>\n    </div>\n    <div class="last">\n        <label for="RCPT_OKPO"><%- OKPO %></label>\n        <input type="text" id="RCPT_OKPO" value="<%- CI %>" disabled=\'disabled\' class="okpo"/>\n    </div>\n\n    <% if (ISB) { %>\n    <div class="details form-group">\n    <% } else { %>\n    <div class="details">\n    <% } %>\n        <label for="PAYMENT_DETAILS"><%- DOCUMENT_INFO %></label>\n        <textarea rows=\'4\' disabled=\'disabled\' id="PAYMENT_DETAILS" class="details"><%- NP %></textarea>\n    </div>\n\n    <% if (ISB) { %>\n    <div class="clearfix">\n        <div class="first">\n            <label form="BC"><%- BUDGET_CODE %></label>\n            <input type="text" id="BC" name="BC" disabled=\'disabled\' value="<%- BC %>" class="budget-code"/>\n        </div>\n\n        <div class="budget-code-desc">\n            <label form="BDESC"><%- BUDGET_CODE_DESCRIPTION %></label>\n            <input type="text" id="BDESC" name="BDESC" disabled=\'disabled\' value="<%- BDESC %>"/>\n        </div>\n    </div>\n    <% } %>\n</div>\n'}),define("apps/statement/statement_view",["jquery","underscore","marionette","text!apps/statement/templates/statement.tmpl","i18n!apps/statement/nls/statement"],function(a,b,c,d,e){"use strict";return c.ItemView.extend({tagName:"div",className:"doc-wrapper operation-detail",template:b.template(d),templateHelpers:e})}),define("commons/base_object/document/group_opers_document_controller",["jquery","underscore","bifit","app","dialogUtils","thesaurusUtils","libs/multi_client_utils","actionUtils","collections/thesaurus","commons/base_object/document/document_controller","commons/base_object/document/confirm_reason_view","i18n!nls/document"],function(a,b,c,d,e,f,g,h,i,j,k,l){return j.extend({getListViewOptions:function(){return j.prototype.getListViewOptions.call(this)},addListViewListeners:function(a){j.prototype.addListViewListeners.call(this,a),this.listenTo(a,"update-actions",this.updateActions)},updateActions:function(a){d.mainLayout.actionBar.show(this.createActionBar(a))},COPY_GROUP:function(){var e=new this.Model({type:this.docType}),f=b.groupBy(this.collection.selected,function(a){return a.get("owner_id")}),h=0,j=this,k=b.size(f),m=b.keys(f),n=!1,o=this.showGroupList(l.group_view_copy_h1,{stopOperation:function(){n=!0},entityType:"documents",operationType:"copying"}),p=function(){if(k>h&&!n){var q=m[h++],r=f[q],s=d.isMultiClient()?g.loadTemplate(!1,q,e):e.loadTemplate();s.done(function(e){var f,h=[],k=function(a,b){var d,e=j.getWorkContent(a).NUM_DOC,f=b||e+"/C",g=j.getCurrencyName(a.getCurrency());return d=a.getFAmount()?c.sprintf(l.group_view_copy,e,a.getFAmount(),g,f):c.sprintf(l.group_view_copy_2,e,f)},m=0,s=function(){if(!n)if(m<h.length){var a=h[m++];a.on("model:completeSync",s),a.save({},{silent:!0,emulateClientRequest:d.isMultiClient()})}else p()},t=b.size(r);if(d.isMultiClient()){var u=b.findWhere(i.getThesaurus("sub_clients").array,{client_id:q}),v=r[0].attributes,w=(u||{}).name_cln||v.CLN_NAME||v.PAYER_NAME||v.SENDER,x={statusHandlers:{403:function(a){b.each(r,function(b){var c=k(b);o.add(b,c),b.trigger("model:completeSync",b,l.error,a,403)})}}};f=g.loadSubClientData(q,w,x)}else f=a.Deferred().resolve();f.then(function(){var a=function(b){var c=r[b],d=j.getWorkContent(c),f=d.NUM_DOC;j.prepareContent4Save(j.prepareContent4Create(d)).then(function(d){d.NUM_DOC=""+(e.N?e.N++:f+"/C");var g=new j.Model(d,{silent:!0}),i=k(c,d.NUM_DOC);return j.isAccountsForCreateAction()?(o.add(g,i),h.push(g),void(b===t-1?s():b%100===0?setTimeout(a.bind(this,++b),0):a(++b))):(o.add(g,i),void g.trigger("model:completeSync",g,j.getNoAccErrorText()))})};a(0)})})}};p()},DELETE_GROUP:function(){var a=this.collection.selected,c=function(){var c=!1,e=this.group(function(a,b){this.addModelToGroupView(a,b,"delete")}.bind(this),l.group_view_delete_h1,a,{stopOperation:function(){c=!0},entityType:"documents",operationType:"deleting"}),f=b.pluck(e.children,"model"),g=0,h=function(){if(g<f.length&&!c){var a=f[g++];d.isMultiClient()&&(d.multiClient.currentSubClientId=a.get("owner_id"));var e={statusHandlers:{403:function(a){h()}}};a.destroy(b.extend(e,{silent:!0,wait:!0,emulateClientRequest:d.isMultiClient(),success:function(){a.trigger("model:completeSync",a,"Ok"),h()},error:function(){h()}}))}};h()},f=1===b.keys(a).length?l.confirm_delete_doc:l.confirm_delete_many_doc;e.confirm(f,c,!1,this)},SIGN_GROUP:function(){var e=this.collection.urlRoot+this.docType+"/sign/",i=";jsessionid="+c.getStoredItem("JSESSIONID"),j=b.values(this.collection.selected),k=0,m=!1,n=function(){if(k<j.length&&!m){var o=j[k++],p=o.get("attaches");if(!b.isEmpty(p))for(var q=f.getClientProp("documents.attachments.extensions"),r=0;r<p.length;r++)if(!c.checkAttachExtension(p[r].name,q))return o.trigger("model:completeSync",o,l.error,c.sprintf(l.attach_has_not_allowed_extension,q)),void n();var s=b.isEmpty(p)?a.when():this.loadAndSetAttachesContent(o),t=s.then(function(){var a=this.signData(o);return{content:this.prepare4Sign(a),id:o.get("id")}}.bind(this),function(a){o.trigger("model:completeSync",o,l.error,c.sprintf(l.attach_load_error,a.name)),n()}),u=function(b){SignPluginServices.signData(b.content).then(function(c){a.ajax({type:"POST",dataType:"json",url:e+b.id+i,data:JSON.stringify({id:b.id,sign:c.sign,timestamp:c.timestamp}),success:function(a){o.set(a,{silent:!0}),o.trigger("model:completeSync",o,"Ok","",200),n()},error:function(a){o.trigger("model:completeSync",o,l.error,a.responseText,a.status),n()}})})},v=function(a,c){var d=b.contains(["2","2002","3004"],o.get("status"));if(d||a===w.length)return o.trigger("model:completeSync",o,"Ok","",200),void n();var f=parseInt(o.get("sign_groups_mask"));return h.hasSignOfGroup(f,w[a].GR)?void v(a+1,c):void g.useKey(w[a].ID).then(function(){SignPluginServices.signData(c.content).then(function(b){g.ajax({type:"POST",dataType:"json",url:e+c.id,data:JSON.stringify({id:c.id,sign:b.sign,timestamp:b.timestamp}),currentSubClientKeyId:w[a].ID,success:function(b){return o.set(b,{silent:!0}),b.error&&a<w.length-1?(o.trigger("model:completeSync",o,l.error,b.error,200),void n()):void v(a+1,c)},error:function(a){o.trigger("model:completeSync",o,l.error,a.responseText,a.status),n()}})})})};if(d.isMultiClient())if(-1===this.docType.indexOf("budget")){var w=g.getKeysListLocatedMultiClient(o.get("owner_id"));t.then(v.bind(this,0))}else g.useMultiClientKey().then(function(){t.then(u)});else t.then(u)}}.bind(this);this.group(function(a,b){this.addModelToGroupView(a,b,"sign"),j.length===b.children.length&&n()}.bind(this),l.group_view_sign_h1,j,{stopOperation:function(){m=!0},entityType:"documents",operationType:"signing"})},addModelToGroupView:function(a,b,d){var e,f=a.get("NUM_DOC"),g=a.getFAmount(),h="";g?(e="sign"===d?l.group_view_sign:l.group_view_delete,h=c.sprintf(e,f,g,this.getCurrencyName(a.getCurrency()))):(e="sign"===d?l.group_view_sign_2:l.group_view_delete_2,h=c.sprintf(e,f)),b.add(a,h)},REJECT_GROUP:function(){var a=new k({el:e.wrapper(),templateHelpers:{maxLength:200,title:l[1===this.collection.selectedLength?"reject_doc_title":"reject_docs_title"],ok_button_name:l.reject_link_btn,cancel_button_name:l.close_link_btn}}).render();a.on("confirm",this.groupRejectRequest,this)},groupRejectRequest:function(d){var e=b.values(this.collection.selected),f=0,g=!1,h=function(){if(f<e.length&&!g){var b=e[f++];a.ajax({type:"PUT",contentType:"application/json",data:d||"",url:this.collection.urlRoot+this.docType+"/"+b.get("id")+"/reject"+b._session(),success:function(a){b.set(a,{silent:!0}),a.error?b.trigger("model:completeSync",b,l.error,a.error,200):b.trigger("model:completeSync",b,"Ok","",200),h()}.bind(this),error:function(a){b.trigger("model:completeSync",b,"documentNls.error",a.responseText,a.status),h()}.bind(this)})}}.bind(this);this.group(function(a,b){var d=a.get("NUM_DOC");b.add(a,c.sprintf(l.group_view_reject,d)),e.length===b.children.length&&h()},l.group_view_reject_h1,e,{stopOperation:function(){g=!0},entityType:"documents",operationType:"rejecting"})},prepareDeferredForModelsFetch:function(c){var d=a.Deferred(),e=b.values(this.collection.selected),f=0,g=function(){if(f<this.collection.selectedLength){var a=e[f++];!c||c(a)?(this.listenToOnce(a,"model:completeSync",function(){g()}),a.fetch()):g()}else d.resolve()}.bind(this);return g(),d},PRINT_GROUP:function(a){a.stopPropagation(),this.printDocs(b.values(this.collection.selected))},printDocs:function(){}})}),define("apps/ua_payment/nls/ua_payment_base",{root:{no_uah_accs:"Невозможно создать документ. Отсутствует текущий счет в национальной валюте.",number:"Номер",date:"Дата",rcpt:"Получатель",payer:"Плательщик",sender:"Отправитель",acc:"Счет",several_accs:"неск. счетов",several_reqs:"неск. реквизитов",amount:"Сумма",details:"Назначение",status:"Статус",links:"Связи",linkTo:"Связь с",from:"от",amount_from:"Сумма от",to:"до",of:"из",amount_to:"Сумма до",amountError:"Максимальная сумма должна быть больше минимальной",no_filter:"Выбрать всё",any:"Любые связи",no_links:"Нет связей","doc/pay_sheet":"Зарплатная ведомость",add_to_rcpt:"Сохранить в справочник",pp:"Номер",value_date:"Дата валютир.",date_doc:"Дата документа",from_acc:"Со счета",to_acc:"На счет",by_amount:"Прошу перечислить",okpo:"ЕГРПОУ",mfo:"МФО",details_ext:"Назначение платежа",not_required:"необяз.",current:"текущая",autonum:"автонумер.",name:"Наименование",ua_payment:"Гривневое поручение",ua_payment_list:"Гривневые поручения",ua_payment_print_registry:"Печать реестра",ua_payment_print_docs:"Печать документов",ua_payment_print_registry_title:"Печать реестра документов",to_bank:"Банк",seria:"Серия",passp:"Паспорт",expense_item:"Статья бюджета",budget_payment:"Платеж в бюджет",payment_kind_code_placeholder:"Начинайте вводить код или вид уплаты",nds1:"Без НДС",nds2:"НДС 20%",country_code:"Страна",no_nds_dtls:"Без ПДВ.",with_nds_dtls:"у т.ч. ПДВ ",preload_text:"Загрузка списка получателей",footer_s_template:"{1} {2} {3} из {4} на общую сумму {5} грн.",footer_selected_sin:"Выбрано",footer_selected_pl:"Выбрано",footer_1_doc:"поручение",footer_1_doc_pl:"поручение",footer_2_4_docs:"поручения",footer_5_0_docs:"поручений",field_DATE_DOC:"Дата документа",field_NUM_DOC:"Номер документа",field_AMOUNT:"Сумма платежа",field_CLN_NAME:"Наименование плательщика",field_CLN_OKPO:"ЕГРПОУ плательщика",field_CLN_ACCOUNT:"Счет плательщика",field_CLN_BANK_NAME:"Наименование банка плательщика",field_CLN_BANK_MFO:"МФО банка плательщика",field_RCPT_NAME:"Наименование получателя",field_RCPT_OKPO:"ЕГРПОУ получателя",field_RCPT_ACCOUNT:"Счет получателя",field_RCPT_BANK_NAME:"Наименование банка получателя",field_RCPT_BANK_MFO:"МФО банка получателя",field_PAYMENT_DETAILS:"Назначение платежа",field_VALUE_DATE:"Дата валютирования",field_CLN_COUNTRY_CODE:"Код страны плательщика",field_RCPT_COUNTRY_CODE:"Код страны получателя",field_EXPENSE_ITEM:"Код бюджетирования",field_RCPT_PASSP_SER:"Серия паспорта получателя",field_RCPT_PASSP_NUM:"Номер паспорта получателя",field_PAYER_NAME:"Наименование плательщика",field_PAYER_OKPO:"ЕГРПОУ плательщика",field_PAYER_ACCOUNT:"Счет плательщика",field_PAYER_BANK_NAME:"Наименование банка плательщика",field_PAYER_BANK_MFO:"МФО банка плательщика",field_PAYER_COUNTRY_CODE:"Код страны плательщика",field_PAYER_PASSP_SER:"Серия паспорта плательщика",field_PAYER_PASSP_NUM:"Номер паспорта плательщика",incorrect_payments_kinds:"Указанный код отсутствует в справочнике",incorrectPassp:"Данные паспорта заполнены некорректно. Данные могут представлять собой номер документа (9 символов) или серию и номер документа (6 символов)",bank_client:"ИБИС",requisites_change_is_forbidden:"Для платежей по зарплатному проекту запрещено редактирование основных реквизитов получателя",incoming_payment:"ВХОДЯЩИЕ",sent_payment:"ИСХОДЯЩИЕ",code_type:"Код вида уплаты",payer_number:"Номер плательщика",explain_inf:"Назначение платежа",confirm_select:"Выбрать",close_link_btn:"Закрыть",start_entering:"Начинайте вводить наименование",entering_placeholder:"Начинайте вводить",recount_with_nds:"пересчитать сумму с учетом НДС",item_search:"Поиск статьи",item_code:"Код статьи",code_label:"Код",descr_label:"Описание",planned_remainder:"Планируемый остаток",archives_notification_1:"Обратите внимание, что в этом списке отсутствуют документы с датой создания не больше, чем {1}",archives_notification_2:'Для их просмотра перейдите на вкладку "Архивные"',pay_sheet:"Зарплатная ведомость",link0_title:"Основной платеж",
link1_title:"Платеж за РКО",links_warn:"Внимание!",links_incorrect:"'{1}' не соответствует ведомости. Возможная причина - изменение ведомости или документа '{1}'."},uk:!0,en:!0}),define("apps/ua_payment/nls/ua_payment",["underscore","apps/ua_payment/nls/ua_payment_base"],function(a,b){return{root:a.extend({},b.root,{bank_client:"Банк-клиент"}),uk:!0,en:!0}}),define("apps/ua_payment/nls/uk/ua_payment_base",{no_uah_accs:"Неможливо створити документ. Вiдсутнiй поточний рахунок в нацiональнiй валютi.",number:"Номер",date:"Дата",rcpt:"Отримувач",payer:"Платник",sender:"Вiдправник",acc:"Рахунок",several_accs:"дек. рахунків",several_reqs:"дек. реквізитів",amount:"Сума",details:"Призначення",status:"Статус",links:"Зв’язки",linkTo:"Зв’язок з",from:"від",amount_from:"Сума від",to:"до",of:"з",amount_to:"Сума до",amountError:"Максимальна сума повинна бути більше ніж мінімальна",no_filter:"Вибрати все",any:"Будь-які зв'язки",no_links:"Немає зв'язків","doc/pay_sheet":"Зарплатна відомість",add_to_rcpt:"Зберегти у довідник",pp:"Номер",value_date:"Дата валютув.",date_doc:"Дата документа",from_acc:"З рахунку",to_acc:"На рахунок",by_amount:"Прошу перерахувати",okpo:"ЄДРПОУ",mfo:"МФО",to_bank:"Банк",seria:"Серія",passp:"Паспорт",expense_item:"Стаття витрат",budget_payment:"Плата до бюджету",payment_kind_code_placeholder:"Починайте вводити код або вид сплати",nds1:"Без ПДВ",nds2:"ПДВ 20%",country_code:"Країна",details_ext:"Призначення платежу",not_required:"не обов.",current:"поточна",autonum:"автонумер.",name:"Найменування",ua_payment:"Гривневе доручення",ua_payment_list:"Гривневі доручення",ua_payment_print_registry:"Друк реєстру",ua_payment_print_docs:"Друк документів",ua_payment_print_registry_title:"Друк реєстру документів",no_nds_dtls:"Без ПДВ.",with_nds_dtls:"у т.ч. ПДВ ",preload_text:"Завантаження списку отримувачів",footer_s_template:"{1} {2} {3} з {4} на загальну суму {5} грн.",footer_selected_sin:"Обрано",footer_selected_pl:"Обрано",footer_1_doc:"доручення",footer_1_doc_pl:"доручення",footer_2_4_docs:"доручення",footer_5_0_docs:"доручень",field_DATE_DOC:"Дата документа",field_NUM_DOC:"Номер документа",field_AMOUNT:"Сума платежу",field_CLN_NAME:"Найменування платника",field_CLN_OKPO:"ЄДРПОУ платника",field_CLN_ACCOUNT:"Рахунок платника",field_CLN_BANK_NAME:"Найменування банку платника",field_CLN_BANK_MFO:"МФО банку платника",field_RCPT_NAME:"Найменування отримувача",field_RCPT_OKPO:"ЄДРПОУ отримувача",field_RCPT_ACCOUNT:"Рахунок отримувача",field_RCPT_BANK_NAME:"Найменування банку отримувача",field_RCPT_BANK_MFO:"МФО банку отримувача",field_PAYMENT_DETAILS:"Призначення платежу",field_VALUE_DATE:"Дата валютування",field_CLN_COUNTRY_CODE:"Код країни платника",field_RCPT_COUNTRY_CODE:"Код країни отримувача",field_EXPENSE_ITEM:"Код бюджетування",field_RCPT_PASSP_SER:"Серія паспорта отримувача",field_RCPT_PASSP_NUM:"Номер паспорта отримувача",field_PAYER_NAME:"Найменування платника",field_PAYER_OKPO:"ЄДРПОУ платника",field_PAYER_ACCOUNT:"Рахунок платника",field_PAYER_BANK_NAME:"Найменування банку платника",field_PAYER_BANK_MFO:"МФО банку платника",field_PAYER_COUNTRY_CODE:"Код країни платника",field_PAYER_PASSP_SER:"Серія паспорта платника",field_PAYER_PASSP_NUM:"Номер паспорта платника",incorrect_payments_kinds:"Зазначений код відсутній в довіднику",incorrectPassp:"Дані паспорта заповнені некоректно. Дані можуть являти собою номер документа (9 символів) або серію та номер документа (6 символів)",bank_client:"ІБІС",requisites_change_is_forbidden:"Для платежів за зарплатним проектом заборонено редагування основних реквізитів отримувача",incoming_payment:"ВХІДНІ",sent_payment:"ВИХІДНІ",code_type:"Код виду сплати",payer_number:"Номер платника",explain_inf:"Призначення платежу",confirm_select:"Вибрати",close_link_btn:"Закрити",start_entering:"Починайте вводити найменування",entering_placeholder:"Починайте вводити",recount_with_nds:"перерахувати суму враховуючи ПДВ",item_search:"Пошук статті",item_code:"Код статті",code_label:"Код",descr_label:"Опис",planned_remainder:"Плановий залишок",archives_notification_1:"Зверніть увагу, що в цьому списку відсутні документи з датою створення не більш, ніж {1}",archives_notification_2:'Для їх перегляду перейдіть на вкладку "Архівні"',pay_sheet:"Зарплатна відомість",link0_title:"Основний платіж",link1_title:"Платіж за РКО",links_warn:"Увага!",links_incorrect:"'{1}' не відповідає відомості. Можлива причина - зміна відомості або документа '{1}'."}),define("apps/ua_payment/nls/uk/ua_payment",["underscore","apps/ua_payment/nls/uk/ua_payment_base"],function(a,b){return a.extend({},b,{bank_client:"Банк-клієнт"})}),define("apps/ua_payment/nls/en/ua_payment_base",{no_uah_accs:"Unable to create a document. Current account in national currency is missing.",number:"Number",date:"Date",rcpt:"Recipient",payer:"Payer",sender:"Sender",acc:"Account",several_accs:"sev. accounts",several_reqs:"sev. requisites",amount:"Amount",details:"Details",status:"Status",links:"Links",linkTo:"Link with",from:"from",amount_from:"Amount from",to:"to",of:"of",amount_to:"Amount to",amountError:"The maximum amount should be more than the minimum",no_filter:"Select all",any:"Any links",no_links:"No links","doc/pay_sheet":"Salary sheet",add_to_rcpt:"Save to the directory",pp:"Number",value_date:"Value date",date_doc:"Document date",from_acc:"From account",to_acc:"To account",by_amount:"Ask to transfer",okpo:"EDRPOU",mfo:"MFO",details_ext:"Payment details",not_required:"optional",current:"current",autonum:"autonum.",name:"Name",ua_payment:"Hryvnia payment order",ua_payment_list:"Hryvnia payment orders",ua_payment_print_registry:"Print a list",ua_payment_print_docs:"Print documents",ua_payment_print_registry_title:"Print a list of documents",to_bank:"Bank",seria:"Series",passp:"Passport",expense_item:"Budget item",budget_payment:"Budget payment",payment_kind_code_placeholder:"Start to enter a code or type of payment",nds1:"VAT not included",nds2:"VAT 20%",country_code:"Country",no_nds_dtls:"Без ПДВ.",with_nds_dtls:"у т.ч. ПДВ ",preload_text:"Loading of recipients list",footer_s_template:"{1} {2} {3} of {4}, total {5} UAH.",footer_selected_sin:"Selected",footer_selected_pl:"Selected",footer_1_doc:"order",footer_1_doc_pl:"orders",footer_2_4_docs:"orders",footer_5_0_docs:"orders",field_DATE_DOC:"Document date",field_NUM_DOC:"Document number",field_AMOUNT:"Amount of payment",field_CLN_NAME:"Payer's name",field_CLN_OKPO:"Payer's EDRPOU",field_CLN_ACCOUNT:"Payer's account",field_CLN_BANK_NAME:"Payer's bank name",field_CLN_BANK_MFO:"Payer's bank MFO",field_RCPT_NAME:"Recipient's name",field_RCPT_OKPO:"Recipient's EDRPOU",field_RCPT_ACCOUNT:"Recipient's account",field_RCPT_BANK_NAME:"Recipient's bank name",field_RCPT_BANK_MFO:"Recipient's bank MFO",field_PAYMENT_DETAILS:"Payment details",field_VALUE_DATE:"Value date",field_CLN_COUNTRY_CODE:"Country code of payer",field_RCPT_COUNTRY_CODE:"Country code of recipient",field_EXPENSE_ITEM:"Budgetary code",field_RCPT_PASSP_SER:"Recipient's passport series",field_RCPT_PASSP_NUM:"Recipient's passport number",field_PAYER_NAME:"Payer's name",field_PAYER_OKPO:"Payer's EDRPOU",field_PAYER_ACCOUNT:"Payer's account",field_PAYER_BANK_NAME:"Payer's bank name",field_PAYER_BANK_MFO:"Payer's bank MFO",field_PAYER_COUNTRY_CODE:"Country code of payer",field_PAYER_PASSP_SER:"Payer's passport series",field_PAYER_PASSP_NUM:"Payer's passport number",incorrect_payments_kinds:"Specified code does not exist in directory",incorrectPassp:"Passport requisites are filled incorrectly. Requisites may be a number of the document (9 characters) or a series and number (6 characters)",bank_client:"IBIS",requisites_change_is_forbidden:"It is not allowed to edit the basic requisites of the recipient in the salary project payments",incoming_payment:"INBOX",sent_payment:"OUTBOX",code_type:"Code of payment type",payer_number:"Payer's number",explain_inf:"Payment details",confirm_select:"Select",close_link_btn:"Close",start_entering:"Start typing the name",entering_placeholder:"Start typing",recount_with_nds:"recount the amount in view of VAT",item_search:"Item search",item_code:"Item code",code_label:"Code",descr_label:"Description",planned_remainder:"Planned balance",archives_notification_1:"Please note that in this list are no documents created before {1}",archives_notification_2:'To view them, click on the tab "Archived"',pay_sheet:"Salary sheet",link0_title:"Main payment",link1_title:"Payment for CSS",links_warn:"Attention!",links_incorrect:"'{1}' does not match the salary sheet. Possible cause - changes in salary sheet or in document '{1}'."}),define("apps/ua_payment/nls/en/ua_payment",["underscore","apps/ua_payment/nls/en/ua_payment_base"],function(a,b){return a.extend({},b,{bank_client:"Bank-client"})}),define("apps/ua_payment/ua_payment_model",["jquery","underscore","backbone","collections/thesaurus","bifit","appsPieces","customConstants","models/base_document","i18n!apps/ua_payment/nls/ua_payment","i18n!nls/validation","backboneValidation"],function(a,b,c,d,e,f,g,h,i,j){"use strict";d.getThesaurus("country").fetch();var k=function(a,b,c,d){var e;return"0000000000"===c[d.okpo]&&(a?2!==a.length&&(e=j.invalid_field):9!==c[d.num].length&&(e=j.required)),e},l=function(a,b,c,d){var e;return"0000000000"===c[d.okpo]&&(a?a.length!==(c[d.ser]?6:9)?e=j.invalid_field:a.match(/^\d+$/)||(e=j.incorrect_digest):e=j.required),e};return h.extend({type:"ua_payment",nls:i,defaults:{status:"",status_desc:"",status_color:"000000",planned_remainder:"",DATE_DOC:"",NUM_DOC:"",AMOUNT:"",CLN_NAME:"",CLN_OKPO:"",CLN_ACCOUNT:"",CLN_BANK_NAME:"",CLN_BANK_MFO:"",RCPT_NAME:"",RCPT_OKPO:"",RCPT_ACCOUNT:"",RCPT_BANK_NAME:"",RCPT_BANK_MFO:"",PAYMENT_DETAILS:"",VALUE_DATE:"",CLN_COUNTRY_CODE:"",EXPENSE_ITEM:"",RCPT_COUNTRY_CODE:"",RCPT_PASSP_SER:"",RCPT_PASSP_NUM:""},checkPasspSer:k,checkPasspNum:l,meta:b.extend({},h.prototype.meta,{relatively:b.extend({RCPT_NAME:function(a){return a},AMOUNT:function(a){return parseFloat(a)},CLN_NAME:function(a){return a},PAYER_NAME:function(a){return a}},h.prototype.meta.relatively),formattedFields:{AMOUNT:function(){return this._amountFormatter(this.get("AMOUNT"),2)},planned_remainder:function(){return e.formatAmount(this.get("planned_remainder"))}}}),order:["DATE_DOC","NUM_DOC","AMOUNT","CLN_NAME","CLN_OKPO","CLN_ACCOUNT","CLN_BANK_NAME","CLN_BANK_MFO","RCPT_NAME","RCPT_OKPO","RCPT_ACCOUNT","RCPT_BANK_NAME","RCPT_BANK_MFO","PAYMENT_DETAILS","VALUE_DATE","RCPT_COUNTRY_CODE","CLN_COUNTRY_CODE"],validation:{NUM_DOC:{numDocRequired:!0,maxLength:10},DATE_DOC:{required:!0,dateDoc:!0},AMOUNT:[{required:!0},{max:999999999999.99,pattern:/^\d+\.\d{2}$/,msg:j.incorrect_amount},{min:.01,msg:j.positive_amount}],CLN_NAME:{required:!0,maxLength:40,clientInfo:"name_cln"},CLN_OKPO:{required:!0,clientInfo:"okpo",minLength:8,maxLength:10,digits:!0},CLN_ACCOUNT:[{required:!0,minLength:5,maxLength:14,digits:!0},{fn:function(a){var c,d=b.where(f.getAccounts(g.ACCOUNT_TYPES,!0).UAH,{account:a});if(0===d.length)return c=j.invalid_field;var e=b.any(d,function(a){return a.permissions>0});return e||(c=j.account_not_permission),c}}],CLN_BANK_NAME:{required:!0,maxLength:45},CLN_BANK_MFO:[{required:!0,length:6,digits:!0},{fn:function(a){var c,e=b.any(d.getThesaurus("accs_info").array,function(b){return b.mfo===a});return e||(c=j.invalid_field),c}}],RCPT_NAME:{required:!0,minLength:3,maxLength:40},RCPT_OKPO:{okpo:!0},RCPT_ACCOUNT:[{required:!0,minLength:5,maxLength:14,digits:!0,calcAcc:"RCPT_BANK_MFO"},{fn:function(a,b,c){var d;return c.CLN_ACCOUNT===a&&(d=j.rcpt_acc_eq_cln),d}}],RCPT_BANK_NAME:{required:!0,maxLength:45},RCPT_BANK_MFO:[{required:!0,length:6,digits:!0},{fn:function(a,b,c){var d,e=c.RCPT_BANK_NAME;return e||(d=j.mfo_not_found),d}}],PAYMENT_DETAILS:{required:!0,minLength:3,maxLength:g.PAYMENT_DETAILS_LENGTH},VALUE_DATE:{fn:function(a,b,c){var d;if(a)if(e.checkDateMatch(a)){var f=c.DATE_DOC||e.date2str(new Date);if(f){f=e.str2date(f),a=e.str2date(a);var g=a.getTime()-f.getTime();0>g?d=j.value_date_01:Math.floor(g/1e3/60/60/24)>10&&(d=this._valueDateErrorWrapper(10))}}else d=j.incorrect_date;return d}},CLN_COUNTRY_CODE:{required:!1,digits:!0},RCPT_COUNTRY_CODE:{fn:function(a,c,e){var f,g=e.RCPT_OKPO;return"000000000"===g&&(a?3!==a.length?f=j.invalid_field:a.match(/^\d+$/)?b.findWhere(d.getThesaurus("country").array,{code:a})||(f=j.invalid_field):f=j.incorrect_digest:f=j.required),f}},RCPT_PASSP_SER:{fn:function(a,b,c){return k(a,b,c,{okpo:"RCPT_OKPO",ser:"RCPT_PASSP_SER",num:"RCPT_PASSP_NUM"})}},RCPT_PASSP_NUM:{fn:function(a,b,c){return l(a,b,c,{okpo:"RCPT_OKPO",ser:"RCPT_PASSP_SER",num:"RCPT_PASSP_NUM"})}}},getCurrency:function(){return"UAH"}})}),define("apps/ua_payment/ua_payment_confirm",["app","jquery","underscore","collections/thesaurus","thesaurusUtils","libs/multi_client_utils","bifit","i18n!nls/common","commons/base_object/base_confirm","chosen"],function(a,b,c,d,e,f,g,h,i){"use strict";var j=function(a){if(this.silent_error=a.silent_error,this.groupedCollection=a.groupedCollection,this.data={},this.idsOfAllDocs=[],this.model){var b={};b[this.model.id]=this.model,this.data[this.model.get("owner_id")]=b,this.idsOfAllDocs.push(this.model.id)}this.collection&&c.each(this.groupedCollection,function(a,b){var d={};c.each(a,function(a){d[a.id]=a,this.idsOfAllDocs.push(a.id)},this),this.data[b]=d},this),this.idsOfAllDocs=this.idsOfAllDocs.join(",")},k=function(a,b){var c=localStorage.getItem("addr"),d=this.model||this.collection[0];return g.sprintf("{1}/document/{2}/{3}/{4}{5}",c,d.type,b,a,d._session())},l=function(e){function g(d){a.isMultiClient()&&(a.multiClient.currentSubClientId=j[d][0]);var l=j[d][1],m=c.keys(l).join(",");(a.isMultiClient()?f:b).ajax({url:k.call(i,"confirm",m),type:"post",dataType:"json",data:JSON.stringify(e),success:function(a){a=c.reject(a,function(a){return a.session_password?(e.session_password=a.session_password,!0):!1});var f=!1;c.each(a,function(a){var d=l[a.doc_id||a.id];c.has(a,"error")?(d.trigger("model:completeSync",d,h.error,a.message,400),f=!0,i.silent_error||b("<div class='errors'>"+a.message+"</div>").insertAfter(i.$("input:last"))):(d.set(a),d.trigger("model:completeSync",d,"Ok","",200))}),f&&!i.silent_error||i.trigger("navigate","finish"),d<j.length-1&&g(d+1)},error:function(a){b("<div class='errors'>"+a.responseText+"</div>").insertBefore(i.$("br:last"))}})}this.$("div.errors").remove();var i=this;a.isMultiClient()&&(e.mempl_id=d.getThesaurus("mempl_info").array[0].empl_id);var j=c.pairs(this.data);g(0)},m=i.OTPView.extend({initialize:function(a){i.OTPView.prototype.initialize.call(this,a),j.call(this,a)},loadTokenSerials:function(a){d.getThesaurus("token_serials",!1).fetch().done(a)},getEmployeeTokenSerial:function(){var b=a.isMultiClient()?"mempl_info":"empl_info";return d.getThesaurus(b).array[0].token_serial},confirm:l}),n=i.GoogleView.extend({initialize:function(a){i.GoogleView.prototype.initialize.call(this,a),j.call(this,a)},confirm:l}),o=i.SMSView.extend({initialize:function(a){i.SMSView.prototype.initialize.call(this,a),j.call(this,a)},getUrl:function(a){return k.call(this,a,this.idsOfAllDocs)},getMobilePhone:function(){return d.getThesaurus(a.isMultiClient()?"mempl_info":"empl_info").array[0].phone},getSendAgainTimeProp:function(){return e.getClientProp("security.sms.send_again_time")},confirm:l});return i.extend({initialize:function(a){i.prototype.initialize.call(this,a),this.silent_error=a.silent_error,this.map=c.extend(c.clone(i.STEP_VIEWS_MAP),{sms:o,otp:m,google:n}),this.model?this.clientsId=this.model.get("owner_id"):this.collection&&(this.groupedCollection=c.groupBy(this.collection,function(a){return a.get("owner_id")}),this.clientsId=c.keys(this.groupedCollection).join(";"))},getOptions:function(){return{collection:this.collection,silent_error:this.silent_error,groupedCollection:this.groupedCollection}},render:function(){var a={data:{query:this.clientsId}};return d.getThesaurus("document_confirm",!1).fetch(a).done(function(a){this.obtainable=c.intersection(c.keys(a[0]),c.keys(this.map)),!c.contains(this.obtainable,"google")||0!==d.getThesaurus("google_auth").array.length&&"true"===g.getStorageData("google.authenticator.can_usage")||(this.obtainable=c.without(this.obtainable,"google"));var b;switch(this.obtainable.length){case 0:b="empty";break;case 1:b="otp"===this.obtainable[0]?"otp":"way";break;default:b="way"}this.to(this.map[b])}.bind(this)),this}})}),define("text!templates/views/document/group-filter.tmpl",[],function(){return'<div class="group-checkbox" onmousedown="return false" onselectstart="return false">\n    <div class="popup-wrapper bottom sub-menu">\n        <ul class="popup filter">\n        </ul>\n    </div>\n</div>\n\n'}),define("commons/base_object/document/group_opers_doc_list_view",["jquery","underscore","app","bifit","services/doc_statuses","actionUtils","commons/base_object/base_list_view","text!templates/views/document/group-filter.tmpl","i18n!nls/document","libs/group_opers_utils"],function(a,b,c,d,e,f,g,h,i,j){"use strict";return g.extend({events:b.extend(g.prototype.events,{"click th.check input":"markAll","click div.group-checkbox a":"markByStatus","click div.group-checkbox":"toggleFilter"}),childEvents:b.extend(g.prototype.childEvents,{markOne:"markOne"}),footerNls:null,isAccountsForCreateAction:null,initialize:function(a){g.prototype.initialize.apply(this,arguments),this.isAccountsForCreateAction=a.isAccountsForCreateAction,"false"!==d.getStorageData("is_need_deselect_selected_items")&&b.each(this.collection.selected,function(a){this.collection.deselect(a)}.bind(this)),d.setStorageData("is_need_deselect_selected_items","true")},selectItem:function(a,b){g.prototype.selectItem.call(this,a,b),d.setStorageData("is_need_deselect_selected_items","false")},onRender:function(){g.prototype.onRender.call(this),this.prepareTable()},prepareTable:function(){j.prepareTable.call(this),this.initStatusSelector(),this.postModelMark()},initStatusSelector:function(){var c=b.uniq(b.map(this.collection.models,function(a){return a.get("status")})),f=b.intersection(c,["0","1","3004"]);if(f){if(f.length>1){var g=d.getLocale(),j=a(b.template(h,i)),k=j.find("ul");b.each(f,function(b){var c=parseInt(b,10),f=d.sprintf(i.flt_st,e.getLocalizedNameById(c,g)),h="st"+b;a("<li><a data-action='"+h+"' href='#'>"+f+"</a></li>").appendTo(k)}.bind(this)),this.$("table.list").find("th.check").append(j)}}else this.$("table.list").find("th.check, td.check").hide()},toggleFilter:function(b){b.stopPropagation();var c=a(b.target).find(".sub-menu"),d=function(){c.hide(),a("div.group-checkbox").removeClass("shadow"),a(document).unbind("click.filter-sub-menu")};return"block"===c.css("display")?d():(c.show(),this.$("div.group-checkbox").addClass("shadow"),a(document).bind("click.filter-sub-menu",d)),!0},markOne:j.markOne,markAll:j.markAll,markByStatus:function(c){c.preventDefault(),this.$(".group-checkbox .sub-menu").hide(),this.$("tbody tr").removeClass("selected"),this.$("tbody tr").find("input").prop("checked",!1),this.collection.selectNone();var d=a(c.target).attr("data-action");this.$("tbody tr."+d).addClass("selected"),this.$("tbody tr.selected input").prop("checked",!0);var e=this.collection.where({status:d.substr("st".length)});b.each(e,function(a){a.select()}),this.postModelMark()},postModelMark:function(){var a=this.collection.selectedLength>0,c=this.getAvailableActions(a),d=0;a&&b.each(this.collection.selected,function(a){c=b.intersection(c,f.getPossibleActions(a)),d+=parseFloat(a.getAmount())});var e=this.collection.length===this.collection.selectedLength;this.$("th.check input")[e?"removeClass":"addClass"]("some"),this.$("th.check input").prop("checked",a),this.trigger("update-actions",this.getPermittedActions(c)),this.changeFooter(d.toFixed(2))},getAvailableActions:function(a){var b;return a?(b=[f.DocumentAction.PRINT],(c.isMultiClient()||this.isAccountsForCreateAction)&&(b=b.concat([f.DocumentAction.SIGN,f.DocumentAction.COPY,f.DocumentAction.DELETE]))):(c.isMultiClient()||this.isAccountsForCreateAction)&&(b=[f.DocumentAction.CREATE,f.DocumentAction.IMPORT]),b},getPermittedActions:function(a){for(var c=["CREATE","IMPORT","PRINT","SIGN","COPY","DELETE","CONFIRM","TOGGLE","CFC_CONFIRM","CFC_REJECT","CFC_SIGN"],d=this.getDocumentTypeForActions(),e=[],g=0;g<c.length;g++){var h=c[g],i=b.contains(a,f.DocumentAction[h])&&f.isActionPermitted(h,d);i&&e.push(h+(b.contains(["CREATE","IMPORT"],h)?"":"_GROUP"))}return e},getDocumentTypeForActions:function(){return this.collection.options.document_type},changeFooter:function(a){if(this.footerNls){var b=this.$("tfoot.summary"),c=this.collection.selectedLength;if(b.length){b[c?"show":"hide"]();var e=c%100,f="footer_5_0_docs",g="footer_selected_pl";if(11>e||e>19){var h=c%10;1===h?(f=1===c?"footer_1_doc":"footer_1_doc_pl",g="footer_selected_sin"):h>1&&5>h&&(f="footer_2_4_docs")}var i=this.footerNls,j=d.sprintf(i.footer_s_template,i[g],c,i[f],this.collection.length,a);b.find("td").html(j).trigger("footer:change",c)}}}})}),define("commons/base_object/group_opers_list_item_view",["commons/base_object/base_list_item_view"],function(a){"use strict";return a.extend({triggers:{"click td:not(.check)":"selectItem"},events:{"click td.check input":function(a){this.trigger("markOne",a)}}})}),define("text!apps/ua_payment/templates/ua_payment_list.tmpl",[],function(){return'<table class="list ua_payment" style="display: table;">\n    <thead class="widescreen">\n    <tr>\n        <th class="check">\n            <input type="checkbox"/>\n            <span class="checkbox"></span>\n        </th>\n        <th class="number">\n            <span class="sortable" data-field="NUM_DOC"><%- number %></span>\n        </th>\n        <th class="date">\n            <span class="sortable" data-field="DATE_DOC"><%- date %></span>\n        </th>\n        <% if (!isMultiClient()) { %>\n            <th class="rcpt-account">\n                <span class="sortable" data-field="RCPT_ACCOUNT"><%- field_RCPT_ACCOUNT %></span>\n            </th>\n        <% } %>\n        <% if (isMultiClient()) { %>\n            <th class="payer ellipsis">\n                <span class="sortable" data-field="CLN_NAME"><%= payer %></span>\n            </th>\n        <% } %>\n        <th class="rcpt ellipsis">\n            <span class="sortable" data-field="RCPT_NAME"><%- rcpt %></span>\n        </th>\n        <th class="amount">\n            <span class="sortable" data-field="AMOUNT"><%- amount %></span>\n        </th>\n        <th class="status">\n            <span class="sortable" data-field="status_desc"><%- status %></span>\n        </th>\n        <th class="empty"></th>\n        <th class="mobile">&nbsp;</th>\n    </tr>\n    </thead>\n    <tbody></tbody>\n    <tfoot class="summary">\n        <tr>\n            <td colspan="8"></td>\n        </tr>\n    </tfoot>\n</table>\n'}),define("text!apps/ua_payment/templates/ua_payment_list_item.tmpl",[],function(){return'<td class="check widescreen"><input type=\'checkbox\'/><span class="checkbox"></span></td>\n<td class="number widescreen"><%- NUM_DOC %></td>\n<td class="date widescreen"><%- DATE_DOC %></td>\n<% if (!isMultiClient()) { %>\n<td class="rcpt-account widescreen"><%- RCPT_ACCOUNT %></td>\n<% } %>\n<% if (isMultiClient()) { %>\n    <td class="payer ellipsis widescreen"><%- CLN_NAME %></td>\n<% } %>\n<td class="rcpt ellipsis widescreen"><%- RCPT_NAME %></td>\n<td class="amount widescreen"><%- formatAmount(AMOUNT) %></td>\n<td class="status widescreen"><%- status_desc %></td>\n<td class="empty"></td>\n<td class="deposits mobile">\n    <span class=\'date\'><%- DATE_DOC %></span>\n    <span class=\'amount\'><%- formatAmount(AMOUNT) %></span>\n    <span class=\'rcpt ellipsis\'><%- RCPT_NAME %></span>\n    <span class=\'status\'><%- status_desc %></span>\n</td>\n'}),define("apps/ua_payment/ua_payment_list_view",["app","jquery","underscore","bifit","actionUtils","commons/base_object/document/group_opers_doc_list_view","commons/base_object/group_opers_list_item_view","text!apps/ua_payment/templates/ua_payment_list.tmpl","text!apps/ua_payment/templates/ua_payment_list_item.tmpl","text!templates/views/document/group-filter.tmpl","i18n!apps/ua_payment/nls/ua_payment"],function(a,b,c,d,e,f,g,h,i,j,k){"use strict";return f.extend({template:c.template(h),templateHelpers:c.extend({},f.prototype.templateHelpers,k),childView:g.extend({template:c.template(i)}),footerNls:k,getAvailableActions:function(c){var d=[e.DocumentAction.PRINT];return(a.isMultiClient()||this.isAccountsForCreateAction)&&(c?"archived"===b("#tab_statuses .current").attr("data-status")?d.push(e.DocumentAction.COPY):(d=d.concat([e.DocumentAction.SIGN,e.DocumentAction.COPY,e.DocumentAction.DELETE,e.DocumentAction.CONFIRM]),a.isMultiClient()&&(d=d.concat([e.DocumentAction.CFC_CONFIRM,e.DocumentAction.CFC_REJECT]))):d=d.concat([e.DocumentAction.CREATE,e.DocumentAction.IMPORT])),d}})}),define("commons/base_object/document/document_status_filter_view",["underscore","bifit","collections/thesaurus","services/doc_statuses","commons/base_object/document/document_filter_view","i18n!nls/document-filter"],function(a,b,c,d,e,f){"use strict";return e.extend({ui:a.extend({status:"#state_chosen_filter",statusContainer:"div.state-chosen-filter"},e.prototype.ui),statusesIds:[],statusSelection:{},initialize:function(){e.prototype.initialize.apply(this,arguments),this.on("tabStatus:changed",this.refreshStatusesForTab.bind(this))},reload:function(a){var b=this.getStatusFilterString();b&&(a=a||{},a.status=b),e.prototype.reload.call(this,a)},showTabStatuses:function(){e.prototype.showTabStatuses.apply(this,arguments),this.initStatusChosen(),this.refreshStatusesForTab()},initStatusChosen:function(){var c=b.getLocale();this.ui.statusContainer.show(),this.ui.status.chosen({searchable:!1,data:{array:[],id:"status_id",text:"localized_name",selection:this.statusSelection,all:f.any},renderInput:function(e,g){var h,i=a.size(g.selection);if(g.selection.all)h=f.any;else if(1===i){var j=parseInt(a.keys(g.selection)[0],10);h=d.getLocalizedNameById(j,c)}else h=b.sprintf(f.several,i);e.val(h)}}),this.ui.status.on("group:itemSelected",function(b,c,d){"all"!==c&&(delete d.selection.all,a.size(d.selection)===d.array.length-1&&(d.selection.all=!0))}),this.ui.status.on("chosen:group:selected",function(){a.isEmpty(this.statusSelection)&&this.ui.status.trigger("chooseById","all")}.bind(this))},refreshStatusesForTab:function(){if(!this.canSelectStatus())return void this.ui.statusContainer.hide();var b=this.statusSelection.all?[]:a.keys(this.statusSelection);this.ui.statusContainer.show(),this.ui.status.trigger("refresh",{array:this.getStatusesForSelectedTab()}),a.each(b,function(a){this.ui.status.trigger("chooseById",a)}.bind(this)),a.isEmpty(this.statusSelection)&&this.ui.status.trigger("chooseById","all")},canSelectStatus:function(){return this.tabsStatuses[this.tabsStatuses.selectedTab].split(",").length>1},getStatusesForSelectedTab:function(){var c=b.getLocale(),e=this.tabsStatuses[this.tabsStatuses.selectedTab].split(",");return a.chain(this.statusesIds).map(function(b){return a.contains(e,b)?{status_id:b,localized_name:d.getLocalizedNameById(b,c)}:void 0}).compact().value()},getStatusFilterString:function(){return this.canSelectStatus()&&!this.statusSelection.all?a.keys(this.statusSelection).join(","):null},restoreLastLoadFilterData:function(){this.lastLoadFilterData.status&&(a.each(this.statusSelection,function(a,b,c){delete c[b]}),a.each(this.lastLoadFilterData.status.split(","),function(a){this.ui.status.trigger("chooseById",a)}.bind(this))),e.prototype.restoreLastLoadFilterData.call(this)}})}),define("text!apps/ua_payment/templates/ua_payment_ext_filter.tmpl",[],function(){return'<div id="expanded-view">\n    <% if (isMultiClient()) { %>\n    <div class="data-row">\n        <div class="row">\n            <label for="client" class="col-xs-12"><%- payer %></label>\n        </div>\n        <div class="row">\n            <div class="col-xs-12"><input class="ellipsis" id="client"></div>\n        </div>\n    </div>\n    <% } %>\n    <div class="data-row">\n        <div class="row">\n            <label class="col-xs-4"><%- field_NUM_DOC %></label>\n            <label class="col-xs-8 links"><%- links %></label>\n        </div>\n        <div class="row">\n            <div class="col-xs-4">\n                <input autocomplete="off" maxlength="10" id="NUM_DOC">\n            </div>\n            <div class="col-xs-8 links">\n                <input id="LINK_TYPE">\n            </div>\n        </div>\n    </div>\n    <div class="data-row">\n        <div class="row">\n            <label class="col-xs-6"><%- amount %></label>\n            <label class="col-xs-6"><%- from_acc %></label>\n        </div>\n        <div class="row">\n            <div class="col-xs-6">\n                <div class="row">\n                    <div class="col-xs-5">\n                        <input id="AMOUNT_MIN" class="sum" autocomplete="off" placeholder="<%- from %>">\n                    </div>\n                    <div class="col-xs-1">\n                        <label class="amount-to">-</label>\n                    </div>\n                    <div class="col-xs-5">\n                        <input id="AMOUNT_MAX" class="sum" autocomplete="off" placeholder="<%- to %>">\n                    </div>\n                </div>\n            </div>\n            <div class="col-xs-6">\n                <input id="CLN_ACCOUNT" maxlength="14" autocomplete="off" placeholder="<%- entering_placeholder %>">\n            </div>\n        </div>\n    </div>\n    <div class="data-row">\n        <div class="row">\n            <label class="col-xs-8"><%- rcpt %></label>\n            <label class="col-xs-4"><%- to_acc %></label>\n        </div>\n        <div class="row">\n            <div class="col-xs-8">\n                <input id="RCPT_NAME" maxlength="40" autocomplete="off" placeholder="<%- start_entering %>">\n            </div>\n            <div class="col-xs-4">\n                <input id="RCPT_ACCOUNT" maxlength="14" autocomplete="off" placeholder="<%- entering_placeholder %>">\n            </div>\n        </div>\n    </div>\n    <div class="data-row">\n        <div class="row">\n            <label class="col-xs-4"><%- okpo %></label>\n            <label class="col-xs-8"><%- details_ext %></label>\n        </div>\n        <div class="row">\n            <div class="col-xs-4">\n                <input id="RCPT_OKPO" maxlength="10" autocomplete="off" placeholder="<%- entering_placeholder %>">\n            </div>\n            <div class="col-xs-8">\n                <input id="PAYMENT_DETAILS" maxlength="160" autocomplete="off">\n            </div>\n        </div>\n    </div>\n</div>\n<div id="minimized-view"></div>\n'}),define("apps/ua_payment/ua_payment_ext_filter_view",["underscore","backbone","app","bifit","customConstants","collections/thesaurus","appsPieces","commons/base_object/document/document_ext_filter_view","text!apps/ua_payment/templates/ua_payment_ext_filter.tmpl","i18n!apps/ua_payment/nls/ua_payment"],function(a,b,c,d,e,f,g,h,i,j){"use strict";var k=["no_filter","any","no_links","doc/pay_sheet"];k=a.map(k,function(a){return{id:a,text:j[a]}});var l=new b.Collection;return h.extend({template:a.template(i),templateHelpers:a.extend({},j,h.prototype.templateHelpers),className:"ua_payment",ui:a.defaults({NUM_DOC:"#NUM_DOC",AMOUNT_MIN:"#AMOUNT_MIN",AMOUNT_MAX:"#AMOUNT_MAX",CLN_ACCOUNT:"#CLN_ACCOUNT",LINK_TYPE:"#LINK_TYPE",RCPT_NAME:"#RCPT_NAME",RCPT_ACCOUNT:"#RCPT_ACCOUNT",RCPT_OKPO:"#RCPT_OKPO",PAYMENT_DETAILS:"#PAYMENT_DETAILS",client:"#client",status:"#STATUS",links:"#expanded-view .links"},h.prototype.ui),events:a.defaults({"blur @ui.AMOUNT_MIN":"validateFilterAmount","blur @ui.AMOUNT_MAX":"validateFilterAmount","chosen:select @ui.LINK_TYPE":"onChangeLinkType","chosen:select @ui.RCPT_NAME":"onRecipientSelected","chosen:select @ui.RCPT_ACCOUNT":"onRecipientAccountSelected","chosen:select @ui.RCPT_OKPO":"onRecipientSelected","blur @ui.RCPT_NAME":"onRecipientChanged",
"blur @ui.RCPT_OKPO":"onRecipientChanged"},h.prototype.events),fieldsMeta:{NUM_DOC:{idx:"1",order:2,label:j.field_NUM_DOC},AMOUNT_MIN:{idx:"2",order:4,label:j.amount_from,type:"amount",operation:">="},AMOUNT_MAX:{idx:"2",order:5,label:j.amount_to,shortLabel:j.to,type:"amount",operation:"<="},CLN_ACCOUNT:{idx:"5",order:6,label:j.from_acc},RCPT_NAME:{idx:"8",order:7,label:j.rcpt},RCPT_ACCOUNT:{idx:"10",order:8,label:j.to_acc},RCPT_OKPO:{idx:"9",order:9,label:j.okpo},PAYMENT_DETAILS:{idx:"13",order:10,label:j.details_ext},client:{idx:"3",order:1,type:"client",label:j.payer}},isFieldsOrder:!0,initialize:function(a){this.collection=l,this.recipients=[],h.prototype.initialize.call(this,a)},getExtFilterData:function(){var a=h.prototype.getExtFilterData.call(this);return this.trigger("getExtFilterData",this.collection),a},initForm:function(){this.addFormatters(),this.initChosens(),this.listenTo(c.mainLayout.content,"content:reloaded",this.highlightFoundText)},addFormatters:function(){this.ui.AMOUNT_MIN.formatter("amount"),this.ui.AMOUNT_MAX.formatter("amount"),this.ui.CLN_ACCOUNT.formatter("number"),this.ui.RCPT_ACCOUNT.formatter("number"),this.ui.RCPT_OKPO.formatter("number")},initChosens:function(){this.initClnAccountChosen(),this.initLinksChosen(),this.initRcptNameChosen(),this.initRcptOkpoChosen(),this.initRcptBillsChosen(),this.fillRcptChosens()},fillRcptChosens:function(){var a=c.isMultiClient()?f.loadMultiClientThesaurus("ua_recipients"):f.loadClientThesaurus("ua_recipients");a.done(function(a){this.recipients=a,this.fillRcptAccountsChosen(),this.fillRcptNameChosen(a),this.fillRcptOkpoChosen(a)}.bind(this))},fillRcptAccountsChosen:function(){if(this.recipients.length)if(this.ui.RCPT_ACCOUNT.val()&&this.ui.RCPT_NAME.val()&&this.ui.RCPT_OKPO.val()){var b=a.findWhere(this.recipients,{name:this.ui.RCPT_NAME.val(),inn:this.ui.RCPT_OKPO.val()});b&&this.ui.RCPT_ACCOUNT.trigger("refresh",{array:b.requisites})}else this.fillAllRcptAccountsChosen()},fillAllRcptAccountsChosen:function(){if(this.recipients&&this.recipients.length){var b=a.flatten(a.pluck(this.recipients,"requisites"));this.ui.RCPT_ACCOUNT.trigger("refresh",{array:b})}},fillRcptNameChosen:function(a){this.ui.RCPT_NAME.trigger("refresh",{array:a})},fillRcptOkpoChosen:function(a){this.ui.RCPT_OKPO.trigger("refresh",{array:a})},initLinksChosen:function(){this.ui.LINK_TYPE.chosen({searchable:!1,data:{array:k,id:"id",text:"text"}})},initClnAccountChosen:function(){this.ui.CLN_ACCOUNT.chosen({accType:e.NEED_SHOW_ACC_TYPE,data:{id:"account_id",array:[],text:"account"}});var a=g.getAccounts(e.ACCOUNT_TYPES,!0).UAH;g.removeDepositAccountsWithoutLinks(a).then(function(a){this.ui.CLN_ACCOUNT.trigger("refresh",{array:g.addAccountTypeDescription(a)})}.bind(this))},initRcptNameChosen:function(){this.ui.RCPT_NAME.chosen({data:{array:[],id:"id",text:"name"}})},initRcptOkpoChosen:function(){this.ui.RCPT_OKPO.chosen({data:{array:[],id:"id",text:"inn"}})},initRcptBillsChosen:function(){this.ui.RCPT_ACCOUNT.chosen({data:{array:[],id:"id",text:"bill"}})},collectAdditionalData:function(){var a=[];return this.linkType&&"no_filter"!==this.linkType.value&&a.push(this.linkType),a},restoreAdditionalFields:function(){var a=this.collection.get("LINK_TYPE");this.ui.LINK_TYPE.trigger("chooseById",a?a.get("value"):"no_filter")},onChangeLinkType:function(a,b){this.linkType={id:"LINK_TYPE",order:3,value:b.id,displayValue:b.text,label:j.linkTo}},onRecipientSelected:function(a,b){var c=b.requisites[0];this.ui.RCPT_NAME.val(d.getContent(b,"name")),this.ui.RCPT_OKPO.val(d.getContent(b,"inn")),this.ui.RCPT_ACCOUNT.trigger("refresh",{array:b.requisites}),this.ui.RCPT_ACCOUNT.val(d.getContent(c,"bill")),this.ui.PAYMENT_DETAILS.val(c.comment)},onRecipientAccountSelected:function(a,b){this.fillRcptFields(b)},fillRcptFields:function(a){var b=this.findRcptByRequisite(a);b&&(this.ui.RCPT_ACCOUNT.trigger("refresh",{array:b.requisites,value:d.getContent(a,"bill")}),this.ui.RCPT_NAME.val(d.getContent(b,"name")),this.ui.RCPT_OKPO.val(d.getContent(b,"inn")),this.ui.PAYMENT_DETAILS.val(a.comment))},findRcptByRequisite:function(a){if(this.recipients.length)for(var b,c=0;c<this.recipients.length;c++){b=this.recipients[c].requisites;for(var d=0;d<b.length;d++)if(b[d].id===a.id)return this.recipients[c]}},onRecipientChanged:function(){this.ui.RCPT_NAME.val()||this.ui.RCPT_OKPO.val()||(this.ui.RCPT_ACCOUNT.val(""),this.fillRcptAccountsChosen())},getAdditionalFilter:function(){var a={},b=this.collection.get("LINK_TYPE");return b&&(a.linkType=b.get("value")),a},highlightFoundText:function(){var a=this.collection.get("NUM_DOC");a&&g.highlightFoundText(a.get("value"),"td.number");var b=this.collection.get("RCPT_NAME");b&&g.highlightFoundText(b.get("value"),"td.rcpt");var c=this.collection.get("RCPT_ACCOUNT");c&&g.highlightFoundText(c.get("value"),"td.rcpt-account")},setDefaults:function(){this.ui.LINK_TYPE.trigger("chooseById","no_filter"),this.fillAllRcptAccountsChosen()},handleTabStatusChanged:function(a){this.ui.links.length&&this.ui.links.css("display","archived"===a.selectedTab?"none":"block")},onBeforeDestroy:function(){this.ui.LINK_TYPE.disposeChosen(),this.ui.RCPT_NAME.disposeChosen(),this.ui.CLN_ACCOUNT.disposeChosen(),this.ui.RCPT_ACCOUNT.disposeChosen(),this.ui.RCPT_OKPO.disposeChosen(),h.prototype.onBeforeDestroy.call(this)}})}),define("apps/ua_payment/ua_payment_mclient_ext_filter_view",["jquery","underscore","bifit","customConstants","collections/thesaurus","appsPieces","apps/ua_payment/ua_payment_ext_filter_view"],function(a,b,c,d,e,f,g){"use strict";var h=function(a){return f.getClnAccounts(a).then(function(c){return f.removeDepositAccountsWithoutLinks(c,a).then(function(a){return b.filter(a,function(a){return"UAH"===a.currency&&"2"===a.status&&b.contains(["1","3","10"],a.type)})})})};return g.extend({events:b.extend({"change @ui.client":"onClientNameChanged"},g.prototype.events),initClnAccountChosen:function(){this.ui.CLN_ACCOUNT.chosen({accType:d.NEED_SHOW_ACC_TYPE,data:{id:"id",array:[],text:"account"}})},onClientNameChanged:function(){var c=this.ui.client.val(),d=b.findWhere(e.getThesaurus("sub_clients").array,{name_cln:c});a.when(d?h(d.client_id):[]).done(function(a){a=f.addAccountTypeDescription(a);var c=this.ui.CLN_ACCOUNT.val();this.ui.CLN_ACCOUNT.trigger("refresh",{array:a});var d=c&&(!a.length||b.any(a,function(a){return a.account.indexOf(c)>-1}));d&&this.ui.CLN_ACCOUNT.val(c).change()}.bind(this))},highlightFoundText:function(){g.prototype.highlightFoundText.call(this);var a=this.collection.get("client");a&&f.highlightFoundText(a.get("value"),"td.payer")}})}),define("apps/ua_payment/ua_payment_filter_view",["jquery","underscore","backbone","app","bifit","commons/base_object/document/document_status_filter_view","apps/ua_payment/ua_payment_ext_filter_view","apps/ua_payment/ua_payment_mclient_ext_filter_view","collections/thesaurus","components/date_period/date_period","i18n!apps/ua_payment/nls/ua_payment"],function(a,b,c,d,e,f,g,h,i,j,k){"use strict";return f.extend({documentTypeTitle:k.ua_payment_list,maxArchiveDate:null,ExtFilterComponent:d.isMultiClient()?h:g,statusesIds:["0","1","2","3","4","6","21","22","3004","5","13","14","15","16","17","18"],initialize:function(a){f.prototype.initialize.call(this,a),this.maxArchiveDate=a.maxArchiveDate,this.addModelListeners()},addModelListeners:function(){this.listenTo(c,"update-archive-dates",function(a,b){this.createDatePeriodComponent(a,b)})},createDatePeriodComponent:function(b,c){if(this.datePeriodComponent=new j({docType:this.docType,selectedTab:this.tabsStatuses.selectedTab}),"archived"!==this.tabsStatuses.selectedTab){if(this.maxArchiveDate){var d=e.str2date(this.maxArchiveDate);d.setDate(d.getDate()+1),this.datePeriodComponent.minDate=e.date2str(d)||""}if(this.maxArchiveDate&&!a(".archives-notification").length){var f=e.sprintf(k.archives_notification_1,this.maxArchiveDate)+"</br>"+k.archives_notification_2;a('<div class="archives-notification">'+f+"</div>").appendTo("div.toolbar-container")}}else this.datePeriodComponent.bdate=b||localStorage.getItem("ua_payment_archived_filter_bdate")||this.maxArchiveDate,this.datePeriodComponent.edate=c||localStorage.getItem("ua_payment_archived_filter_edate")||this.maxArchiveDate,this.datePeriodComponent.maxDate=this.maxArchiveDate,a(".archives-notification").remove();this.datePeriod.show(this.datePeriodComponent)},onShow:function(){f.prototype.onShow.call(this),this.listenTo(this.extFilterView,"getExtFilterData",function(a){this.trigger("getExtFilterData",a)}),this.tabsStatuses.archived&&(this.on("tabStatus:changed",this.extFilterView.handleTabStatusChanged.bind(this.extFilterView,this.tabsStatuses)),this.extFilterView.handleTabStatusChanged(this.tabsStatuses))},onSyncEnd:function(){f.prototype.onSyncEnd.call(this),this.trigger("onSyncEnd",this.collection)}})}),function(a){"use strict";function b(a){function l(a,b){var c,d,e,f,g,h,i=this;if(!(i instanceof l))return R&&E(26,"constructor call without new",a),new l(a,b);if(null!=b&&S(b,2,64,I,"base")){if(b=0|b,h=a+"",10==b)return i=new l(a instanceof l?a:h),F(i,L+i.e+1,M);if((f="number"==typeof a)&&0*a!=0||!new RegExp("^-?"+(c="["+s.slice(0,b)+"]+")+"(?:\\."+c+")?$",37>b?"i":"").test(h))return H(i,h,f,b);f?(i.s=0>1/a?(h=h.slice(1),-1):1,R&&h.replace(/^0\.0*|\./,"").length>15&&E(I,r,a),f=!1):i.s=45===h.charCodeAt(0)?(h=h.slice(1),-1):1,h=z(h,10,b,i.s)}else{if(a instanceof l)return i.s=a.s,i.e=a.e,i.c=(a=a.c)?a.slice():a,void(I=0);if((f="number"==typeof a)&&0*a==0){if(i.s=0>1/a?(a=-a,-1):1,a===~~a){for(d=0,e=a;e>=10;e/=10,d++);return i.e=d,i.c=[a],void(I=0)}h=a+""}else{if(!m.test(h=a+""))return H(i,h,f);i.s=45===h.charCodeAt(0)?(h=h.slice(1),-1):1}}for((d=h.indexOf("."))>-1&&(h=h.replace(".","")),(e=h.search(/e/i))>0?(0>d&&(d=e),d+=+h.slice(e+1),h=h.substring(0,e)):0>d&&(d=h.length),e=0;48===h.charCodeAt(e);e++);for(g=h.length;48===h.charCodeAt(--g););if(h=h.slice(e,g+1))if(g=h.length,f&&R&&g>15&&(a>v||a!==o(a))&&E(I,r,i.s*a),d=d-e-1,d>Q)i.c=i.e=null;else if(P>d)i.c=[i.e=0];else{if(i.e=d,i.c=[],e=(d+1)%u,0>d&&(e+=u),g>e){for(e&&i.c.push(+h.slice(0,e)),g-=u;g>e;)i.c.push(+h.slice(e,e+=u));h=h.slice(e),e=u-h.length}else e-=g;for(;e--;h+="0");i.c.push(+h)}else i.c=[i.e=0];I=0}function z(a,b,c,e){var f,g,i,k,m,n,o,p=a.indexOf("."),q=L,r=M;for(37>c&&(a=a.toLowerCase()),p>=0&&(i=V,V=0,a=a.replace(".",""),o=new l(c),m=o.pow(a.length-p),V=i,o.c=h(j(d(m.c),m.e),10,b),o.e=o.c.length),n=h(a,c,b),g=i=n.length;0==n[--i];n.pop());if(!n[0])return"0";if(0>p?--g:(m.c=n,m.e=g,m.s=e,m=G(m,o,q,r,b),n=m.c,k=m.r,g=m.e),f=g+q+1,p=n[f],i=b/2,k=k||0>f||null!=n[f+1],k=4>r?(null!=p||k)&&(0==r||r==(m.s<0?3:2)):p>i||p==i&&(4==r||k||6==r&&1&n[f-1]||r==(m.s<0?8:7)),1>f||!n[0])a=k?j("1",-q):"0";else{if(n.length=f,k)for(--b;++n[--f]>b;)n[f]=0,f||(++g,n=[1].concat(n));for(i=n.length;!n[--i];);for(p=0,a="";i>=p;a+=s.charAt(n[p++]));a=j(a,g)}return a}function A(a,b,c,e){var f,g,h,k,m;if(c=null!=c&&S(c,0,8,e,q)?0|c:M,!a.c)return a.toString();if(f=a.c[0],h=a.e,null==b)m=d(a.c),m=19==e||24==e&&N>=h?i(m,h):j(m,h);else if(a=F(new l(a),b,c),g=a.e,m=d(a.c),k=m.length,19==e||24==e&&(g>=b||N>=g)){for(;b>k;m+="0",k++);m=i(m,g)}else if(b-=h,m=j(m,g),g+1>k){if(--b>0)for(m+=".";b--;m+="0");}else if(b+=g-k,b>0)for(g+1==k&&(m+=".");b--;m+="0");return a.s<0&&f?"-"+m:m}function B(a,b){var c,d,e=0;for(g(a[0])&&(a=a[0]),c=new l(a[0]);++e<a.length;){if(d=new l(a[e]),!d.s){c=d;break}b.call(c,d)&&(c=d)}return c}function C(a,b,c,d,e){return(b>a||a>c||a!=k(a))&&E(d,(e||"decimal places")+(b>a||a>c?" out of range":" not an integer"),a),!0}function D(a,b,c){for(var d=1,e=b.length;!b[--e];b.pop());for(e=b[0];e>=10;e/=10,d++);return(c=d+c*u-1)>Q?a.c=a.e=null:P>c?a.c=[a.e=0]:(a.e=c,a.c=b),a}function E(a,b,c){var d=new Error(["new BigNumber","cmp","config","div","divToInt","eq","gt","gte","lt","lte","minus","mod","plus","precision","random","round","shift","times","toDigits","toExponential","toFixed","toFormat","toFraction","pow","toPrecision","toString","BigNumber"][a]+"() "+b+": "+c);throw d.name="BigNumber Error",I=0,d}function F(a,b,c,d){var e,f,g,h,i,j,k,l=a.c,m=w;if(l){a:{for(e=1,h=l[0];h>=10;h/=10,e++);if(f=b-e,0>f)f+=u,g=b,i=l[j=0],k=i/m[e-g-1]%10|0;else if(j=n((f+1)/u),j>=l.length){if(!d)break a;for(;l.length<=j;l.push(0));i=k=0,e=1,f%=u,g=f-u+1}else{for(i=h=l[j],e=1;h>=10;h/=10,e++);f%=u,g=f-u+e,k=0>g?0:i/m[e-g-1]%10|0}if(d=d||0>b||null!=l[j+1]||(0>g?i:i%m[e-g-1]),d=4>c?(k||d)&&(0==c||c==(a.s<0?3:2)):k>5||5==k&&(4==c||d||6==c&&(f>0?g>0?i/m[e-g]:0:l[j-1])%10&1||c==(a.s<0?8:7)),1>b||!l[0])return l.length=0,d?(b-=a.e+1,l[0]=m[(u-b%u)%u],a.e=-b||0):l[0]=a.e=0,a;if(0==f?(l.length=j,h=1,j--):(l.length=j+1,h=m[u-f],l[j]=g>0?o(i/m[e-g]%m[g])*h:0),d)for(;;){if(0==j){for(f=1,g=l[0];g>=10;g/=10,f++);for(g=l[0]+=h,h=1;g>=10;g/=10,h++);f!=h&&(a.e++,l[0]==t&&(l[0]=1));break}if(l[j]+=h,l[j]!=t)break;l[j--]=0,h=1}for(f=l.length;0===l[--f];l.pop());}a.e>Q?a.c=a.e=null:a.e<P&&(a.c=[a.e=0])}return a}var G,H,I=0,J=l.prototype,K=new l(1),L=20,M=4,N=-7,O=21,P=-1e7,Q=1e7,R=!0,S=C,T=!1,U=1,V=0,W={decimalSeparator:".",groupSeparator:",",groupSize:3,secondaryGroupSize:0,fractionGroupSeparator:" ",fractionGroupSize:0};return l.another=b,l.ROUND_UP=0,l.ROUND_DOWN=1,l.ROUND_CEIL=2,l.ROUND_FLOOR=3,l.ROUND_HALF_UP=4,l.ROUND_HALF_DOWN=5,l.ROUND_HALF_EVEN=6,l.ROUND_HALF_CEIL=7,l.ROUND_HALF_FLOOR=8,l.EUCLID=9,l.config=l.set=function(){var a,b,c=0,d={},e=arguments,h=e[0],i=h&&"object"==typeof h?function(){return h.hasOwnProperty(b)?null!=(a=h[b]):void 0}:function(){return e.length>c?null!=(a=e[c++]):void 0};return i(b="DECIMAL_PLACES")&&S(a,0,y,2,b)&&(L=0|a),d[b]=L,i(b="ROUNDING_MODE")&&S(a,0,8,2,b)&&(M=0|a),d[b]=M,i(b="EXPONENTIAL_AT")&&(g(a)?S(a[0],-y,0,2,b)&&S(a[1],0,y,2,b)&&(N=0|a[0],O=0|a[1]):S(a,-y,y,2,b)&&(N=-(O=0|(0>a?-a:a)))),d[b]=[N,O],i(b="RANGE")&&(g(a)?S(a[0],-y,-1,2,b)&&S(a[1],1,y,2,b)&&(P=0|a[0],Q=0|a[1]):S(a,-y,y,2,b)&&(0|a?P=-(Q=0|(0>a?-a:a)):R&&E(2,b+" cannot be zero",a))),d[b]=[P,Q],i(b="ERRORS")&&(a===!!a||1===a||0===a?(I=0,S=(R=!!a)?C:f):R&&E(2,b+p,a)),d[b]=R,i(b="CRYPTO")&&(a===!0||a===!1||1===a||0===a?a?(a="undefined"==typeof crypto,!a&&crypto&&(crypto.getRandomValues||crypto.randomBytes)?T=!0:R?E(2,"crypto unavailable",a?void 0:crypto):T=!1):T=!1:R&&E(2,b+p,a)),d[b]=T,i(b="MODULO_MODE")&&S(a,0,9,2,b)&&(U=0|a),d[b]=U,i(b="POW_PRECISION")&&S(a,0,y,2,b)&&(V=0|a),d[b]=V,i(b="FORMAT")&&("object"==typeof a?W=a:R&&E(2,b+" not an object",a)),d[b]=W,d},l.max=function(){return B(arguments,J.lt)},l.min=function(){return B(arguments,J.gt)},l.random=function(){var a=9007199254740992,b=Math.random()*a&2097151?function(){return o(Math.random()*a)}:function(){return 8388608*(1073741824*Math.random()|0)+(8388608*Math.random()|0)};return function(a){var c,d,e,f,g,h=0,i=[],j=new l(K);if(a=null!=a&&S(a,0,y,14)?0|a:L,f=n(a/u),T)if(crypto.getRandomValues){for(c=crypto.getRandomValues(new Uint32Array(f*=2));f>h;)g=131072*c[h]+(c[h+1]>>>11),g>=9e15?(d=crypto.getRandomValues(new Uint32Array(2)),c[h]=d[0],c[h+1]=d[1]):(i.push(g%1e14),h+=2);h=f/2}else if(crypto.randomBytes){for(c=crypto.randomBytes(f*=7);f>h;)g=281474976710656*(31&c[h])+1099511627776*c[h+1]+4294967296*c[h+2]+16777216*c[h+3]+(c[h+4]<<16)+(c[h+5]<<8)+c[h+6],g>=9e15?crypto.randomBytes(7).copy(c,h):(i.push(g%1e14),h+=7);h=f/7}else T=!1,R&&E(14,"crypto unavailable",crypto);if(!T)for(;f>h;)g=b(),9e15>g&&(i[h++]=g%1e14);for(f=i[--h],a%=u,f&&a&&(g=w[u-a],i[h]=o(f/g)*g);0===i[h];i.pop(),h--);if(0>h)i=[e=0];else{for(e=-1;0===i[0];i.splice(0,1),e-=u);for(h=1,g=i[0];g>=10;g/=10,h++);u>h&&(e-=u-h)}return j.e=e,j.c=i,j}}(),G=function(){function a(a,b,c){var d,e,f,g,h=0,i=a.length,j=b%x,k=b/x|0;for(a=a.slice();i--;)f=a[i]%x,g=a[i]/x|0,d=k*f+g*j,e=j*f+d%x*x+h,h=(e/c|0)+(d/x|0)+k*g,a[i]=e%c;return h&&(a=[h].concat(a)),a}function b(a,b,c,d){var e,f;if(c!=d)f=c>d?1:-1;else for(e=f=0;c>e;e++)if(a[e]!=b[e]){f=a[e]>b[e]?1:-1;break}return f}function d(a,b,c,d){for(var e=0;c--;)a[c]-=e,e=a[c]<b[c]?1:0,a[c]=e*d+a[c]-b[c];for(;!a[0]&&a.length>1;a.splice(0,1));}return function(e,f,g,h,i){var j,k,m,n,p,q,r,s,v,w,x,y,z,A,B,C,D,E=e.s==f.s?1:-1,G=e.c,H=f.c;if(!(G&&G[0]&&H&&H[0]))return new l(e.s&&f.s&&(G?!H||G[0]!=H[0]:H)?G&&0==G[0]||!H?0*E:E/0:NaN);for(s=new l(E),v=s.c=[],k=e.e-f.e,E=g+k+1,i||(i=t,k=c(e.e/u)-c(f.e/u),E=E/u|0),m=0;H[m]==(G[m]||0);m++);if(H[m]>(G[m]||0)&&k--,0>E)v.push(1),n=!0;else{for(A=G.length,C=H.length,m=0,E+=2,p=o(i/(H[0]+1)),p>1&&(H=a(H,p,i),G=a(G,p,i),C=H.length,A=G.length),z=C,w=G.slice(0,C),x=w.length;C>x;w[x++]=0);D=H.slice(),D=[0].concat(D),B=H[0],H[1]>=i/2&&B++;do{if(p=0,j=b(H,w,C,x),0>j){if(y=w[0],C!=x&&(y=y*i+(w[1]||0)),p=o(y/B),p>1)for(p>=i&&(p=i-1),q=a(H,p,i),r=q.length,x=w.length;1==b(q,w,r,x);)p--,d(q,r>C?D:H,r,i),r=q.length,j=1;else 0==p&&(j=p=1),q=H.slice(),r=q.length;if(x>r&&(q=[0].concat(q)),d(w,q,x,i),x=w.length,-1==j)for(;b(H,w,C,x)<1;)p++,d(w,x>C?D:H,x,i),x=w.length}else 0===j&&(p++,w=[0]);v[m++]=p,w[0]?w[x++]=G[z]||0:(w=[G[z]],x=1)}while((z++<A||null!=w[0])&&E--);n=null!=w[0],v[0]||v.splice(0,1)}if(i==t){for(m=1,E=v[0];E>=10;E/=10,m++);F(s,g+(s.e=m+k*u-1)+1,h,n)}else s.e=k,s.r=+n;return s}}(),H=function(){var a=/^(-?)0([xbo])(?=\w[\w.]*$)/i,b=/^([^.]+)\.$/,c=/^\.([^.]+)$/,d=/^-?(Infinity|NaN)$/,e=/^\s*\+(?=[\w.])|^\s+|\s+$/g;return function(f,g,h,i){var j,k=h?g:g.replace(e,"");if(d.test(k))f.s=isNaN(k)?null:0>k?-1:1;else{if(!h&&(k=k.replace(a,function(a,b,c){return j="x"==(c=c.toLowerCase())?16:"b"==c?2:8,i&&i!=j?a:b}),i&&(j=i,k=k.replace(b,"$1").replace(c,"0.$1")),g!=k))return new l(k,j);R&&E(I,"not a"+(i?" base "+i:"")+" number",g),f.s=null}f.c=f.e=null,I=0}}(),J.absoluteValue=J.abs=function(){var a=new l(this);return a.s<0&&(a.s=1),a},J.ceil=function(){return F(new l(this),this.e+1,2)},J.comparedTo=J.cmp=function(a,b){return I=1,e(this,new l(a,b))},J.decimalPlaces=J.dp=function(){var a,b,d=this.c;if(!d)return null;if(a=((b=d.length-1)-c(this.e/u))*u,b=d[b])for(;b%10==0;b/=10,a--);return 0>a&&(a=0),a},J.dividedBy=J.div=function(a,b){return I=3,G(this,new l(a,b),L,M)},J.dividedToIntegerBy=J.divToInt=function(a,b){return I=4,G(this,new l(a,b),0,1)},J.equals=J.eq=function(a,b){return I=5,0===e(this,new l(a,b))},J.floor=function(){return F(new l(this),this.e+1,3)},J.greaterThan=J.gt=function(a,b){return I=6,e(this,new l(a,b))>0},J.greaterThanOrEqualTo=J.gte=function(a,b){return I=7,1===(b=e(this,new l(a,b)))||0===b},J.isFinite=function(){return!!this.c},J.isInteger=J.isInt=function(){return!!this.c&&c(this.e/u)>this.c.length-2},J.isNaN=function(){return!this.s},J.isNegative=J.isNeg=function(){return this.s<0},J.isZero=function(){return!!this.c&&0==this.c[0]},J.lessThan=J.lt=function(a,b){return I=8,e(this,new l(a,b))<0},J.lessThanOrEqualTo=J.lte=function(a,b){return I=9,-1===(b=e(this,new l(a,b)))||0===b},J.minus=J.sub=function(a,b){var d,e,f,g,h=this,i=h.s;if(I=10,a=new l(a,b),b=a.s,!i||!b)return new l(NaN);if(i!=b)return a.s=-b,h.plus(a);var j=h.e/u,k=a.e/u,m=h.c,n=a.c;if(!j||!k){if(!m||!n)return m?(a.s=-b,a):new l(n?h:NaN);if(!m[0]||!n[0])return n[0]?(a.s=-b,a):new l(m[0]?h:3==M?-0:0)}if(j=c(j),k=c(k),m=m.slice(),i=j-k){for((g=0>i)?(i=-i,f=m):(k=j,f=n),f.reverse(),b=i;b--;f.push(0));f.reverse()}else for(e=(g=(i=m.length)<(b=n.length))?i:b,i=b=0;e>b;b++)if(m[b]!=n[b]){g=m[b]<n[b];break}if(g&&(f=m,m=n,n=f,a.s=-a.s),b=(e=n.length)-(d=m.length),b>0)for(;b--;m[d++]=0);for(b=t-1;e>i;){if(m[--e]<n[e]){for(d=e;d&&!m[--d];m[d]=b);--m[d],m[e]+=t}m[e]-=n[e]}for(;0==m[0];m.splice(0,1),--k);return m[0]?D(a,m,k):(a.s=3==M?-1:1,a.c=[a.e=0],a)},J.modulo=J.mod=function(a,b){var c,d,e=this;return I=11,a=new l(a,b),!e.c||!a.s||a.c&&!a.c[0]?new l(NaN):!a.c||e.c&&!e.c[0]?new l(e):(9==U?(d=a.s,a.s=1,c=G(e,a,0,3),a.s=d,c.s*=d):c=G(e,a,0,U),e.minus(c.times(a)))},J.negated=J.neg=function(){var a=new l(this);return a.s=-a.s||null,a},J.plus=J.add=function(a,b){var d,e=this,f=e.s;if(I=12,a=new l(a,b),b=a.s,!f||!b)return new l(NaN);if(f!=b)return a.s=-b,e.minus(a);var g=e.e/u,h=a.e/u,i=e.c,j=a.c;if(!g||!h){if(!i||!j)return new l(f/0);if(!i[0]||!j[0])return j[0]?a:new l(i[0]?e:0*f)}if(g=c(g),h=c(h),i=i.slice(),f=g-h){for(f>0?(h=g,d=j):(f=-f,d=i),d.reverse();f--;d.push(0));d.reverse()}for(f=i.length,b=j.length,0>f-b&&(d=j,j=i,i=d,b=f),f=0;b;)f=(i[--b]=i[b]+j[b]+f)/t|0,i[b]=t===i[b]?0:i[b]%t;return f&&(i=[f].concat(i),++h),D(a,i,h)},J.precision=J.sd=function(a){var b,c,d=this,e=d.c;if(null!=a&&a!==!!a&&1!==a&&0!==a&&(R&&E(13,"argument"+p,a),a!=!!a&&(a=null)),!e)return null;if(c=e.length-1,b=c*u+1,c=e[c]){for(;c%10==0;c/=10,b--);for(c=e[0];c>=10;c/=10,b++);}return a&&d.e+1>b&&(b=d.e+1),b},J.round=function(a,b){var c=new l(this);return(null==a||S(a,0,y,15))&&F(c,~~a+this.e+1,null!=b&&S(b,0,8,15,q)?0|b:M),c},J.shift=function(a){var b=this;return S(a,-v,v,16,"argument")?b.times("1e"+k(a)):new l(b.c&&b.c[0]&&(-v>a||a>v)?b.s*(0>a?0:1/0):b)},J.squareRoot=J.sqrt=function(){var a,b,e,f,g,h=this,i=h.c,j=h.s,k=h.e,m=L+4,n=new l("0.5");if(1!==j||!i||!i[0])return new l(!j||0>j&&(!i||i[0])?NaN:i?h:1/0);if(j=Math.sqrt(+h),0==j||j==1/0?(b=d(i),(b.length+k)%2==0&&(b+="0"),j=Math.sqrt(b),k=c((k+1)/2)-(0>k||k%2),j==1/0?b="1e"+k:(b=j.toExponential(),b=b.slice(0,b.indexOf("e")+1)+k),e=new l(b)):e=new l(j+""),e.c[0])for(k=e.e,j=k+m,3>j&&(j=0);;)if(g=e,e=n.times(g.plus(G(h,g,m,1))),d(g.c).slice(0,j)===(b=d(e.c)).slice(0,j)){if(e.e<k&&--j,b=b.slice(j-3,j+1),"9999"!=b&&(f||"4999"!=b)){+b&&(+b.slice(1)||"5"!=b.charAt(0))||(F(e,e.e+L+2,1),a=!e.times(e).eq(h));break}if(!f&&(F(g,g.e+L+2,0),g.times(g).eq(h))){e=g;break}m+=4,j+=4,f=1}return F(e,e.e+L+1,M,a)},J.times=J.mul=function(a,b){var d,e,f,g,h,i,j,k,m,n,o,p,q,r,s,v=this,w=v.c,y=(I=17,a=new l(a,b)).c;if(!(w&&y&&w[0]&&y[0]))return!v.s||!a.s||w&&!w[0]&&!y||y&&!y[0]&&!w?a.c=a.e=a.s=null:(a.s*=v.s,w&&y?(a.c=[0],a.e=0):a.c=a.e=null),a;for(e=c(v.e/u)+c(a.e/u),a.s*=v.s,j=w.length,n=y.length,n>j&&(q=w,w=y,y=q,f=j,j=n,n=f),f=j+n,q=[];f--;q.push(0));for(r=t,s=x,f=n;--f>=0;){for(d=0,o=y[f]%s,p=y[f]/s|0,h=j,g=f+h;g>f;)k=w[--h]%s,m=w[h]/s|0,i=p*k+m*o,k=o*k+i%s*s+q[g]+d,d=(k/r|0)+(i/s|0)+p*m,q[g--]=k%r;q[g]=d}return d?++e:q.splice(0,1),D(a,q,e)},J.toDigits=function(a,b){var c=new l(this);return a=null!=a&&S(a,1,y,18,"precision")?0|a:null,b=null!=b&&S(b,0,8,18,q)?0|b:M,a?F(c,a,b):c},J.toExponential=function(a,b){return A(this,null!=a&&S(a,0,y,19)?~~a+1:null,b,19)},J.toFixed=function(a,b){return A(this,null!=a&&S(a,0,y,20)?~~a+this.e+1:null,b,20)},J.toFormat=function(a,b){var c=A(this,null!=a&&S(a,0,y,21)?~~a+this.e+1:null,b,21);if(this.c){var d,e=c.split("."),f=+W.groupSize,g=+W.secondaryGroupSize,h=W.groupSeparator,i=e[0],j=e[1],k=this.s<0,l=k?i.slice(1):i,m=l.length;if(g&&(d=f,f=g,g=d,m-=d),f>0&&m>0){for(d=m%f||f,i=l.substr(0,d);m>d;d+=f)i+=h+l.substr(d,f);g>0&&(i+=h+l.slice(d)),k&&(i="-"+i)}c=j?i+W.decimalSeparator+((g=+W.fractionGroupSize)?j.replace(new RegExp("\\d{"+g+"}\\B","g"),"$&"+W.fractionGroupSeparator):j):i}return c},J.toFraction=function(a){var b,c,e,f,g,h,i,j,k,m=R,n=this,o=n.c,p=new l(K),q=c=new l(K),r=i=new l(K);if(null!=a&&(R=!1,h=new l(a),R=m,(m=h.isInt())&&!h.lt(K)||(R&&E(22,"max denominator "+(m?"out of range":"not an integer"),a),a=!m&&h.c&&F(h,h.e+1,1).gte(K)?h:null)),!o)return n.toString();for(k=d(o),f=p.e=k.length-n.e-1,p.c[0]=w[(g=f%u)<0?u+g:g],a=!a||h.cmp(p)>0?f>0?p:q:h,g=Q,Q=1/0,h=new l(k),i.c[0]=0;j=G(h,p,0,1),e=c.plus(j.times(r)),1!=e.cmp(a);)c=r,r=e,q=i.plus(j.times(e=q)),i=e,p=h.minus(j.times(e=p)),h=e;return e=G(a.minus(c),r,0,1),i=i.plus(e.times(q)),c=c.plus(e.times(r)),i.s=q.s=n.s,f*=2,b=G(q,r,f,M).minus(n).abs().cmp(G(i,c,f,M).minus(n).abs())<1?[q.toString(),r.toString()]:[i.toString(),c.toString()],Q=g,b},J.toNumber=function(){return+this},J.toPower=J.pow=function(a,b){var c,d,e,f=o(0>a?-a:+a),g=this;if(null!=b&&(I=23,b=new l(b)),!S(a,-v,v,23,"exponent")&&(!isFinite(a)||f>v&&(a/=0)||parseFloat(a)!=a&&!(a=NaN))||0==a)return c=Math.pow(+g,a),new l(b?c%b:c);for(b?a>1&&g.gt(K)&&g.isInt()&&b.gt(K)&&b.isInt()?g=g.mod(b):(e=b,b=null):V&&(c=n(V/u+2)),d=new l(K);;){if(f%2){if(d=d.times(g),!d.c)break;c?d.c.length>c&&(d.c.length=c):b&&(d=d.mod(b))}if(f=o(f/2),!f)break;g=g.times(g),c?g.c&&g.c.length>c&&(g.c.length=c):b&&(g=g.mod(b))}return b?d:(0>a&&(d=K.div(d)),e?d.mod(e):c?F(d,V,M):d)},J.toPrecision=function(a,b){return A(this,null!=a&&S(a,1,y,24,"precision")?0|a:null,b,24)},J.toString=function(a){var b,c=this,e=c.s,f=c.e;return null===f?e?(b="Infinity",0>e&&(b="-"+b)):b="NaN":(b=d(c.c),b=null!=a&&S(a,2,64,25,"base")?z(j(b,f),0|a,10,e):N>=f||f>=O?i(b,f):j(b,f),0>e&&c.c[0]&&(b="-"+b)),b},J.truncated=J.trunc=function(){return F(new l(this),this.e+1,1)},J.valueOf=J.toJSON=function(){var a,b=this,c=b.e;return null===c?b.toString():(a=d(b.c),a=N>=c||c>=O?i(a,c):j(a,c),b.s<0?"-"+a:a)},J.isBigNumber=!0,null!=a&&l.config(a),l}function c(a){var b=0|a;return a>0||a===b?b:b-1}function d(a){for(var b,c,d=1,e=a.length,f=a[0]+"";e>d;){for(b=a[d++]+"",c=u-b.length;c--;b="0"+b);f+=b}for(e=f.length;48===f.charCodeAt(--e););return f.slice(0,e+1||1)}function e(a,b){var c,d,e=a.c,f=b.c,g=a.s,h=b.s,i=a.e,j=b.e;if(!g||!h)return null;if(c=e&&!e[0],d=f&&!f[0],c||d)return c?d?0:-h:g;if(g!=h)return g;if(c=0>g,d=i==j,!e||!f)return d?0:!e^c?1:-1;if(!d)return i>j^c?1:-1;for(h=(i=e.length)<(j=f.length)?i:j,g=0;h>g;g++)if(e[g]!=f[g])return e[g]>f[g]^c?1:-1;return i==j?0:i>j^c?1:-1}function f(a,b,c){return(a=k(a))>=b&&c>=a}function g(a){return"[object Array]"==Object.prototype.toString.call(a)}function h(a,b,c){for(var d,e,f=[0],g=0,h=a.length;h>g;){for(e=f.length;e--;f[e]*=b);for(f[d=0]+=s.indexOf(a.charAt(g++));d<f.length;d++)f[d]>c-1&&(null==f[d+1]&&(f[d+1]=0),f[d+1]+=f[d]/c|0,f[d]%=c)}return f.reverse()}function i(a,b){return(a.length>1?a.charAt(0)+"."+a.slice(1):a)+(0>b?"e":"e+")+b}function j(a,b){var c,d;if(0>b){for(d="0.";++b;d+="0");a=d+a}else if(c=a.length,++b>c){for(d="0",b-=c;--b;d+="0");a+=d}else c>b&&(a=a.slice(0,b)+"."+a.slice(b));return a}function k(a){return a=parseFloat(a),0>a?n(a):o(a)}var l,m=/^-?(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,n=Math.ceil,o=Math.floor,p=" not a boolean or binary digit",q="rounding mode",r="number type has more than 15 significant digits",s="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ$_",t=1e14,u=14,v=9007199254740991,w=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],x=1e7,y=1e9;l=b(),l["default"]=l.BigNumber=l,"function"==typeof define&&define.amd?define("bigNumber",[],function(){return l}):"undefined"!=typeof module&&module.exports?module.exports=l:(a||(a="undefined"!=typeof self?self:Function("return this")()),a.BigNumber=l)}(this),define("apps/pay_sheet/nls/pay_sheet_base",{root:{no_uah_accs:"Невозможно создать документ. Отсутствует текущий счет в национальной валюте.",pay_type:"Вид начисления",number:"Номер",date:"Дата",amount:"Сумма",priority:"Приоритет",status:"Статус",summary:"Общая сумма:",client:"Клиент",pay_sheet:"Зарплатная ведомость",pay_sheet_list:"Зарплатные ведомости",ua_payment:"Платежное поручение",from_acc:"Счет списания",from_commission_acc:"Счет списания комиссии за РКО",not_required:"необяз.",current:"текущая",autonum:"автонумер.",pp:"Номер",value_date:"Дата валютир.",date_doc:"Дата документа",period:"Период начисления",sks:"СКС",inn:"ИНН",fio:"ФИО",add_employee:"Добавить",remove_employees:"Удалить все",total:"всего",count:"Насчитано",recipients:"Получатели",total_recipients:"Всего получателей:",title_add_employee:"ввод можно завершить нажав Enter",loading:"Загрузка данных",wait:"Подождите, это может занять несколько секунд",preload_text:"Загрузка списка сотрудников. Подождите несколько секунд.",creating:"Создание документа ...",start_entering:"Начинайте вводить ФИО, СКС или ИНН",change:"Изменить",cancel:"Отменить",success_link_btn:"Применить",generate_link_btn:"Создать",generating_link_btn:"Создание",unlink_btn:"УКАЗАТЬ",close_link_btn:"Закрыть",links:"платежи",links_warn:"Внимание!",links_payment_rejected:"Обратите внимание, что '{1}' отклонен.",links_payment_incorrect:"'{1}' не соответствует ведомости. Возможная причина - изменение ведомости или документа '{1}'.",has_payment:"№{1} от {2} на сумму {3} ({4})",without_payment:"<платеж не выбран>",without_conformity_payment:"<Отсутствуют платежи, соответствующие ЗП-ведомости>",link0_title:"Основной платеж",link1_title:"Платеж за РКО",create_payments:"Создать платежи",links_management:"Управление связями",need_to_fill:"Для отправки документа в банк необходимо указать:",need_to_deliver:"Для дальнейшей обработки документа необходимо отправить Основной платеж и платеж за РКО в банк",impossible_to_delete:"Удаление невозможно – к зарплатной ведомости привязано(ы) платежное(ые) поручение(я)",need_to_deliver_one:"Для дальнейшей обработки документа необходимо отправить Основной платеж в банк",similar_employee:"В списке получателей есть одинаковые сотрудники. Убедитесь, что список получателей не содержит лишних записей - для удобства поиска такие сотрудники выделены синим цветом",unspecifiedParam:"Для документа '{1}' банком не указан параметр {2}",incorrectParam:"Для документа '{1}' банком для параметра '{2}' задано не корректное значение '{3}'",rcpt_mfo:"МФО",rcpt_account:"Счет",rcpt_okpo:"ЕГПРОУ",rcpt_name:"Наименование получателя",commission:"коммисия за РКО",selectedAll:"Выбрать всех",bank_name:"Банк",field_DATE_DOC:"Дата документа",field_NUM_DOC:"Номер документа",field_AMOUNT:"Сумма платежа",field_CLN_NAME:"Наименование клиента",field_CLN_OKPO:"ЕГРПОУ клиента",field_PAYER_ACCOUNT:"Счет клиента",field_PAYER_BANK_ACCOUNT:"Счет банка клиента",field_PAYER_BANK_NAME:"Наименование банка клиента",field_PAYER_BANK_MFO:"МФО банка клиента",field_PAYER_COMMISSION_ACCOUNT:"Счет для списания комиссии за РКО",field_PAYER_COMMISSION_BANK_MFO:"МФО банка для списания комиссии за РКО",field_PAYER_COMMISSION_BANK_NAME:"Наименование банка для списания комиссии за РКО",field_ONFLOW_TYPE:"Тип начисления",field_VALUE_DATE:"Дата валютирования",field_COMMISSION_PERCENT:"Процент комиссии",field_ONFLOW_TYPE_ID:"Код типа начисления",field_PERIOD:"Период начисления",field_CARD_HOLDERS:"Список сотрудников","field_CARD_HOLDERS.AMOUNT":"Сумма зачисления","field_CARD_HOLDERS.CARD_NUM":"Карточный счет","field_CARD_HOLDERS.CARD_HOLDER":"ФИО сотрудника","field_CARD_HOLDERS.CARD_HOLDER_INN":"ИНН",field_not_specify:"Не указан(а) {1} для {2}",field_specify:"Для {1} указан {2} = {3}, в банке = {4}",empl_is_absent:"Нет данных о {1}",field_is_incorrect:"Некорректное значение в поле '{1}' = {2} для {3}",incorrect_amount:"Некорректное значение суммы начисления",incorrect_onflow_type:"Указан неактуальный вид начисления",card_holders_is_empty:"Добавьте начисления сотрудникам",unallowed_transfer_type:"У вас нет прав на данный тип начисления для Зарплатной ведомости",unknown_transfer_type:"{1}: '{2}' отсутствует в справочнике",unknown_sks:"{1}: '{2}' отсутствует в справочнике сотрудников",inn_is_incorrect:"{1} '{2}' для {3} '{4}' не совпадает со значением {5} '{6}' в справочнике сотрудников",card_holder_name_not_specify:"Не указан(а) {1} для Карточного счета {2}",employess_number_selected:"Выбрано сотрудников: {1}",not_ua_acount_for_mfo:"Отсутствуют права на работу с гривневыми счетами в МФО {1}",footer_s_template:"{1} {2} {3} из {4} на общую сумму {5} грн.",footer_selected_sin:"Выбрана",footer_selected_pl:"Выбрано",footer_1_doc:"ведомость",footer_1_doc_pl:"ведомость",footer_2_4_docs:"ведомости",footer_5_0_docs:"ведомостей",onflow_type_deleted:"(удален)"},uk:!0,en:!0}),define("apps/pay_sheet/nls/pay_sheet",["underscore","apps/pay_sheet/nls/pay_sheet_base"],function(a,b){return{root:a.extend({},b.root,{bank_client:"Банк-клиент"}),uk:!0,en:!0}}),define("apps/pay_sheet/nls/uk/pay_sheet_base",{no_uah_accs:"Неможливо створити документ. Вiдсутнiй поточний рахунок в нацiональнiй валютi.",pay_type:"Вид нарахування",number:"Номер",date:"Дата",amount:"Сума",priority:"Пріоритет",status:"Статус",summary:"Загальна сума:",client:"Клієнт",pay_sheet:"Зарплатна відомість",pay_sheet_list:"Зарплатні відомості",ua_payment:"Платіжне доручення",from_acc:"Рахунок списання",from_commission_acc:"Рахунок списання комісії за РКО",not_required:"не обов.",current:"поточна",autonum:"автонумер.",pp:"Номер",value_date:"Дата валютув.",
date_doc:"Дата документа",period:"Період нарахування",sks:"СКР",inn:"ІПН",fio:"ПІБ",add_employee:"Додати",remove_employees:"Вилучити всі",total:"усього",count:"Начислено",recipients:"Отримувачі",total_recipients:"Разом отримувачів:",title_add_employee:"введення можна завершити натиснувши Enter",loading:"Завантаження даних",wait:"Зачекайте, це може зайняти декілька секунд",preload_text:"Завантаження списка співробітників. Зачекайте декілька секунд",creating:"Створення документу ...",start_entering:"Починайте вводити ПІБ, СКР або ІПН",links_warn:"Увага!",links_payment_rejected:"Зверніть увагу, що '{1}' відхилений.",links_payment_incorrect:"'{1}' не відповідає відомості. Можлива причина - зміна відомості або документа '{1}'.",links:"платежi",has_payment:"№{1} від {2} на суму {3} ({4})",without_payment:"<платіж не вибраний>",without_conformity_payment:"<Відсутні платежі, що відповідають ЗП-відомості>",link0_title:"Основний платіж",link1_title:"Платіж за РКО",create_payments:"Створити платежі",links_management:"Керування зв’язками",need_to_fill:"Для відправлення документа в банк необхідно вказати:",need_to_deliver:"Для подальшої обробки документа необхідно відправити Основний платіж і платіж за РКО в банк",impossible_to_delete:"Вилучення неможливе - до зарплатної відомості прив'язано(і) платіжне(і) доручення.",need_to_deliver_one:"Для подальшої обробки документа необхідно відправити Основний платіж в банк",similar_employee:"У списку отримувачів присутні однакові співробітники. Переконайтеся, що список отримувачів не містить зайвих записів - для зручності пошуку такі співробітники виділені синім кольором",unspecifiedParam:"Для документа '{1}' банком не задано параметр {2}",incorrectParam:"Для документа '{1}' банком для параметру '{2}' задано не корректне значення '{3}'",rcpt_mfo:"МФО",rcpt_account:"Рахунок",rcpt_okpo:"ЄДРПОУ",rcpt_name:"Найменування отримувача",commission:"комісія за РКО",selectedAll:"Обрати всіх",bank_name:"Банк",change:"Змінити",cancel:"Відмінити",success_link_btn:"Застосувати",generate_link_btn:"Створити",generating_link_btn:"Створення",unlink_btn:"ВКАЗАТИ",close_link_btn:"Закрити",field_DATE_DOC:"Дата документа",field_NUM_DOC:"Номер документа",field_AMOUNT:"Сума платежу",field_CLN_NAME:"Найменування платника",field_CLN_OKPO:"ЄДРПОУ платника",field_PAYER_ACCOUNT:"Рахунок платника",field_PAYER_BANK_ACCOUNT:"Рахунок банку платника",field_PAYER_BANK_NAME:"Найменування банку платника",field_PAYER_BANK_MFO:"МФО банку платника",field_PAYER_COMMISSION_ACCOUNT:"Рахунок для списання комісії за РКО",field_PAYER_COMMISSION_BANK_MFO:"МФО банку для списання комісії за РКО",field_PAYER_COMMISSION_BANK_NAME:"Найменування банку для списання комісії за РКО",field_ONFLOW_TYPE:"Тип нарахування",field_VALUE_DATE:"Дата валютування",field_COMMISSION_PERCENT:"Процент комісії",field_ONFLOW_TYPE_ID:"Код типу нарахування",field_PERIOD:"Період нарахування",field_CARD_HOLDERS:"Список співробітників","field_CARD_HOLDERS.AMOUNT":"Сума зарахування","field_CARD_HOLDERS.CARD_NUM":"Картковий рахунок","field_CARD_HOLDERS.CARD_HOLDER":"ПІБ співробітника","field_CARD_HOLDERS.CARD_HOLDER_INN":"ІПН",field_not_specify:"Не вказаний(-а) {1} для {2}",field_specify:"Для {1} вказаний {2} = {3}, в банку = {4}",empl_is_absent:"Нема даних про {1}",field_is_incorrect:"Некоректне значення в полі '{1}' = {2} для {3}",incorrect_amount:"Некоректне значення суми нарахування",incorrect_onflow_type:"Вказано неактуальний вид нарахування",card_holders_is_empty:"Додайте нарахування співробітникам",unallowed_transfer_type:"У вас немає прав на даний тип нарахування для Зарплатної відомості",unknown_transfer_type:"{1}: '{2}' відсутній в довіднику",unknown_sks:"{1}: '{2}' відсутній у довіднику співробітників",inn_is_incorrect:"{1} '{2}' для {3} '{4}' не співпадає зі значенням {5} '{6}' у довіднику співробітників",card_holder_name_not_specify:"Не вказаний(-а) {1} для Карткового рахунку {2}",employess_number_selected:"Обрано співробітників: {1}",not_ua_acount_for_mfo:"Відсутні права на роботу з гривневими рахунками в МФО {1}",footer_s_template:"{1} {2} {3} з {4} на загальну суму {5} грн.",footer_selected_sin:"Обрана",footer_selected_pl:"Обрано",footer_1_doc:"відомість",footer_1_doc_pl:"відомість",footer_2_4_docs:"відомості",footer_5_0_docs:"відомостей",onflow_type_deleted:"(видалений)"}),define("apps/pay_sheet/nls/uk/pay_sheet",["underscore","apps/pay_sheet/nls/uk/pay_sheet_base"],function(a,b){return a.extend({},b,{bank_client:"Банк-клієнт"})}),define("apps/pay_sheet/nls/en/pay_sheet_base",{no_uah_accs:"Unable to create a document. Current account in national currency is missing.",pay_type:"Type of charge",number:"Number",date:"Date",amount:"Amount",priority:"Priority",status:"Status",summary:"Total amount:",client:"Client",pay_sheet:"Salary sheet",pay_sheet_list:"Salary sheets",ua_payment:"Payment order",from_acc:"Write-off account",from_commission_acc:"RKO write-off account",not_required:"optional",current:"current",autonum:"autonum.",pp:"Number",value_date:"Value date",date_doc:"Document date",period:"Period of charging",sks:"SCA",inn:"ITN",fio:"Full name",add_employee:"Add",remove_employees:"Delete all",total:"total",count:"Accrued",recipients:"Recipients",total_recipients:"All recipients:",title_add_employee:"you can stop inputting by pressing Enter",loading:"Loading data",wait:"Wait, it may take a few seconds",preload_text:"Loading of recipients list. Wait for a few seconds.",creating:"Creation of document …",start_entering:"Start typing full name, SCA or ITN",change:"Change",cancel:"Cancel",success_link_btn:"Apply",generate_link_btn:"Create",generating_link_btn:"Creation",unlink_btn:"SPECIFY",close_link_btn:"Close",links:"payments",links_warn:"Attention!",links_payment_rejected:"Please note that the '{1}' is rejected.",links_payment_incorrect:"'{1}' does not match the salary sheet. Possible cause - changes in salary sheet or in document '{1}'.",has_payment:"No {1} from {2} on amount {3} ({4})",without_payment:"<payment not selected>",without_conformity_payment:"<No payments conformity for the salary sheet>",link0_title:"Main payment",link1_title:"Payment for CSS",create_payments:"Generate payments",links_management:"Links management",need_to_fill:"To send a document to the bank you must specify:",need_to_deliver:"For further processing of document you should send the main and CSS commission payments to the bank",impossible_to_delete:"Deleting is not possible — salary sheets is linked with payment(s).",need_to_deliver_one:"For further processing of document you should send the main payment to the bank",similar_employee:"There are the same employees in the recipients list. Make sure that the recipients list doesn't contain unwanted records - for easy search such employees are highlighted in blue",unspecifiedParam:"For document '{1}' parameter {2} is not specified by the bank",incorrectParam:"For document '{1}' parameter '{2}' is set to an invalid value '{3}' by the bank",rcpt_mfo:"MFO",rcpt_account:"Account",rcpt_okpo:"EDRPOU",rcpt_name:"Recipient's name",commission:"CSS commission",selectedAll:"Select all",bank_name:"Bank",field_DATE_DOC:"Document date",field_NUM_DOC:"Document number",field_AMOUNT:"Amount of payment",field_CLN_NAME:"Client's name",field_CLN_OKPO:"Client's EDRPOU",field_PAYER_ACCOUNT:"Client's account",field_PAYER_BANK_ACCOUNT:"Account of client's bank",field_PAYER_BANK_NAME:"Client's bank name",field_PAYER_BANK_MFO:"Client's bank MFO",field_PAYER_COMMISSION_ACCOUNT:"Account to charge off commissions for RKO",field_PAYER_COMMISSION_BANK_MFO:"Bank MFO to charge off commissions for RKO",field_PAYER_COMMISSION_BANK_NAME:"Name of the bank to charge off commissions for RKO",field_ONFLOW_TYPE:"Type of charge",field_VALUE_DATE:"Value date",field_COMMISSION_PERCENT:"Commission percent",field_ONFLOW_TYPE_ID:"Charging type code",field_PERIOD:"Period of charging",field_CARD_HOLDERS:"List of employees","field_CARD_HOLDERS.AMOUNT":"Amount of charging","field_CARD_HOLDERS.CARD_NUM":"Card account","field_CARD_HOLDERS.CARD_HOLDER":"Employee's full name","field_CARD_HOLDERS.CARD_HOLDER_INN":"ITN",field_not_specify:"Not specified {1} for {2}",field_specify:"For {1} is specified {2} = {3}, in bank = {4}",empl_is_absent:"There is no data for {1}",field_is_incorrect:"Invalid value in field '{1}' = {2} for {3}",incorrect_amount:"Invalid amount of charge",incorrect_onflow_type:"The specified type of charge is not relevant",card_holders_is_empty:"Add charging for employees",unallowed_transfer_type:"You don't have rights for this type of charge for the salary sheet",unknown_transfer_type:"{1}: '{2}' is not found in the directory",unknown_sks:"{1}: '{2}' is not found in the employees directory",inn_is_incorrect:"{1} '{2}' to {3} '{4}' is not matches the value {5} '{6}' in employees directory",card_holder_name_not_specify:"Not specified {1} for card account {2}",employess_number_selected:"Selected employees: {1}",not_ua_acount_for_mfo:"There are no rights for working with hryvnia accounts in MFO {1}",footer_s_template:"{1} {2} {3} of {4}, total {5} UAH.",footer_selected_sin:"Selected",footer_selected_pl:"Selected",footer_1_doc:"sheet",footer_1_doc_pl:"sheets",footer_2_4_docs:"sheets",footer_5_0_docs:"sheets",onflow_type_deleted:"(removed)"}),define("apps/pay_sheet/nls/en/pay_sheet",["underscore","apps/pay_sheet/nls/en/pay_sheet_base"],function(a,b){return a.extend({},b,{bank_client:"Bank-client"})}),define("apps/pay_sheet/pay_sheet_model",["jquery","underscore","backbone","app","collections/thesaurus","appsPieces","thesaurusUtils","bifit","models/base_document","i18n!apps/pay_sheet/nls/pay_sheet","i18n!nls/validation","backboneValidation"],function(a,b,c,d,e,f,g,h,i,j,k){"use strict";function l(a,b){var c=g.getClientProp("documents.pay_sheet.commission.percent",a),d=!(!c||0===parseFloat(c));return"1"===b.account_commission_flag&&d}return i.extend({type:"pay_sheet",nls:j,defaults:{status:"",status_desc:"",status_color:"000000",DATE_DOC:"",NUM_DOC:"",CLN_NAME:"",PAYER_BANK_MFO:"",PAYER_BANK_NAME:"",PAYER_ACCOUNT:"",CARD_HOLDERS:"",ONFLOW_TYPE:"",AMOUNT:"",PAYER_BANK_ACCOUNT:"",COMMISSION_PERCENT:"",VALUE_DATE:"",CLN_OKPO:"",ONFLOW_TYPE_ID:"",PERIOD:"",PAYER_COMMISSION_ACCOUNT:"",PAYER_COMMISSION_BANK_MFO:"",PAYER_COMMISSION_BANK_NAME:"",ATT_CNT:"0"},meta:b.extend({},i.prototype.meta,{relatively:b.extend({ONFLOW_TYPE:function(a){return a},AMOUNT:function(a){return parseFloat(a)}},i.prototype.meta.relatively),formattedFields:{AMOUNT:function(){return this._amountFormatter(this.get("AMOUNT"),2)}}}),order:["DATE_DOC","NUM_DOC","CLN_NAME","PAYER_BANK_MFO","PAYER_BANK_NAME","PAYER_ACCOUNT",{name:"CARD_HOLDERS",order:["CARD_NUM","CARD_HOLDER","CARD_HOLDER_INN","AMOUNT","STAFF_ID","RESIDENT_FLAG"]},"ONFLOW_TYPE","AMOUNT","PAYER_BANK_ACCOUNT","COMMISSION_PERCENT","VALUE_DATE"],validation:{NUM_DOC:{numDocRequired:!0,maxLength:10},DATE_DOC:{required:!0,dateDoc:!0},VALUE_DATE:{fn:function(a,b,c){var d;if(a)if(h.checkDateMatch(a)){var e=c.DATE_DOC||h.date2str(new Date);if(e){e=h.str2date(e),a=h.str2date(a);var f=a.getTime()-e.getTime();0>f?d=k.value_date_01:Math.floor(f/1e3/60/60/24)>10&&(d=this._valueDateErrorWrapper(10))}}else d=k.incorrect_date;return d}},CLN_NAME:{required:!0,maxLength:40,clientInfo:"name_cln"},CLN_OKPO:{required:!0,clientInfo:"okpo",minLength:8,maxLength:10,digits:!0},PAYER_ACCOUNT:[{required:!0,minLength:5,maxLength:14,digits:!0},{fn:function(a){var c,d=b.where(f.getAccounts(["1"],!0).UAH,{account:a});if(0===d.length)return c=k.invalid_field;var e=b.any(d,function(a){return a.permissions>0});return e||(c=k.account_not_permission),c}}],PAYER_BANK_NAME:{required:!0,maxLength:45},PAYER_BANK_MFO:[{required:!0,length:6,digits:!0},{fn:function(a){var c,d=b.any(e.getThesaurus("accs_info").array,function(b){return b.mfo===a});return d||(c=k.invalid_field),c}}],PAYER_COMMISSION_ACCOUNT:[{digits:!0},{fn:function(a,c,d){var g=e.getThesaurus("pay_sheet_transfer_types").array;if(0!==g.length){var i=b.findWhere(g,{id:d.ONFLOW_TYPE_ID})||{};if(l(d.PAYER_BANK_MFO,i)){if(!a)return h.sprintf(k.required_field,j.field_PAYER_COMMISSION_ACCOUNT);if(a.length<5||a.length>14)return h.sprintf(k.length_range,j.field_PAYER_COMMISSION_ACCOUNT,5,14);var m=b.findWhere(f.getAccounts(["1"],!0).UAH,{mfo:d.PAYER_COMMISSION_BANK_MFO,account:a});if(!m)return k.invalid_field;if(m.permissions<=0)return k.account_not_permission}else if(a)return k.empty_field}}}],PAYER_COMMISSION_BANK_NAME:[{maxLength:45},{fn:function(a,c,d){var f=e.getThesaurus("pay_sheet_transfer_types").array;if(0!==f.length){var g=b.findWhere(f,{id:d.ONFLOW_TYPE_ID})||{};if(l(d.PAYER_BANK_MFO,g)){if(!a)return h.sprintf(k.required_field,j.field_PAYER_COMMISSION_BANK_NAME)}else if(a)return k.empty_field}}}],PAYER_COMMISSION_BANK_MFO:[{maxLength:6,digits:!0},{fn:function(a,c,d){var f=e.getThesaurus("pay_sheet_transfer_types").array;if(0!==f.length){var g=b.findWhere(f,{id:d.ONFLOW_TYPE_ID})||{};if(l(d.PAYER_BANK_MFO,g)){if(!a)return h.sprintf(k.required_field,j.field_PAYER_COMMISSION_BANK_MFO);var i=b.any(e.getThesaurus("accs_info").array,function(b){return b.mfo===a});if(!i)return k.required_field}else if(a)return k.empty_field}}}],ONFLOW_TYPE:[{required:!0,msg:k.invalid_field},{fn:function(a){var c=b.filter(e.getThesaurus("pay_sheet_transfer_types").array,function(a){return"1"===a.status});if(c.length){var f=d.isMultiClient()?d.multiClient.defaultClientKeysByCID[d.multiClient.currentSubClientId].EMPL_ID:localStorage.getItem("eid"),h=g.getClientProp("documents.pay_sheet.transfer_type_id."+f),i=b.find(c,function(b){return b.name_ru===a||b.name_ua===a||b.name_en===a});return i?h&&!b.contains(h.split(";"),i.ext_code)?j.unallowed_transfer_type:"":j.incorrect_onflow_type}}}],ONFLOW_TYPE_ID:{required:!0,maxLength:20,digits:!0},PERIOD:[{maxLength:60},{fn:function(a,c,d){var f=e.getThesaurus("pay_sheet_transfer_types").array;if(f.length){var g=b.some(f,b.matches({id:d.ONFLOW_TYPE_ID,payment_period:"Y"}));return Boolean(a)===g?"":k.invalid_field}}}],_CARD_HOLDERS:{fn:function(a,d,f){var i=f.CARD_HOLDERS;if(!i||0===i.length)return c.trigger("pay-sheet-model:card-holders_is_empty",j.card_holders_is_empty),h.sprintf(k.required_field,j.field_CARD_HOLDERS);for(var l=g.getClientProp("documents.pay_sheet.need_validation"),m=e.getThesaurus("staff"),n=0;n<i.length;n++){var o,p=i[n];if(!p.CARD_HOLDER||0===p.CARD_HOLDER.length)return o=h.sprintf(j.card_holder_name_not_specify,j["field_CARD_HOLDERS.CARD_HOLDER"],p.CARD_NUM),c.trigger("pay-sheet-model:card-holder_is_incorrect",o),o;for(var q=["CARD_NUM","CARD_HOLDER_INN","AMOUNT"],r=0;r<q.length;r++){var s=q[r];if(!p[s]||0===p[s].length)return o=h.sprintf(j.field_not_specify,j["field_CARD_HOLDERS."+s],p.CARD_HOLDER),c.trigger("pay-sheet-model:card-holder_is_incorrect",o),o}var t=parseFloat(p.AMOUNT);if(0>=t||t>1e11)return o=h.sprintf(j.field_is_incorrect,j["field_CARD_HOLDERS.AMOUNT"],t,p.CARD_HOLDER),c.trigger("pay-sheet-model:card-holder_is_incorrect",o),o;if(m.loaded&&(0===l.length||"true"===l)){var u,v=b.findWhere(m.array,{sks_number:p.CARD_NUM}),w=b.findWhere(m.array,{card_holder_inn:p.CARD_HOLDER_INN});if(v&&!w)return u=h.sprintf(j.inn_is_incorrect,j.inn,p.CARD_HOLDER_INN,j.sks,p.CARD_NUM,j.inn,v.card_holder_inn),c.trigger("pay-sheet-model:card-holder_is_incorrect",u),u;if(!v)return u=h.sprintf(j.unknown_sks,j.sks,p.CARD_NUM),c.trigger("pay-sheet-model:card-holder_is_incorrect",u),u}}}}},revert:function(){i.prototype.revert.call(this),this.unset("CARD_HOLDERS",{silent:!0})},getCurrency:function(){return"UAH"}})}),define("text!apps/ua_payment/templates/ua_payment_edit.tmpl",[],function(){return'<form>\n    <div class="grey-container">\n        <div class="link_pay_sheet link" style="display: none">\n            <ul>\n                <li id="pay_sheet">\n                    <span id="status_desc_link">&nbsp;</span>\n                    <a id="link" href="#"><%- pay_sheet %></a>\n                </li>\n                <li id="payment">\n                    <a class=\'disabled\'></a>\n                </li>\n            </ul>\n        </div>\n        <h1><%- ua_payment %></h1>\n\n        <% if (isMultiClient) { %>\n            <div class="sub-client-info"></div>\n        <% } %>\n\n        <% if (viewMode) { %>\n            <span id="status_desc" class="status-code-<%- statusCode %>"><%- status_desc %></span>\n        <% } %>\n\n    </div>\n\n    <div class="grey-container">\n        <div class=\'form-group additional\'>\n            <div class="num-doc">\n                <label for="NUM_DOC"><%- pp %></label>\n                <input type="text" id="NUM_DOC" name="NUM_DOC" autocomplete="off" maxlength="10"\n                       tabindex="11" placeholder="<%- autonum %>"/>\n            </div>\n\n            <div class=\'right\'>\n                <div class=\'date-doc\'>\n                    <label for="DATE_DOC"><%- date_doc %></label>\n                    <input type="text" id="DATE_DOC" name="DATE_DOC" class="form-control date datepicker" maxlength="10"\n                           tabindex="12" placeholder="<%- current %>"/>\n                    <span class="datepicker"></span>\n                </div>\n\n                <div class=\'value-date\'>\n                    <label for="VALUE_DATE"><%- value_date %></label>\n                    <input type="text" id="VALUE_DATE" name="VALUE_DATE" class="form-control date datepicker"\n                           maxlength="10"\n                           tabindex="13" placeholder="<%- not_required %>"/>\n                    <span class="datepicker"></span>\n                </div>\n            </div>\n        </div>\n\n        <div class="container">\n            <div class=\'amount\'>\n                <label for="AMOUNT"><%- by_amount %></label>\n                <input type="text" id="AMOUNT" name="AMOUNT" autocomplete="off" tabindex="1" placeholder="0.00"/>\n                <label class="nds-calc">\n                    <input type="checkbox" id="nds-calc"/>\n                    <span class="checkbox"></span>\n                    <%- recount_with_nds %>\n                </label>\n            </div>\n\n            <div class=\'acc with-type\'>\n                <label for="CLN_ACCOUNT"><%- from_acc %></label>\n                <input type="text" name="CLN_ACCOUNT" id="CLN_ACCOUNT" tabindex="2" class="account"/>\n            </div>\n\n            <div class=\'planned-remainder\'>\n                <label><%- planned_remainder %></label>\n                <input id=\'PLANNED_REMAINDER\' type="text"/>\n            </div>\n        </div>\n\n        <h2><%- rcpt %></h2>\n\n        <div class=\'rcpt container\'>\n            <div class=\'name\'>\n                <input type="text" value="<%- RCPT_NAME %>" name="RCPT_NAME" id="RCPT_NAME" maxlength="40" tabindex="3"\n                       placeholder="<%- start_entering %>"/>\n            </div>\n\n            <div>\n                <div class=\'okpo\'>\n                    <label for="RCPT_OKPO"><%- okpo %></label>\n                    <input type="text" name="RCPT_OKPO" id="RCPT_OKPO" tabindex="4" maxlength="10" class="unique"\n                           autocomplete="off" placeholder="<%- entering_placeholder %>"/>\n                </div>\n\n                <div class=\'country\'>\n                    <label for="RCPT_COUNTRY_CODE" id="country_label"><%- country_code %></label>\n                    <input type="text" name="RCPT_COUNTRY_CODE" id="RCPT_COUNTRY_CODE"/>\n                </div>\n\n                <div class=\'passp\'>\n                    <label for="RCPT_PASSP_SER" id="passp_label"><%- passp %></label>\n                    <div class="left">\n                        <input type="text" name="RCPT_PASSP_SER" id="RCPT_PASSP_SER" tabindex="5"\n                               maxlength="2" autocomplete="off" placeholder="<%- seria %>"/>\n                    </div>\n                    <div class="right-aligned">\n                        <input type="text" name="RCPT_PASSP_NUM" id="RCPT_PASSP_NUM" tabindex="6"\n                               maxlength="<%- RCPT_PASSP_SER ? 6 : 9 %>" autocomplete="off"\n                               placeholder="<%- number %>"/>\n                    </div>\n                </div>\n                <div class="clear"></div>\n            </div>\n\n            <div class="bank">\n                <label for="RCPT_BANK_MFO"><%- to_bank %></label>\n                <input type="text" name="RCPT_BANK_MFO" id="RCPT_BANK_MFO" tabindex="8" placeholder="<%- mfo %>"\n                       maxlength="6" class="mfo unique" autocomplete="off"/>\n                <input type="text" name="RCPT_BANK_NAME" id="RCPT_BANK_NAME" disabled=\'disabled\'\n                       placeholder="<%- name %>" tabindex="7" class="name"/>\n            </div>\n\n            <div class="rcpt-account">\n                <label for="RCPT_ACCOUNT"><%- to_acc %></label>\n                <input type="text" id="RCPT_ACCOUNT" name="RCPT_ACCOUNT" tabindex="9" class="account unique"\n                       maxlength="14" autocomplete="off" placeholder="<%- entering_placeholder %>"/>\n            </div>\n\n            <div id="add">\n                <label>\n                    <input type="checkbox" class="add-rcpt"/>\n                    <span class="checkbox"></span>\n                    <%- add_to_rcpt %>\n                </label>\n            </div>\n        </div>\n\n        <div class=\'expense-item container\'>\n            <a id=\'expense_item_link\' href="#"><%- expense_item %></a>\n            <label id=\'expense_item_lable\' for="EXPENSE_ITEM"><%- expense_item %></label>\n            <input type="text" id="EXPENSE_ITEM" name="EXPENSE_ITEM" maxlength="20"\n                   placeholder="<%- item_code %>" disabled="disabled"/>\n        </div>\n\n        <div class="details">\n            <div class="group-box">\n                <a id=\'with_nds\' class="select-box" href="#"><%- nds2 %></a>\n                <a id=\'without_nds\' class="select-box" href="#"><%- nds1 %></a>\n                <a id=\'budget_payment\' class="select-box" href="#">(<%- budget_payment %>)</a>\n            </div>\n\n            <% if (typeof promptValue !== "undefined" && promptValue !== "") { %>\n            <label for="PAYMENT_DETAILS"\n                   data-toggle="tooltip"\n                   data-trigger="hover"\n                   data-placement="bottom"\n                   title="<%- promptValue %>"><%- details_ext %></label>\n            <% } else { %>\n            <label for="PAYMENT_DETAILS"><%- details_ext %></label>\n            <% } %>\n            <textarea id="PAYMENT_DETAILS" name="PAYMENT_DETAILS" rows="2" tabindex="10">\n            </textarea>\n        </div>\n    </div>\n</form>\n\n<div class="document-status-bar"></div>\n<div class="comments-bar"></div>\n'}),define("styles!apps/ua_payment/css/ua_payment",[],function(){}),define("apps/ua_payment/ua_payment_view",["jquery","underscore","marionette","backbone","app","bifit","bigNumber","appsPieces","thesaurusUtils","libs/multi_client_utils","collections/documents","commons/base_object/document/document_item_view","apps/pay_sheet/pay_sheet_model","text!apps/ua_payment/templates/ua_payment_edit.tmpl","i18n!apps/ua_payment/nls/ua_payment","styles!apps/ua_payment/css/ua_payment"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){"use strict";return l.extend({tagName:"div",className:"doc-wrapper ua_payment",template:b.template(n),templateHelpers:o,okpoFieldTitle:"RCPT_OKPO",ui:{passpInfo:"div.passp",countryInfo:"div.country",tooltips:'[data-toggle="tooltip"]'},events:{"click div.link_pay_sheet a":"clickLinkPaySheet"},initialize:function(a){a&&(this.plannedRemainders=a.plannedRemainders,"archived"===a.selectedTab&&a.maxArchiveDate&&this.model.set("maxArchiveDate",a.maxArchiveDate,{silent:!0})),this.canGoToPaySheet=!0,this.listenTo(e,"toggleCanChooseItem",function(a){this.canGoToPaySheet=a})},updatePlannedRemainders:function(b){this.model.attributes.planned_remainder=(parseFloat(this.model.attributes.planned_remainder)-parseFloat(b)).toFixed(2),a("#PLANNED_REMAINDER").val(f.formatAmount(this.model.attributes.planned_remainder))},onShow:function(){if(l.prototype.onShow.call(this),this.renderPassportContent(),this.$("div.rcpt label.add").hide(),this.$("#with_nds, #without_nds, #budget_payment").hide(),this.$("label.nds-calc").hide(),this.$("#PAYMENT_DETAILS").formatter("oneline_textarea",{maxlength:550}).change(),this.model.get("EXPENSE_ITEM")?this.$("#expense_item_link").hide():this.$("div.expense-item").hide(),this.plannedRemainders&&(this.$("#PLANNED_REMAINDER").val(f.formatAmount(this.plannedRemainders[this.$("#CLN_ACCOUNT").val()])),this.model.attributes.planned_remainder=this.plannedRemainders[this.$("#CLN_ACCOUNT").val()]),this.model.get("links"))this.renderLinkPaySheet();else{var b=e.isMultiClient()?{data:{subClientEmployees:a.param(j.getDefaultEmployees())}}:null;this.model.fetch(b).done(function(){this.renderLinkPaySheet()}.bind(this))}this.ui.tooltips.tooltip()},renderLinkPaySheet:function(){if(this.model.get("links")&&this.model.get("links").length>0){this.$("div.link_pay_sheet").show();var b=this.isCommissionPaySheetLink(),c=b?o.link1_title:o.link0_title;this.$("div.link_pay_sheet li#payment a").text(c);var d=this.model.get("links")[0];if(this.$("span#status_desc_link").removeClass().addClass("status-code-"+d.status).attr("data-original-title",d.status_desc).tooltip({placement:"bottom",trigger:"hover"}),k.options.document_type===this.model.get("type")&&a("div.link_pay_sheet ul li#pay_sheet").appendTo(a("div.link_pay_sheet ul")),b||d.AMOUNT===this.model.get("AMOUNT")){if(b){var e,h=this.findProp("documents.pay_sheet.commission.percent");if(h&&!isNaN(h)){var i=new g(d.AMOUNT);e=i.times(h).div(100).toFixed(2,g.ROUND_HALF_UP)}this.model.get("AMOUNT")!==e&&this.renderWarnMsg(f.sprintf(o.links_incorrect,c))}}else this.renderWarnMsg(f.sprintf(o.links_incorrect,c))}},renderPassportContent:function(){switch(this.model.get(this.okpoFieldTitle)){case"0000000000":this.ui.passpInfo.show(),this.ui.countryInfo.hide();break;case"000000000":this.ui.passpInfo.hide(),this.ui.countryInfo.show();break;default:this.ui.passpInfo.hide(),this.ui.countryInfo.hide()}},clickLinkPaySheet:function(b){b&&(b.preventDefault(),"disabled"===a(b.target).attr("class"))||this.canGoToPaySheet!==!1&&(this.canGoToPaySheet=!1,this.goToPaySheet())},goToPaySheet:function(c){this.model.get("links").length>0?(d.history.navigate("document/list/pay_sheet"),require(["apps/pay_sheet/pay_sheet_controller"],function(d){(e.isMultiClient()?h.loadPermsForAllSubclients("pay_sheet,ua_payment"):a.Deferred().resolve()).done(function(){var a=new d,e=new m(this.model.get("links")[0]);a.collection&&(c&&(e=a.collection.findWhere({id:e.id}),e.set("links",b.reject(e.get("links"),function(a){return a.id===c}))),a.showItemView(e))}.bind(this))}.bind(this))):this.trigger("showList")},isCommissionPaySheetLink:function(){return this.model.get("RCPT_OKPO")===this.findProp("documents.pay_sheet.commission.rcpt_okpo")&&this.model.get("RCPT_ACCOUNT")===this.findProp("documents.pay_sheet.commission.rcpt_account")&&this.model.get("RCPT_BANK_MFO")===this.findProp("documents.pay_sheet.commission.rcpt_mfo")},findProp:function(a){var b=this.model.get("CLN_BANK_MFO");return i.getClientProp(a,b)},renderWarnMsg:function(b){a("<div>",{id:"warn-msg"}).insertAfter(this.$("#status_desc")),a("#warn-msg").append("<h2>"+o.links_warn+"</h2>").append("<span>"+b+"</span>")}})}),define("text!apps/ua_payment/templates/budget_payment_editor.tmpl",[],function(){return'<div class="box">\n    <div class="exit">&nbsp;</div>\n    <div class="title"><%- budget_payment %></div>\n\n    <div id="budget_payment-editor">\n        <div class="payment_kind_code">\n            <label for="PAYMENT_KIND_CODE"><%- code_type %></label>\n            <input type="text" id="PAYMENT_KIND_CODE" name="PAYMENT_KIND_CODE"\n                   placeholder="<%- payment_kind_code_placeholder %>"/>\n        </div>\n\n        <div id="DETAILS"></div>\n\n        <div>\n            <label for="PAYER_NUMBER"><%- payer_number %></label>\n            <input type="text" id="PAYER_NUMBER"/>\n        </div>\n\n        <div>\n            <label for="EXPLAIN_INF"><%- explain_inf %></label>\n            <textarea id="EXPLAIN_INF" rows="3"></textarea>\n        </div>\n    </div>\n\n    <button type="button" class=\'select primary\'><%- confirm_select %></button>\n    <button type="button" class="exit"><%- close_link_btn %></button>\n</div>\n\n'}),define("apps/ua_payment/budget_payment_editor_view",["jquery","underscore","backbone","marionette","bifit","collections/thesaurus","thesaurusUtils","dialogUtils","text!apps/ua_payment/templates/budget_payment_editor.tmpl","i18n!apps/ua_payment/nls/ua_payment","styles!apps/ua_payment/css/ua_payment"],function(a,b,c,d,e,f,g,h,i,j){var k={ru:"name_ru",uk:"name_uk",en:"name_en"}[e.getLocale()],l=function(a,c){var d=function(a,c){c=c||"";var d=c.indexOf(a);if(-1!==d){var e=b.escape(c.substr(0,d)),f=b.escape(c.substr(d,a.length)),g=b.escape(c.substr(d+a.length));return e+"<em>"+f+"</em>"+g}return b.escape(c)},e=d(c,a.code),f=d(c,a[k]);return e+"<br/>"+f};return d.ItemView.extend({template:b.template(i),templateHelpers:j,ui:{PAYMENT_KIND_CODE:"#PAYMENT_KIND_CODE",PAYER_NUMBER:"#PAYER_NUMBER",EXPLAIN_INF:"#EXPLAIN_INF",CONFIRM_BTN:".select",DETAILS:"#DETAILS"},events:{"click @ui.CONFIRM_BTN":"onConfirmBtnClick","change @ui.PAYMENT_KIND_CODE":"onPaymentKindCodeChange","click .exit":"destroy"},paymentsKinds:[],getSelectedKindCode:function(){return this.ui.PAYMENT_KIND_CODE.val().trim().split(" ")[0]},onRender:function(){this.$el.addClass("show"),this.ui.CONFIRM_BTN.focus().attr("disabled","disabled"),this.ui.PAYER_NUMBER.val(g.getClientProp("ua_payment.budget.client_code")),this.ui.EXPLAIN_INF.formatter("oneline_textarea"),this.ui.PAYMENT_KIND_CODE.formatter(["number","text_cyrillic","text_cyrillic_up","text_latin","text_latin_up","text_ua","space_symbol"]),this.ui.PAYMENT_KIND_CODE.chosen({searchable:!0,maxHeight:105,data:{array:this.paymentsKinds,id:"id",text:["code",k]},render:l}),f.getThesaurus("ua_payment_payments_kinds").fetch().done(function(a){this.paymentsKinds=b.sortBy(a,function(a){return+a.code||a.code}),this.ui.PAYMENT_KIND_CODE.trigger("refresh",{array:this.paymentsKinds}),this.ui.PAYMENT_KIND_CODE.val().length>0&&this.ui.PAYMENT_KIND_CODE.change()}.bind(this))},onPaymentKindCodeChange:function(d){if(0===a(d.target).val().length)return this.ui.DETAILS.empty(),this.ui.CONFIRM_BTN.prop("disabled",!0),c.Validation.callbacks.invalid(null,"PAYMENT_KIND_CODE",c.Validation.messages.required),void c.Validation.callbacks.showError({PAYMENT_KIND_CODE:c.Validation.messages.required});var e=this.getSelectedKindCode(),f=b.findWhere(this.paymentsKinds,{code:e});return f?(this.ui.DETAILS.html(f[k]),this.ui.CONFIRM_BTN.prop("disabled",!1),void c.Validation.callbacks.valid(null,"PAYMENT_KIND_CODE")):(this.ui.DETAILS.empty(),this.ui.CONFIRM_BTN.prop("disabled",!0),c.Validation.callbacks.invalid(null,"PAYMENT_KIND_CODE",j.incorrect_payments_kinds),void c.Validation.callbacks.showError({PAYMENT_KIND_CODE:j.incorrect_payments_kinds}))},onConfirmBtnClick:function(a){a.preventDefault();var b=this.getSelectedKindCode(),c=this.ui.PAYER_NUMBER.val()||" ",d=this.ui.EXPLAIN_INF.val(),e="*;"+b+";"+c+";"+d+";;;";this.trigger("ua_payment:payment_details:append",e),this.destroy()},onBeforeDestroy:function(){this.ui.PAYMENT_KIND_CODE.disposeChosen()}})}),define("text!apps/ua_payment/templates/budget_code_list.tmpl",[],function(){return'<div id="budget-code-list" class="box">\n    <div class="exit">&nbsp;</div>\n    <div class="title"><%- expense_item %></div>\n\n    <div class="errors" style="display: none"/>\n\n    <input type="text" name="filter" id="filter" placeholder="<%- item_search %>"/>\n\n    <div class="table-header">\n        <table class="list">\n            <thead>\n                <tr>\n                    <th class="code-col"><%- code_label %></th>\n                    <th class="descr-col"><%- descr_label %></th>\n                </tr>\n            </thead>\n        </table>\n    </div>\n    <div class="scrollbox">\n        <table class="list">\n            <tbody></tbody>\n        </table>\n    </div>\n\n    <button type="button" class="exit"><%- close_link_btn %></button>\n</div>\n';
}),define("text!apps/ua_payment/templates/budget_code_item.tmpl",[],function(){return'<td class="ellipsis code-col" style="white-space: pre"><%- Array(parseInt(nesting_level)).join(\'   \') + code %></td>\n<td class="ellipsis descr-col"><%- description %></td>\n'}),define("apps/ua_payment/budget_code_list_view",["jquery","underscore","backbone","marionette","bifit","collections/thesaurus","thesaurusUtils","dialogUtils","text!apps/ua_payment/templates/budget_code_list.tmpl","text!apps/ua_payment/templates/budget_code_item.tmpl","i18n!apps/ua_payment/nls/ua_payment","styles!apps/ua_payment/css/ua_payment"],function(a,b,c,d,e,f,g,h,i,j,k){return d.CompositeView.extend({template:b.template(i),templateHelpers:k,events:{"click .exit":"dispose","input #filter":"doFilter"},childView:d.ItemView.extend({template:b.template(j),tagName:"tr",triggers:{click:"selectItem"}}),childViewContainer:"tbody",childEvents:{selectItem:"selectItem"},ui:{filterInput:"#filter"},collection:new c.Collection,initialize:function(a){this.collection.comparator=function(a,b){return a.get("left_key")-b.get("left_key")},this.originalCollection=a.expenceItems,this.collection.set(this.originalCollection)},onRender:function(){this.$el.addClass("show"),a(".box button:first-of-type").focus()},selectItem:function(a,b){b.model.get("right_key")-b.model.get("left_key")===1&&(this.trigger("ua_payment:budget_code:selected",b.model.get("code")),this.dispose())},doFilter:function(){var a=this.ui.filterInput.val(),c=a?b.filter(this.originalCollection,function(b){return a=a.toLowerCase(),b.code.toLowerCase().indexOf(a)>-1||b.description.toLowerCase().indexOf(a)>-1}):this.originalCollection;this.collection.reset(c)},dispose:function(){this.off("ua_payment:budget_code:selected"),this.remove()}})}),define("text!components/requisites_list_modal/template/requisites_list_modal_view.tmpl",[],function(){return'<div class="box requisites-list">\n    <div class="exit">&nbsp;</div>\n    <div class="title"><%- name %></div>\n    <div><%- edrpou %>: <%- inn %></div>\n\n    <table>\n        <thead>\n            <tr>\n                <th><%- account %></th>\n                <th><%- payment_details %></th>\n                <th><%- notes %></th>\n            </tr>\n        </thead>\n        <tbody></tbody>\n    </table>\n\n    <button type="button" class="exit"><%- close_link_btn %></button>\n</div>\n'}),define("text!components/requisites_list_modal/template/requisites_list_modal_row.tmpl",[],function(){return'<td class="bill"><%- bill %></td>\n<td class="comment ellipsis"><%- comment %></td>\n<td class="notes ellipsis"><%- note %></td>'}),define("components/requisites_list_modal/nls/requisites_list_modal",{root:{edrpou:"ЕГРПОУ",close_link_btn:"Закрыть",account:"счет",payment_details:"Назначение платежа",notes:"примечание"},uk:!0,en:!0}),define("components/requisites_list_modal/nls/uk/requisites_list_modal",{edrpou:"ЄДРПОУ",close_link_btn:"Закрити",account:"рахунок",payment_details:"Призначення платежу",notes:"примітка"}),define("components/requisites_list_modal/nls/en/requisites_list_modal",{edrpou:"EDRPOU",close_link_btn:"Close",account:"account",payment_details:"Payment details",notes:"notes"}),define("components/requisites_list_modal/requisites_list_modal_view",["underscore","backbone","marionette","dialogUtils","text!components/requisites_list_modal/template/requisites_list_modal_view.tmpl","text!components/requisites_list_modal/template/requisites_list_modal_row.tmpl","i18n!components/requisites_list_modal/nls/requisites_list_modal"],function(a,b,c,d,e,f,g){"use strict";var h=c.ItemView.extend({tagName:"tr",template:a.template(f),triggers:{click:"selectRequisites"}});return c.CompositeView.extend({template:a.template(e),templateHelpers:g,childView:h,childViewContainer:"tbody",childEvents:{selectRequisites:"selectRequisites"},events:{"click .exit":"destroy"},initialize:function(c){this.recipient=c.recipient,this.templateHelpers=a.extend({},this.templateHelpers,{inn:this.recipient.inn,name:this.recipient.name}),this.collection=new b.Collection(this.recipient.requisites)},onRender:function(){this.$el.addClass("show")},selectRequisites:function(a){var b={bic:a.model.get("bic"),bill:a.model.get("bill"),comment:a.model.get("comment")};this.trigger("recipient_requisites:choose",b),this.destroy()}})}),define("apps/ua_payment/ua_payment_edit",["jquery","underscore","appsPieces","backbone","marionette","dialogUtils","customConstants","commons/base_object/document/document_item_edit","collections/thesaurus","thesaurusUtils","bifit","customConstants","chosen","apps/ua_payment/budget_payment_editor_view","apps/ua_payment/budget_code_list_view","components/requisites_list_modal/requisites_list_modal_view","text!apps/ua_payment/templates/ua_payment_edit.tmpl","i18n!apps/ua_payment/nls/ua_payment","styles!apps/ua_payment/css/ua_payment","formatter"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){"use strict";var s=null,t=[];return h.extend({id:"edit",className:"doc-wrapper ua_payment",template:b.template(q),templateHelpers:r,serializeModel:function(){return b.extend({promptValue:this.getPromptValue()},h.prototype.serializeModel.apply(this,arguments))},ui:{passpInfo:"div.passp",countryInfo:"div.country",addRecipient:"input.add-rcpt",addDiv:"div#add",expenseItemPanel:"div.expense-item",calcNds:"input#nds-calc",withNds:"a#with_nds",withoutNds:"a#without_nds",tooltips:'[data-toggle="tooltip"]'},events:{"change #RCPT_OKPO":"onChangeRcptOkpo","input #RCPT_BANK_MFO":"changedMfo","change #RCPT_BANK_MFO":"changedMfo","change #RCPT_PASSP_SER":"onChangePasspSer","change #RCPT_PASSP_NUM":"onChangePasspNum","click @ui.withoutNds":"withoutNdsCalc","click @ui.withNds":"withNdsCalc","click a#budget_payment":"budgetPaymentCalc","click a#expense_item_link":"selectExpenseItem","change @ui.calcNds":"onCalcNdsClick","change input.unique":"toggleAddLabel","blur input.unique":"toggleAddLabel","change input[type=text]":"onChangeField","change textarea":"onChangeField","chosen:select #CLN_ACCOUNT":"onChangeClientAccount","keyup #RCPT_ACCOUNT":"onInputRcptAccount","keyup #RCPT_OKPO":"onInputRcptOkpo","hide #DATE_DOC":"onBlurDate","blur #DATE_DOC":"onBlurDate","hide #VALUE_DATE":"onBlurDate","blur #VALUE_DATE":"onBlurDate"},passpSerField:"RCPT_PASSP_SER",passpNumField:"RCPT_PASSP_NUM",initialize:function(a){this.accounts=a.accounts,this.recipientList=a.recipientList,this.countryList=a.countryList,this.getMfo=a.getMfo,this.getReference=a.getReference,this.getBankBranches=a.getBankBranches,this.plannedRemainders=a.plannedRemainders,this.currentSubClientId=a.currentSubClientId,this.fillUiElements(this.getUiElementsTitles()),this.on("budgetId:changed",this.updateExpenseItemPanel),r=this.changedNls||r},getUiElementsTitles:function(){return["DATE_DOC","NUM_DOC","AMOUNT","CLN_NAME","CLN_OKPO","CLN_ACCOUNT","CLN_BANK_NAME","CLN_BANK_MFO","RCPT_NAME","RCPT_OKPO","RCPT_ACCOUNT","RCPT_BANK_NAME","RCPT_BANK_MFO","PAYMENT_DETAILS","VALUE_DATE","CLN_COUNTRY_CODE","EXPENSE_ITEM","RCPT_COUNTRY_CODE","RCPT_PASSP_SER","RCPT_PASSP_NUM","PLANNED_REMAINDER"]},onShow:function(){if(h.prototype.onShow.call(this,arguments),this._prepareLists(),this.onChangeRcptOkpo(!0),this.ui.AMOUNT.formatter("amount"),this.ui.RCPT_ACCOUNT.formatter("number"),this.ui.RCPT_OKPO.formatter("number"),this.ui.RCPT_BANK_MFO.formatter("number"),this.ui.RCPT_PASSP_NUM.formatter("number"),this.ui.PLANNED_REMAINDER.formatter("amount"),this.ui.RCPT_NAME.formatter("text"),!this.model.isNew()){var c=this.model.get("links");c&&c.length>0&&(this.ui.RCPT_ACCOUNT.prop("disabled",!0),this.ui.RCPT_BANK_MFO.prop("disabled",!0),this.ui.RCPT_OKPO.prop("disabled",!0),this.ui.RCPT_NAME.prop("disabled",!0),a("<div>",{id:"warn-msg"}).html(r.requisites_change_is_forbidden).insertAfter(this.$("h1")))}if(this.model.isNew()&&this.model.get("CLN_ACCOUNT")){var d=b.findWhere(this.accounts,{account:this.model.get("CLN_ACCOUNT")});d&&this.saveAccountIdToLocalStorage(d)}this.ui.PLANNED_REMAINDER.prop("disabled",!0),this.ui.DATE_DOC.formatter("date"),this.ui.VALUE_DATE.formatter("date"),k.datePicker(a("input.datepicker"),{orientation:"bottom auto"}),this.ui.PAYMENT_DETAILS.formatter("oneline_textarea",{maxlength:l.PAYMENT_DETAILS_LENGTH}).change(),this.$("#expense_item_lable").hide(),this.updateBudgetId(),this.ui.tooltips.tooltip()},onBeforeDestroy:function(){this.ui.CLN_ACCOUNT.disposeChosen(),this.ui.RCPT_NAME.disposeChosen(),this.ui.RCPT_COUNTRY_CODE.disposeChosen()},fillAccountList:function(){this.accounts=c.addAccountTypeDescription(this.accounts);var a={array:this.accounts,id:"account_id",text:"account"};this.ui.CLN_ACCOUNT.chosen({searchable:!1,data:a,accType:g.NEED_SHOW_ACC_TYPE}),this.updatePlannedRemainders(this.ui.CLN_ACCOUNT.val())},saveAccountIdToLocalStorage:function(a){k.setStorageDocData("ua_payment_acc_id",a.account_id)},onChangeClientAccount:function(a,b){this.saveAccountIdToLocalStorage(b),this.model.set(this.fillClientAccount(b)),this.updateBudgetId(),this.updatePlannedRemainders(b.account)},updatePlannedRemainders:function(a){this.plannedRemainders&&this.ui.PLANNED_REMAINDER.prop("value",k.formatAmount(this.plannedRemainders[a]))},fillClientAccount:function(a){var c=b.findWhere(this.getBankBranches,{bik:a.mfo});return{CLN_ACCOUNT:a.account,CLN_BANK_MFO:a.mfo,CLN_BANK_NAME:c.name}},onInputRcptAccount:function(a){this._onInput("bill",a.target.value,5)},onInputRcptOkpo:function(a){this._onInput("inn",a.target.value,8)},createFromRecipients:function(){var a=sessionStorage.getItem("rcpt_id");a&&(this.ui.RCPT_NAME.trigger("chooseById",a),sessionStorage.removeItem("rcpt_id"))},toggleAddLabel:function(){var a=this.ui.RCPT_OKPO.val(),c=this.ui.RCPT_ACCOUNT.val(),d=this.ui.RCPT_BANK_MFO.val();a&&c&&d?this.recipientList.done(function(e){var f=b.find(e,function(e){var f=k.getContent(e,"inn");return f===a&&b.findWhere(e.requisites,{bill:c})&&b.findWhere(e.requisites,{bic:d})});f?(this.ui.addDiv.hide(),this.ui.addRecipient.removeAttr("checked")):this.ui.addDiv.show()}.bind(this)):(this.ui.addDiv.hide(),this.ui.addRecipient.removeAttr("checked"))},onChangeRcptOkpo:function(a){switch(this.ui.RCPT_OKPO.val()){case"0000000000":a||(this.ui.RCPT_PASSP_SER.val(""),this.ui.RCPT_PASSP_NUM.val("")),this.ui.passpInfo.show(),this.ui.countryInfo.hide(),this.ui.RCPT_COUNTRY_CODE.val("");break;case"000000000":this.ui.RCPT_PASSP_SER.val(""),this.ui.RCPT_PASSP_NUM.val(""),this.ui.passpInfo.hide(),this.ui.countryInfo.show(),this.ui.RCPT_COUNTRY_CODE.is(".select-box")||this.fillCountryList();break;default:this.ui.RCPT_COUNTRY_CODE.val(""),this.ui.RCPT_PASSP_SER.val(""),this.ui.RCPT_PASSP_NUM.val(""),this.ui.passpInfo.hide(),this.ui.countryInfo.hide()}},fillCountryList:function(){var a={ru:"country",uk:"ukr_name",en:"eng_name"},c=a[k.getLocale()];this.countryList.done(function(a){var d=function(a,d,e){var f=a.code;if(d&&0!==d.length){e=e||0;var g=b.escape(f.substr(0,e)),h=b.escape(f.substr(e,d.length)),i=b.escape(f.substr(e+d.length));d=g+"<em>"+h+"</em>"+i}else d=b.escape(f);return d+="<span class='country-name'>"+b.escape(a[c])+"</span>"};this.ui.RCPT_COUNTRY_CODE.chosen({width:"10em",render:d,strict:!0,data:{array:a,id:"code",text:"code"}}),this.ui.RCPT_COUNTRY_CODE.formatter("number")}.bind(this))},getPromptValue:function(){var a=j.getClientProp("documents.ua_payment.prompt");return k.replaceAll(a,"^"," ")},changedMfo:function(){this.onChangeMfo("RCPT_BANK_NAME")},onChangeMfo:function(a){var b=this.ui.RCPT_BANK_MFO.val(),c=this.getMfo(b);this.ui.RCPT_BANK_NAME.val(""),c&&c.done(function(c){this.ui.RCPT_BANK_NAME.val(c[0]?c[0].name:""),this.model.set(a,c[0]?c[0].name:""),this.ui.RCPT_ACCOUNT.change(),this.validateField(this.ui.RCPT_BANK_MFO[0].id,b);var d=this.ui.RCPT_ACCOUNT.val();d&&this.validateField(this.ui.RCPT_ACCOUNT[0].id,d)}.bind(this))},withNdsCalc:function(a){a.preventDefault(),this.clearPrevNds();var b=.2,c=this.ui.AMOUNT.getUnformattedValue()||"0.00",d=r.with_nds_dtls+(100*b).toFixed(0)+"% - "+(c-c/(1+b)).toFixed(2)+" грн.";return this.addNdsInfo(d),!1},withoutNdsCalc:function(a){return a.preventDefault(),this.clearPrevNds(),this.addNdsInfo(r.no_nds_dtls),!1},budgetPaymentCalc:function(a){a.preventDefault();var b=new n({el:f.wrapper()});return b.render(),b.once("ua_payment:payment_details:append",function(a){this.ui.PAYMENT_DETAILS.val(this.ui.PAYMENT_DETAILS.val()+a).change()},this),!1},clearPrevNds:function(){var a=this.ui.PAYMENT_DETAILS.val();a=k.replaceAll(a,r.no_nds_dtls,"");var b=new RegExp(r.with_nds_dtls+".*?грн\\.","g");a=a.replace(b,""),this.ui.PAYMENT_DETAILS.val(a)},addNdsInfo:function(a){var b=this.ui.PAYMENT_DETAILS.val().trim(),c=b.length;b+=" "+a,b=b.length>l.PAYMENT_DETAILS_LENGTH?b.substr(0,l.PAYMENT_DETAILS_LENGTH):b,this.ui.PAYMENT_DETAILS.val(b).change(),k.setSelectionRange(this.ui.PAYMENT_DETAILS,c,b.length)},onChangePasspSer:function(a){var b=this.ui.RCPT_PASSP_SER.val();b?this.validateField(this.passpSerField,this.ui.RCPT_PASSP_SER.val()):(this.model.set(this.passpSerField,b,{silent:!0}),d.Validation.callbacks.valid(null,this.passpSerField)),this.ui.RCPT_PASSP_NUM.attr("maxlength",b?6:9),b&&this.ui.RCPT_PASSP_NUM.val().length>6&&this.ui.RCPT_PASSP_NUM.val(""),this.ui.RCPT_PASSP_NUM.val()&&this.ui.RCPT_PASSP_NUM.change()},onChangePasspNum:function(){this.validateField(this.passpNumField,this.ui.RCPT_PASSP_NUM.val()),this.onPasspChanged()},onPasspChanged:function(){this.ui.RCPT_PASSP_SER.hasClass("error")||this.ui.RCPT_PASSP_NUM.hasClass("error")?d.Validation.callbacks.showGlobalError(r.incorrectPassp):this.$("div.errors").remove()},onCalcNdsClick:function(a){this.clearPrevNds();var b=this.ui.AMOUNT.getUnformattedValue(),c=a.target.checked;c&&this.addNdsInfo(r.with_nds_dtls+"20% - "+(.2*(b||"0.00")).toFixed(2)+" грн."),b&&(b=c?1.2*b:b/1.2,this.ui.AMOUNT.val(k.formatAmount(b.toFixed(2))).change()),this.ui.AMOUNT.prop("disabled",c),this.ui.withNds.css("display",c?"none":"inline"),this.ui.withoutNds.css("display",c?"none":"inline")},onChangeField:function(a){var c=a.target.id;-1===c.indexOf("BANK_MFO")&&-1===c.indexOf("PASSP")&&-1===c.indexOf("DATE")&&h.prototype.onChangeField.call(this,a);var d=["RCPT_NAME","RCPT_OKPO","RCPT_ACCOUNT","PAYER_NAME","PAYER_OKPO","PAYER_ACCOUNT"];-1!==b.indexOf(d,c)&&(this.ui.RCPT_NAME.val()||this.ui.RCPT_OKPO.val()||this.ui.RCPT_ACCOUNT.val()||this.recipientList.done(function(a){this.ui.RCPT_OKPO.trigger("refresh",{array:b.isArray(a)?b.sortBy(a,"name"):[a],value:this.ui.RCPT_OKPO.val()}),this.ui.RCPT_ACCOUNT.trigger("refresh",{array:this._getAllRequisites(a),value:this.ui.RCPT_ACCOUNT.val()})}.bind(this)))},onBlurDate:function(a){var b=a.target.id;""===this.ui[b].val().replace(/\s+/g,"").replace(/\./g,"")&&this.ui[b].val(""),this.validateField(b,this.ui[b].val())},updateExpenseItemPanel:function(){s?this.getExpenceItems().done(function(a){t=a;var c=b.findWhere(t,{code:this.ui.EXPENSE_ITEM.val()});c||this.ui.EXPENSE_ITEM.val(""),this.ui.expenseItemPanel.show()}.bind(this)):(this.ui.EXPENSE_ITEM.val(""),this.ui.expenseItemPanel.hide())},updateBudgetId:function(){this.getBudgetId().done(function(a){s=a,this.trigger("budgetId:changed")}.bind(this))},getBudgetId:function(){var b=a.Deferred();if(this.isBudgetAccount()){var c=this.model.get("CLN_ACCOUNT"),d=this.model.get("CLN_BANK_MFO");if(""===this.validateField("DATE_DOC",this.ui.DATE_DOC.val())||""===this.ui.DATE_DOC.val()){var e=this.getDocDate(),f={query:"[0]=='"+d+"' && [1]=='"+c+"' && [4]==1 && [2] <= '"+e+"' && [3] >= '"+e+"'"};this.getReference("budget",f,!0,this.currentSubClientId).done(function(a){var c=a&&a.length>0?a[0].id:null;b.resolve(c)})}else b.resolve(null)}else b.resolve(null);return b},isBudgetAccount:function(){return Boolean(b.findWhere(this.accounts,{account:this.model.get("CLN_ACCOUNT"),currency:"UAH"}))},selectExpenseItem:function(a){a.preventDefault();var b=this;if(s){var c=new o({el:f.wrapper(),expenceItems:t});c.render(),c.on("ua_payment:budget_code:selected",function(a){this.ui.EXPENSE_ITEM.val(a)},b)}return!1},getExpenceItems:function(){var a=this.getDocDate(),b={query:"[0]=="+s+" && [7]==1 && (([14] <= '"+a+"' && [15] >= '"+a+"') || ([14] == NULL && [15] == NULL))"};return this.getReference("budget_item",b,!0,this.currentSubClientId)},getDocDate:function(){return this.ui.DATE_DOC.val()||k.date2str(k.getServerDate())},_prepareLists:function(){this.fillAccountList(),this._fillList(this.ui.RCPT_NAME,"name",200),this._fillList(this.ui.RCPT_OKPO,"inn",10),this._fillRecipientAccountsList()},_fillList:function(a,c,d){var e={data:{array:[],id:"id",text:c},maxLength:d};if(-1!==a.attr("name").indexOf("_NAME")){var f=function(a,c,d){var e=k.getContent(a,"name");if(c&&0!==c.length){d=d||0;var f=b.escape(e.substr(0,d)),g=b.escape(e.substr(d,c.length)),h=b.escape(e.substr(d+c.length));c=f+"<em>"+g+"</em>"+h}else c=b.escape(e);var i=k.getContent(a,"requisites"),j=i.length>1?r.several_reqs:b.escape(i[0].bill);return c+="<div class='bill'>"+j+"</div>"};b.extend(e,{render:f})}a.chosen(e),this.recipientList.done(function(c){var d=a.val(),e=b.clone(c);a.trigger("refresh",{array:b.isArray(e)?b.sortBy(e,"name"):[e],value:d}),a.bind("chosen:select",function(a,b){this._onChooseRcptField(e,b)}.bind(this)),a.val(d).change(),this.createFromRecipients(),this.toggleAddLabel()}.bind(this))},_fillRecipientAccountsList:function(){this.recipientList.done(function(a){b.each(a,function(a){b.each(a.requisites,function(b){b.idd=a.idd})});var c=this.ui.RCPT_ACCOUNT.val(),d=this._filterRecipients(a),e=this._getAllRequisites(d),f={data:{array:e,id:"id",text:"bill",value:c},maxLength:14};this.ui.RCPT_ACCOUNT.chosen(f),this.ui.RCPT_ACCOUNT.bind("chosen:select",function(c,d){var e=b.findWhere(a,{idd:d.idd});this._onChooseRcptField(a,e)}.bind(this)),this.ui.RCPT_ACCOUNT.val(c).change()}.bind(this))},_onChooseRcptField:function(a,c){c.requisites.length>1?this._showRequisitesListModal(c,a):this._fillFields({recipient:b.extend(c,c.requisites[0]),recipients:a})},_filterRecipients:function(a){var c=this.model.get("RCPT_OKPO")||this.model.get("PAYER_OKPO");return c?b.findWhere(a,{inn:c,name:this.model.get("RCPT_NAME")})||[]:b.clone(a)},_getAllRequisites:function(a){var c=b.isArray(a)?b.map(a,function(a){return a.requisites}):a.requisites;return b.flatten(c)},_showRequisitesListModal:function(a,c){var d={el:f.wrapper(),recipient:a},e=new p(d);e.render(),e.once("recipient_requisites:choose",function(d){this._fillFields({recipient:b.extend(a,d),recipients:c})}.bind(this))},_fillFields:function(a){var b=a.recipient;this.ui.RCPT_ACCOUNT.val(k.getContent(b,"bill")),this.ui.RCPT_NAME.val(k.getContent(b,"name")).change(),this.ui.RCPT_OKPO.val(k.getContent(b,"inn")).change(),this.ui.RCPT_BANK_MFO.val(k.getContent(b,"bic")).change(),b.comment=this.getCorrectPaymentDetailsOld(b.comment);var c=k.getContent(b,"comment");this.ui.PAYMENT_DETAILS.val(c).change(),this.ui.RCPT_ACCOUNT.trigger("refresh",{array:b.requisites,value:this.ui.RCPT_ACCOUNT.val()}),this.ui.RCPT_OKPO.trigger("refresh",{array:[b],value:this.ui.RCPT_OKPO.val()})},_onInput:function(a,c,d){c.length>=d&&this.recipientList.done(function(d){var e=b.filter(d,function(b){return k.getContent(b,a)===c});1===e.length&&this._onChooseRcptField(d,e[0])}.bind(this))},getCorrectPaymentDetailsOld:function(a){return a.length>l.PAYMENT_DETAILS_LENGTH?a.slice(0,l.PAYMENT_DETAILS_LENGTH):a}})}),define("commons/base_object/document/document_print_processor",["jquery","underscore","bifit","printUtils"],function(a,b,c,d){"use strict";function e(b,c,d,e,f){this.form=b,this.$mainElement=a(b[0].querySelector("section.main").querySelector("article.main")),this.$printButton=a(b[0].querySelector("button.print.to-printer")),this.$printPdfButton=a(b[0].querySelector("button.print.to-pdf")),this.printStyle=d,this.pdfTemplate=e,this.documentType=c,this.modelStatus=f,this.printPromises=[]}return e.prototype.run=function(c){a(this.form[0].querySelector("#doc-div")).remove(),this.$mainElement.append('<style type="text/css">'+this.printStyle+"</style>"),this.$printPdfButton.parent().show(),d.spinBtn(this.$printButton),d.spinBtn(this.$printPdfButton),d.createLeftMenu(c,this.form).then(function(){var e=this.form.find("input[type=checkbox]");e.prop("disabled",!0),this.renderDocument(c[0],this.$mainElement);var f=!b.contains(["pay_sheet","assign_card_order","fire_staff_order","card_prolongation"],this.documentType);setTimeout(function(){a.when.apply(a,this.printPromises).then(function(){for(var b=f?this.$mainElement.clone(!0):this.$mainElement,g=1;g<c.length;g++)this.renderDocument(c[g],b);a.when.apply(a,this.printPromises).always(function(){f&&(this.$mainElement[0].innerHTML=b[0].innerHTML),e.prop("disabled",!1),d.stopBtn(this.$printButton),d.stopBtn(this.$printPdfButton)}.bind(this))}.bind(this))}.bind(this),300),this.addPrintPdfButtonHandler()}.bind(this))},e.prototype.renderDocument=function(){throw new Error("renderDocument is not implemented")},e.prototype.addPrintPdfButtonHandler=function(){this.$printPdfButton.bind("click",function(){var b=this.documentType+".pdf",e=this.prepareDocumentForPdf(this.$mainElement.clone(!0));a.ajax({type:"POST",url:localStorage.getItem("addr")+"/print_to_pdf;jsessionid="+c.getStoredItem("JSESSIONID"),contentType:"application/x-www-form-urlencoded; charset=UTF-8",mimeType:"text/plain; charset=x-user-defined",data:{html:this.getHtmlForPdf(e),fileName:b,stampAbsolutePosition:!0},success:function(a){d.createPdfFile(a,b,this.form[0])}.bind(this)})}.bind(this))},e.prototype.getHtmlForPdf=function(a){var c={"<br>":"<br/>",'"':'"',"<hr>":"<hr/>"};return b.template(this.pdfTemplate,{content_for_pdf:a[0].outerHTML}).replace(/<br>|"|<hr>/gi,function(a){return c[a]})},e.prototype.prepareDocumentForPdf=function(c){c.find("style").remove(),c.find("h1.empty").remove(),c.find(".hidden").remove(),c.find("colgroup").remove(),this.form.find("#ecp_owner").is(":checked")||c.find(".sign1, .sign2").children().remove(),this.form.find("#service_info").is(":checked")||0===c.find(".serv-info-table")||c.find(".serv-info-table").remove(),b.contains(["ua_payment","ua_payment_request","bank_ua_payment_request"],this.documentType)&&(this.form.find("#two_copies").is(":checked")||0===c.find(".doc-div-copied")||c.find(".doc-div-copied").remove());var d=c.find(".for-img img").parent();return d.empty(),this.form.find("#bank_stamp").is(":checked")&&d.each(function(){var b=a(this);b.append("<"+b.attr("data-stamp-name")+"/>")}),c},e}),define("text!apps/ua_payment/templates/print/print_pdf.tmpl",[],function(){return"<html>\n    <head>\n        <style type=\"text/css\">\n            div.ua_payment {\n                font-size: 8px;\n                font-family: 'Courier New', Courier, 'Lucida Console', monospace;\n                line-height: 1;\n            }\n\n            div.bank_ua_payment_request, div.ua_payment_request {\n                font-size: 10px;\n                font-family: \"Times_New_Roman\", serif;\n                line-height: 1;\n            }\n\n            table {\n                width: 100%;\n                border-spacing: 1px;\n                border-collapse: collapse;\n            }\n\n            td {\n                font-size: 11px;\n                padding: 3px;\n            }\n\n            div.doc-div {\n                page-break-after: always;\n            }\n\n            hr {\n                border-top-style: dashed;\n            }\n\n            body table .bordered, .border {\n                border: solid 1px #000000;\n            }\n\n            body table .bordered, body table .pad4 {\n                padding: 4px;\n            }\n\n            .tbordered {\n                border-top: 1px solid black;\n            }\n\n            .lbordered {\n                border-left: 1px solid black;\n            }\n\n            .bbordered {\n                border-bottom: 1px solid black;\n            }\n\n\n            .header, .header * {\n                font-weight: bold;\n            }\n\n            .amount-number {\n                padding-right: 5px;\n                text-align: right;\n            }\n\n            .doc-ident {\n                float: right;\n                padding: 1px 10px;\n            }\n\n            .pay-num {\n                font-size: 11pt;\n            }\n\n            .centered {\n                text-align: center;\n            }\n\n            .exec-bank {\n                height: 15px;\n            }\n\n            div.doc-div-copied, div.for-service-info {\n                padding-top: 2em;\n            }\n\n            div table.serv-info-table {\n                font-weight: 600;\n                border-collapse: collapse;\n                border-top: 1px solid black;\n                border-left: 1px solid black;\n            }\n\n            div table.serv-info-table td {\n                border-right: 1px solid black;\n                border-bottom: 1px solid black;\n            }\n\n            div.ua_payment table.serv-info-table, div.ua_payment_request table.serv-info-table {\n                font-family: Serif, 'Times New Roman', serif;\n            }\n\n            table.payment-info td.recipient-name, table.payer td.payer-name,\n            table.payment-info td.recipient-title, table.payer td.payer-title {\n                vertical-align: top;\n                padding-top: 0 !important;\n            }\n\n            table.payment-info td.recipient-name, table.payer td.payer-name {\n                word-wrap: break-word;\n            }\n\n            div.bank_ua_payment_request td.doc-date div, div.ua_payment_request td.doc-date div {\n                font-size: 9pt;\n            }\n\n            div.bank_ua_payment_request .font8, div.ua_payment_request .font8  {\n                font-size: 8pt;\n            }\n\n            div.bank_ua_payment_request body table td, div.ua_payment_request body table td {\n                padding: 2px !important;\n            }\n\n            div.bank_ua_payment_request .sign-empty-cell, div.ua_payment_request .sign-empty-cell {\n                height: 20px;\n            }\n        </style>\n    </head>\n    <body>\n        <%= content_for_pdf %>\n    </body>\n</html>"}),define("apps/ua_payment/ua_payment_print",["jquery","underscore","bifit","printUtils","commons/base_object/document/document_print_processor","text!apps/ua_payment/templates/print/print_pdf.tmpl"],function(a,b,c,d,e,f){"use strict";function g(a,b,c,d){this.printTemplate=d,e.call(this,a,b,c,f)}return g.prototype=Object.create(e.prototype),g.prototype.constructor=g,g.prototype.renderDocument=function(a,c){c.append('<div id="doc-div-'+a.id+'" class="doc-div"></div>');var e=c.find("#doc-div-"+a.id);e.addClass(this.documentType).html(b.template(this.printTemplate)(a.toJSON()));var f=e.find("div.doc-print-content").clone(!0);f.attr("class","doc-div-copied").css("display","none"),e.append(f);var g=a.get("AMOUNT");e.find(".amount-number").html(g.replace(".",",")),e.find(".amount-words").html(d.amountToWords(g));var h=e.find(".doc-date");h.html("<div>від "+d.dateToWords(a.get("DATE_DOC"))+"</div>"+h.html());var i=a.get("PAYMENT_DETAILS");e.find(".payment_details").html(b.escape(i));var j=d.addDocumentAdditionalInfo(e[0],a).then(function(){"ua_payment"===this.documentType&&d.getPrintParam("two_copies")&&f.css("display","block")}.bind(this));this.printPromises.push(j)},function(a,b,c){d.createPrintFormForPdf().then(function(d){var e=a[0].type||"ua_payment",f=new g(d,e,c,b);f.run(a)})}}),define("text!apps/ua_payment/templates/print/print.tmpl",[],function(){return'<div class="doc-print-content">\n\n    <table>\n        <tbody>\n            <tr>\n                <td width="75%"></td>\n                <td class="border doc-ident">0410001</td>\n            </tr>\n        </tbody>\n    </table>\n    <table>\n        <tr>\n            <td width="10%"></td>\n            <td width="40%" class="header centered pay-num">ПЛАТІЖНЕ ДОРУЧЕННЯ N <%- NUM_DOC %></td>\n            <td colspan="2">&nbsp;</td>\n        </tr>\n        <tr>\n            <td></td>\n            <td class="header centered doc-date"/>\n            <td width="30%">&nbsp;</td>\n            <td width="20%" class="centered" nowrap>Одержано банком</td>\n            <td>&nbsp;</td>\n        </tr>\n        <tr>\n            <td colspan="3">&nbsp;</td>\n            <td class="bbordered centered in-bank">&nbsp;</td>\n            <td>&nbsp;</td>\n        </tr>\n    </table>\n    <table class="payer">\n        <tr>\n            <td width="10%" class="payer-title">Платник</td>\n            <td width="90%" class="header payer-name"><%- CLN_NAME %></td>\n        </tr>\n    </table>\n    <table cols="7" class="payment-info">\n        <colgroup>\n            <col width="10%"/>\n            <col width="20%"/>\n            <col width="16%"/>\n            <col width="12%"/>\n            <col width="7%"/>\n            <col width="20%"/>\n            <col width="16%"/>\n        </colgroup>\n        <tr>\n            <td width="10%">Код</td>\n            <td width="20%" class="header bordered"><%= CLN_OKPO %></td>\n            <td width="16%">&nbsp;</td>\n            <td colspan="4">&nbsp;</td>\n        </tr>\n        <tr>\n            <td colspan="3">Банк платника</td>\n            <td width="12%" class="centered">код банку</td>\n            <td width="7%" class="centered"></td>\n            <td width="20%" class="centered">ДЕБЕТ рах. N</td>\n            <td width="16%" class="centered">СУМА</td>\n        </tr>\n        <tr>\n            <td class="header bbordered" colspan="3"><%- CLN_BANK_NAME %></td>\n            <td class="header bordered centered"><%= CLN_BANK_MFO %></td>\n            <td></td>\n            <td class="header tbordered lbordered bbordered"><%= CLN_ACCOUNT %></td>\n            <td class="header bordered amount-number" rowspan="5" valign="top"></td>\n        </tr>\n        <tr>\n            <td class="recipient-title">Отримувач</td>\n            <td class="header recipient-name" colspan="3"><%- RCPT_NAME %></td>\n            <td>&nbsp;</td>\n        </tr>\n        <tr>\n            <td>Код</td>\n            <td class="header">\n                <table style="height: 100%;">\n                    <tr><td  width="100%" class="bordered"><%= RCPT_OKPO %></td></tr>\n                </table>\n            </td>\n            <td colspan="3">&nbsp;</td>\n            <td class="centered">КРЕДИТ рах. N</td>\n        </tr>\n        <tr>\n            <td colspan="3">Банк отримувача</td>\n            <td class="centered">код банку</td>\n            <td></td>\n            <td class="header tbordered lbordered pad4"><%= RCPT_ACCOUNT %></td>\n        </tr>\n        <tr>\n            <td class="header bbordered" colspan="3"><%- RCPT_BANK_NAME %></td>\n            <td class="header centered bordered"><%= RCPT_BANK_MFO %></td>\n            <td></td>\n            <td class="tbordered lbordered bbordered"></td>\n        </tr>\n        <tr>\n            <td colspan="2">Сума (словами)</td>\n            <td colspan="2"></td>\n            <td colspan="3"></td>\n        </tr>\n        <tr>\n            <td class="header amount-words" colspan="5"><br><br></td>\n            <td colspan="2">&nbsp;</td>\n        </tr>\n    </table>\n\n    <table class="details" cols="6" cellspacing="2mm">\n        <tr>\n            <td width="70%" class="tbordered" colspan="4">Призначення платежу</td>\n            <td width="10%">&nbsp;</td>\n            <td class="bordered" width="20%">\n                <% if (typeof CLN_COUNTRY_CODE !=\'undefined\' && CLN_COUNTRY_CODE) { %>\n                П <%- CLN_COUNTRY_CODE %>\n                <% } %>\n                <% if (typeof RCPT_COUNTRY_CODE !=\'undefined\' && RCPT_COUNTRY_CODE) { %>\n                О <%- RCPT_COUNTRY_CODE %>\n                <% } %>\n                &nbsp;\n            </td>\n        </tr>\n        <tr>\n            <td class="header" colspan="4"><%- PAYMENT_DETAILS %></td>\n            <td colspan="2">&nbsp;</td>\n        </tr>\n    </table>\n    <table cellspacing="2mm">\n        <tr>\n            <td class="padded" colspan="2" valign="top">ДР</td>\n            <td class="bordered" colspan="2">\n                <% if (typeof RCPT_OKPO != \'undefined\' && RCPT_OKPO && RCPT_OKPO === \'0000000000\' &&\n                typeof RCPT_PASSP_SER != \'undefined\' && typeof RCPT_PASSP_NUM != \'undefined\') { %>\n                <span>Серія і N пасп. отр.:</span><br>\n                <span class="header"><%- RCPT_PASSP_SER %>&nbsp;<%- RCPT_PASSP_NUM %></span>\n                <% } %>\n                &nbsp;\n            </td>\n            <td width="44%"></td>\n            <td width="1%"></td>\n            <td width="20%" class="centered" rowspan="3" nowrap valign="top">\n                <table>\n                    <tr>\n                        <td class="exec-bank-title">Проведено банком</td>\n                    </tr>\n                    <tr>\n                        <td class="exec-bank">\n                            <% if (typeof OPER_DATE != \'undefined\' && OPER_DATE) { %>\n                            <%= OPER_DATE %>\n                            <% } %>\n                        </td>\n                    </tr>\n                    <tr>\n                        <td class="tbordered">підпис банку</td>\n                    </tr>\n                </table>\n            </td>\n        </tr>\n        <tr>\n            <td width="5%" class="padded" valign="top">М.П.</td>\n            <td width="8%" valign="top">Підписи</td>\n            <td width="2%"></td>\n            <td width="20%" class="bbordered"></td>\n            <td width="44%" class="sign1"></td>\n            <td width="1%"></td>\n        </tr>\n        <tr>\n            <td colspan="3"></td>\n            <td width="20%" class="bbordered">&nbsp;</td>\n            <td width="44%" class="sign2"></td>\n            <td width="1%"></td>\n        </tr>\n    </table>\n    <div class="for-img" style="float: right"/>\n</div>\n<hr/>\n<div class="for-service-info"></div>\n';
}),define("text!apps/ua_payment/css/print.css",[],function(){return"section.doc-print article div.ua_payment,section.doc-print div.ua_payment div,\nsection.doc-print div.ua_payment td,section.doc-print div.ua_payment span,section.doc-print div.ua_payment p,\nsection.doc-print div.ua_payment u{\nfont-family:'Courier New',Courier,'Lucida Console',monospace;\nfont-size:8pt;\n}\ndiv.ua_payment td.header,div.ua_payment td.header *{\nfont-weight:bold;\n}\ndiv.ua_payment td:not([class=\"padded\"]):first-child{\npadding-left:0;\n}\n.doc-date div.bbordered{\ndisplay:inline-block;\n}\ndiv.ua_payment .amount-number{\npadding-right:5px;\ntext-align:right;\n}\nbody table .bordered,body table .pad4{\npadding:4px !important;\n}\nbody table td{\npadding:2px !important;\n}\nsection.doc-print table{\npadding:0;\n}\n.border{\nborder:solid 1px #000000;\n}\ndiv.ua_payment .doc-ident{\nfloat:right;\npadding:1px 10px !important;\n}\ndiv.doc-div.ua_payment td.pay-num{\nfont-size:11pt;\n}\ndiv.ua_payment .centered{\ntext-align:center;\n}\ndiv.ua_payment .tbordered{\nborder-top:1px solid black;\n}\ndiv.ua_payment .lbordered{\nborder-left:1px solid black;\n}\ndiv.ua_payment .bbordered{\nborder-bottom:1px solid black;\n}\ndiv.ua_payment table{\nwidth:100%;\nborder-collapse:collapse;\nborder-spacing:0;\n}\ndiv.ua_payment .header{\nfont-weight:bold;\n}\nsection.doc-print table.payment-info,\nsection.doc-print table.payer{\ntable-layout:fixed;\n}\nsection.doc-print table.payment-info td.recipient-name,\nsection.doc-print table.payer td.payer-name{\nword-wrap:break-word;\n}\ndiv.ua_payment .exec-bank{\nheight:15px;\n}"}),define("text!apps/ua_payment/templates/print/print_sub_menu.tmpl",[],function(){return'<div class="popup-wrapper bottom sub-menu">\n    <span class="popup-arrow"></span>\n    <span class="popup-arrow-border"></span>\n    <ul class="popup" style="white-space: nowrap">\n        <li class="popup-li"><a href="#" data-action="PRINT_REGISTRY"><%- ua_payment_print_registry %></a></li>\n        <% if (isSelected) { %>\n            <li class="popup-li"><a href="#" data-action="PRINT_LIST_DOC"><%- ua_payment_print_docs %></a></li>\n        <% } %>\n    </ul>\n</div>'}),define("text!apps/ua_payment/templates/print/print_registry.tmpl",[],function(){return'<table id="page-number">\n    <tr><td>Сторінка <%- page_number %></td></tr>\n</table>\n<div id="content"></div>'}),define("text!apps/ua_payment/templates/print/print_registry_header.tmpl",[],function(){return'<style>\n    .header {\n        line-height: 1.5;\n        padding-bottom: 20px;\n        padding-top: 20px;\n    }\n    .header span {\n        font-size: 12pt;\n    }\n    #content {\n        padding-bottom: 30px;\n    }\n    #page-number tr td {\n        text-align: right;\n    }\n    .registry-item {\n        padding: 10px 20px 10px 25px;\n    }\n    .registry-item-row {\n        table-layout: fixed;\n        border-spacing: 1px;\n    }\n    .registry-item-row__block {\n        font-family: "Times_New_Roman", serif;\n        font-size: 13px;\n        line-height: 1.1;\n        padding: 0 !important;\n        word-wrap: break-word;\n        -ms-word-wrap: break-word;\n    }\n    .registry-item-row__indent {\n        width: 10px;\n    }\n    .registry-item-row__num-doc {\n        width: 220px;\n    }\n    .registry-item-row__date {\n        width: 100px;\n    }\n    .registry-item-row__amount {\n        width: 130px;\n    }\n    .registry-item-row__payer {\n        width: 80px;\n    }\n    .registry-item-row__mfo {\n        width: 45px;\n    }\n    .registry-item-row__edrpou {\n        width: 75px;\n    }\n    .registry-item-row__acc {\n        width: 100px;\n    }\n    .registry-item-row__cln-name {\n        width: 340px;\n    }\n    .registry-item-row__cln-name.passport {\n        width: 240px;\n    }\n    .registry-item-row__nomination {\n        width: 133px;\n    }\n    .registry-item-row__desc {\n        width: 550px;\n    }\n    .registry-item-row__passp-ser {\n        width: 27px;\n    }\n    .registry-item-row__passp-num {\n        width: 65px;\n    }\n</style>\n\n<div class="centered bold-text header" align="center" id="header">\n    <span><%- BNK_NAME %></span><br>\n    <span><%- CLN_NAME %></span><br>\n    <span>РЕЄСТР ДОКУМЕНТІВ</span><br>\n    <span>з <%- BD %> до <%- ED %></span>\n</div>'}),define("text!apps/ua_payment/templates/print/print_registry_footer.tmpl",[],function(){return'<div id="footer">\n    <table>\n        <tbody>\n            <tr>\n                <td width="60%"></td>\n                <td width="20%" align="right">Усього документів: </td>\n                <td><%- COUNT_DOC %><br></td>\n            </tr>\n             <tr>\n                 <td></td>\n                 <td align="right">На загальну суму: </td>\n                 <td><%- TOTAL_AMOUNT %></td>\n             </tr>\n        </tbody>\n    </table>\n    <div style="padding-top: 3em">\n        <table>\n            <tbody>\n                <tr>\n                    <td width="10%"></td>\n                    <td width="12%">Бухгалтер</td>\n                    <td class="bbordered" width="30%"></td>\n                    <td></td>\n                </tr>\n                <tr>\n                    <td></td>\n                    <td>Директор</td>\n                    <td class="bbordered"></td>\n                </tr>\n            </tbody>\n        </table>\n    </div>\n</div>\n'}),define("text!apps/ua_payment/templates/print/print_registry_item.tmpl",[],function(){return'<div class="registry-item">\n    <table class="registry-item-row">\n        <tr>\n            <td class="registry-item-row__block registry-item-row__num-doc" valign="top">Документ N <%- NUM_DOC %></td>\n            <td class="registry-item-row__block registry-item-row__date" valign="top">Дата: <%- DATE_DOC %></td>\n            <td class="registry-item-row__block registry-item-row__indent" valign="top"></td>\n            <td class="registry-item-row__block registry-item-row__amount" valign="top">Сума: <%- AMOUNT %></td>\n            <td class="registry-item-row__block registry-item-row__indent" valign="top"></td>\n            <td class="registry-item-row__block" valign="top">Статус: <%- status_desc_ua %></td>\n        </tr>\n    </table>\n\n    <table class="registry-item-row">\n        <tr>\n            <td class="registry-item-row__block registry-item-row__payer" valign="top">Платник:</td>\n            <td class="registry-item-row__block registry-item-row__mfo" valign="top"><%- CLN_BANK_MFO %></td>\n            <td class="registry-item-row__block registry-item-row__indent" valign="top"></td>\n            <td class="registry-item-row__block registry-item-row__edrpou" valign="top"><%- CLN_OKPO %></td>\n            <td class="registry-item-row__block registry-item-row__indent"></td>\n            <td class="registry-item-row__block registry-item-row__acc" valign="top"><%- CLN_ACCOUNT %></td>\n            <td class="registry-item-row__block registry-item-row__indent" valign="top"></td>\n            <td class="registry-item-row__block registry-item-row__cln-name" valign="top"><%- CLN_NAME %></td>\n        </tr>\n    </table>\n\n    <table class="registry-item-row">\n        <tr>\n            <td class="registry-item-row__block registry-item-row__payer" valign="top">Отримувач:</td>\n            <td class="registry-item-row__block registry-item-row__mfo" valign="top"><%- RCPT_BANK_MFO %></td>\n            <td class="registry-item-row__block registry-item-row__indent" valign="top"></td>\n            <td class="registry-item-row__block registry-item-row__edrpou" valign="top"><%- RCPT_OKPO %></td>\n            <td class="registry-item-row__block registry-item-row__indent" valign="top"></td>\n            <td class="registry-item-row__block registry-item-row__acc" valign="top"><%- RCPT_ACCOUNT %></td>\n            <td class="registry-item-row__block registry-item-row__indent" valign="top"></td>\n            <% if (RCPT_OKPO === \'0000000000\') { %>\n                <td class="registry-item-row__block registry-item-row__cln-name passport" valign="top"><%- RCPT_NAME %></td>\n                <td class="registry-item-row__block registry-item-row__indent" valign="top"></td>\n                <td class="registry-item-row__block registry-item-row__passp-ser" valign="top"><%- RCPT_PASSP_SER %></td>\n                <td class="registry-item-row__block registry-item-row__indent" valign="top"></td>\n                <td class="registry-item-row__block registry-item-row__passp-num" valign="top"><%- RCPT_PASSP_NUM %></td>\n            <% } else { %>\n                <td class="registry-item-row__block registry-item-row__cln-name" valign="top"><%- RCPT_NAME %></td>\n            <% } %>\n        </tr>\n    </table>\n\n    <table class="registry-item-row">\n        <tr>\n            <td class="registry-item-row__block registry-item-row__nomination" valign="top">Банк отримувача:</td>\n            <td class="registry-item-row__block registry-item-row__desc" valign="top"><%- RCPT_BANK_NAME %></td>\n        </tr>\n    </table>\n\n    <table class="registry-item-row">\n        <tr>\n            <td class="registry-item-row__block registry-item-row__nomination" valign="top">Призначення платежу:</td>\n            <td class="registry-item-row__block registry-item-row__desc" valign="top"><%- PAYMENT_DETAILS %></td>\n        </tr>\n    </table>\n\n    <% if (EXPENSE_ITEM) { %>\n        <table class="registry-item-row">\n            <tr>\n                <td class="registry-item-row__block registry-item-row__nomination" valign="top">Стаття витрат:</td>\n                <td class="registry-item-row__block registry-item-row__desc" valign="top"><%- EXPENSE_ITEM %> <%- description %></td>\n            </tr>\n        </table>\n    <% } %>\n    <br/>\n</div>'}),define("text!apps/ua_payment/templates/print/print_registry_pdf.tmpl",[],function(){return'<html>\n<head>\n    <style type="text/css">\n        body {\n            font-size: 10pt;\n            font-family: "Times_New_Roman", serif;\n        }\n        table {\n            border-spacing: 1px;\n        }\n        td {\n            font-size: 13px;\n            padding: 0 !important;\n        }\n        .header {\n            text-align: center;\n            font-weight: bold;\n            padding: 20px 0 0 0;\n        }\n        #content {\n            padding-bottom: 25px;\n        }\n        div.header span {\n            font-size: 10pt;\n        }\n        div.registry-item {\n            padding: 10px 5px 9px 25px;\n        }\n        #page-number {\n            width: 100%;\n        }\n        #page-number tr td {\n            text-align: right;\n        }\n        .bbordered {\n            border-bottom: 1px solid black;\n        }\n        #footer table td {\n            padding: 5px !important;\n        }\n    </style>\n</head>\n<body>\n<%= content_for_pdf %>\n</body>\n</html>'}),define("apps/ua_payment/ua_payment_print_list",["jquery","underscore","app","services/doc_statuses","collections/thesaurus","bifit","printUtils","text!apps/ua_payment/templates/print/print_registry.tmpl","text!apps/ua_payment/templates/print/print_registry_header.tmpl","text!apps/ua_payment/templates/print/print_registry_footer.tmpl","text!apps/ua_payment/templates/print/print_registry_item.tmpl","text!apps/ua_payment/templates/print/print_registry_pdf.tmpl","i18n!apps/ua_payment/nls/ua_payment"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){"use strict";return function(n,o,p){g.createPrintFormForPdf().then(function(q){function r(a,b){D.append(a),w.height()>x&&(w.find(b).last().remove(),v++,u+=D[0].outerHTML,u+='<div style="page-break-after: always"></div>',w.parent().append('<div id="doc-div" class="ua-payment-registry page">'+y({page_number:v})+"</div>"),w=q.find("div#doc-div.ua-payment-registry").last(),D=w.find("#content").append(a),u+=w.find("#page-number")[0].outerHTML)}var s=q.find(".print.to-printer"),t=q.find(".print.to-pdf");g.spinBtn(s),g.spinBtn(t);var u,v=1;q.find("h1.empty").html(m.ua_payment_print_registry_title);var w=q.find("#doc-div").addClass("ua-payment-registry page"),x=w.height(),y=b.template(h),z=0,A=n.options.data;t.parent().show(),t.bind("click",function(){var c="ua_payment_registry.pdf";a.ajax({url:localStorage.getItem("addr")+"/print_to_pdf;jsessionid="+f.getStoredItem("JSESSIONID"),type:"POST",contentType:"application/x-www-form-urlencoded; charset=UTF-8",data:{html:b.template(l,{content_for_pdf:u}).split("<br>").join("<br/>").split('"').join('"'),fileName:c},mimeType:"text/plain; charset=x-user-defined",success:function(a){g.createPdfFile(a,c,q[0])}})}),w.html(y({page_number:v}));var B=b.template(i,{BNK_NAME:o.name,CLN_NAME:c.isMultiClient()?"":p.name_cln,BD:A.bdate,ED:A.edate}),C=w.find("#page-number");u=C[0].outerHTML+B,C.append(B);var D=w.find("#content");e.getThesaurus("budget_codes",!1).fetch().done(function(a){b.each(n.models,function(c){var e;c.get("EXPENSE_ITEM")&&(e=(b.findWhere(a,{code:c.get("EXPENSE_ITEM")})||{}).description);var f=parseInt(c.get("status")),g=d.getLocalizedNameById(f,"uk");if(1===f){var h=c.get("status_desc");g+=" "+h.substr(h.indexOf("(")).split(m.of).join("з")}var i=b.template(k,b.extend({description:e||""},{status_desc_ua:g},c.toJSON()));z+=parseFloat(c.get("AMOUNT")),r(i,".registry-item")});var c=b.template(j,{COUNT_DOC:n.models.length,TOTAL_AMOUNT:z.toFixed(2)});r(c,"#footer"),u+=D[0].outerHTML,g.stopBtn(s),g.stopBtn(t)})})}}),define("apps/ua_payment/base_ua_payment_controller",["jquery","underscore","backbone","bifit","app","charsets","appsPieces","customConstants","actionUtils","dialogUtils","thesaurusUtils","collections/thesaurus","collections/documents","collections/editabled_thesaurus","libs/multi_client_utils","models/reference","commons/base_object/document/group_opers_document_controller","apps/ua_payment/ua_payment_model","apps/ua_payment/ua_payment_confirm","apps/ua_payment/ua_payment_list_view","apps/ua_payment/ua_payment_filter_view","apps/ua_payment/ua_payment_view","apps/ua_payment/ua_payment_edit","apps/ua_payment/ua_payment_print","text!apps/ua_payment/templates/print/print.tmpl","text!apps/ua_payment/css/print.css","text!apps/ua_payment/templates/print/print_sub_menu.tmpl","apps/ua_payment/ua_payment_print_list","text!apps/ua_payment/templates/ua_payment_list_item.tmpl","i18n!apps/ua_payment/nls/ua_payment","i18n!nls/common","i18n!nls/document","i18n!commons/registry_docs/nls/registry_docs"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G){"use strict";var H=function(a){var c=a?a.mfo:0,d=b.findWhere(l.getThesaurus("bank_branches").array,{bik:c});return{CLN_ACCOUNT:a.account,CLN_BANK_MFO:a.mfo,CLN_BANK_NAME:d.name}},I=function(){var a=l.getThesaurus("accs_info").array;return a=b.filter(a,function(a){return"UAH"===a.currency&&a.permissions>0&&"2"===a.status&&b.contains(h.ACCOUNT_TYPES,a.type)}),b.sortBy(a,"account")},J=function(){var a=n.getThesaurus("ua_recipients"),b={error:function(a){c.Validation.invalidField(null,"RCPT_NAME",a)}};return a.loaded=!1,a.fetch(b)},K=function(){var a=l.getThesaurus("country"),b={error:function(a){c.Validation.invalidField(null,"RCPT_COUNTRY_CODE",a)}};return a.fetch(b)},L=null,M=null,N=function(a){if(a.length<12||a.length>18)return!1;var b=a.charAt(0);if("R"!==b&&"r"!==b)return!1;var c=parseInt(+a.substr(1,2),10);if(isNaN(c)||1>c||c>31)return!1;var d=parseInt(+a.substr(3,2),10);if(isNaN(d)||0>d||d>23)return!1;var e=parseInt(+a.substr(5,2),10);return!(isNaN(e)||0>e||e>59)},O=q.extend({tabsStatuses:{work:"0,1,2,3,4,6,21,22,3004",executed:"5",selectedTab:"work"},actionBarPrintSubMenu:null,ListView:t,listItemTemplate:C,Model:r,FilterView:u,View:v,Edit:w.extend({changedNls:D}),docType:"ua_payment",nls:D,maxArchiveDate:null,aliases:null,initialize:function(){this.maxArchiveDate=k.firstPropOf("documents.ua_payment.archive_temp_doc_date","documents.ua_payment.archive_max_doc_date"),e.isMultiClient()&&"ua_payment"===this.docType&&(this.tabsStatuses.for_consideration="13,14,15,16,17,18"),this.maxArchiveDate&&"ua_payment"===this.docType&&(this.tabsStatuses.archived="0,1,2,3,4,5,6,12,3004"),q.prototype.initialize.call(this)},addActions:function(){q.prototype.addActions.call(this),"ua_payment"===this.docType&&(this.actionsList?this.actionsList.push("PRINT_GROUP"):this.actionsList=["PRINT_GROUP"])},reloadDocumentsList:function(a){e.mainLayout.actionBar.show(this.createActionBar(this.actionsList)),"archived"===this.tabsStatuses.selectedTab&&(a.isArchive=!0,d.str2date(a.bdate)>d.str2date(this.maxArchiveDate)&&(a.bdate=this.maxArchiveDate),d.str2date(a.edate)>d.str2date(this.maxArchiveDate)&&(a.edate=this.maxArchiveDate),c.trigger("update-archive-dates",a.bdate,a.edate)),q.prototype.reloadDocumentsList.call(this,a)},documentReloadOptions:function(a){return a.exclude="links",q.prototype.documentReloadOptions.call(this,a)},createFilterView:function(){var a=new this.FilterView({collection:this.collection,tabsStatuses:this.tabsStatuses,docType:this.docType,maxArchiveDate:this.maxArchiveDate});return this.listenTo(a,"getExtFilterData",function(a){M=a}),this.listenTo(a,"reload",this.reloadDocumentsList),this.listenTo(a,"onSyncEnd",function(a){this.getPlannedRamainders(a).done(function(a){L=a}.bind(this))}),a},getPossibleActionsForItemView:function(a){return i.isArchive(a)?this.isAccountsForCreateAction()?[i.DocumentAction.COPY,i.DocumentAction.PRINT]:[i.DocumentAction.PRINT]:q.prototype.getPossibleActionsForItemView.call(this,a)},viewDocumentOptions:function(){return{model:new this.Model(this.preparedContent4View),plannedRemainders:L,maxArchiveDate:this.maxArchiveDate,selectedTab:this.tabsStatuses.selectedTab}},showItemView:function(c){if(this.canChooseItem!==!1){this.canChooseItem=!1;var d=this,f=function(){d.canChooseItem=!0,!b.isEmpty(L)&&b.has(L,c.attributes.CLN_ACCOUNT)?q.prototype.showItemView.call(d,c):d.updatePlannedRemainders().done(function(){q.prototype.showItemView.call(d,c)})};if(e.isMultiClient()){var g=o.loadSubClientData(c.get("owner_id"),c.get("CLN_NAME"));a.when(g).then(f).fail(function(){d.canChooseItem=!0})}else f()}},createItemView:function(a,b){var c=q.prototype.createItemView.call(this,a,b);return c.then(function(){m.options.document_type!==this.selectedModel.get("type")&&(this.stopListening(this.selectedModel,"destroy"),this.listenTo(this.selectedModel,"destroy",function(){this.itemViewInstance.goToPaySheet.call(this.itemViewInstance,this.selectedModel.get("id"))}.bind(this)),this.listenTo(this.itemViewInstance,"showList",this.showListView))}.bind(this))},getPlannedRamainders:function(d){var f={};if(e.isMultiClient()){var g=e.multiClient.currentSubClientId;d=new c.Collection(d.where({owner_id:g}))}b.each(l.getThesaurus("accs_info").array,function(a){"UAH"===a.currency&&(f[a.account]=parseFloat(a.remainder).toFixed(2))});var h=a.Deferred(),i=function(c){var d={},e=b.filter(c.models,function(b){var c=b.attributes.status;return a.inArray(c,["2","3","4"])>-1}),g=b.groupBy(e,function(a){return a.attributes.PAYER_ACCOUNT?a.attributes.PAYER_ACCOUNT:a.attributes.CLN_ACCOUNT}),h=f;return b.each(g,function(a){d[a[0].attributes.CLN_ACCOUNT]=b.reduce(a,function(a,b){return a+parseFloat(b.attributes.AMOUNT)},0),h[a[0].attributes.CLN_ACCOUNT]=parseFloat(f[a[0].attributes.CLN_ACCOUNT]-d[a[0].attributes.CLN_ACCOUNT]).toFixed(2)}),h};if(d)h.resolve(i(d));else{var j=m.clone();j.model=this.Model,j.fetch({document_type:"ua_payment",silent:!0,data:{exclude:"links"}}).done(function(){h.resolve(i(j))}.bind(this))}return h},updatePlannedRemainders:function(){var b=a.Deferred(),e=d.settings.server_addr+"/document/"+this.docType+";jsessionid="+d.getStoredItem("JSESSIONID");return a.ajax({url:e,type:"GET",data:{status:"0,1,2,3,4,6,21,22,3004",bdate:localStorage.getItem(this.docType+"_work_filter_bdate")||d.date2str(new Date),edate:localStorage.getItem(this.docType+"_work_filter_edate")||d.date2str(new Date),exclude:"links"}}).done(function(a){this.getPlannedRamainders(new c.Collection(a)).done(function(a){L=a,b.resolve(a)}.bind(this))}.bind(this)),b},showDocumentEdit:function(a,c){l.getThesaurus("account_alias",!1).fetch().done(function(d){this.aliases=d,!b.isEmpty(L)&&b.has(L,a.CLN_ACCOUNT)?q.prototype.showDocumentEdit.call(this,a,c):this.updatePlannedRemainders().done(function(){q.prototype.showDocumentEdit.call(this,a,c)}.bind(this))}.bind(this))},editDocumentOptions:function(){var a=q.prototype.editDocumentOptions.call(this);return g.removeDepositAccountsWithoutLinks(I()).then(function(b){return g.setAccountComments(b).then(function(b){return a.accounts=b,a.recipientList=J(),a.countryList=K(),a.getMfo=g.getMfo,a.getReference=g.getReference,a.getBankBranches=g.getBanks(),a.plannedRemainders=L,a.currentSubClientId=e.isMultiClient()?e.multiClient.currentSubClientId:null,a})})},prepareContent:function(c){var e=q.prototype.prepareContent.call(this,c);return e.then(function(c){var e=c.PAYMENT_DETAILS;e&&c.id&&(c.PAYMENT_DETAILS=this.getCorrectPaymentDetailsOld(e));var f=l.getThesaurus("clients").array[0];c.CLN_NAME=f.name_cln,c.CLN_OKPO=f.okpo,c.AMOUNT=c.AMOUNT?d.roundFloat(c.AMOUNT,2,2):"","0"===f.resident_flag&&(c.CLN_COUNTRY_CODE=f.country_code);var g=b.findWhere(l.getThesaurus("bank_branches").array,{bik:c.CLN_BANK_MFO});g&&(c.CLN_BANK_NAME=g.name);var h=c.RCPT_BANK_MFO,i="[0]=='"+h+"'",j=l.getThesaurus("ua_swift").fetch({data:{query:i,PAGE_NUMBER:0,PAGE_SIZE:1}});return a.when(j.then(function(a){return c.RCPT_BANK_NAME=a[0]?a[0].name:"",c}))}.bind(this))},prepareContent4Create:function(a){var c=q.prototype.prepareContent4Create.call(this,a);return c.then(function(a){return g.removeDepositAccountsWithoutLinks(I()).then(function(c){if(!a.CLN_ACCOUNT){var d=1===c.length?c[0]:b.findWhere(c,{account_id:this.getAccountIdFromLocalStorage()});d=d||(c.length>0?c[0]:{}),b.extend(a,H(d))}return a}.bind(this))}.bind(this))},getAccountIdFromLocalStorage:function(){return d.getStorageDocData("ua_payment_acc_id")},getContentFromForm:function(){var b=q.prototype.getContentFromForm.call(this);return b.EXPENSE_ITEM=a("#EXPENSE_ITEM").val(),b.AMOUNT=a("#AMOUNT").val(),b.RCPT_COUNTRY_CODE&&(b.RCPT_COUNTRY_CODE=b.RCPT_COUNTRY_CODE.split(" ")[0]),b.AMOUNT=d.removeThousandSeparator(b.AMOUNT),b},getWorkContent:function(a){var b=a.get("PAYMENT_DETAILS");return b&&(a.attributes.PAYMENT_DETAILS=this.getCorrectPaymentDetailsOld(b)),q.prototype.getWorkContent.call(this,a)},beforeSaveModel:function(b){if(b.attributes.planned_remainder=L[b.attributes.CLN_ACCOUNT],q.prototype.beforeSaveModel.call(this,b),a("input.add-rcpt").is(":checked")){var c=new p({refType:"ua_recipients"});c.set(this.getRecipientContent(b),{validate:!0}),n.getThesaurus("ua_recipients").create(c)}},getImportBankMap:function(){return{CLN_BANK_MFO:"CLN_BANK_NAME",RCPT_BANK_MFO:"RCPT_BANK_NAME"}},parseBankClientFile:function(c,g,h){var j=a.Deferred(),k=function(a){var k=new FileReader;k.onload=function(c){for(var k=[],l=f.cp866,m=new Uint8Array(c.target.result),n="",o=0;o<m.length;o++){var p=m[o];n+=String.fromCharCode(l[p])}var q=n.split("\r").join("").split("\n");q=b.compact(q);for(var r=function(a){return a.replace(/[\u0009]/g," ").trim()},s=0;s<q.length;s++){var t=q[s].split("·");if(t=b.map(t,r),t[1]!==("ua_payment"===h?"1":"11"))return void j.reject([g]);var u={NUM_DOC:t[2],CLN_BANK_MFO:t[4],CLN_ACCOUNT:t[6],AMOUNT:(parseFloat(+t[8])/100).toFixed(2),PAYMENT_DETAILS:t[11]},v="ua_payment"===h?"RCPT_":"PAYER_";u[v+"BANK_MFO"]=t[5],u[v+"ACCOUNT"]=t[7],u[v+"NAME"]=t[10],u[v+"OKPO"]=t[16];var w=t[3];w&&(u.DATE_DOC=w.substr(6,2)+"."+w.substr(4,2)+"."+w.substr(0,4));var x=t[12];x&&(u.VALUE_DATE=x.substr(6,2)+"."+x.substr(4,2)+"."+x.substr(0,4)),k.push(u)}if(e.isMultiClient()&&!i.isActionPermittedForClient("IMPORT",h,a)){this.importListView=this.showGroupList(F.group_view_import_h1,{actions:[i.DocumentAction.SAVE_IMPORT_RESULT]});var y=i.getDescriptionForPermittedActions(h,a),z=new this.Model(k,{silent:!0});this.addModelToGroup(z);var A=y?d.sprintf(G.only_rights,y):d.sprintf(G.no_rights,this.nls[this.docType]);return z.trigger("model:completeSync",z,E.error,A),this.importListView.addSummaryImportInfo(F),void this.toggleAllButtons(!1)}j.resolve(k)}.bind(this),k.readAsArrayBuffer(c)}.bind(this);return e.isMultiClient()?this.showSubClientsList.call(this,k,this.showListView):k(),j},identifyClientByContent:function(c,d){var e=a.Deferred(),f={data:{query:"[6]=='UAH'"}};return l.getThesaurus("maccs_info").fetch(f).done(function(a){var f={};return b.each(c,function(b){b.CLN_OKPO||b.CLN_NAME?this.identifyClientByOkpoOrName(b,d):this.identifyClientByAccount(f,b,a)}.bind(this)),e.resolve(c)}.bind(this)),e},identifyClientByAccount:function(a,c,d){var e=a[c.CLN_ACCOUNT+"-"+c.CLN_BANK_MFO]||b.findWhere(d,{account:c.CLN_ACCOUNT,mfo:c.CLN_BANK_MFO});c.owner_id=e?e.client_id:"",a[c.CLN_ACCOUNT+"-"+c.CLN_BANK_MFO]=c.owner_id,c.owner_id||(c.owner_error=F.client_not_found)},parseFile4Import:function(c){var d=a.Deferred(),f=N(c.name),g=f?this.parseBankClientFile(c,this.prepareIncorrectImportMessage(),this.docType):q.prototype.parseFile4Import.call(this,c);return g.done(function(c){var g=function(){m.options.document_type!==this.docType&&(e.navigate("document/list/ua_payment_request/work",{}),localStorage.setItem("request_selectedTab","work"));var g=[],h=b.keys(this.getImportBankMap()),j=function(a,b){g.push(a[b])};b.each(c,function(a){b.each(h,j.bind(null,a))});var k=b.unique(g),n="[0] IN ('"+k.join("', '")+"')",o=l.getThesaurus("ua_swift").fetch({data:{query:n,PAGE_NUMBER:0,PAGE_SIZE:k.length}}),p=l.getThesaurus("country").fetch();a.when(o.promise(),p.promise()).then(function(a){var e={};b.each(a,function(a){e[a.code]=a.name}),b.each(c,function(a){b.each(this.getImportBankMap(),function(b,c){a[b]=e[a[c]]||""})}.bind(this)),f&&i(),d.resolve(c)}.bind(this)).fail(d.reject)}.bind(this),h=0,i=function(){h<c.length&&this.prepareContent(c[h++]).done(function(){g()})}.bind(this);f?i():g()}.bind(this)).fail(d.reject),d},getImportFormats:function(){return[D.bank_client,"iBank2"]},getRecipientContent:function(a){return{name:a.get("RCPT_NAME"),inn:a.get("RCPT_OKPO"),requisites:[{id:"",bic:a.get("RCPT_BANK_MFO"),bill:a.get("RCPT_ACCOUNT"),comment:a.get("PAYMENT_DETAILS"),note:"",rcpt_bnk_name:a.get("RCPT_BANK_NAME")}]}},CONFIRM:function(){if(this.itemViewInstance){var a=this.actionBarInstance.$("button[data-action='CONFIRM']").parent(),b=new s({model:this.selectedModel});this.itemViewInstance.$el.prepend(b.render().$el),a.hide(),b.afterRender(),b.on("dispose",function(c){b.off("dispose"),b.dispose(),c?a.show():this.showItemView(this.selectedModel)}.bind(this))}},PRINT:function(){this.printDocs([this.selectedModel])},PRINT_GROUP:function(a){d.showSubMenu(a)},PRINT_REGISTRY:function(){var a=l.getThesaurus("bank_branches").array[0];B(this.collection,a,this.getClient())},PRINT_LIST_DOC:function(){this.printDocs(b.values(this.collection.selected))},printDocs:function(a){x(a,y,z)},getPrintSubMenu:function(){return b.template(A,b.extend(D,{isSelected:this.collection.selectedLength>0}))},getClient:function(){return l.getThesaurus("clients").array[0]},CONFIRM_GROUP:function(){var a=b.values(this.collection.selected),c=function(a,b){var c=F.group_view_confirm,e=a.get("NUM_DOC");b.add(a,d.sprintf(c,e,a.getFAmount()))},e=this.group(c,F.group_view_confirm_h1,a),f=new s({collection:a,silent_error:!0});e.$el.prepend(f.render().$el),f.afterRender(),f.on("dispose",function(a){f.off("dispose"),f.dispose(),a&&this.showListView()}.bind(this))},SIGN:function(a){q.prototype.SIGN.call(this,a),this.listenTo(this.selectedModel,"change:status",function(){var a=parseInt(this.selectedModel.attributes.status);a>1&&!b.contains([3004,21],a)&&this.isNotFiltered(this.selectedModel,M)&&(this.itemViewInstance.updatePlannedRemainders(this.selectedModel.attributes.AMOUNT),L[this.selectedModel.attributes.CLN_ACCOUNT]-=parseFloat(this.selectedModel.attributes.AMOUNT).toFixed(2))})},EDIT:function(a){this.toggleAllButtons(!0),this.selectedModel.fetch().done(function(){q.prototype.EDIT.call(this,a)}.bind(this))},isNotFiltered:function(a,c){var e=d.str2date(localStorage.getItem("ua_payment_work_filter_bdate")||d.date2str(new Date)).getTime(),f=d.str2date(localStorage.getItem("ua_payment_work_filter_edate")||d.date2str(new Date)).getTime(),g=d.str2date(a.attributes.DATE_DOC).getTime(),h=g>=e&&f>=g;if(!h)return!1;if(!c)return!0;var i={};b.each(c.models,function(a){i[a.attributes.id]=a.attributes.value||"","status"===a.attributes.id&&(i[a.attributes.id]=Object.keys(a.attributes.selection))});var j=a.attributes;if(i.AMOUNT_MIN&&parseFloat(j.AMOUNT)<parseFloat(i.AMOUNT_MIN))return!1;if(i.AMOUNT_MAX&&parseFloat(j.AMOUNT)>parseFloat(i.AMOUNT_MAX))return!1;if(i.CLN_ACCOUNT&&i.CLN_ACCOUNT!==j.CLN_ACCOUNT)return!1;if(i.RCPT_NAME&&i.RCPT_NAME!==d.escapeSpecialChars(j.RCPT_NAME))return!1;if(i.RCPT_ACCOUNT&&i.RCPT_ACCOUNT!==j.RCPT_ACCOUNT)return!1;if(i.RCPT_OKPO&&i.RCPT_OKPO!==j.RCPT_OKPO)return!1;if(i.PAYMENT_DETAILS&&i.PAYMENT_DETAILS!==j.PAYMENT_DETAILS)return!1;if(i.status&&!b.contains(i.status,j.status))return!1;if(i.LINK_TYPE){if("any"===i.LINK_TYPE&&b.isEmpty(j.links))return!1;if("no_links"===i.LINK_TYPE&&!b.isEmpty(j.links))return!1;if("doc/pay_sheet"===i.LINK_TYPE&&b.isEmpty(j.links)||"pay_sheet"!==j.links[0].type)return!1}return!0},getCorrectPaymentDetailsOld:function(a){return a.length>h.PAYMENT_DETAILS_LENGTH?a.slice(0,h.PAYMENT_DETAILS_LENGTH):a},CFC_REJECT:function(a){this.changeStatus("15",a)},CFC_CONFIRM:function(a){this.changeStatus("14",a)},CFC_REJECT_GROUP:function(){this.changeStatusGroup("15")},CFC_CONFIRM_GROUP:function(){this.changeStatusGroup("14")},changeStatus:function(a,b){var c=getTimeStamp(),d=this.signData(this.selectedModel),f=e.multiClient.defaultClientKeysByCID[this.selectedModel.get("owner_id")].ID,g={content:this.prepare4Sign(d,c),id:this.selectedModel.get("id"),timestamp:c,status:a};o.useKey(f).then(function(){SignPluginServices.signData(g.content).then(function(a){a.sign&&g.timestamp?(g.sign=a.sign,o.ajax({type:"POST",dataType:"json",url:this.collection.urlRoot+this.docType+"/"+g.id+"/change_status",data:JSON.stringify(g),currentSubClientKeyId:f,success:function(a){this.selectedModel.set(a),this.showItemView(this.selectedModel)}.bind(this),error:function(a){400!==a.status&&500!==a.status||j.alert(a.responseText),this.toggleEventButton(b.target,!1)}.bind(this)})):this.toggleEventButton(b.target,!1)}.bind(this))}.bind(this))},changeStatusGroup:function(a){var c=0,f=b.values(this.collection.selected),g=function(){if(c<f.length){var b=f[c++],d=this.signData(b),h=getTimeStamp(),i={content:this.prepare4Sign(d,h),id:b.get("id"),timestamp:h,status:a},j=e.multiClient.defaultClientKeysByCID[b.get("owner_id")].ID;o.useKey(j).then(function(){SignPluginServices.signData(i.content).then(function(a){a.sign&&i.timestamp?(i.sign=a.sign,o.ajax({type:"POST",dataType:"json",url:this.collection.urlRoot+this.docType+"/"+i.id+"/change_status",data:JSON.stringify(i),currentSubClientKeyId:j,success:function(a){b.set(a,{silent:!0}),b.trigger("model:completeSync",b,"Ok","",200),g()}.bind(this),error:function(a){b.trigger("model:completeSync",b,F.error,a.responseText,a.status),g()}.bind(this)})):this.toggleEventButton(event.target,!1)}.bind(this))}.bind(this))}}.bind(this);this.group(function(b,c){c.add(b,d.sprintf(F["14"===a?"group_view_confirm":"group_view_reject"],b.get("NUM_DOC"),b.get("AMOUNT"))),f.length===c.children.length&&g()},F["14"===a?"group_view_confirm_h1":"group_view_reject_h1"],f)},isAccountsForCreateAction:function(){return I().length>0},getNoAccErrorText:function(){return D.no_uah_accs}});return O.getAccounts=I,O}),define("apps/ua_payment/ua_payment_controller",["apps/ua_payment/base_ua_payment_controller","i18n!apps/ua_payment/nls/ua_payment"],function(a,b){"use strict";return a.extend({getImportFormats:function(){return[b.bank_client,"BM-RS","iBank2"]}})}),define("apps/statement/statement_service",["jquery","underscore","apps/statement/statement_collection"],function(a,b,c){"use strict";function d(a,c,d){return b.map(a,function(a){
return d?b.filter(a.get(c),d):a.get(c)})}return{sortViaStatementsCollection:function(a,d){d=d||this;var e=new c(a,{sort:!0,sortedInfo:d.sortedInfo,isGroupByAccount:d.isGroupByAccount});return b.map(e.models,function(a){return a.attributes})},sortUnGroupedOperations:function(a,c,e,f){var g=d(c,e,f);return this.sortViaStatementsCollection(b.flatten(g),a)},sortGroupedOperations:function(a,c,e,f){var g=d(c,e,f);return b.flatten(b.map(g,function(b){return this.sortViaStatementsCollection(b,a)}.bind(this)))}}}),define("text!apps/statement/templates/statement_print_registry.tmpl",[],function(){return'<table id="page-number">\n    <tr><td style="text-align: right;">Сторінка <%- page_number %></td></tr>\n</table>\n<div id="content"></div>\n<div id="current-time">Виписка сформована <%- current_time %></div>'}),define("text!apps/statement/templates/statement_print_registry_header.tmpl",[],function(){return'<style type="text/css">\n    .statement-registry {\n        position: relative;\n    }\n    .header {\n        padding: 20px 0 0 0;\n    }\n    .header p {\n        font-size: 12pt;\n    }\n    #content {\n        padding-bottom: 30px;\n    }\n    .registry-item {\n        padding: 10px 5px 10px 25px;\n    }\n    .registry-item-row {\n        table-layout: fixed;\n        border-spacing: 1px;\n    }\n    .registry-item-row__block {\n        font-family: "Times_New_Roman", serif;\n        font-size: 13px;\n        line-height: 1.1;\n        padding: 0 !important;\n        word-wrap: break-word;\n        -ms-word-wrap: break-word;\n    }\n    .registry-item-row__indent {\n        width: 10px;\n    }\n    .registry-item-row__num-doc {\n        width: 333px;\n    }\n    .registry-item-row__date {\n        width: 215px;\n    }\n    .registry-item-row__payer {\n        width: 80px;\n    }\n    .registry-item-row__mfo {\n        width: 45px;\n    }\n    .registry-item-row__edrpou {\n        width: 75px;\n    }\n    .registry-item-row__acc {\n        width: 100px;\n    }\n    .registry-item-row__acc.iban {\n        width: 240px;\n    }\n    .registry-item-row__cur {\n        width: 35px;\n    }\n    .registry-item-row__cln-name {\n        width: 310px;\n    }\n    .registry-item-row__cln-name.iban {\n        width: 170px;\n    }\n    .registry-item-row__nomination {\n        width: 140px;\n    }\n    .registry-item-row__desc {\n        width: 550px;\n    }\n    #current-time {\n        position: absolute;\n        bottom: 25px;\n        right: 30px;\n        font-size: 8pt;\n    }\n    #registry-footer .left1 {\n        padding-left: 460px;\n        padding-top: 10px;\n    }\n    #registry-footer .left2 {\n        padding-left: 80px;\n        padding-top: 20px;\n    }\n    .statements-normal-text {\n        font-size: 100%;\n        font-weight: normal;\n    }\n</style>\n<div id="header" class="centered bold-text header" align="center">\n    <p><%- BNK_NAME %> <%- CITY %>, код банку <%- MFO %> </p>\n    <p><%- CLN_NAME %>, ЄДРПОУ <%- CLN_OKPO %></p>\n    <p>РЕЄСТР ДОКУМЕНТІВ (<% if (OT === \'D\') {%>ДЕБЕТ<%} else { %>КРЕДИТ<% } %>) </p>\n    <p><% if (!isMultiReport) { %>По рахунку <% } %><span class="statements-normal-text"><%- ACCOUNT_INFO %></span> з\n        <span class="statements-normal-text"><%- BD %></span> по <span class="statements-normal-text"><%- ED %></span>\n        <% if(withExtendFilter) {%> <span class="statements-normal-text">(вик. фільтр)</span><% } %><br/></p>\n</div>\n'}),define("text!apps/statement/templates/statement_print_registry_item.tmpl",[],function(){return'<div class="registry-item">\n    <table class="registry-item-row">\n        <tr>\n            <td class="registry-item-row__block registry-item-row__num-doc" valign="top">Документ N <%- ND %></td>\n            <td class="registry-item-row__block registry-item-row__indent" valign="top"></td>\n            <td class="registry-item-row__block registry-item-row__date" valign="top">Проведено банком: <%- OD %></td>\n            <td class="registry-item-row__block" valign="top">Сума: <%- amount %></td>\n        </tr>\n    </table>\n\n    <table class="registry-item-row">\n        <tr>\n            <td class="registry-item-row__block registry-item-row__payer" valign="top">\n                <% if (OT === \'-1\') { %>Платник:<% } else { %>Отримувач:<% }%>\n            </td>\n            <td class="registry-item-row__block registry-item-row__indent" valign="top"></td>\n            <td class="registry-item-row__block registry-item-row__mfo" valign="top"><%- MFO %></td>\n            <td class="registry-item-row__block registry-item-row__indent" valign="top"></td>\n            <td class="registry-item-row__block registry-item-row__edrpou" valign="top"><%- CLN_OKPO %></td>\n            <td class="registry-item-row__block registry-item-row__indent" valign="top"></td>\n            <td class="registry-item-row__block registry-item-row__acc <%- ibanClass %>" valign="top"><%- AC %></td>\n            <td class="registry-item-row__block registry-item-row__indent" valign="top"></td>\n            <td class="registry-item-row__block registry-item-row__cur" valign="top"><%- CUR %></td>\n            <td class="registry-item-row__block registry-item-row__indent" valign="top"></td>\n            <td class="registry-item-row__block registry-item-row__cln-name <%- ibanClass %>" valign="top">\n                <%- CLN_NAME %>\n            </td>\n        </tr>\n    </table>\n\n    <table class="registry-item-row">\n        <tr>\n            <td class="registry-item-row__block registry-item-row__payer" valign="top">\n                <% if (OT === \'-1\') { %>Отримувач:<% } else { %>Платник:<% }%>\n            </td>\n            <td class="registry-item-row__block registry-item-row__indent" valign="top"></td>\n            <td class="registry-item-row__block registry-item-row__mfo" valign="top"><%- CBB %></td>\n            <td class="registry-item-row__block registry-item-row__indent" valign="top"></td>\n            <td class="registry-item-row__block registry-item-row__edrpou" valign="top"><%- CI %></td>\n            <td class="registry-item-row__block registry-item-row__indent" valign="top"></td>\n            <td class="registry-item-row__block registry-item-row__acc <%- ibanClass %>" valign="top"><%- CA %></td>\n            <td class="registry-item-row__block registry-item-row__indent" valign="top"></td>\n            <td class="registry-item-row__block registry-item-row__cur" valign="top"><%- CUR %></td>\n            <td class="registry-item-row__block registry-item-row__indent" valign="top"></td>\n            <td class="registry-item-row__block registry-item-row__cln-name <%- ibanClass %>" valign="top"><%- CN %></td>\n        </tr>\n    </table>\n\n    <table class="registry-item-row">\n        <tr>\n            <td class="registry-item-row__block registry-item-row__nomination" valign="top">Призначення платежу:</td>\n            <td class="registry-item-row__block registry-item-row__desc" valign="top"><%- NP %></td>\n        </tr>\n    </table>\n    \n    <% if (ISB) { %>\n    <table class="registry-item-row">\n        <tr>\n            <td class="registry-item-row__block registry-item-row__nomination" valign="top">Стаття витрат:</td>\n            <td class="registry-item-row__block registry-item-row__desc" valign="top"><%- BC + \' \' + BDESC %></td>\n        </tr>\n    </table>\n    <% } %>\n</div>'}),define("text!apps/statement/templates/statement_print_registry_footer.tmpl",[],function(){return'<div id="registry-footer">\n    <div class="left1">Усього документів: <%- docsCount %></div>\n    <% if (!isMultiReport) { %><div class="left1">На загальну суму: <%- totalAmount %></div><% } %>\n    <div class="left2">Бухгалтер &nbsp;________________________</div>\n    <div class="left2">Директор &nbsp;&nbsp;________________________</div>\n</div>\n'}),define("text!apps/statement/templates/statement_print_registry_pdf.tmpl",[],function(){return'<html>\n    <head>\n        <style type="text/css">\n            body {\n                font-size: 10pt;\n                font-family: "Times_New_Roman", serif;\n            }\n            table {\n                border-spacing: 1px\n            }\n            td {\n                font-family: "Times_New_Roman", serif;\n                font-size: 13px;\n                line-height: 0.9;\n                padding: 0 !important;\n            }\n            #content {\n                padding-bottom: 30px;\n            }\n            #page-number {\n                width: 100%;\n            }\n            .registry-item {\n                padding: 10px 0 18px 25px;\n            }\n            .header {\n                font-size: 12pt;\n                text-align: center;\n                font-weight: bold;\n                padding: 20px 0 0 0;\n            }\n            p {\n                margin: 0;\n                line-height: 1.5;\n            }\n            .left1 {\n                padding-left: 460px;\n                padding-top: 7px;\n            }\n            .left2 {\n                padding-left: 80px;\n                padding-top: 12px;\n            }\n        </style>\n    </head>\n    <body>\n        <%= content_for_pdf %>\n    </body>\n</html>\n\n'}),define("apps/statement/statement_print_registry",["jquery","underscore","backbone","app","bifit","printUtils","apps/statement/statement_service","text!apps/statement/templates/statement_print_registry.tmpl","text!apps/statement/templates/statement_print_registry_header.tmpl","text!apps/statement/templates/statement_print_registry_item.tmpl","text!apps/statement/templates/statement_print_registry_footer.tmpl","text!apps/statement/templates/statement_print_registry_pdf.tmpl","i18n!apps/statement/nls/statement"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){"use strict";return function(c){var n={docHeader:"D"===c.operationType?m.print_debit_registry_title:m.print_credit_registry_title};f.createPrintFormForPdf(n).then(function(m){var n=m.find(".print.to-printer"),o=m.find(".print.to-pdf");f.spinBtn(n),f.spinBtn(o);var p=1,q="",r="",s=b.template(h),t=e.dateTime2str(new Date,!1),u=m.find("#doc-div").addClass("statement-registry"),v=u.height();m.find("body").addClass(localStorage.getItem("locale")),o.parent().show(),o.bind("click",function(){var c="statement_registry.pdf";a.ajax({url:localStorage.getItem("addr")+"/print_to_pdf;jsessionid="+e.getStoredItem("JSESSIONID"),type:"POST",contentType:"application/x-www-form-urlencoded; charset=UTF-8",data:{html:b.template(l,{content_for_pdf:q}).split('"').join('"'),footerText:m.find("#current-time")[0].innerHTML,fileName:c},mimeType:"text/plain; charset=x-user-defined",success:function(a){f.createPdfFile(a,c,m[0])}})});var w=function(){p++,q+='<div style="page-break-after: always"></div>',u.parent().append('<div id="doc-div" class="statement-registry">'+s({page_number:p,current_time:t})+"</div>"),u=m.find("div#doc-div.statement-registry").last(),z=u.find("#content")},x=function(a,b){z.append(a),u.height()>v&&(u.find(b).last().remove(),q+=z[0].outerHTML,w(),z.append(a),q+=u.find("#page-number")[0].outerHTML)},y=function(a){return""!==a[c.operationType]&&"I"!==a.OC};u.html(s({page_number:p,current_time:t}));var z=u.find("#content");a.when(c.accountsInfo,c.budgetCodes).done(function(a,h){var l=c.reportCollection.models,m={};m.sortedInfo=c.sortedInfo,m.isGroupByAccount=c.isGroupByAccount;var p=c.isGroupByAccount?g.sortGroupedOperations(m,l,"operations",y):g.sortUnGroupedOperations(m,l,"operations",y),s=!0,t=function(d,f){var g={docsCount:0,totalAmount:0,isMultiReport:c.isMultiReport,withExtendFilter:c.withExtendFilter};s?s=!1:w();var l=b.template(i,d),m=u.find("#page-number");q+=m[0].outerHTML+l,m.append(l),b.each(p,function(e){var i=b.findWhere(f,{account_id:e.ACID});if(i){var k="1"===b.findWhere(a,{id:i.account_id}).comments,l={},m="";(e.AC.length>14||e.CA.length>14)&&(m+="iban"),b.extend(l,d,e,{BDESC:(b.findWhere(h,{code:e.BC})||{}).description||"",ISB:k,ibanClass:m}),x(b.template(j,l),".registry-item"),c.isMultiReport||(g.totalAmount+=parseFloat(e.amount.split(" ").join(""))),g.docsCount++}}),g.totalAmount=e.formatAmount(g.totalAmount)||"0.00",x(b.template(k,g),"#registry-footer"),q+=z[0].outerHTML};setTimeout(function(){var a,e,g;if(c.isMultiReport)a=localStorage.getItem("statement_undefined_filter_bdate"),e=localStorage.getItem("statement_undefined_filter_edate"),g=c.isAllAccountReport?"По всіх рахунках":"По декількох рахунках";else{var h=b.first(l),i=b.findWhere(c.accounts,{account_id:h.get("ACID")});a=h.get("BD"),e=h.get("ED"),g=i.account+" "+i.currency}r={ACCOUNT_INFO:g,BD:a,ED:e,OT:c.operationType,isMultiReport:c.isMultiReport,withExtendFilter:c.withExtendFilter},d.isMultiClient()&&c.isMultiReport||(b.extend(r,{CLN_NAME:c.client.name_cln,CLN_OKPO:c.client.okpo,BNK_NAME:c.bank.name,CITY:c.bank.city||"",MFO:c.bank.bik}),t(r,c.accounts)),b.each(c.accountsByClientsAndMfos,function(a,d){var e=b.findWhere(c.clients,{client_id:d});b.extend(r,{CLN_NAME:e.name_cln,CLN_OKPO:e.okpo}),b.each(a,function(a,d){var e=b.findWhere(c.banks,{bik:d});b.extend(r,{BNK_NAME:e.name,CITY:e.city,MFO:d}),t(r,a)})}),f.stopBtn(n),f.stopBtn(o)},300)})})}}),define("apps/overturns/overturns_report_model",["jquery","underscore","models/base_model","bifit","collections/thesaurus"],function(a,b,c,d,e){return c.extend({idAttribute:"ACID",parse:function(a){var c=["CV","DV","IR"],f=["CVN","DVN","IRN","ORN"],g=a.CUR,h=(b.findWhere(e.getThesaurus("currency").array,{currency:g})||{}).decimals||2;return b.each(c,function(b){a[b]=d.formatAmount(a[b],{decimallength:h})}),b.each(f,function(b){a[b]=d.formatAmount(a[b])}),b.each(a.balance,function(b){b.ACID=a.ACID,b.C=d.formatAmount(b.C,{decimallength:h}),b.D=d.formatAmount(b.D,{decimallength:h}),b.IR=d.formatAmount(b.IR,{decimallength:h}),b.OR=d.formatAmount(b.OR,{decimallength:h}),b.CN=d.formatAmount(b.CN),b.DN=d.formatAmount(b.DN),b.IRN=d.formatAmount(b.IRN),b.ORN=d.formatAmount(b.ORN)}),a}})}),define("text!apps/statement/templates/statement_print_sub_menu.tmpl",[],function(){return'<div class="popup-wrapper bottom sub-menu">\n    <span class="popup-arrow"></span>\n    <span class="popup-arrow-border"></span>\n    <ul class="popup" style="white-space: nowrap">\n        <li class="popup-li"><a href="#" data-action="PRINT_STATEMENT_STANDART"><%- print_statement_standart %></a></li>\n        <li class="popup-li"><a href="#" data-action="PRINT_STATEMENT_BRIEF"><%- print_statement_brief %></a></li>\n        <li class="popup-li"><a href="#" data-action="PRINT_STATEMENT_EXTENDED"><%- print_statement_extended %></a></li>\n        <li class="popup-li"><a href="#" data-action="PRINT_STATEMENT_EXTENDED_ALBUM"><%- print_statement_extended_album %></a></li>\n        <li class="popup-li"><a href="#" data-action="PRINT_DEBIT_REGISTRY"><%- print_debit_registry %></a></li>\n        <li class="popup-li"><a href="#" data-action="PRINT_CREDIT_REGISTRY"><%- print_credit_registry %></a></li>\n    </ul>\n</div>'}),define("text!apps/statement/templates/statement_export_sub_menu.tmpl",[],function(){return'<div class="popup-wrapper bottom sub-menu">\n    <span class="popup-arrow"></span>\n    <span class="popup-arrow-border"></span>\n    <ul class="popup" style="white-space: nowrap">\n        <li class="popup-li"><a href="#" data-action="EXPORT_CSV"><%- export_csv %></a></li>\n        <li class="popup-li"><a href="#" data-action="EXPORT_BMRS"><%- export_bmrs %></a></li>\n        <li class="popup-li"><a href="#" data-action="EXPORT_IBIS"><%- export_client_bank %></a></li>\n        <li class="popup-li"><a href="#" data-action="EXPORT_PROFIX">Profix</a></li>\n    </ul>\n</div>'}),define("dbfHelper",["charsets"],function(a){"use strict";function b(a,b,c){for(;a.length<b;)a=c+a;return a}function c(a,b,c){for(;a.length<b;)a+=c;return a}function d(a,b,c,d){for(var e=0;b>e;e++)a.setUint8(d,c.charCodeAt(e)),d++;return d}function e(a){function b(a){f(c,a)}var c={};return a.forEach(b),g(c)}function f(a,b){for(var c in b)a[c]=b[c];return a}function g(a){var b={string:"C",number:"N","boolean":"L"},c={C:254,L:1,D:8,N:18,M:18,F:18,B:8},d={},e=[];for(var f in a)d[f]=typeof a[f];for(var g in d){var h=b[d[g]];h&&e.push({name:g,type:h,size:c[h]})}return e}function h(a){return a.reduce(function(a,b){return a+b.size},1)}var i=a.cp1251,j=function(){};return j.prototype.parse=function(a){var b,c={},d=new DataView(a),e=0;for(c.version=d.getInt8(e,!1),e+=1,c.year=d.getUint8(e)+1900,e+=1,c.month=d.getUint8(e),e+=1,c.day=d.getUint8(e),e+=1,c.numberOfRecords=d.getInt32(e,!0),e+=4,c.bytesInHeader=d.getInt16(e,!0),e+=2,c.bytesInRecord=d.getInt16(e,!0),e+=2,e+=2,c.incompleteTransation=d.getUint8(e),e+=1,c.encryptionFlag=d.getUint8(e),e+=1,e+=4,e+=8,c.mdxFlag=d.getUint8(e),e+=1,c.languageDriverId=d.getUint8(e),e+=1,e+=2,c.fields=[];;){var f={},g=[];for(b=0;10>b;b++){var h=d.getUint8(e);0!==h&&g.push(String.fromCharCode(h)),e+=1}if(f.name=g.join("").toUpperCase(),e+=1,f.type=String.fromCharCode(d.getUint8(e)),e+=1,e+=4,f.fieldLength=d.getUint8(e),e+=1,e+=1,e+=2,f.workAreaId=d.getUint8(e),e+=1,e+=2,f.setFieldFlag=d.getUint8(e),e+=1,e+=7,f.indexFieldFlag=d.getUint8(e),e+=1,c.fields.push(f),13===d.getUint8(e))break}e+=1,c.records=[];var j;for(b=0;b<c.numberOfRecords;b++){var k={};e+=1;for(var l=0;l<c.fields.length;l++){for(var m=[],n=0;n<c.fields[l].fieldLength;n++)j=d.getUint8(e),m.push(String.fromCharCode(i[j]||j)),e+=1;k[c.fields[l].name.toUpperCase()]=m.join("").trim()}c.records.push(k)}return c},j.prototype.create=function(a,f){var g=f||e(a),i=32*g.length+1,j=h(g),k=new ArrayBuffer(i+32+j*a.length+1),l=new Date,m=new DataView(k);m.setUint8(0,3),m.setUint8(1,(l.getFullYear()-1900)%100),m.setUint8(2,l.getMonth()+1),m.setUint8(3,l.getDate()),m.setUint32(4,a.length,!0);var n=i+32;m.setUint16(8,n,!0),m.setUint16(10,j,!0),m.setInt8(32+i-1,13),g.forEach(function(a,b){a.name.split("").slice(0,9).forEach(function(a,c){m.setInt8(32+32*b+c,a.charCodeAt(0))}),m.setInt8(32+32*b+11,a.type.charCodeAt(0)),m.setInt8(32+32*b+16,a.size),"N"===a.type&&m.setInt8(32+32*b+17,a.decSize)});var o=i+32;return a.forEach(function(a,e){m.setUint8(o,32),o++,g.forEach(function(e){var f=a[e.name];switch(null!==f&&"undefined"!=typeof f||(f=""),e.type){case"L":m.setUint8(o,f?84:70),o++;break;case"D":o=d(m,8,b(f.toString(),8," "),o);break;case"N":o=d(m,e.size,b(f.toString(),e.size," "),o);break;case"C":o=d(m,e.size,c(f.toString(),e.size," "),o);break;default:throw new Error("Unknown field type")}})}),m.setUint8(o,26),m},j}),define("apps/statement/statement_exchange",["jquery","underscore","backbone","app","bifit","dbfHelper","appsPieces","dialogUtils","collections/documents","collections/thesaurus","i18n!nls/common","i18n!apps/statement/nls/statement","apps/statement/statement_service"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){"use strict";return{overturnsReportCollection:null,accounts:null,client:null,statementsReportCollection:null,isAllAccountReport:null,isMultiReport:null,showGroupList:null,doExport:function(d,f){return this.sortedInfo=f,this.exportFormat=d,"CSV"===d?void this.doExportCSV():"PROFIX"===d?void this.doExportProfix():!this.overturnsReportCollection||b.isEmpty(b.flatten(this.overturnsReportCollection.pluck("balance")))?void h.alert(l.no_overturns):void SignPluginServices.selectDir(l.export_title).then(function(d){var f=this.statementsReportCollection.reduce(function(a,b){return a[b.get("ACID")]=b.get("operations"),a},{}),h=this.overturnsReportCollection.reduce(function(a,c){return b.isEmpty(c.get("balance"))||(a[c.get("ACID")]=c.get("balance")),a},{}),k=d.answer.filePath,m={sort:!1,document_type:"bank_ua_payment_request",data:{fields:"0,1,2,3,4,5,7,8,9,10,11,12,13",status:"0,11,5",bdate:localStorage.getItem("statement_undefined_filter_bdate"),edate:localStorage.getItem("statement_undefined_filter_edate")}},n=i.clone(),o=!b.isEmpty(b.where(this.accounts,{currency:"UAH"})),p=!!b.findWhere(j.getThesaurus("perms_doc").array,{type:"doc/bank_ua_payment_request"});a.when(g.getCurrencies(),o&&p?n.fetch(m):a.when({})).done(function(a){var d={},g=!1,i=this.showGroupList(l.export_result_title,{stopOperation:function(){g=!0},entityType:"report",operationType:"export"});b.each(h,function(g,h){g=g.sort(function(a,b){return e.str2date(a.SD).getTime()<e.str2date(b.SD).getTime()?-1:1}),this.incRem=parseFloat(this.normalizeAmount(g[0].IR));var i=b.findWhere(this.accounts,{account_id:h}),j=this.statementsReportCollection.get(h),k=j?j.get("LOD"):null,l=b.filter(n.toJSON(),function(a){return a.PAYER_ACCOUNT===i.account}.bind(this));b.forEach(g,function(g){this.debetDocs=0,this.creditDocs=0,this.dOverturn=0,this.cOverturn=0;var j,m=i.currency,n=g.SD,o=this.getVip(n,f[h]||[],i),p=this.getVpt(n,l),q=b.findWhere(a,{currency:m}).code_currency;j="UAH"!==m||"BMRS"===this.exportFormat?this.overturnsCurLine(g,n,k,String("0000"+q).slice(-4),this.addLeftWS(m,3),i):this.overturnsLine(n,k,i),k=n;var r=this.getFileName(n,i);d[r]||(d[r]=new c.Model);var s=d[r].get("dataForSave")||"",t=e.utf8_decode_cp1125(j+o+p).split("\n").join("\r\n");d[r].set({dataForSave:s+t,date:n})}.bind(this))}.bind(this)),b.each(d,function(a,b){i.add(a,e.sprintf(l.export_element_title_brms,a.get("date"),b))});var j=b.keys(d),m=function(a){if(!g){var b=j[a],c=d[b],e=window.btoa(c.get("dataForSave"));SignPluginServices.silentSaveFile(k+"/"+b,e,"a").then(function(){c.trigger("model:completeSync",c,"ok"),a<j.length-1&&m(a+1)})}}.bind(this);m(0)}.bind(this))}.bind(this))},overturnsLine:function(a,b,c){a=this.getDate(a),b=b?this.getDate(b):b;var d="0"+this.addWS(c.account,14)+(a||"00000000")+(b||"00000000");return d+=this.addLeftWS(this.removePoints(Math.abs(this.incRem).toFixed(2)),19)+(this.incRem<0?"-":"+")+this.addLeftWS(this.debetDocs,6)+this.addLeftWS(this.removePoints(parseFloat(Math.abs(this.dOverturn)).toFixed(2)),19)+this.addLeftWS(this.creditDocs,6)+this.addLeftWS(this.removePoints(Math.abs(this.cOverturn).toFixed(2)),19),this.incRem+=this.cOverturn-this.dOverturn,d+=this.addLeftWS(this.removePoints(Math.abs(this.incRem).toFixed(2)),19)+(this.incRem<0?"-":"+")+"\n"},overturnsCurLine:function(a,b,c,d,f,g){!c||e.str2date(c).getTime()<e.str2date(a.SD).getTime()||h.alert(l.no_overturns);var i=this.normalizeAmount(a.IR),j=this.normalizeAmount(a.IRN),k=this.normalizeAmount(a.D),m=this.normalizeAmount(a.DN),n=this.normalizeAmount(a.C),o=this.normalizeAmount(a.CN),p=this.normalizeAmount(a.OR),q=this.normalizeAmount(a.ORN);b=this.getDate(b),c=c?this.getDate(c):c;var r="0";if("BMRS"===this.exportFormat&&(r+=this.addLeftWS(g.mfo,9)),r+=this.addWS(g.account,14),r+="BMRS"===this.exportFormat?f:d,r+=(b||"00000000")+(c||"00000000")+this.addLeftWS(this.removePoints(j||i),19)+this.addLeftWS(this.removePoints(i),19)+(this.incRem<0?"-":"+")+this.addLeftWS(this.debetDocs,6)+this.addLeftWS(this.removePoints(m||k),19)+this.addLeftWS(this.removePoints(k),19)+this.addLeftWS(this.creditDocs,6)+this.addLeftWS(this.removePoints(o||n),19)+this.addLeftWS(this.removePoints(n),19)+this.addLeftWS(this.removePoints(q||p),19)+this.addLeftWS(this.removePoints(p),19)+(parseFloat(p)<0?"-":"+"),"BMRS"===this.exportFormat){var s=this.getClient(g.client_id);r+=this.addLeftWS(s.okpo,14)+this.addLeftWS(s.name_cln,38)+this.addLeftWS("",60)}return r+"\n"},getVpt:function(a,c){var d="";return b.each(c,function(b){b.DATE_DOC===a&&(d+="2+"+this.addLeftWS(b.CLN_BANK_MFO,9)+this.addWS(b.CLN_ACCOUNT,14)+this.addLeftWS(b.CLN_OKPO,14)+this.addWS(b.CLN_NAME,40)+this.addLeftWS(b.PAYER_BANK_MFO,9)+this.addWS(b.PAYER_ACCOUNT,14)+this.addLeftWS(b.PAYER_OKPO,14)+this.addWS(b.PAYER_NAME,40)+"01"+this.addLeftWS(b.NUM_DOC,10)+this.addLeftWS(this.removePoints(b.AMOUNT),19)+this.getDate(b.DATE_DOC)+this.addWS("",16)+this.addWS(b.PAYMENT_DETAILS,"BMRS"===this.exportFormat?240:255)+"\n")}.bind(this)),d},getVip:function(a,c,d){var e="",f=m.sortViaStatementsCollection.call(this,c);return b.each(f,function(b){if(a.substring(0,10)===b.OD.substring(0,10)&&"I"!==b.OC){e+=""===b.C?this.debetLine(b,d):this.creditLine(b,d);var c=this.getDate(b.OD);e+=c+this.addWS("",4)+c+this.addWS("",4)+this.addWS(b.NP,"BMRS"===this.exportFormat?240:255)+"\n",this.dOverturn+=parseFloat(this.normalizeAmount(b.D))||0,this.cOverturn+=parseFloat(this.normalizeAmount(b.C))||0}}.bind(this)),e},creditLine:function(a,b){var c=this.getClient(b.client_id),d="1+"+this.addLeftWS(a.CBB,9)+this.addWS(a.CA,14)+this.addLeftWS(a.CI,14)+this.addWS(a.CN,40)+this.addLeftWS(b.mfo,9)+this.addWS(a.AC,14)+this.addLeftWS(c.okpo,14)+this.addWS(c.name_cln,40)+"01"+this.addLeftWS(a.ND,10);return"UAH"!==b.currency?d+=this.addLeftWS(this.removePoints(this.normalizeAmount(a.RP)),19):"BMRS"===this.exportFormat&&(d+=this.addLeftWS(this.removePoints(this.normalizeAmount(a.C)),19)),d+=this.addLeftWS(this.removePoints(this.normalizeAmount(a.C)),19),this.creditDocs++,d},debetLine:function(a,b){var c=this.getClient(b.client_id),d="1-"+this.addLeftWS(b.mfo,9)+this.addWS(a.AC,14)+this.addLeftWS(c.okpo,14)+this.addWS(c.name_cln,40)+this.addLeftWS(a.CBB,9)+this.addWS(a.CA,14)+this.addLeftWS(a.CI,14)+this.addWS(a.CN,40)+"01"+this.addLeftWS(a.ND,10);return"UAH"!==b.currency?d+=this.addLeftWS(this.removePoints(this.normalizeAmount(a.RP)),19):"BMRS"===this.exportFormat&&(d+=this.addLeftWS(this.removePoints(this.normalizeAmount(a.D)),19)),d+=this.addLeftWS(this.removePoints(this.normalizeAmount(a.D)),19),this.debetDocs++,d},addLeftWS:function(a,b){return String(new Array(b+1).join(" ")+a).slice(-b)},addWS:function(a,b){return String(a+new Array(b+1).join(" ")).slice(0,b)},getFileName:function(a,b){return("UAH"===b.currency||"BMRS"===this.exportFormat?"v":"w")+a.substring(8)+a.substring(3,5)+a.substring(0,2)+".zzz"},removePoints:function(a){return a&&"0.00"!==a?a.toString().replace(".","").replace(" ",""):"0"},getDate:function(a){return a.substring(6,10)+a.substring(3,5)+a.substring(0,2)},doExportCSV:function(){var a=[l.h_okpo,l.h_mfo,l.h_acc,l.h_cur,l.h_odate,l.h_code,l.h_bmfo,l.h_bname,l.h_kacc,l.h_kokpo,l.h_korr,l.h_dnum,l.h_ddate,l.h_debt,l.h_cred,l.h_detail,l.h_uah],d=a.join(";")+"\n",f="",g=[];g=this.isGroupByAccount?m.sortGroupedOperations(this,this.statementsReportCollection.models,"operations"):m.sortUnGroupedOperations(this,this.statementsReportCollection.models,"operations"),g.forEach(function(a){var c=b.findWhere(this.accounts,{account_id:a.ACID});f=[this.getClient(c.client_id).okpo,c.mfo,c.account,c.currency,a.OD,a.OC,a.CBB,this.escapeString(a.CBN),a.CA,a.CI,this.escapeString(a.CN),this.escapeString(a.ND),a.DD,this.normalizeAmount(a.D),this.normalizeAmount(a.C),this.escapeString(a.NP),this.normalizeAmount(a.RP)],"I"!==a.OC&&(d+=f.join(";")+"\n")}.bind(this)),SignPluginServices.saveFile({title:l.export_title,defaultFileName:"export.csv",fileMask:'{"text":"'+l.export_report_types+'","pattern":"*.csv"}',fileType:"csv",data:window.btoa(e.utf8_decode_win1251(d.split("\n").join("\r\n")))}).done(function(a){var d,f=this.showGroupList(l.export_result_title),g=new c.Model,h=localStorage.getItem("statement_undefined_filter_bdate"),i=localStorage.getItem("statement_undefined_filter_edate");d=this.isMultiReport?this.isAllAccountReport?l.export_by_all_account:l.export_by_several_account:e.sprintf(l.export_by_account,this.statementsReportCollection.first().get("AC")),f.add(g,e.sprintf(l.export_success_csv,d,h,i,a));var j;b.chain(this.statementsReportCollection.models).map(function(a){return a.get("operations")}).flatten().reject(function(a){return"I"===a.OC}).each(function(a){j=new c.Model(a),f.add(j,e.sprintf(l.export_element_title,j.get("ND"),j.get("OD"),j.get("AC"))),j.trigger("model:completeSync",j,j.get("export_status")||"ok")}),g.trigger("model:completeSync",g,"ok")}.bind(this))},doExportProfix:function(){a.when(g.getCurrencies(),g.getUaSwiftForAccounts(this.accounts)).done(function(a,d){function g(a){var b=a.split(" ")[0].split(".").reverse().join("");return b.match(/^\d{8}$/)?b:""}function h(a){var b=a.split(" ").pop().split(":").join("");return b.match(/^\d{4}$/)?b:"0000"}function i(a,b,c,d){return a.length>c?(d.export_result_text+=e.sprintf(l.export_warning_text,b,c)+"<br/>",a.substring(0,c)):a}var j=[],n=new c.Collection,o=function(a){return"I"!==a.OC},p=[];p=this.isGroupByAccount?m.sortGroupedOperations(this,this.statementsReportCollection.models,"operations",o):m.sortUnGroupedOperations(this,this.statementsReportCollection.models,"operations",o),p.forEach(function(c){var f=b.findWhere(this.accounts,{account_id:c.ACID}),k=b.findWhere(a,{currency:f.currency}).code_currency,m=this.getClient(f.client_id),o=e.utf8_decode_win1251(m.name_cln),p=e.utf8_decode_win1251((b.findWhere(d,{code:f.mfo})||{name:""}).name),q={export_status:"",export_result_text:""},r="-1"===c.OT,s=this.normalizeAmount(c[r?"D":"C"]);if(c.ND.length>15)q.export_status=l.export_error,q.export_result_text=e.sprintf(l.export_error_text,l.h_dnum);else if(s.length>19)q.export_status=l.export_error,q.export_result_text=e.sprintf(l.export_error_text,l.amount);else{var t=g(c.DD);j.push({MFO:f.mfo,MFO_NM:i(p,l.h_bname,50,q),KL_NM:o,KL_OKP:m.okpo,KL_CHK:f.account,CUR_ID:k,MFO_K:c.CBB,MFO_NM_K:e.utf8_decode_win1251(i(c.CBN,l.h_bname,50,q)),KL_NM_K:e.utf8_decode_win1251(i(c.CN,l.h_korr,50,q)),KL_OKP_K:c.CI,KL_CHK_K:c.CA,ND:e.utf8_decode_win1251(c.ND),DK:r?1:2,VOB:1,S:parseFloat(s),DATA:t,DATA_S:g(c.OD),TIME_S:h(c.OD),ADATEOPL:t,N_P:e.utf8_decode_win1251(i(c.NP,l.h_detail,160,q))})}n.add(b.extend(q,c))}.bind(this));var q=[{name:"MFO",type:"C",size:15},{name:"MFO_NM",type:"C",size:50},{name:"KL_NM",type:"C",size:50},{name:"KL_OKP",type:"C",size:15},{name:"KL_CHK",type:"C",size:35},{name:"CUR_ID",type:"N",size:5,decSize:0},{name:"MFO_K",type:"C",size:15},{name:"MFO_NM_K",type:"C",size:50},{name:"KL_NM_K",type:"C",size:50},{name:"KL_OKP_K",type:"C",size:15},{name:"KL_CHK_K",type:"C",size:35},{name:"ND",type:"C",size:15},{name:"DK",type:"N",size:1,decSize:0},{name:"VOB",type:"N",size:5,decSize:0},{name:"S",type:"N",size:19,decSize:2},{name:"DATA",type:"D",size:8},{name:"DATA_S",type:"D",size:8},{name:"TIME_S",type:"C",size:4},{name:"ADATEOPL",type:"D",size:8},{name:"N_P",type:"C",size:160}],r=(new f).create(j,q);SignPluginServices.saveFile({title:k.export_title,defaultFileName:"export.dbf",fileType:"dbf",data:window.btoa(e.stringFromCharCode(r.buffer))}).done(function(a){var d=this.showGroupList(l.export_result_title),f=localStorage.getItem("statement_undefined_filter_bdate"),g=localStorage.getItem("statement_undefined_filter_edate"),h=new c.Model,i="";i=this.isMultiReport?this.isAllAccountReport?l.export_by_all_account:l.export_by_several_account:e.sprintf(l.export_by_account,this.statementsReportCollection.first().get("AC")),d.add(h,e.sprintf(l.export_success_csv,i,f,g,a)),b.each(n.models,function(a){d.add(a,e.sprintf(l.export_element_title,a.get("ND"),a.get("OD"),a.get("AC"))),a.trigger("model:completeSync",a,a.get("export_status")||"ok",a.get("export_result_text")||"")}),h.trigger("model:completeSync",h,"ok")}.bind(this))}.bind(this))},escapeString:function(a){return a=a.split('"').join('""'),(a.indexOf('"')>=0||a.indexOf(";")>=0)&&(a='"'+a+'"'),a},normalizeAmount:function(a){return a.split(" ").join("")},getClient:function(a){return d.isMultiClient()?b.findWhere(j.getThesaurus("sub_clients").array,{client_id:a}):this.client}}}),define("apps/statement/statement_controller",["jquery","underscore","app","appsPieces","backbone","bifit","collections/thesaurus","collections/editabled_thesaurus","dialogUtils","printUtils","models/reference","customConstants","actionUtils","commons/empty_list_view","commons/base_object/base_controller","models/base_model","commons/base_object/reference/reference_edit_controller","apps/statement/statement_filter_view","apps/statement/statement_report_model","apps/statement/statement_report_view","apps/statement/statement_print","apps/statement/statement_view","apps/ua_payment/ua_payment_controller","apps/ua_payment/ua_payment_print","apps/statement/statement_print_registry","apps/overturns/overturns_report_model","text!apps/ua_payment/templates/print/print.tmpl","text!apps/ua_payment/css/print.css","text!apps/statement/templates/statement_print_sub_menu.tmpl","text!apps/statement/templates/statement_export_sub_menu.tmpl","apps/statement/statement_exchange","views/tree","views/group","views/document/aside-left","components/aside_right/aside_right","text!apps/statement/templates/statement_item.tmpl","i18n!apps/statement/nls/statement"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K){
"use strict";var L=p.extend({name:"OverturnsReportLoader",urlRoot:f.settings.server_addr+"/overturn",save:function(){throw new Error("Action is not supported")}}),M=p.extend({name:"StatementsReportLoader",urlRoot:f.settings.server_addr+"/statement",save:function(){throw new Error("Action is not supported")}}),N=e.Collection.extend({model:s}),O=!1;return o.extend({actionBarPrintSubMenu:b.template(C,K),actionBarExportSubMenu:b.template(D,K),selectedAccountsIds:null,selectedModel:null,accounts:null,accountsByMfo:null,FilterViewClass:r,initialize:function(d){delete c.mainLayout.content.options.expectedType,this.createMembers();var e=this.handleInitialOptions(d);this.listenTo(this.reportLoader,"sync",this.onReportLoad);var f=g.getThesaurus("accs_info").fetch(),h=g.getThesaurus("account_alias",!1).fetch();this.initGroupByAccountFlag(),a.when(f,h).done(function(a,d){this.accounts=b.chain(a).filter(function(a){return"0"!==a.status&&"3"!==a.type}).map(function(a){a=b.clone(a);var c=b.findWhere(d,{account_id:a.account_id,empl_id:a.empl_id});return c&&(a.client_comment=c.client_comment),a}).sortBy("account").value(),this.accountsByMfo=b.groupBy(this.accounts,"mfo"),c.mainLayout.showRegions({filter:this.createFilterView(e),left:new F})}.bind(this))},handleInitialOptions:function(a){var b=!!(a||{}).acc_id;return b&&(localStorage.setItem("statement_undefined_filter_bdate",a.bdate),localStorage.setItem("statement_undefined_filter_edate",a.edate),this.selectedAccountsIds=a.acc_id,c.navigate("/statements",{replace:!0})),b},createMembers:function(){this.reportLoader=new M,this.overturnsReportLoader=new L,this.reportCollection=new N,this.jointReportCollection=new e.Collection},selectStatement:function(a){var b=new H;this.listenTo(b,"action:doAction",this.showMainLayoutRegions.bind(this,["PRINT_GROUP","EXPORT_GROUP"],!0)),c.mainLayout.left.show(b),c.mainLayout.filter.empty(),this.renderStatementItemView(a).done(function(){c.mainLayout.right.show(this.createAsideRight(a))}.bind(this))},renderStatementItemView:function(a){return this.selectedModel=a,this.addAdditionalAttributes(a).done(function(b){var d=v.extend({model:new e.Model(b)});this.statementViewInstance=new d,c.mainLayout.content.show(this.statementViewInstance),c.mainLayout.actionBar.show(this.createActionBar(this.getPossibleActionsForSelectStatement(a)))}.bind(this))},addAdditionalAttributes:function(c){return a.when(this.getAccountsExtendedInfo(),this.getBudgetCodes()).then(function(a,d){var e=b.findWhere(a,{id:c.get("ACID")}),f=(b.findWhere(d,{code:c.get("BC")})||{}).description||"";return b.extend({ISB:"1"===e.comments,BDESC:f},c.attributes)}.bind(this))},getPossibleActionsForSelectStatement:function(a){var b=[];return"UAH"===a.get("CUR")&&(b.push(m.DocumentAction.PRINT.toString()),b.push(m.DocumentAction.ADD_RECIPIENT.toString()),""!==a.get("D")&&m.isActionPermitted("CREATE","ua_payment")&&w.prototype.isAccountsForCreateAction()&&b.push(m.DocumentAction.COPY.toString())),b},getFullAttributesList:function(a,c){var d=this.getClientForReport(a),e=b.findWhere(g.getThesaurus("bank_branches").array,{bik:a.get("IB")}).name,f={NUM_DOC:c?a.get("ND"):"",DATE_DOC:c?a.get("DD"):"",AMOUNT:a.get("amount").split(" ").join(""),PAYMENT_DETAILS:a.get("NP"),OPER_DATE:(a.get("OD")||"").substr(0,10)};return f="C"===c?b.defaults(f,{RCPT_BANK_MFO:a.get("IB"),RCPT_OKPO:d.okpo,RCPT_ACCOUNT:a.get("AC"),RCPT_BANK_NAME:e,RCPT_NAME:d.name_cln,CLN_ACCOUNT:a.get("CA"),CLN_BANK_MFO:a.get("CBB"),CLN_NAME:a.get("CN"),CLN_OKPO:a.get("CI"),CLN_BANK_NAME:a.get("CBN")}):b.defaults(f,{RCPT_BANK_MFO:a.get("CBB"),RCPT_OKPO:a.get("CI"),RCPT_ACCOUNT:a.get("CA"),RCPT_BANK_NAME:a.get("CBN"),RCPT_NAME:a.get("CN"),CLN_ACCOUNT:a.get("AC"),CLN_BANK_MFO:a.get("IB"),CLN_NAME:d.name_cln,CLN_OKPO:d.okpo,CLN_BANK_NAME:e})},showMainLayoutRegions:function(a,b){c.mainLayout.showRegions({left:new F,filter:this.createFilterView(b),content:this.createReportListView(),actionBar:this.createActionBar(a)}),c.mainLayout.content.options.expectedType="statement"},showGroupList:function(a,b){var d=new H;b=b||{};var e=new G({title:a,stopOperation:b.stopOperation,entityType:b.entityType,operationType:b.operationType,waitForFinishCommand:b.waitForFinishCommand});return this.listenTo(d,"action:doAction",function(){var a=e.getRunningOperation();a?i.confirm(a.stopMsg,function(){a.stopOperation(),this.showMainLayoutRegions()}.bind(this)):this.showMainLayoutRegions()}.bind(this)),c.mainLayout.showRegions({left:d,content:e}),e},createFilterView:function(a){var b=new this.FilterViewClass(this.getFilterViewOptions(a));return this.listenTo(b,"reload",this.reload),this.listenTo(b,"reset",this.reset),this.listenTo(b,"changeGroupState",this.changeGroupState),b},getFilterViewOptions:function(b){return{checkedGroupByAccount:O,model:this.reportLoader,accounts:this.accounts,selectedAccountsIds:this.selectedAccountsIds,loadReport:a.parseJSON(localStorage.getItem("statements_initialize"))||b}},createReportListView:function(){var a;return this.reportCollection.isEmpty()?a=new(n.extend({message:K.empty_list_header,text:K.empty_list_msg})):(a=new t(this.getListViewOptions()),this.listenTo(a,"selectStatement",this.selectStatement),this.listenTo(a,"show",c.mainLayout.content.trigger.bind(c.mainLayout.content,"content:reloaded")),this.sortInfo=a.getSortedInfo()),a},getListViewOptions:function(){return{model:this.reportLoader,collection:!O&&this.isMultiReport?this.jointReportCollection:this.reportCollection,isGroupByAccount:!!O,isMultiReport:!!this.isMultiReport}},createAsideRight:function(a){var c=b.flatten(this.reportCollection.pluck("operations")),d=new I({collection:new e.Collection(c),listItemTemplate:J,selectedItemModel:a,listItemTemplateHelpers:{contentAlign:"justify"},viewInstanceEl:this.statementViewInstance.$el});return this.listenTo(d,"select:item",this.renderStatementItemView),d},onReportLoad:function(){if("statement"===c.mainLayout.content.options.expectedType){this.isMultiReport=b.size(this.reportLoader.attributes)>1;var a=b.chain(this.reportLoader.attributes).values().filter(function(a){return!b.isEmpty(a.operations)}).value();this.reportCollection.reset(a,{parse:!0}),this.jointReportCollection.reset(this.prepareJointReport()),c.mainLayout.content.show(this.createReportListView()),c.mainLayout.actionBar.show(this.createActionBar(this.reportCollection.isEmpty()?["PRINT_GROUP"]:["PRINT_GROUP","EXPORT_GROUP"])),localStorage.setItem("statements_initialize","true")}},prepareJointReport:function(){var a={};return a.operations=b.flatten(this.reportCollection.pluck("operations")),a},reload:function(a){c.mainLayout.content.options.expectedType="statement",this.overturnsReportLoader.clear(),this.withExtendFilter=b.size(a)>3,this.fetchOptions={data:a},this.selectedAccountsIds=a.acc_id,this.reportLoader.fetch(this.fetchOptions)},reset:function(){c.mainLayout.actionBar.empty(),c.mainLayout.content.empty(),this.reportLoader.clear(),this.reportCollection.reset(),this.jointReportCollection.reset()},COPY:function(a,b){var c=new w;c.collection&&c.collection.fetch({document_type:c.docType,data:{status:c.tabsStatuses.work,bdate:localStorage.getItem(c.docType+"_work_filter_bdate")||f.date2str(new Date)}}),e.history.navigate("document/list/ua_payment"),f.setStorageData("selected_main_menu_item",c.docType),c.CREATE(null,this.getFullAttributesList(this.selectedModel),b)},ADD_RECIPIENT:function(){var a=new q,b=this.getFullAttributesList(this.selectedModel),c="ua_recipients";return a.model=new k({refType:c}),a.modelType=c,a.model.set("name",b.RCPT_NAME),a.model.set("inn",b.RCPT_OKPO),a.model.set("requisites",[{id:"",bic:b.RCPT_BANK_MFO,bill:b.RCPT_ACCOUNT,rcpt_bnk_name:b.RCPT_BANK_NAME,comment:this.getCorrectPaymentDetails(b.PAYMENT_DETAILS),note:""}]),a.validate()?void h.getThesaurus(a.modelType).create(a.model,{silent:!0,wait:!0,success:function(a){var b=a.get("error");b?i.alert(b):i.alert(K.recipient_success)},error:function(){i.alert(K.recipient_error)}}):void i.alert(K.invalid_recipient)},PRINT:function(){var a=b.clone(this.selectedModel),c=""!==a.get("C")?"C":"D";a.set(this.getFullAttributesList(this.selectedModel,c)),a.type="ua_payment",x([a],A,B)},PRINT_GROUP:function(a){f.showSubMenu(a)},PRINT_STATEMENT_STANDART:function(){this.printStatements("STANDART")},PRINT_STATEMENT_EXTENDED:function(){this.printStatements("EXTENDED")},PRINT_STATEMENT_EXTENDED_ALBUM:function(){this.printStatements("EXTENDED_ALBUM")},PRINT_STATEMENT_BRIEF:function(){this.printStatements("BRIEF")},printStatements:function(a){var c=this.getClient(),d=b.chain(this.reportLoader.attributes).values().filter(function(a){return b.has(a,"IB")}).value(),e=new u({selectedAccounts:this.getSelectedAccounts(),accountsInfoPromise:this.getAccountsExtendedInfo(),statementsReportCollection:new N(d),overturnsReportCollectionPromise:this.getOverturnsReportCollection(),budgetCodesPromise:this.getBudgetCodes(),client:c,print_type:a,sortInfo:this.sortInfo,withExtendFilter:this.withExtendFilter});e.render()},PRINT_DEBIT_REGISTRY:function(){y(this.getPrintData("D"))},PRINT_CREDIT_REGISTRY:function(){y(this.getPrintData("C"))},EXPORT_GROUP:function(a){f.showSubMenu(a)},EXPORT_CSV:function(a){this.doExport("CSV")},EXPORT_BMRS:function(a){this.doExport("BMRS")},EXPORT_IBIS:function(){this.doExport("IBIS")},EXPORT_PROFIX:function(){this.doExport("PROFIX")},doExport:function(a){var c=this.getSelectedAccounts(),d=b.findWhere(c,{account_id:this.reportCollection.first().id}).mfo,e=b.extend(E,{accounts:c,client:this.getClient(),isAllAccountReport:this.isAllAccountReport(d),isMultiReport:this.isMultiReport,isGroupByAccount:O,statementsReportCollection:this.reportCollection,showGroupList:this.showGroupList.bind(this)});"BMRS"===a||"IBIS"===a?this.getOverturnsReportCollection().then(function(c){b.extend(e,{overturnsReportCollection:c}).doExport(a,this.sortInfo)}.bind(this)):e.doExport(a,this.sortInfo)},getOverturnsReportCollection:function(){function c(a){var c=e.Collection.extend({model:z});return new c(b.values(a),{parse:!0})}var d=a.Deferred(),f={};return f.error=function(){d.reject()}.bind(this),f.success=function(a){d.resolve(c(a.toJSON()))},b.isEmpty(this.overturnsReportLoader.attributes)?this.overturnsReportLoader.fetch(b.defaults(f,this.fetchOptions)):d.resolve(c(this.overturnsReportLoader.attributes)),d},getPrintData:function(a){var c=this.getSelectedAccounts(),d=b.first(c),e=this.getClient(),f=b.chain(this.reportLoader.attributes).values().filter(function(a){return b.has(a,"IB")}).value(),h=d.mfo,i=b.findWhere(g.getThesaurus("bank_branches").array,{bik:h});return{accounts:c,client:e,bank:i,budgetCodes:this.getBudgetCodes(),accountsInfo:this.getAccountsExtendedInfo(),operationType:a,reportCollection:new N(f),isAllAccountReport:this.isAllAccountReport(h),isMultiReport:this.isMultiReport,withExtendFilter:this.withExtendFilter,sortedInfo:this.sortInfo,isGroupByAccount:O}},getClient:function(){return g.getThesaurus("clients").array[0]},getClientForReport:function(){return this.getClient()},getSelectedAccounts:function(){var a=this.selectedAccountsIds.split(";");return b.filter(this.accounts,function(c){return b.contains(a,c.account_id)})},getAccountsExtendedInfo:function(){return g.getThesaurus("cln_accounts").fetch()},getBudgetCodes:function(){return g.getThesaurus("budget_codes").fetch()},getCity:function(a){var c=b.findWhere(g.getThesaurus("bank_branches").array,{bik:a.mfo});return c.city||""},changeGroupState:function(a){O=a.isGroup,f.storeItem("statement_is_group_by_account",O),this.reportCollection.isEmpty()||c.mainLayout.content.show(this.createReportListView())},getCorrectPaymentDetails:function(a){return a.length>l.PAYMENT_DETAILS_LENGTH?a.slice(0,l.PAYMENT_DETAILS_LENGTH):a},isAllAccountReport:function(a){return b.size(this.reportLoader.attributes)===this.accountsByMfo[a].length},initGroupByAccountFlag:function(){O="true"===f.getStoredItem("statement_is_group_by_account")}})}),function(a){var b=document,c="appendChild",d="styleSheet",e=b.createElement("style");e.type="text/css",b.getElementsByTagName("head")[0][c](e),e[d]?e[d].cssText=a:e[c](b.createTextNode(a))}(".ua_payment .okpo{\nfloat:left;\nmargin-bottom:0.5em;\n}\n.ua_payment div.country,.ua_payment div.passp{\nfloat:right;\n}\n.ua_payment .fleft{\nfloat:left;\n}\n.ua_payment div.details{\nclear:both;\nposition:relative;\n}\n.ua_payment div.group-box{\nfloat:right;\nmargin-top:0.5em;\n}\n.ua_payment a{\nfont-size:0.8125em;\ntext-decoration:none;\nfont-weight:600;\n}\n.expense-item a{\ndisplay:block;\nmargin-bottom:0.25em;\n}\n.ua_payment div.group-box a:not(:last-child){\nmargin-right:0.8em;\n}\n.ua_payment label[for='RCPT_ACCOUNT']{\nclear:both;\n}\n.ua_payment td.details{\nmax-width:400px;\n}\n.ua_payment label[for='PAYMENT_DETAILS']{\ndisplay:inline-block;\npadding-top:1em;\n}\nform#edit.ua_payment div.passp{\nwidth:210px;\n}\n.ua_payment input#RCPT_PASSP_SER{\nmargin-right:1.25em;\nwidth:75px;\n}\n.ua_payment input#RCPT_PASSP_NUM,\n.ua_payment input#RCPT_PASSP_NUM.error + .error-tooltip{\nwidth:90px;\n}\n.ua_payment input#RCPT_PASSP_SER.error + .error-tooltip{\nwidth:7.3em;\n}\n.ua_payment input#RCPT_COUNTRY_CODE{\nwidth:180px;\n}\n.ua_payment form input#RCPT_NAME{\nwidth:100%;\n}\n.ua_payment form input#RCPT_BANK_NAME{\nwidth:27.4em;\n}\n.ua_payment form div.additional > input#NUM_DOC{\nmargin-bottom:1em;\n}\n.ua_payment div.num-doc input#NUM_DOC{\nwidth:8em;\n}\n.ua_payment div#add{\ndisplay:none;\n}\n.ua_payment div.details label{\ndisplay:inline-block;\n}\n.ua_payment .container > div.rcpt-account{\nmargin-bottom:0;\n}\n.ua_payment div#add{\nmargin-top:0.75em;\n}\ndiv.modal div#budget_payment-editor{\nmargin-bottom:1.25em;\n}\ndiv.payment_kind_code span.error-tooltip{\nposition:absolute;\n}\ndiv.modal div#budget_payment-editor label{\ndisplay:block;\nmargin-bottom:0.25em;\n}\ndiv.modal div#budget_payment-editor > div{\nmargin-bottom:0.75em;\n}\ndiv.modal div#budget_payment-editor #PAYMENT_KIND_CODE{\nwidth:100%;\n}\ndiv.modal div#budget_payment-editor #DETAILS{\ndisplay:block;\nfont-size:0.675em;\nline-height:1.4em;\nheight:4.2em;\nmargin-top:-0.5em;\nmargin-bottom:2em;\n}\ndiv.modal div#budget_payment-editor textarea{\nheight:82px !important;\nwidth:100%;\n}\ndiv#budget-code-list{\nwidth:50em;\n}\ndiv#budget-code-list #filter{\nwidth:21em;\nmargin:0.3em 0;\n}\ndiv#budget-code-list .scrollbox{\nheight:25em;\nmargin-bottom:0.3em;\n}\ndiv#budget-code-list table{\ntable-layout:fixed;\nheight:auto;\n}\ndiv#budget-code-list .code-col{\nwidth:5em;\n}\ndiv#budget-code-list .descr-col{\nwidth:9em;\n}\ndiv#budget-code-list td,div.modal #budget-code-list th{\npadding:0.45em 0.857em;\n}\n.ua_payment:not(.ua_payment_request):not(.bank_ua_payment_request) .container div.amount{\nfloat:none;\n}\n.ua_payment:not(.ua_payment_request):not(.bank_ua_payment_request) .container div.amount input{\nwidth:12.8em;\nmargin-right:0.5em;\ndisplay:inline-block;\n}\n.ua_payment:not(.ua_payment_request):not(.bank_ua_payment_request) .container div.amount .nds-calc{\ndisplay:inline-block;\n}\n.ua_payment div.container div.acc{\nfloat:right;\n}\n.ua_payment:not(.ua_payment_request):not(.bank_ua_payment_request) .container div.acc,\n.ua_payment .container div.acc.with-type{\nmargin-left:0;\n}\n.ua_payment:not(.ua_payment_request):not(.bank_ua_payment_request) .container div.acc{\nfloat:none;\n}\n.ua_payment:not(.ua_payment_request):not(.bank_ua_payment_request) .container div.acc input,\n.ua_payment .container div.acc.with-type input{\nwidth:19.2em;\n}\n.ua_payment:not(.ua_payment_request):not(.bank_ua_payment_request) .container div.planned-remainder{\nfloat:right;\n}\n.container div.planned-remainder input{\nwidth:13em;\n}\n.ua_payment div.value-date{\nfloat:left;\nclear:none;\nmargin-left:3em;\n}\n.ua_payment div.date-doc{\nclear:none;\nfloat:left;\n}\n.ua_payment div.additional + div.container{\nmargin-top:0em;\n}\n.ua_payment .right{\nfloat:right;\n}\n.ua_payment .rcpt .bill{\nfloat:right;\nwidth:25%;\nmargin-right:1em;\ntext-align:right;\n}\n.ua_payment div.link_pay_sheet{\npadding-bottom:2em;\n}\n.ua_payment div.link_pay_sheet a{\npadding-right:1em;\nfont-weight:400;\nfont-size:1.1em;\n}\n.ua_payment div.link_pay_sheet li:last-child{\nfloat:left;\nborder-left:1px solid #D5D5D5;\npadding-left:1em;\n}\n.ua_payment div.link_pay_sheet li#payment a{\npointer-events:none;\ncursor:default;\ncolor:#888;\n}\n.ua_payment div.link_pay_sheet span{\ndisplay:inline-block;\nwidth:0.688em;\n}\n.ua_payment div.link_pay_sheet span:before{\ncontent:' \\25CF\\00a0 ';\nfont-size:1.1em;\n}\ndiv.filter div.archives-notification{\nfont-size:0.8125em;\npadding-top:0.8em;\ndisplay:block;\ncolor:#666666;\n}\n.ua_payment div.row.form-group label{\nmargin-bottom:0.25em !important;\n}");
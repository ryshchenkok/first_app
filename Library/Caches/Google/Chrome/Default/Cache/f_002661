define("commons/base_object/document/group_opers_document_controller",["jquery","underscore","bifit","app","dialogUtils","thesaurusUtils","libs/multi_client_utils","actionUtils","collections/thesaurus","commons/base_object/document/document_controller","commons/base_object/document/confirm_reason_view","i18n!nls/document"],function(a,b,c,d,e,f,g,h,i,j,k,l){return j.extend({getListViewOptions:function(){return j.prototype.getListViewOptions.call(this)},addListViewListeners:function(a){j.prototype.addListViewListeners.call(this,a),this.listenTo(a,"update-actions",this.updateActions)},updateActions:function(a){d.mainLayout.actionBar.show(this.createActionBar(a))},COPY_GROUP:function(){var e=new this.Model({type:this.docType}),f=b.groupBy(this.collection.selected,function(a){return a.get("owner_id")}),h=0,j=this,k=b.size(f),m=b.keys(f),n=!1,o=this.showGroupList(l.group_view_copy_h1,{stopOperation:function(){n=!0},entityType:"documents",operationType:"copying"}),p=function(){if(k>h&&!n){var q=m[h++],r=f[q],s=d.isMultiClient()?g.loadTemplate(!1,q,e):e.loadTemplate();s.done(function(e){var f,h=[],k=function(a,b){var d,e=j.getWorkContent(a).NUM_DOC,f=b||e+"/C",g=j.getCurrencyName(a.getCurrency());return d=a.getFAmount()?c.sprintf(l.group_view_copy,e,a.getFAmount(),g,f):c.sprintf(l.group_view_copy_2,e,f)},m=0,s=function(){if(!n)if(m<h.length){var a=h[m++];a.on("model:completeSync",s),a.save({},{silent:!0,emulateClientRequest:d.isMultiClient()})}else p()},t=b.size(r);if(d.isMultiClient()){var u=b.findWhere(i.getThesaurus("sub_clients").array,{client_id:q}),v=r[0].attributes,w=(u||{}).name_cln||v.CLN_NAME||v.PAYER_NAME||v.SENDER,x={statusHandlers:{403:function(a){b.each(r,function(b){var c=k(b);o.add(b,c),b.trigger("model:completeSync",b,l.error,a,403)})}}};f=g.loadSubClientData(q,w,x)}else f=a.Deferred().resolve();f.then(function(){var a=function(b){var c=r[b],d=j.getWorkContent(c),f=d.NUM_DOC;j.prepareContent4Save(j.prepareContent4Create(d)).then(function(d){d.NUM_DOC=""+(e.N?e.N++:f+"/C");var g=new j.Model(d,{silent:!0}),i=k(c,d.NUM_DOC);return j.isAccountsForCreateAction()?(o.add(g,i),h.push(g),void(b===t-1?s():b%100===0?setTimeout(a.bind(this,++b),0):a(++b))):(o.add(g,i),void g.trigger("model:completeSync",g,j.getNoAccErrorText()))})};a(0)})})}};p()},DELETE_GROUP:function(){var a=this.collection.selected,c=function(){var c=!1,e=this.group(function(a,b){this.addModelToGroupView(a,b,"delete")}.bind(this),l.group_view_delete_h1,a,{stopOperation:function(){c=!0},entityType:"documents",operationType:"deleting"}),f=b.pluck(e.children,"model"),g=0,h=function(){if(g<f.length&&!c){var a=f[g++];d.isMultiClient()&&(d.multiClient.currentSubClientId=a.get("owner_id"));var e={statusHandlers:{403:function(a){h()}}};a.destroy(b.extend(e,{silent:!0,wait:!0,emulateClientRequest:d.isMultiClient(),success:function(){a.trigger("model:completeSync",a,"Ok"),h()},error:function(){h()}}))}};h()},f=1===b.keys(a).length?l.confirm_delete_doc:l.confirm_delete_many_doc;e.confirm(f,c,!1,this)},SIGN_GROUP:function(){var e=this.collection.urlRoot+this.docType+"/sign/",i=";jsessionid="+c.getStoredItem("JSESSIONID"),j=b.values(this.collection.selected),k=0,m=!1,n=function(){if(k<j.length&&!m){var o=j[k++],p=o.get("attaches");if(!b.isEmpty(p))for(var q=f.getClientProp("documents.attachments.extensions"),r=0;r<p.length;r++)if(!c.checkAttachExtension(p[r].name,q))return o.trigger("model:completeSync",o,l.error,c.sprintf(l.attach_has_not_allowed_extension,q)),void n();var s=b.isEmpty(p)?a.when():this.loadAndSetAttachesContent(o),t=s.then(function(){var a=this.signData(o);return{content:this.prepare4Sign(a),id:o.get("id")}}.bind(this),function(a){o.trigger("model:completeSync",o,l.error,c.sprintf(l.attach_load_error,a.name)),n()}),u=function(b){SignPluginServices.signData(b.content).then(function(c){a.ajax({type:"POST",dataType:"json",url:e+b.id+i,data:JSON.stringify({id:b.id,sign:c.sign,timestamp:c.timestamp}),success:function(a){o.set(a,{silent:!0}),o.trigger("model:completeSync",o,"Ok","",200),n()},error:function(a){o.trigger("model:completeSync",o,l.error,a.responseText,a.status),n()}})})},v=function(a,c){var d=b.contains(["2","2002","3004"],o.get("status"));if(d||a===w.length)return o.trigger("model:completeSync",o,"Ok","",200),void n();var f=parseInt(o.get("sign_groups_mask"));return h.hasSignOfGroup(f,w[a].GR)?void v(a+1,c):void g.useKey(w[a].ID).then(function(){SignPluginServices.signData(c.content).then(function(b){g.ajax({type:"POST",dataType:"json",url:e+c.id,data:JSON.stringify({id:c.id,sign:b.sign,timestamp:b.timestamp}),currentSubClientKeyId:w[a].ID,success:function(b){return o.set(b,{silent:!0}),b.error&&a<w.length-1?(o.trigger("model:completeSync",o,l.error,b.error,200),void n()):void v(a+1,c)},error:function(a){o.trigger("model:completeSync",o,l.error,a.responseText,a.status),n()}})})})};if(d.isMultiClient())if(-1===this.docType.indexOf("budget")){var w=g.getKeysListLocatedMultiClient(o.get("owner_id"));t.then(v.bind(this,0))}else g.useMultiClientKey().then(function(){t.then(u)});else t.then(u)}}.bind(this);this.group(function(a,b){this.addModelToGroupView(a,b,"sign"),j.length===b.children.length&&n()}.bind(this),l.group_view_sign_h1,j,{stopOperation:function(){m=!0},entityType:"documents",operationType:"signing"})},addModelToGroupView:function(a,b,d){var e,f=a.get("NUM_DOC"),g=a.getFAmount(),h="";g?(e="sign"===d?l.group_view_sign:l.group_view_delete,h=c.sprintf(e,f,g,this.getCurrencyName(a.getCurrency()))):(e="sign"===d?l.group_view_sign_2:l.group_view_delete_2,h=c.sprintf(e,f)),b.add(a,h)},REJECT_GROUP:function(){var a=new k({el:e.wrapper(),templateHelpers:{maxLength:200,title:l[1===this.collection.selectedLength?"reject_doc_title":"reject_docs_title"],ok_button_name:l.reject_link_btn,cancel_button_name:l.close_link_btn}}).render();a.on("confirm",this.groupRejectRequest,this)},groupRejectRequest:function(d){var e=b.values(this.collection.selected),f=0,g=!1,h=function(){if(f<e.length&&!g){var b=e[f++];a.ajax({type:"PUT",contentType:"application/json",data:d||"",url:this.collection.urlRoot+this.docType+"/"+b.get("id")+"/reject"+b._session(),success:function(a){b.set(a,{silent:!0}),a.error?b.trigger("model:completeSync",b,l.error,a.error,200):b.trigger("model:completeSync",b,"Ok","",200),h()}.bind(this),error:function(a){b.trigger("model:completeSync",b,"documentNls.error",a.responseText,a.status),h()}.bind(this)})}}.bind(this);this.group(function(a,b){var d=a.get("NUM_DOC");b.add(a,c.sprintf(l.group_view_reject,d)),e.length===b.children.length&&h()},l.group_view_reject_h1,e,{stopOperation:function(){g=!0},entityType:"documents",operationType:"rejecting"})},prepareDeferredForModelsFetch:function(c){var d=a.Deferred(),e=b.values(this.collection.selected),f=0,g=function(){if(f<this.collection.selectedLength){var a=e[f++];!c||c(a)?(this.listenToOnce(a,"model:completeSync",function(){g()}),a.fetch()):g()}else d.resolve()}.bind(this);return g(),d},PRINT_GROUP:function(a){a.stopPropagation(),this.printDocs(b.values(this.collection.selected))},printDocs:function(){}})}),define("apps/ua_intrabank_currency_payment/nls/ua_intrabank_currency_payment",{root:{ua_intrabank_currency_payment:"Валютное поручение в пределах Банка",ua_intrabank_currency_payment_list:"Валютные поручения в пределах Банка",number:"Номер",date:"Дата",recipient:"Получатель",account:"Счет получателя",currency:"Валюта",amount:"Сумма",status:"Статус",payer:"Плательщик",empty_list:"Отсутствуют документы, удовлетворяющие условиям фильтрации.",empty_list_desc:"Попробуйте поискать документы по другим условиям.",by_amount:"Просим перечислить",from_account:"Со счета",from_comission_account:"Счет для списания комиссии",acc:"Счет",edrpou:"ЕГРПОУ",resident:"Резидент",bank:"Банк",add_to_rcpt:"Сохранить в справочник",details:"Назначение платежа",number_doc:"Номер",date_doc:"Дата документа",value_date:"Дата валютирования",autonum:"автонумер.",current:"текущая",not_required:"необяз.",mfo:"МФО",cln_bank:"Банк плательщика",name:"Наименование",start_entering_name:"Начинайте вводить наименование",start_entering:"Начинайте вводить",not_ua_acount_for_mfo:"Отсутствуют права на работу с гривневыми счетами в МФО {1}",not_acount_for_cur:"Отсутствуют права на работу со счетами в выбранной валюте",no_uah_accs:"Невозможно создать документ. Отсутствует текущий счет в национальной валюте.",no_cur_accs:"Невозможно создать документ. Отсутствует текущий счет в иностранной валюте.",field_DATE_DOC:"Дата документа",field_NUM_DOC:"Номер документа",field_AMOUNT:"Сумма платежа",field_CLN_NAME:"Наименование плательщика",field_CLN_OKPO:"ЕГРПОУ плательщика",field_CLN_ACCOUNT:"Счет плательщика",field_CLN_BNK_NAME:"Наименование банка плательщика",field_CLN_BANK_MFO:"МФО банка плательщика",field_RCPT_NAME:"Наименование получателя",field_RCPT_OKPO:"ЕГРПОУ получателя",field_RCPT_ACCOUNT:"Счет получателя",field_RCPT_BNK_NAME:"Наименование банка получателя",field_RCPT_BANK_MFO:"МФО банка получателя",field_PAYMENT_DETAILS:"Назначение платежа",field_CURRENCY_DATE:"Дата валютирования",field_RCPT_COUNTRY_CODE:"Код страны получателя",field_CLN_COUNTRY_CODE:"Код страны плательщика",field_AMOUNT_CURRENCY:"Валюта платежа",field_CLN_ADDR:"Адрес плательщика",field_CLN_RESIDENT:"Признак резидента",field_CLN_COUNTRY:"Страна регистрации плательщика",field_RCPT_RESIDENT:"Признак резидента",field_CLN_BNK_ADDR:"Адрес банка плательщика",field_RCPT_BNK_ADDR:"Адрес банка получателя",field_COMISSION_ACCOUNT:"Счет плательщика для оплаты комиссии",field_AMOUNT_CURRENCY_CODE:"Цифровой код валюты платежа",footer_s_template:"{1} {2} {3} из {4}",footer_selected_sin:"Выбрано",footer_selected_pl:"Выбрано",footer_1_doc:"поручение",footer_1_doc_pl:"поручение",footer_2_4_docs:"поручения",footer_5_0_docs:"поручений"},uk:!0,en:!0}),define("apps/ua_intrabank_currency_payment/nls/uk/ua_intrabank_currency_payment",{ua_intrabank_currency_payment:"Валютне доручення у межах Банку",ua_intrabank_currency_payment_list:"Валютні доручення у межах Банку",number:"Номер",date:"Дата",recipient:"Отримувач",account:"Рахунок отримувача",amount:"Сума",currency:"Валюта",status:"Статус",payer:"Платник",empty_list:"Жоден документ не відповідає умовам фільтрації.",empty_list_desc:"Спробуйте пошукати документи за іншими умовами.",by_amount:"Просимо перерахувати",from_account:"З рахунку",from_comission_account:"Рахунок для списання комісії",acc:"Рахунок",edrpou:"ЄДРПОУ",resident:"Резидент",bank:"Банк",add_to_rcpt:"Зберегти у довідник",details:"Призначення платежу",number_doc:"Номер",date_doc:"Дата документа",value_date:"Дата валютування",autonum:"автонумер.",current:"поточна",not_required:"не обов.",mfo:"МФО",cln_bank:"Банк платника",name:"Найменування",start_entering_name:"Починайте вводити найменування",start_entering:"Починайте вводити",not_ua_acount_for_mfo:"Відсутні права на роботу з гривневими рахунками в МФО {1}",not_acount_for_cur:"Відсутні права на роботу з рахунками в обраній валюті",no_uah_accs:"Неможливо створити документ. Вiдсутнiй поточний рахунок у національній валютi.",no_cur_accs:"Неможливо створити документ. Вiдсутнiй поточний рахунок в iноземнiй валютi.",field_DATE_DOC:"Дата документа",field_NUM_DOC:"Номер документа",field_AMOUNT:"Сума платежу",field_CLN_NAME:"Найменування платника",field_CLN_OKPO:"ЄДРПОУ платника",field_CLN_ACCOUNT:"Рахунок платника",field_CLN_BNK_NAME:"Найменування банку платника",field_CLN_BANK_MFO:"МФО банку платника",field_RCPT_NAME:"Найменування отримувача",field_RCPT_OKPO:"ЄДРПОУ отримувача",field_RCPT_ACCOUNT:"Рахунок отримувача",field_RCPT_BNK_NAME:"Найменування банку отримувача",field_RCPT_BANK_MFO:"МФО банку отримувача",field_PAYMENT_DETAILS:"Призначення платежу",field_CURRENCY_DATE:"Дата валютування",field_RCPT_COUNTRY_CODE:"Код країни отримувача",field_CLN_COUNTRY_CODE:"Код країни платника",field_AMOUNT_CURRENCY:"Валюта платежу",field_CLN_ADDR:"Адреса платника",field_CLN_RESIDENT:"Ознака резидента",field_CLN_COUNTRY:"Країна реєстрації платника",field_RCPT_RESIDENT:"Ознака резидента",field_CLN_BNK_ADDR:"Адреса банку платника",field_RCPT_BNK_ADDR:"Адреса банку отримувача",field_COMISSION_ACCOUNT:"Рахунок платника для сплати комісії",field_AMOUNT_CURRENCY_CODE:"Цифровий код валюти платежу",footer_s_template:"{1} {2} {3} з {4}",footer_selected_sin:"Обрано",footer_selected_pl:"Обрано",footer_1_doc:"доручення",footer_1_doc_pl:"доручення",footer_2_4_docs:"доручення",footer_5_0_docs:"доручень"}),define("apps/ua_intrabank_currency_payment/nls/en/ua_intrabank_currency_payment",{ua_intrabank_currency_payment:"Payment within the Bank",ua_intrabank_currency_payment_list:"Payments within the Bank",number:"Number",date:"Date",recipient:"Recipient",account:"Recipient's account",currency:"Currency",amount:"Amount",status:"Status",payer:"Payer",empty_list:"There are no documents for these filtering conditions.",empty_list_desc:"Try searching documents by other conditions.",by_amount:"Ask to transfer",from_account:"From account",from_comission_account:"Account to charge the commission",acc:"Account",edrpou:"EDRPOU",resident:"Resident",bank:"Bank",add_to_rcpt:"Add to reference",details:"Payment details",number_doc:"Number",date_doc:"Document date",value_date:"Value date",autonum:"Autonum.",current:"Current",not_required:"optional",mfo:"MFO",cln_bank:"Payer's bank",name:"Name",start_entering_name:"Start typing the name",start_entering:"Start typing",not_ua_acount_for_mfo:"There are no rights for working with hryvnia accounts in MFO {1}",not_acount_for_cur:"There are no rights for working with accounts in selected currency",no_uah_accs:"Unable to create a document. Current account in national currency is missing.",no_cur_accs:"Unable to create a document. Current account in foreign currency is missing.",field_DATE_DOC:"Document date",field_NUM_DOC:"Document name",field_AMOUNT:"Payment amount",field_CLN_NAME:"Payer's name",field_CLN_OKPO:"Payer's EDRPOU",field_CLN_ACCOUNT:"Payer's account",field_CLN_BNK_NAME:"Payer's bank name",field_CLN_BANK_MFO:"Payer's bank MFO",field_RCPT_NAME:"Recipient's name",field_RCPT_OKPO:"Recipient's EDRPOU",field_RCPT_ACCOUNT:"Recipient's account",field_RCPT_BNK_NAME:"Recipient's bank name",field_RCPT_BANK_MFO:"Recipient's bank MFO",field_PAYMENT_DETAILS:"Payment details",field_CURRENCY_DATE:"Value date",field_RCPT_COUNTRY_CODE:"Country code of recipient",field_CLN_COUNTRY_CODE:"Country code of payer",field_AMOUNT_CURRENCY:"Payment currency",field_CLN_ADDR:"Payer's address",field_CLN_RESIDENT:"Resident flag",field_CLN_COUNTRY:"Registration country of the payer",field_RCPT_RESIDENT:"Resident flag",field_CLN_BNK_ADDR:"Payer's bank address",field_RCPT_BNK_ADDR:"Recipient's bank address",field_COMISSION_ACCOUNT:"Payer's account for commission payment",field_AMOUNT_CURRENCY_CODE:"Numeric code of the payment currency",footer_s_template:"{1} {2} {3} of {4}",footer_selected_sin:"Selected",footer_selected_pl:"Selected",footer_1_doc:"order",footer_1_doc_pl:"orders",footer_2_4_docs:"orders",footer_5_0_docs:"orders"}),define("apps/ua_intrabank_currency_payment/ua_intrabank_currency_payment_model",["jquery","underscore","backbone","bifit","appsPieces","models/base_document","i18n!apps/ua_intrabank_currency_payment/nls/ua_intrabank_currency_payment","i18n!nls/validation","collections/thesaurus","backboneValidation"],function(a,b,c,d,e,f,g,h,i){"use strict";return f.extend({type:"ua_intrabank_currency_payment",nls:g,defaults:{status:"",status_desc:"",status_color:"000000",DATE_DOC:"",NUM_DOC:"",CLN_ACCOUNT:"",CLN_OKPO:"",CLN_NAME:"",CLN_ADDR:"",CLN_BANK_MFO:"",CLN_BNK_NAME:"",RCPT_ACCOUNT:"",RCPT_OKPO:"",RCPT_NAME:"",RCPT_BANK_MFO:"",RCPT_BNK_NAME:"",AMOUNT:"",AMOUNT_CURRENCY:"",PAYMENT_DETAILS:"",CLN_BNK_ADDR:"",RCPT_BNK_ADDR:"",CURRENCY_DATE:"",RCPT_RESIDENT:"",COMISSION_ACCOUNT:"",RCPT_COUNTRY_CODE:"",CLN_COUNTRY_CODE:"",CLN_RESIDENT:"",CLN_COUNTRY:"",AMOUNT_CURRENCY_CODE:"",ATT_CNT:"0"},meta:b.extend({},f.prototype.meta,{relatively:b.extend({RCPT_NAME:function(a){return a},AMOUNT:function(a){return parseFloat(a)},AMOUNT_CURRENCY:function(a){return a}},f.prototype.meta.relatively),formattedFields:{AMOUNT:function(){return this._amountFormatter(this.get("AMOUNT"),this.get("AMOUNT_CURRENCY"),2)}}}),order:["DATE_DOC","NUM_DOC","AMOUNT","CLN_NAME","CLN_OKPO","CLN_ACCOUNT","CLN_BNK_NAME","CLN_BANK_MFO","RCPT_NAME","RCPT_OKPO","RCPT_ACCOUNT","RCPT_BNK_NAME","RCPT_BANK_MFO","PAYMENT_DETAILS","CURRENCY_DATE","RCPT_COUNTRY_CODE","CLN_COUNTRY_CODE","AMOUNT_CURRENCY","CLN_ADDR","CLN_RESIDENT","CLN_COUNTRY","RCPT_RESIDENT","CLN_BNK_ADDR","RCPT_BNK_ADDR","COMISSION_ACCOUNT","AMOUNT_CURRENCY_CODE"],validation:{DATE_DOC:{dateDoc:!0},NUM_DOC:{numDocRequired:!0,maxLength:10},CLN_ACCOUNT:[{required:!0,digits:!0,maxLength:14},{fn:function(a,c,f){var g=d.checkAccount(a,f.mfo);if(!g){var i=b.where(e.getAccounts(["1","10"],!0)[f.AMOUNT_CURRENCY],{account:a});if(b.isEmpty(i))return g=h.invalid_field;var j=b.any(i,function(a){return a.permissions>0});j||(g=h.account_not_permission)}return g}}],CLN_OKPO:{required:!0,clientInfo:"okpo",minLength:8,maxLength:10,digits:!0},CLN_NAME:{required:!0,minLength:3,maxLength:40},CLN_ADDR:{required:!0,maxLength:100},CLN_BANK_MFO:[{required:!0,length:6,digits:!0},{fn:function(a){var c,d=b.any(i.getThesaurus("accs_info").array,function(b){return b.mfo===a});return d||(c=h.invalid_field),c}}],CLN_BNK_NAME:{required:!0,maxLength:45},RCPT_ACCOUNT:[{required:!0,minLength:5,maxLength:14,digits:!0,calcAcc:"RCPT_BANK_MFO"},{fn:function(a,b,c){var d;return c.CLN_ACCOUNT===a&&(d=h.rcpt_acc_eq_cln),d}}],RCPT_OKPO:{okpo:!0},RCPT_NAME:{required:!0,minLength:3,maxLength:40},RCPT_BANK_MFO:[{required:!0,maxLength:6,digits:!0},{fn:function(a,c,d){var e,f=b.findWhere(i.getThesaurus("init_as").array,{bik:a}),g=d.RCPT_BNK_NAME;return f&&g||(e=h.mfo_not_found),e}}],RCPT_BNK_NAME:{required:!0,maxLength:45},AMOUNT:[{required:!0},{max:9999999999.9999,pattern:/^\d+\.\d{4}$/,msg:h.incorrect_amount},{min:.01,msg:h.positive_amount}],AMOUNT_CURRENCY:[{required:!0,length:3},{fn:function(a){var c;return b.findWhere(i.getThesaurus("currency").array,{currency:a})||(c=h.invalid_field),c}}],PAYMENT_DETAILS:{required:!0,maxLength:160,minLength:3},CLN_BNK_ADDR:{required:!0,maxLength:80},RCPT_BNK_ADDR:{required:!0,maxLength:80},CURRENCY_DATE:{fn:function(a,b,c){var e,f=c.DATE_DOC||d.date2str(new Date);if(f&&a)if(d.checkDateMatch(a)){f=d.str2date(f),a=d.str2date(a);var g=a.getTime()-f.getTime();0>g?e=h.value_date_01:Math.floor(g/1e3/60/60/24)>10&&(e=this._valueDateErrorWrapper(10))}else e=h.incorrect_date;return e}},RCPT_RESIDENT:{fn:function(a){var b;return a&&"0"!==a&&"1"!==a&&(b=h.invalid_field),b}},COMISSION_ACCOUNT:[{required:!0,digits:!0,maxLength:14},{fn:function(a,c,f){var g;if(0===a.length)g=h.required;else if(g=d.checkAccount(a,f.CLN_BANK_MFO),!g){var i=e.getAccounts().UAH,j=b.any(i,function(b){return b.account===a});j||(g=h.account_not_permission)}return g}}],RCPT_COUNTRY_CODE:{required:!1,maxLength:3},CLN_COUNTRY_CODE:{required:!1,maxLength:3},CLN_RESIDENT:{fn:function(a){var b;return a&&"0"!==a&&"1"!==a&&(b=h.invalid_field),b}},CLN_COUNTRY:{required:!0,maxLength:70},AMOUNT_CURRENCY_CODE:{required:!1,digits:!0,length:3}}})}),define("nls/states_types",{root:{any:"любые","new":"новые",in_bank:"в банке",rejected:"отвергнутые",signed:"подписаные",executed:"исполненные",partly_executed:"исп. частично",sent_to_client:"отправленные клиенту",not_confirmed:"не подтвержденные",requires_confirmation:"требуют подтверждения",formed:"сформированные",approved:"одобренные"},uk:!0,en:!0}),define("nls/uk/states_types",{any:"будь-які","new":"нові",in_bank:"у банку",rejected:"відхилені",signed:"підписані",executed:"виконані",partly_executed:"виконані частково",sent_to_client:"відправлені клієнту",not_confirmed:"не підтверджені",requires_confirmation:"вимагають підтвердження",formed:"сформовані",approved:"узгоджені"}),define("nls/en/states_types",{any:"any","new":"new",in_bank:"in bank",rejected:"rejected",signed:"signed",executed:"executed",partly_executed:"partly executed",sent_to_client:"sent to the client",not_confirmed:"not confirmed",requires_confirmation:"requires confirmation",formed:"formed",approved:"approved"}),define("commons/base_object/document/document_state_filter_view",["underscore","commons/base_object/document/document_filter_view","i18n!nls/states_types"],function(a,b,c){"use strict";return b.extend({ui:a.extend({statesChosen:"#state_chosen_filter",statesChosenContainer:"div.state-chosen-filter"},b.prototype.ui),events:a.extend({"chosen:select @ui.statesChosen":"onStateFilterChanged"},b.prototype.events),states:{work:[{id:"any",name:c.any},{id:"new",name:c["new"],filter:"0,1,3004"},{id:"in_bank",name:c.in_bank,filter:"2,3,4,11,12,13,17,2001,2002"},{id:"rejected",name:c.rejected,filter:"6"}]},cache:{},onShow:function(){this.createStateFilter(),b.prototype.onShow.call(this)},createStateFilter:function(){this.ui.statesChosenContainer.show(),this.ui.statesChosen.chosen({searchable:!1,data:{array:[],id:"id",text:"name"}}),this.configureStateFilterForStatusTab()},onStateFilterChanged:function(a,b){b.id!==this.getSelectedState()&&(this.setSelectedState(b.id),this.reload())},changeStatus:function(a){b.prototype.changeStatus.call(this,a),this.configureStateFilterForStatusTab()},configureStateFilterForStatusTab:function(){return this.isStateFilterRequired()?(this.ui.statesChosenContainer.show(),this.ui.statesChosen.trigger("refresh",{array:this.getStatesRef()}),void this.ui.statesChosen.trigger("chooseById",this.getSelectedState())):void this.ui.statesChosenContainer.hide()},reload:function(a){a=this.addStateFilterData(a),b.prototype.reload.call(this,a)},addStateFilterData:function(b){if(this.isStateFilterRequired()){var c=a.findWhere(this.getStatesRef(),{id:this.getSelectedState()});b=c&&c.filter?a.extend({},b,{status:c.filter}):b}return b},getStatesRef:function(){return this.states[this.tabsStatuses.selectedTab]},getSelectedState:function(){return this.cache[this.docType+this.tabsStatuses.selectedTab]||"any"},setSelectedState:function(a){return this.cache[this.docType+this.tabsStatuses.selectedTab]=a},isStateFilterRequired:function(){return this.getStatesRef()&&this.getStatesRef().length>1},onBeforeDestroy:function(){this.ui.statesChosen.disposeChosen()}})}),define("text!commons/base_object/document/templates/document_ext_filter_minimized_item.tmpl",[],function(){return"<label><%- (label ? label + ': ' : '') %></label>\n<span class=\"value <%- id %>\"><%- displayValue %></span>\n<span class=\"delete-filter-item\">&#10005;</span>"}),define("nls/document-filter",{root:{status_all:"Все",period_from:"Период с",period_to:"по",getdocs:"Получить",loading_docs:"Получение",incorrect_filter_date:"Дата окончания интервала для получения документов ранее даты начала интервала",ua_payment:"Гривневые поручения",bank_ua_payment_request:"Гривневые требования",ua_payment_request:"Гривневые требования",ua_currency_purchase:"Покупка валюты",ua_currency_sale:"Продажа валюты",ua_currency_convert:"Конвертация валюты",ua_currency_payment:"Валютные поручения",pay_sheet:"Зарплатные ведомости",letter:"Письма",inStatus:"В статусе",any:"Все",several:"Выбрано статусов: {1}",num_doc:"Номер документа",currency:"Валюта",amount:"Сумма",from:"от",to:"до",amount_from:"Сумма от",amount_to:"Сумма до",payer:"Плательщик",recipient:"Получатель",account:"Счет",start_entering:"Начинайте вводить",start_entering_acc:"Начинайте вводить номер счета",start_entering_name:"Начинайте вводить наименование",all:"Все",amountError:"Максимальная сумма должна быть больше минимальной"},uk:!0,en:!0}),define("nls/uk/document-filter",{status_all:"Всі",period_from:"Перiод від",period_to:"до",getdocs:"Отримати",loading_docs:"Отримання",incorrect_filter_date:"Дата завершення інтервалу для отримання документів раніше дати початку інтервалу",ua_payment:"Гривневі доручення",bank_ua_payment_request:"Гривневі вимоги",ua_payment_request:"Гривневі вимоги",ua_currency_purchase:"Купівля валюти",ua_currency_sale:"Продаж валюти",ua_currency_payment:"Валютні доручення",ua_currency_convert:"Конвертація валюти",pay_sheet:"Зарплатні відомості",letter:"Листи",inStatus:"У статусі",any:"Всі",several:"Обрано статусів: {1}",num_doc:"Номер документа",currency:"Валюта",amount:"Сума",from:"від",to:"до",amount_from:"Сума від",amount_to:"Сума до",payer:"Платник",recipient:"Отримувач",account:"Рахунок",start_entering:"Починайте вводити",start_entering_acc:"Починайте вводити номер рахунку",start_entering_name:"Починайте вводити найменування",all:"Всі",amountError:"Максимальна сума повинна бути більше ніж мінімальна"}),define("nls/en/document-filter",{status_all:"All",period_from:"Period from",period_to:"to",getdocs:"Receive",loading_docs:"Loading",incorrect_filter_date:"Interval final date for receiving the statement is earlier than its initial one",ua_payment:"Hryvnia Payment orders",bank_ua_payment_request:"Hryvnia Payment requests",ua_payment_request:"Hryvnia Outgoing Payment Request-Orders",ua_currency_purchase:"Currency purchase",ua_currency_sale:"Currency sale",ua_currency_convert:"Currency conversion",ua_currency_payment:"Currency payments",pay_sheet:"Salary sheets",letter:"Letters",inStatus:"In status",any:"Any",several:"Selected statuses: {1}",num_doc:"Document number",currency:"Currency",amount:"Amount",from:"from",to:"to",amount_from:"Amount from",amount_to:"Amount to",payer:"Payer",recipient:"Recipient",account:"Account",start_entering:"Start typing",start_entering_acc:"Start typing the account",start_entering_name:"Start typing the name",all:"All",amountError:"The maximum amount should be more than the minimum"}),define("commons/base_object/document/document_ext_filter_view",["underscore","backbone","marionette","app","bifit","collections/thesaurus","dialogUtils","text!commons/base_object/document/templates/document_ext_filter_minimized_item.tmpl","i18n!nls/document-filter"],function(a,b,c,d,e,f,g,h,i){"use strict";return c.CompositeView.extend({template:a.template('<div id="expanded-view"></div><div id="minimized-view"></div>'),templateHelpers:{isMultiClient:d.isMultiClient},ui:{expanded:"#expanded-view",minimized:"#minimized-view"},events:{"chosen:select #client":"onClientSelected"},fieldsMeta:{},childView:c.ItemView.extend({template:a.template(h),tagName:"span",id:function(){return this.model.id},triggers:{"click .delete-filter-item":"deleteFilterItem"}}),selectedClient:null,childViewContainer:"#minimized-view",childEvents:{deleteFilterItem:"deleteFilterItem"},isExpanded:!0,isFieldsOrder:!1,getExtFilterData:function(){if(this.isExpanded&&this.resetFilterCollection(),this.isValidFilterData()){var b={};return a.extend(b,this.getQueryFilter()),a.extend(b,this.getAdditionalFilter()),a.extend(b,this.getClientIdFilter()),b}},toggleMode:function(){this.isExpanded?this.isValidFilterData()&&(this.ui.expanded.hide(),this.ui.minimized.show(),this.resetFilterCollection()):(this.ui.expanded.show(),this.ui.minimized.hide(),this.restoreFilter()),this.isExpanded=!this.isExpanded,this.trigger("filter:resized")},resetFilter:function(){this.clearForm(),this.setDefaults(),!this.isExpanded&&this.collection.length&&(this.collection.reset(),this.trigger("filter:changed"),this.trigger("filter:resized"))},clearForm:function(){this.ui.expanded.find("input:text:not([readonly])").val("").change().trigger("empty")},setDefaults:function(){},initialize:function(){},onShow:function(){this.initForm(),this.ui.client&&this.ui.client.length&&this.initClientChosen(),this.collection.length&&this.restoreFilter()},initForm:function(){},restoreFilter:function(){this.restoreQueryFields(),this.restoreAdditionalFields()},restoreQueryFields:function(){a.each(this.fieldsMeta,function(a,b){var c=this.collection.get(b);if(0!==this.ui[b].length){var d=c?c.get("displayValue"):"";this.ui[b].val(d),d||this.ui[b].trigger("empty"),this.ui[b].change()}}.bind(this))},restoreAdditionalFields:function(){},resetFilterCollection:function(){var b=a.union(this.collectQueryData(),this.collectAdditionalData());this.isFieldsOrder&&b.sort(function(b,c){return a.has(b,"order")&&a.has(c,"order")?b.order-c.order:0}),this.collection.reset(b)},collectQueryData:function(){var b=[];return a.each(this.fieldsMeta,function(c,d){var e=this.getFilterValue(d);if(e){var f={id:d,idx:c.idx,order:c.order,value:e,type:c.type,operation:c.operation,displayValue:this.getDisplayValue(d),label:"<="===c.operation&&a.findWhere(b,{idx:c.idx})?c.shortLabel:c.label};"client"===c.type&&this.selectedClient&&this.selectedClient.name_cln===f.value&&(f.client_id=this.selectedClient.client_id),b.push(f)}}.bind(this)),b},collectAdditionalData:function(){return[]},getQueryFilter:function(){var b="";return a.each(this.fieldsMeta,function(a,c){var d=this.collection.get(c);if(d){var e=this.getQueryPart(d);e&&(b+=(b?" && ":"")+e)}}.bind(this)),b?{query:b}:{}},getQueryPart:function(a){var b=a.get("type");return"amount"===b?this.getAmountQuery(a):"client"===b?this.getClientQuery(a):"number"===b?this.getNumberQuery(a):this.getStringQuery(a)},getAdditionalFilter:function(){return{}},getClientIdFilter:function(){var a=this.collection.get("client");if(a){var b=a.get("client_id");if(b)return{clients:b}}},isValidFilterData:function(){return this.hasAmountFields()?this.isAmountValid():!0},hasAmountFields:function(){return!!a.findWhere(this.fieldsMeta,{type:"amount"})},isAmountValid:function(){var a=+this.ui.AMOUNT_MIN.getUnformattedValue(),b=+this.ui.AMOUNT_MAX.getUnformattedValue();return!(b>0&&a>b)},clearInvalidFields:function(){this.hasAmountFields()&&!this.isAmountValid()&&this.clearAmountFields()},clearAmountFields:function(){this.ui.AMOUNT_MIN.val(""),this.ui.AMOUNT_MAX.val(""),b.Validation.callbacks.valid(null,"AMOUNT_MIN")},validateFilterAmount:function(){this.isAmountValid()?b.Validation.callbacks.valid(null,"AMOUNT_MIN"):b.Validation.invalidField(this,"AMOUNT_MIN",i.amountError)},getFilterValue:function(a){var b=this.ui[a].getUnformattedValue();return this.fieldsMeta[a]&&("amount"===this.fieldsMeta[a].type||"number"===this.fieldsMeta[a].type)&&0>=b?null:b?b.trim():null},getDisplayValue:function(a){return this.ui[a].val().trim()},deleteFilterItem:function(b,c){var d=c.model.id,e=this.fieldsMeta[d];if(e&&">="===e.operation){var f;a.each(this.fieldsMeta,function(a,b){e.idx===a.idx&&b!==d&&"<="===a.operation&&(f=b)}),f&&this.collection.get(f)&&this.ui.minimized.find("#"+f).find("label").html(this.fieldsMeta[f].label+":")}this.collection.remove(c.model),this.ui[d].trigger("empty"),this.trigger("filter:changed"),this.trigger("filter:resized")},onClientSelected:function(a,b){this.selectedClient=b},initClientChosen:function(){this.ui.client.chosen({data:{array:f.getThesaurus("sub_clients").array,id:"client_id",text:"name_cln"}})},getStringQuery:function(a){return"["+a.get("idx")+"] hasi '"+e.escapeSpecialChars(a.get("value"))+"'"},getAmountQuery:function(a){return"["+a.get("idx")+"] "+a.get("operation")+" "+a.get("value")},getNumberQuery:function(a){return"["+a.get("idx")+"] has '"+a.get("value")+"'"},getClientQuery:function(a){return a.get("client_id")?"":this.getStringQuery(a)},onBeforeDestroy:function(){this.ui.client&&this.ui.client.length&&this.ui.client.disposeChosen()}})}),define("text!apps/ua_intrabank_currency_payment/templates/ua_intrabank_currency_payment_ext_filter.tmpl",[],function(){return'<div id="expanded-view">\n    <% if (isMultiClient()) { %>\n    <div class="data-row">\n        <div class="row">\n            <label class="col-xs-12"><%- payer %></label>\n        </div>\n        <div class="row">\n            <div class="col-xs-12"><input class="ellipsis" id="client" placeholder="<%- start_entering_name %>"></div>\n        </div>\n    </div>\n    <% } %>\n    <div class="data-row">\n        <div class="row">\n            <label class="col-xs-3"><%- num_doc %></label>\n            <label class="col-xs-6"><%- amount %></label>\n            <label class="col-xs-3"><%- currency %></label>\n        </div>\n        <div class="row">\n            <div class="col-xs-3">\n                <input id="NUM_DOC" maxlength="10">\n            </div>\n            <div class="col-xs-6 amount-filter">\n                <input id="AMOUNT_MIN" class="sum" autocomplete="off" placeholder="<%- from %>">\n                <label class="amount-to">-</label>\n                <input id="AMOUNT_MAX" class="sum" autocomplete="off" placeholder="<%- to %>">\n            </div>\n            <div class="col-xs-3">\n                <input id="AMOUNT_CURRENCY" autocomplete="off" placeholder="<%- all %>">\n            </div>\n        </div>\n    </div>\n    <div class="data-row">\n        <div class="row">\n            <label class="col-xs-6"><%- recipient %></label>\n            <label class="col-xs-6"><%- field_RCPT_ACCOUNT %></label>\n        </div>\n        <div class="row">\n            <div class="col-xs-6">\n                <input id="RCPT_NAME" autocomplete="off" placeholder="<%- start_entering_name %>">\n            </div>\n            <div class="col-xs-6">\n                <input class="ellipsis" id="RCPT_ACCOUNT" maxlength="14" placeholder="<%- start_entering %>">\n            </div>\n        </div>\n    </div>\n</div>\n<div id="minimized-view"></div>\n';
}),define("apps/ua_intrabank_currency_payment/ua_intrabank_currency_payment_ext_filter_view",["jquery","underscore","backbone","app","bifit","collections/thesaurus","appsPieces","commons/base_object/document/document_ext_filter_view","text!apps/ua_intrabank_currency_payment/templates/ua_intrabank_currency_payment_ext_filter.tmpl","i18n!apps/ua_intrabank_currency_payment/nls/ua_intrabank_currency_payment","i18n!nls/document-filter"],function(a,b,c,d,e,f,g,h,i,j,k){"use strict";var l=new c.Collection;return h.extend({template:b.template(i),templateHelpers:b.extend({},h.prototype.templateHelpers,j,k),className:"ua_intrabank_currency_payment",ui:b.defaults({client:"#client",NUM_DOC:"#NUM_DOC",AMOUNT_MIN:"#AMOUNT_MIN",AMOUNT_MAX:"#AMOUNT_MAX",AMOUNT_CURRENCY:"#AMOUNT_CURRENCY",RCPT_NAME:"#RCPT_NAME",RCPT_ACCOUNT:"#RCPT_ACCOUNT"},h.prototype.ui),events:b.defaults({"blur @ui.AMOUNT_MIN":"validateFilterAmount","blur @ui.AMOUNT_MAX":"validateFilterAmount","chosen:select @ui.AMOUNT_CURRENCY":"onChangeCurrency","chosen:select @ui.RCPT_ACCOUNT":"onRecipientAccountSelected","chosen:select @ui.RCPT_NAME":"onRecipientNameSelected","blur @ui.RCPT_NAME":"onRecipientChanged"},h.prototype.events),fieldsMeta:{client:{idx:"3",type:"client",label:k.payer},NUM_DOC:{idx:"1",label:k.num_doc},AMOUNT_MIN:{idx:"2",label:k.amount_from,type:"amount",operation:">="},AMOUNT_MAX:{idx:"2",label:k.amount_to,shortLabel:k.to,type:"amount",operation:"<="},AMOUNT_CURRENCY:{idx:"17",label:k.currency},RCPT_NAME:{idx:"8",label:k.recipient},RCPT_ACCOUNT:{idx:"10",label:j.field_RCPT_ACCOUNT}},initialize:function(a){this.collection=l,this.recipients=[],h.prototype.initialize.call(this,a)},initForm:function(){this.addFormatters(),this.initCurrencyChosen(),this.initRecipientNamesChosen(),this.initRecipientAccountsChosen(),this.fillRcptChosens(),this.listenTo(d.mainLayout.content,"content:reloaded",this.highlightFoundText)},addFormatters:function(){this.ui.AMOUNT_MIN.formatter("amount"),this.ui.AMOUNT_MAX.formatter("amount"),this.ui.RCPT_ACCOUNT.formatter("number")},initCurrencyChosen:function(){var a=[k.all];this.ui.AMOUNT_CURRENCY.chosen({searchable:!1,data:{array:a},value:k.all}),this.getClientCurrenciesPromise().done(function(b){a.push.apply(a,b),this.ui.AMOUNT_CURRENCY.trigger("refresh",{array:a,value:k.all})}.bind(this))},getClientCurrenciesPromise:function(){var c;return c=d.isMultiClient()?f.getThesaurus("accs_currency").fetch().then(b.partial(b.pluck,b,"currency")):a.when(b.keys(g.getAccounts(["1"],!0))),c.then(function(a){return b.chain(a).without("UAH").sort().value()}).promise()},initRecipientNamesChosen:function(){this.ui.RCPT_NAME.chosen({data:{array:[],id:"id",text:"name"}})},initRecipientAccountsChosen:function(){this.ui.RCPT_ACCOUNT.chosen({data:{array:[],id:"id",text:"bill"}})},fillRcptChosens:function(){var a=d.isMultiClient()?f.loadMultiClientThesaurus("ua_recipients"):f.loadClientThesaurus("ua_recipients");a.done(function(a){this.recipients=a,this.fillRcptAccountsChosen(),this.fillRcptNamesChosen(a)}.bind(this))},fillRcptAccountsChosen:function(){if(this.recipients.length)if(this.ui.RCPT_ACCOUNT.val()&&this.ui.RCPT_NAME.val()){var a=b.findWhere(this.recipients,{name:this.ui.RCPT_NAME.val()});a&&this.ui.RCPT_ACCOUNT.trigger("refresh",{array:a.requisites})}else this.fillAllRcptAccountsChosen()},fillAllRcptAccountsChosen:function(){if(this.recipients&&this.recipients.length){var a=b.flatten(b.pluck(this.recipients,"requisites"));this.ui.RCPT_ACCOUNT.trigger("refresh",{array:a})}},fillRcptNamesChosen:function(a){this.ui.RCPT_NAME.trigger("refresh",{array:a})},onChangeCurrency:function(){g.getCurrencies().done(function(a){var c=b.findWhere(a,{currency:this.ui.AMOUNT_CURRENCY.val()}),d=c?c.decimals:2;this.updateAmountDecimals("AMOUNT_MIN",d),this.updateAmountDecimals("AMOUNT_MAX",d)}.bind(this))},onRecipientNameSelected:function(a,b){this.ui.RCPT_ACCOUNT.trigger("refresh",{array:b.requisites}),this.ui.RCPT_ACCOUNT.val(e.getContent(b.requisites[0],"bill"))},onRecipientChanged:function(){this.ui.RCPT_NAME.val()||(this.ui.RCPT_ACCOUNT.val(""),this.fillRcptAccountsChosen())},onRecipientAccountSelected:function(a,b){this.fillRcptFields(b)},fillRcptFields:function(a){var b=this.findRcptByRequisite(a);b&&(this.ui.RCPT_ACCOUNT.trigger("refresh",{array:b.requisites,value:e.getContent(a,"bill")}),this.ui.RCPT_NAME.val(e.getContent(b,"name")))},findRcptByRequisite:function(a){if(this.recipients.length)for(var b,c=0;c<this.recipients.length;c++){b=this.recipients[c].requisites;for(var d=0;d<b.length;d++)if(b[d].id===a.id)return this.recipients[c]}},restoreQueryFields:function(){h.prototype.restoreQueryFields.apply(this,arguments);var a=this.collection.get("AMOUNT_CURRENCY");this.ui.AMOUNT_CURRENCY.trigger("choose",a?a.get("value"):k.all)},getFilterValue:function(a){return"AMOUNT_CURRENCY"===a&&this.ui[a].val()===k.all?"":h.prototype.getFilterValue.apply(this,arguments)},setDefaults:function(){this.ui.AMOUNT_CURRENCY.trigger("choose",k.all),this.fillAllRcptAccountsChosen()},highlightFoundText:function(){var a=this.collection.get("NUM_DOC");a&&g.highlightFoundText(a.get("value"),"td.number");var b=this.collection.get("client");b&&g.highlightFoundText(b.get("value"),"td.payer");var c=this.collection.get("RCPT_NAME");c&&g.highlightFoundText(c.get("value"),"td.rcpt");var d=this.collection.get("RCPT_ACCOUNT");d&&g.highlightFoundText(d.get("value"),"td.account")},updateAmountDecimals:function(a,b){this.ui[a].formatter("amount",{decimallength:b});var c=this.ui[a].getUnformattedValue();this.ui[a].val(e.changeFloatScaleWithoutRounding(c,b)).blur()}})}),define("apps/ua_intrabank_currency_payment/ua_intrabank_currency_payment_filter_view",["commons/base_object/document/document_state_filter_view","apps/ua_intrabank_currency_payment/ua_intrabank_currency_payment_ext_filter_view","i18n!apps/ua_intrabank_currency_payment/nls/ua_intrabank_currency_payment"],function(a,b,c){"use strict";return a.extend({documentTypeTitle:c.ua_intrabank_currency_payment_list,ExtFilterComponent:b})}),define("text!templates/views/document/group-filter.tmpl",[],function(){return'<div class="group-checkbox" onmousedown="return false" onselectstart="return false">\n    <div class="popup-wrapper bottom sub-menu">\n        <ul class="popup filter">\n        </ul>\n    </div>\n</div>\n\n'}),define("commons/base_object/document/group_opers_doc_list_view",["jquery","underscore","app","bifit","services/doc_statuses","actionUtils","commons/base_object/base_list_view","text!templates/views/document/group-filter.tmpl","i18n!nls/document","libs/group_opers_utils"],function(a,b,c,d,e,f,g,h,i,j){"use strict";return g.extend({events:b.extend(g.prototype.events,{"click th.check input":"markAll","click div.group-checkbox a":"markByStatus","click div.group-checkbox":"toggleFilter"}),childEvents:b.extend(g.prototype.childEvents,{markOne:"markOne"}),footerNls:null,isAccountsForCreateAction:null,initialize:function(a){g.prototype.initialize.apply(this,arguments),this.isAccountsForCreateAction=a.isAccountsForCreateAction,"false"!==d.getStorageData("is_need_deselect_selected_items")&&b.each(this.collection.selected,function(a){this.collection.deselect(a)}.bind(this)),d.setStorageData("is_need_deselect_selected_items","true")},selectItem:function(a,b){g.prototype.selectItem.call(this,a,b),d.setStorageData("is_need_deselect_selected_items","false")},onRender:function(){g.prototype.onRender.call(this),this.prepareTable()},prepareTable:function(){j.prepareTable.call(this),this.initStatusSelector(),this.postModelMark()},initStatusSelector:function(){var c=b.uniq(b.map(this.collection.models,function(a){return a.get("status")})),f=b.intersection(c,["0","1","3004"]);if(f){if(f.length>1){var g=d.getLocale(),j=a(b.template(h,i)),k=j.find("ul");b.each(f,function(b){var c=parseInt(b,10),f=d.sprintf(i.flt_st,e.getLocalizedNameById(c,g)),h="st"+b;a("<li><a data-action='"+h+"' href='#'>"+f+"</a></li>").appendTo(k)}.bind(this)),this.$("table.list").find("th.check").append(j)}}else this.$("table.list").find("th.check, td.check").hide()},toggleFilter:function(b){b.stopPropagation();var c=a(b.target).find(".sub-menu"),d=function(){c.hide(),a("div.group-checkbox").removeClass("shadow"),a(document).unbind("click.filter-sub-menu")};return"block"===c.css("display")?d():(c.show(),this.$("div.group-checkbox").addClass("shadow"),a(document).bind("click.filter-sub-menu",d)),!0},markOne:j.markOne,markAll:j.markAll,markByStatus:function(c){c.preventDefault(),this.$(".group-checkbox .sub-menu").hide(),this.$("tbody tr").removeClass("selected"),this.$("tbody tr").find("input").prop("checked",!1),this.collection.selectNone();var d=a(c.target).attr("data-action");this.$("tbody tr."+d).addClass("selected"),this.$("tbody tr.selected input").prop("checked",!0);var e=this.collection.where({status:d.substr("st".length)});b.each(e,function(a){a.select()}),this.postModelMark()},postModelMark:function(){var a=this.collection.selectedLength>0,c=this.getAvailableActions(a),d=0;a&&b.each(this.collection.selected,function(a){c=b.intersection(c,f.getPossibleActions(a)),d+=parseFloat(a.getAmount())});var e=this.collection.length===this.collection.selectedLength;this.$("th.check input")[e?"removeClass":"addClass"]("some"),this.$("th.check input").prop("checked",a),this.trigger("update-actions",this.getPermittedActions(c)),this.changeFooter(d.toFixed(2))},getAvailableActions:function(a){var b;return a?(b=[f.DocumentAction.PRINT],(c.isMultiClient()||this.isAccountsForCreateAction)&&(b=b.concat([f.DocumentAction.SIGN,f.DocumentAction.COPY,f.DocumentAction.DELETE]))):(c.isMultiClient()||this.isAccountsForCreateAction)&&(b=[f.DocumentAction.CREATE,f.DocumentAction.IMPORT]),b},getPermittedActions:function(a){for(var c=["CREATE","IMPORT","PRINT","SIGN","COPY","DELETE","CONFIRM","TOGGLE","CFC_CONFIRM","CFC_REJECT","CFC_SIGN"],d=this.getDocumentTypeForActions(),e=[],g=0;g<c.length;g++){var h=c[g],i=b.contains(a,f.DocumentAction[h])&&f.isActionPermitted(h,d);i&&e.push(h+(b.contains(["CREATE","IMPORT"],h)?"":"_GROUP"))}return e},getDocumentTypeForActions:function(){return this.collection.options.document_type},changeFooter:function(a){if(this.footerNls){var b=this.$("tfoot.summary"),c=this.collection.selectedLength;if(b.length){b[c?"show":"hide"]();var e=c%100,f="footer_5_0_docs",g="footer_selected_pl";if(11>e||e>19){var h=c%10;1===h?(f=1===c?"footer_1_doc":"footer_1_doc_pl",g="footer_selected_sin"):h>1&&5>h&&(f="footer_2_4_docs")}var i=this.footerNls,j=d.sprintf(i.footer_s_template,i[g],c,i[f],this.collection.length,a);b.find("td").html(j).trigger("footer:change",c)}}}})}),define("commons/base_object/group_opers_list_item_view",["commons/base_object/base_list_item_view"],function(a){"use strict";return a.extend({triggers:{"click td:not(.check)":"selectItem"},events:{"click td.check input":function(a){this.trigger("markOne",a)}}})}),define("text!apps/ua_intrabank_currency_payment/templates/ua_intrabank_currency_payment_list.tmpl",[],function(){return'<table class="list ua_intrabank_currency_payment" style="display: table;">\n    <thead class="widescreen">\n    <tr>\n        <th class="attach">&nbsp;</th>\n        <th class="check">\n            <input type="checkbox"/>\n            <span class="checkbox"/>\n        </th>\n        <th class="number">\n            <span class="sortable" data-field="NUM_DOC"><%- number %></span>\n        </th>\n        <th class="date">\n            <span class="sortable" data-field="DATE_DOC"><%- date %></span>\n        </th>\n        <% if (isMultiClient()) { %>\n            <th class="payer ellipsis">\n                <span class="sortable" data-field="CLN_NAME"><%= payer %></span>\n            </th>\n        <% } %>\n        <th class="account">\n            <span class="sortable" data-field="RCPT_ACCOUNT"><%- account %></span>\n        </th>\n        <th>\n            <span class="sortable" data-field="RCPT_NAME"><%- recipient %></span>\n        </th>\n        <th class="amount">\n            <span class="sortable" data-field="AMOUNT"><%- amount %></span>\n        </th>\n        <th class="currency">\n            <span class="sortable" data-field="AMOUNT_CURRENCY"><%- currency %></span>\n        </th>\n        <th class="status">\n            <span class="sortable" data-field="status_desc"><%- status %></span>\n        </th>\n    </tr>\n    </thead>\n    <tbody></tbody>\n    <tfoot class=\'summary\'>\n    <tr>\n        <td colspan="8"></td>\n    </tr>\n    </tfoot>\n</table>\n'}),define("text!apps/ua_intrabank_currency_payment/templates/ua_intrabank_currency_payment_list_item.tmpl",[],function(){return'<td class="attach widescreen">\n    <% if (ATT_CNT != "0") { %>\n        <span class="att-cnt">&nbsp;</span>\n    <% } %>\n</td>\n<td class="check widescreen"><input type=\'checkbox\'/><span class="checkbox"></span></td>\n<td class="number widescreen"><%- NUM_DOC %></td>\n<td class="date widescreen"><%- DATE_DOC %></td>\n<% if (isMultiClient()) { %>\n    <td class="payer ellipsis widescreen"><%- CLN_NAME %></td>\n<% } %>\n<td class="account widescreen"><%- RCPT_ACCOUNT %></td>\n<td class="widescreen rcpt ellipsis"><%- RCPT_NAME %></td>\n<td class="amount widescreen"><%- formatAmount(AMOUNT) %></td>\n<td class="currency widescreen"><%- AMOUNT_CURRENCY %></td>\n<td class="status widescreen"><%- status_desc %></td>\n<td class=\'mobile\'>\n    <span class=\'attaches<% if (ATT_CNT != "0") { %> att-cnt <% } %>\'>&nbsp;</span>\n    <span class=\'date\'><%- DATE_DOC %></span>\n    <span class=\'amount\'><%- formatAmount(AMOUNT) %>&nbsp;<%- AMOUNT_CURRENCY %></span>\n    <span class=\'rcpt ellipsis\'><%- RCPT_NAME %></span>\n    <span class=\'status\'><%- status_desc %></span>\n</td>\n'}),define("apps/ua_intrabank_currency_payment/ua_intrabank_currency_payment_list_view",["underscore","commons/base_object/document/group_opers_doc_list_view","commons/base_object/group_opers_list_item_view","actionUtils","text!apps/ua_intrabank_currency_payment/templates/ua_intrabank_currency_payment_list.tmpl","text!apps/ua_intrabank_currency_payment/templates/ua_intrabank_currency_payment_list_item.tmpl","i18n!apps/ua_intrabank_currency_payment/nls/ua_intrabank_currency_payment"],function(a,b,c,d,e,f,g){"use strict";return b.extend({template:a.template(e),templateHelpers:a.extend({},b.prototype.templateHelpers,g),footerNls:g,childView:c.extend({template:a.template(f)})})}),define("text!apps/ua_intrabank_currency_payment/templates/ua_intrabank_currency_payment_edit.tmpl",[],function(){return'<form>\n    <div class="grey-container">\n        <h1><%- ua_intrabank_currency_payment %></h1>\n\n        <% if (isMultiClient) { %>\n            <div class="sub-client-info"></div>\n        <% } %>\n\n        <% if (viewMode) { %>\n            <span id="status_desc" class="status-code-<%- statusCode %>"><%- status_desc %></span>\n        <% } %>\n\n    </div>\n\n    <div class="grey-container">\n        <div class="row form-group">\n            <div class="col-xs-3">\n                <label for="NUM_DOC"><%- number_doc %></label>\n                <input type="text" id="NUM_DOC" name="NUM_DOC" autocomplete="off" maxlength="10"\n                       tabindex="1" placeholder="<%- autonum %>"/>\n            </div>\n            <div class="col-xs-3 col-xs-offset-1">\n                <label for="DATE_DOC" class="date-doc"><%- date_doc %></label>\n                <div class="datepicker-container date-doc">\n                    <input type="text" id="DATE_DOC" name="DATE_DOC" class="form-control date datepicker"\n                           maxlength="10" tabindex="3" placeholder="<%- current %>"/>\n                    <span class="datepicker"></span>\n                </div>\n            </div>\n            <div class="col-xs-4 col-xs-offset-1">\n                <label for="CURRENCY_DATE" class="curr-date-label"><%- value_date %></label>\n                <div class="datepicker-container currency-date">\n                    <input type="text" id="CURRENCY_DATE" name="CURRENCY_DATE" class="form-control date datepicker"\n                           maxlength="10" tabindex="2" placeholder="<%- not_required %>"/>\n                    <span class="datepicker"></span>\n                </div>\n            </div>\n        </div>\n\n        <div class="row form-group">\n            <div class="col-xs-5 amount">\n                <label for="AMOUNT"><%- by_amount %></label>\n                <div class="row">\n                    <div class="col-xs-8">\n                        <input type="text" id="AMOUNT" name="AMOUNT" autocomplete="off" tabindex="4"/>\n                    </div>\n                    <div class="col-xs-4">\n                        <input type="text" id="AMOUNT_CURRENCY" class="currency" name="AMOUNT_CURRENCY" tabindex="5"/>\n                    </div>\n                </div>\n            </div>\n            <div class="col-xs-6 acc">\n                <label for="CLN_ACCOUNT"><%- from_account %></label>\n                <input type="text" name="CLN_ACCOUNT" id="CLN_ACCOUNT" tabindex="6"/>\n            </div>\n        </div>\n\n        <h2  class="form-group"><%- recipient %></h2>\n\n        <div class="row form-group">\n            <div class="col-xs-7 rcpt-name">\n                <input autocomplete="off" maxlength="40" type="text"\n                       name="RCPT_NAME" id="RCPT_NAME" placeholder="<%- start_entering_name %>" tabindex="7"/>\n            </div>\n            <div class="col-xs-5 add">\n                <label class="add">\n                    <input type="checkbox" class="add-rcpt"/>\n                    <span class="checkbox"></span>\n                    <%- add_to_rcpt %>\n                </label>\n            </div>\n        </div>\n\n        <div class="row form-group">\n            <div class="col-xs-4 edrpou">\n                <label for="RCPT_OKPO"><%- edrpou %></label>\n                <input class="okpo unique" type="text" name="RCPT_OKPO" id="RCPT_OKPO" autocomplete="off"\n                       maxlength="10" placeholder="<%- start_entering %>" tabindex="8"/>\n            </div>\n            <div class="col-xs-4 rcpt-acc">\n                <label for="RCPT_ACCOUNT"><%- acc %></label>\n                <input type="text" class="unique" name="RCPT_ACCOUNT" id="RCPT_ACCOUNT" autocomplete="off"\n                       maxlength="14" placeholder="<%- start_entering %>" tabindex="9"/>\n            </div>\n            <div class="col-xs-4 resident">\n                <label class="resident">\n                    <input id="RCPT_RESIDENT" type="checkbox"/>\n                    <span class="checkbox"></span>\n                    <%- resident %>\n                </label>\n            </div>\n        </div>\n\n        <div class="form-group bank">\n            <label for="RCPT_BANK_MFO"><%- bank %></label>\n            <div class="row">\n                <div class="col-xs-2">\n                    <input type="text" name="RCPT_BANK_MFO" id="RCPT_BANK_MFO" tabindex="10" placeholder="<%- mfo %>"\n                           maxlength="6" class="mfo" autocomplete="off"/>\n                </div>\n                <div class="col-xs-10">\n                    <input type="text" name="RCPT_BNK_NAME" id="RCPT_BNK_NAME" disabled="disabled"\n                           placeholder="<%- name %>" class="name wide"/>\n                </div>\n            </div>\n        </div>\n\n        <div class="form-group details">\n            <label for="PAYMENT_DETAILS"><%- details %></label>\n            <textarea class="wide" id="PAYMENT_DETAILS" name="PAYMENT_DETAILS" rows="2" tabindex="11"></textarea>\n        </div>\n\n        <div class="comission-account row">\n            <div class="col-xs-6">\n                <label for="COMISSION_ACCOUNT"><%- from_comission_account %></label>\n                <input type="text" name="COMISSION_ACCOUNT" id="COMISSION_ACCOUNT" tabindex="12"/>\n            </div>\n        </div>\n\n        <div class="attach-container container"></div>\n    </div>\n\n</form>\n<div class="document-status-bar"></div>\n<div class="comments-bar"></div>\n'}),define("styles!apps/ua_intrabank_currency_payment/css/ua_intrabank_currency_payment",[],function(){}),define("apps/ua_intrabank_currency_payment/ua_intrabank_currency_payment_item_view",["underscore","bifit","commons/base_object/document/document_item_view","text!apps/ua_intrabank_currency_payment/templates/ua_intrabank_currency_payment_edit.tmpl","i18n!apps/ua_intrabank_currency_payment/nls/ua_intrabank_currency_payment","styles!apps/ua_intrabank_currency_payment/css/ua_intrabank_currency_payment","formatter"],function(a,b,c,d,e){"use strict";return c.extend({tagName:"div",className:"doc-wrapper ua_intrabank_currency_payment",template:a.template(d),templateHelpers:e,behaviors:{AttachBehavior:{viewType:"VIEW",docType:"ua_intrabank_currency_payment",checkPermissions:!0}},ui:{addRecipient:"input.add-rcpt",rcptResident:"input#RCPT_RESIDENT"},initialize:function(a){this.hideUrgencyChoice=a.hideUrgencyChoice,this.isRcptResidentEnabled=a.isRcptResidentEnabled,this.fillUiElements(this.getUiElementsTitles())},getUiElementsTitles:function(){return["EXPENSE_TYPE","RCPT_ACCOUNT","RCPT_BNK_COUNTRY_CODE","PAYMENT_SPEED","RCPT_COUNTRY_CODE","INTERMED_BNK_BIC_TYPE"]},onShow:function(){c.prototype.onShow.call(this),this.$("#PAYMENT_DETAILS").formatter("oneline_textarea").change(),this.ui.rcptResident.prop("checked",this.isRcptResidentEnabled(this.model.get("RCPT_RESIDENT"))),this.$("#COMISSION_ACCOUNT").val(this.model.get("COMISSION_ACCOUNT")+" UAH"),this.$("#CLN_ACCOUNT").val(this.model.get("CLN_ACCOUNT")+" "+this.model.get("AMOUNT_CURRENCY")),this.hideFields()},hideFields:function(){this.ui.addRecipient.parent().hide()}})}),define("text!components/requisites_list_modal/template/requisites_list_modal_view.tmpl",[],function(){return'<div class="box requisites-list">\n    <div class="exit">&nbsp;</div>\n    <div class="title"><%- name %></div>\n    <div><%- edrpou %>: <%- inn %></div>\n\n    <table>\n        <thead>\n            <tr>\n                <th><%- account %></th>\n                <th><%- payment_details %></th>\n                <th><%- notes %></th>\n            </tr>\n        </thead>\n        <tbody></tbody>\n    </table>\n\n    <button type="button" class="exit"><%- close_link_btn %></button>\n</div>\n'}),define("text!components/requisites_list_modal/template/requisites_list_modal_row.tmpl",[],function(){return'<td class="bill"><%- bill %></td>\n<td class="comment ellipsis"><%- comment %></td>\n<td class="notes ellipsis"><%- note %></td>'}),define("components/requisites_list_modal/nls/requisites_list_modal",{root:{edrpou:"ЕГРПОУ",close_link_btn:"Закрыть",account:"счет",payment_details:"Назначение платежа",notes:"примечание"},uk:!0,en:!0}),define("components/requisites_list_modal/nls/uk/requisites_list_modal",{edrpou:"ЄДРПОУ",close_link_btn:"Закрити",account:"рахунок",payment_details:"Призначення платежу",notes:"примітка"}),define("components/requisites_list_modal/nls/en/requisites_list_modal",{edrpou:"EDRPOU",close_link_btn:"Close",account:"account",payment_details:"Payment details",notes:"notes"}),define("components/requisites_list_modal/requisites_list_modal_view",["underscore","backbone","marionette","dialogUtils","text!components/requisites_list_modal/template/requisites_list_modal_view.tmpl","text!components/requisites_list_modal/template/requisites_list_modal_row.tmpl","i18n!components/requisites_list_modal/nls/requisites_list_modal"],function(a,b,c,d,e,f,g){"use strict";var h=c.ItemView.extend({tagName:"tr",template:a.template(f),triggers:{click:"selectRequisites"}});return c.CompositeView.extend({template:a.template(e),templateHelpers:g,childView:h,childViewContainer:"tbody",childEvents:{selectRequisites:"selectRequisites"},events:{"click .exit":"destroy"},initialize:function(c){this.recipient=c.recipient,this.templateHelpers=a.extend({},this.templateHelpers,{inn:this.recipient.inn,name:this.recipient.name}),this.collection=new b.Collection(this.recipient.requisites)},onRender:function(){this.$el.addClass("show")},selectRequisites:function(a){var b={bic:a.model.get("bic"),bill:a.model.get("bill"),comment:a.model.get("comment")};this.trigger("recipient_requisites:choose",b),this.destroy()}})}),define("apps/ua_intrabank_currency_payment/ua_intrabank_currency_payment_item_edit",["jquery","underscore","backbone","bifit","dialogUtils","appsPieces","customConstants","components/requisites_list_modal/requisites_list_modal_view","commons/base_object/document/document_item_edit","text!apps/ua_intrabank_currency_payment/templates/ua_intrabank_currency_payment_edit.tmpl","i18n!apps/ua_intrabank_currency_payment/nls/ua_intrabank_currency_payment","formatter","chosen"],function(a,b,c,d,e,f,g,h,i,j,k){"use strict";return i.extend({id:"edit",className:"doc-wrapper ua_intrabank_currency_payment",template:b.template(j),templateHelpers:k,behaviors:{AttachBehavior:{viewType:"EDIT",docType:"ua_intrabank_currency_payment",checkPermissions:!0}},ui:{dateFields:"input.date",selectBoxes:"input.select-box",addRecipient:"input.add-rcpt",addLabel:"label.add",rcptResident:"input#RCPT_RESIDENT"},events:{"change input[type=text]":"onChangeField","change textarea":"onChangeField","chosen:select #CLN_ACCOUNT":"onChangeClientAccount","chosen:select #AMOUNT_CURRENCY":"onChangeAmountCurrency","chosen:select #COMISSION_ACCOUNT":"onChangeComissionAccount","chosen:select #RCPT_BANK_MFO":"onChangeMfo","change #RCPT_RESIDENT":"onChangeRcptResident","keyup #RCPT_ACCOUNT":"onInputRcptAccount","keyup #RCPT_OKPO":"onInputRcptOkpo","change input.unique":"toggleAddLabel","blur input.unique":"toggleAddLabel","hide #DATE_DOC":"onBlurDate","blur #DATE_DOC":"onBlurDate","hide #CURRENCY_DATE":"onBlurDate","blur #CURRENCY_DATE":"onBlurDate"},initialize:function(a){this.banks=a.banks,this.currencies=a.currencies,this.refFields=a.refFields,this.getMfo=a.getMfo,this.recipientList=a.recipientList,this.isRcptResidentEnabled=a.isRcptResidentEnabled,this.getRcptResidentValue=a.getRcptResidentValue,this.fillUiElements(this.getUiElementsTitles()),this.accounts=f.addAccountTypeDescription(a.accounts)},getUiElementsTitles:function(){return["AMOUNT","CLN_ACCOUNT","AMOUNT_CURRENCY","RCPT_BANK_MFO","RCPT_BNK_NAME","RCPT_OKPO","RCPT_NAME","RCPT_ACCOUNT","PAYMENT_DETAILS","COMISSION_ACCOUNT","DATE_DOC","CURRENCY_DATE"].concat(this.refFields)},onShow:function(){i.prototype.onShow.call(this,arguments),this.initAccountsChosen(),this.initComissionAccountsChosen(),this.initMfoChosen(),this.addFormatters(),this.fillCurrencyList(),this.fillList(this.ui.RCPT_NAME,"name",40),this.fillList(this.ui.RCPT_OKPO,"inn",10),this._fillRecipientAccountsList(),this.ui.rcptResident.prop("checked",this.isRcptResidentEnabled(this.model.get("RCPT_RESIDENT"))),this.ui.dateFields.formatter("date"),d.datePicker(a("input.datepicker"),{orientation:"bottom auto"})},onBeforeDestroy:function(){this.ui.selectBoxes.disposeChosen()},initComissionAccountsChosen:function(){this.ui.COMISSION_ACCOUNT.chosen({accType:!0,searchable:!1,data:{array:[],id:"account_id",text:["account","currency"]}})},initAccountsChosen:function(){this.ui.CLN_ACCOUNT.chosen({width:"9em",accType:!0,searchable:!1,data:{array:this.accounts,id:"account_id",text:["account","currency"]}})},initMfoChosen:function(){this.ui.RCPT_BANK_MFO.chosen({width:"6em",searchable:!1,data:{array:this.banks,id:"bik",text:"bik"}})},addFormatters:function(){this.ui.AMOUNT.formatter("amount"),this.ui.RCPT_BANK_MFO.formatter("number"),this.ui.RCPT_OKPO.formatter("number"),this.ui.RCPT_ACCOUNT.formatter("number"),this.ui.PAYMENT_DETAILS.formatter("oneline_textarea",{maxlength:160}).change()},fillCurrencyList:function(){var a=b.without(b.keys(this.accounts),"UAH");if(0===a.length)throw k.no_cur_accs;a.sort(),this.ui.AMOUNT_CURRENCY.chosen({width:"4em",searchable:!1,data:{array:a}}),this.onChangeAmountCurrency(null,this.ui.AMOUNT_CURRENCY.val())},fillBankInfo:function(a,c,d){var e=this.getMfo(a);e&&e.done(function(e){this.$("#"+c).val(e[0]?e[0].name:""),this.model.set(c,e[0]?e[0].name:"");var f=b.findWhere(this.banks,{bik:a});this.model.set("RCPT_BNK_ADDR",f?f.address:""),"RCPT_BNK_NAME"===c&&this.validateField("RCPT_BANK_MFO",this.ui.RCPT_BANK_MFO.val()),i.prototype.onChangeField.call(this,d,a)}.bind(this))},onChangeMfo:function(a,c){b.findWhere(this.banks,{bik:c.bik})?(this.fillBankInfo(c.bik,"RCPT_BNK_NAME",a),this.ui.RCPT_ACCOUNT.val().length>0&&this.validateField(this.ui.RCPT_ACCOUNT[0].id,this.ui.RCPT_ACCOUNT.val())):this.validateField("RCPT_BANK_MFO",c.bik)},onChangeClientAccount:function(a,c){var e=b.findWhere(this.banks,{bik:c.mfo});this.model.set({CLN_ACCOUNT:c.account,CLN_BANK_MFO:c.mfo,AMOUNT_CURRENCY:c.currency,CLN_BNK_NAME:e.name,CLN_BNK_ADDR:e.address},{silent:!0}),d.setStorageDocData("ua_intrabank_currency_payment_cln_account",c.account_id),this.refreshComissionAccounts(c.mfo)},refreshComissionAccounts:function(a){var e=this.ui.COMISSION_ACCOUNT.val();e||(e=d.getStorageDocData("ua_intrabank_currency_payment_comission_account"));var f=b.filter(this.accounts.UAH,function(b){return b.mfo===a&&"1"===b.type});this.ui.COMISSION_ACCOUNT.trigger("refresh",{array:f}),this.ui.COMISSION_ACCOUNT.trigger("chooseById",(b.findWhere(f,{account:e})||f[0]||{}).account_id),b.isEmpty(f)?c.Validation.invalidField(null,"COMISSION_ACCOUNT",d.sprintf(k.not_ua_acount_for_mfo,a)):c.Validation.callbacks.valid(null,"COMISSION_ACCOUNT")},onChangeAmountCurrency:function(a,c){this.refreshAccounts(c),this.currencies.done(function(a){var e=b.findWhere(a,{currency:c});d.setStorageDocData("ua_intrabank_currency_payment_amount_currency",e.currency),this.ui.AMOUNT.formatter("amount",{decimallength:e.decimals}),this.ui.AMOUNT.attr("placeholder",d.formatAmount("0",{decimallength:e.decimals}));var f=parseFloat(this.ui.AMOUNT.getUnformattedValue());!isNaN(f)&&f&&this.ui.AMOUNT.val(f.toFixed(e.decimals)).trigger("paste")}.bind(this))},onChangeRcptResident:function(){var a=this.ui.rcptResident.prop("checked");this.model.set("RCPT_RESIDENT",this.getRcptResidentValue(a))},onChangeComissionAccount:function(a,b){this.model.set("COMISSION_ACCOUNT",b.account),this.validateField("COMISSION_ACCOUNT",b.account),d.setStorageDocData("ua_intrabank_currency_payment_comission_account",b.account)},onInputRcptAccount:function(a){this.onInput("bill",a.target.value,5)},onInputRcptOkpo:function(a){this.onInput("inn",a.target.value,8)},refreshAccounts:function(a){var e=this.accounts[a];if(e){var f=1===e.length?e[0]:b.findWhere(e,{account:this.ui.CLN_ACCOUNT.val()});f=f||(e.length>0?e[0]:{}),this.ui.CLN_ACCOUNT.trigger("refresh",{array:e}),this.ui.CLN_ACCOUNT.trigger("chooseById",f.account_id||""),this.ui.CLN_ACCOUNT.attr("disabled",1===e.length),c.Validation.callbacks.valid(null,"CLN_ACCOUNT")}else this.ui.CLN_ACCOUNT.trigger("refresh",{array:[]}),c.Validation.invalidField(null,"CLN_ACCOUNT",d.sprintf(k.not_acount_for_cur))},toggleAddLabel:function(){var a=this.ui.RCPT_OKPO.val(),c=this.ui.RCPT_ACCOUNT.val(),e=this.ui.RCPT_BANK_MFO.val();e&&a&&c?this.recipientList.done(function(f){var g=b.find(f,function(f){var g=d.getContent(f,"inn");return g===a&&b.findWhere(f.requisites,{bill:c})&&b.findWhere(f.requisites,{bic:e})});g?(this.ui.addLabel.hide(),this.ui.addRecipient.removeAttr("checked")):this.ui.addLabel.show()}.bind(this)):(this.ui.addLabel.hide(),this.ui.addRecipient.removeAttr("checked"))},fillList:function(a,c,d){a.chosen({data:{array:[],id:"id",text:c},maxLength:d}),this.recipientList.done(function(c){var d=a.val(),e=b.clone(c);a.trigger("refresh",{array:b.isArray(e)?b.sortBy(e,"name"):[e],value:d}),a.bind("chosen:select",function(a,b){this._onChooseRcptField(e,b)}.bind(this)),a.val(d).change(),this.createFromRecipients(),this.toggleAddLabel()}.bind(this))},_fillRecipientAccountsList:function(){this.recipientList.done(function(a){b.each(a,function(a){b.each(a.requisites,function(b){b.idd=a.idd})});var c=this.ui.RCPT_ACCOUNT.val(),d=this._filterRecipients(a),e=this._getAllRequisites(d),f={
data:{array:e,id:"id",text:"bill",value:c},maxLength:14};this.ui.RCPT_ACCOUNT.chosen(f),this.ui.RCPT_ACCOUNT.bind("chosen:select",function(c,d){var e=b.findWhere(a,{idd:d.idd});this._onChooseRcptField(a,e)}.bind(this)),this.ui.RCPT_ACCOUNT.val(c).change()}.bind(this))},_onChooseRcptField:function(a,c){c.requisites.length>1?this._showRequisitesListModal(c,a):this.fillFields({recipient:b.extend(c,c.requisites[0]),recipients:a})},_filterRecipients:function(a){var c=this.model.get("RCPT_OKPO")||this.model.get("PAYER_OKPO");return c?b.findWhere(a,{inn:c,name:this.model.get("RCPT_NAME")})||[]:b.clone(a)},_getAllRequisites:function(a){var c=b.isArray(a)?b.map(a,function(a){return a.requisites}):a.requisites;return b.flatten(c)},_showRequisitesListModal:function(a,c){var d={el:e.wrapper(),recipient:a},f=new h(d);f.render(),f.once("recipient_requisites:choose",function(d){this.fillFields({recipient:b.extend(a,d),recipients:c})}.bind(this))},fillFields:function(a){var b=a.recipient;this.ui.RCPT_ACCOUNT.val(d.getContent(b,"bill")),this.ui.RCPT_NAME.val(d.getContent(b,"name")).change(),this.ui.RCPT_OKPO.val(d.getContent(b,"inn")).change(),this.ui.RCPT_BANK_MFO.trigger("chooseById",d.getContent(b,"bic")),b.comment=this.getCorrectPaymentDetailsOld(b.comment);var c=d.getContent(b,"comment");this.ui.PAYMENT_DETAILS.val(c).change(),this.ui.RCPT_ACCOUNT.trigger("refresh",{array:b.requisites,value:this.ui.RCPT_ACCOUNT.val()}),this.ui.RCPT_OKPO.trigger("refresh",{array:[b],value:this.ui.RCPT_OKPO.val()})},onInput:function(a,c,e){c.length>=e&&this.recipientList.done(function(e){var f=b.filter(e,function(b){return d.getContent(b,a)===c});1===f.length&&this._onChooseRcptField(e,f[0])}.bind(this))},createFromRecipients:function(){var a=sessionStorage.getItem("rcpt_id");a&&(this.ui.RCPT_NAME.trigger("chooseById",a),sessionStorage.removeItem("rcpt_id"))},onChangeField:function(a){var c=a.target.id;if(-1===c.indexOf("COMISSION_ACCOUNT")&&-1===c.indexOf("CLN_ACCOUNT")){if(-1===c.indexOf("BANK_MFO")&&-1===c.indexOf("DATE")){var e={AMOUNT:d.getAmountConverterRule(4)},f=[""],g=d.convertByRules(a,e,f,this.model);i.prototype.onChangeField.call(this,a,g)}else this.ui.RCPT_ACCOUNT.val().length>0&&(this.ui.RCPT_ACCOUNT.change(),this.validateField(this.ui.RCPT_ACCOUNT[0].id,this.ui.RCPT_ACCOUNT.val()));var h=["RCPT_NAME","RCPT_OKPO","RCPT_ACCOUNT"];-1!==b.indexOf(h,c)&&(this.ui.RCPT_NAME.val()||this.ui.RCPT_OKPO.val()||this.ui.RCPT_ACCOUNT.val()||this.recipientList.done(function(a){this.ui.RCPT_OKPO.trigger("refresh",{array:a,value:this.ui.RCPT_OKPO.val()}),this.ui.RCPT_ACCOUNT.trigger("refresh",{array:this._getAllRequisites(a),value:this.ui.RCPT_ACCOUNT.val()})}.bind(this)))}},onBlurDate:function(a){var b=a.target.id;""===this.ui[b].val().replace(/\s+/g,"").replace(/\./g,"")&&this.ui[b].val(""),this.validateField(b,this.ui[b].val())},getCorrectPaymentDetailsOld:function(a){return a.length>g.PAYMENT_DETAILS_LENGTH?a.slice(0,g.PAYMENT_DETAILS_LENGTH):a}})}),define("commons/base_object/document/document_print_processor",["jquery","underscore","bifit","printUtils"],function(a,b,c,d){"use strict";function e(b,c,d,e,f){this.form=b,this.$mainElement=a(b[0].querySelector("section.main").querySelector("article.main")),this.$printButton=a(b[0].querySelector("button.print.to-printer")),this.$printPdfButton=a(b[0].querySelector("button.print.to-pdf")),this.printStyle=d,this.pdfTemplate=e,this.documentType=c,this.modelStatus=f,this.printPromises=[]}return e.prototype.run=function(c){a(this.form[0].querySelector("#doc-div")).remove(),this.$mainElement.append('<style type="text/css">'+this.printStyle+"</style>"),this.$printPdfButton.parent().show(),d.spinBtn(this.$printButton),d.spinBtn(this.$printPdfButton),d.createLeftMenu(c,this.form).then(function(){var e=this.form.find("input[type=checkbox]");e.prop("disabled",!0),this.renderDocument(c[0],this.$mainElement);var f=!b.contains(["pay_sheet","assign_card_order","fire_staff_order","card_prolongation"],this.documentType);setTimeout(function(){a.when.apply(a,this.printPromises).then(function(){for(var b=f?this.$mainElement.clone(!0):this.$mainElement,g=1;g<c.length;g++)this.renderDocument(c[g],b);a.when.apply(a,this.printPromises).always(function(){f&&(this.$mainElement[0].innerHTML=b[0].innerHTML),e.prop("disabled",!1),d.stopBtn(this.$printButton),d.stopBtn(this.$printPdfButton)}.bind(this))}.bind(this))}.bind(this),300),this.addPrintPdfButtonHandler()}.bind(this))},e.prototype.renderDocument=function(){throw new Error("renderDocument is not implemented")},e.prototype.addPrintPdfButtonHandler=function(){this.$printPdfButton.bind("click",function(){var b=this.documentType+".pdf",e=this.prepareDocumentForPdf(this.$mainElement.clone(!0));a.ajax({type:"POST",url:localStorage.getItem("addr")+"/print_to_pdf;jsessionid="+c.getStoredItem("JSESSIONID"),contentType:"application/x-www-form-urlencoded; charset=UTF-8",mimeType:"text/plain; charset=x-user-defined",data:{html:this.getHtmlForPdf(e),fileName:b,stampAbsolutePosition:!0},success:function(a){d.createPdfFile(a,b,this.form[0])}.bind(this)})}.bind(this))},e.prototype.getHtmlForPdf=function(a){var c={"<br>":"<br/>",'"':'"',"<hr>":"<hr/>"};return b.template(this.pdfTemplate,{content_for_pdf:a[0].outerHTML}).replace(/<br>|"|<hr>/gi,function(a){return c[a]})},e.prototype.prepareDocumentForPdf=function(c){c.find("style").remove(),c.find("h1.empty").remove(),c.find(".hidden").remove(),c.find("colgroup").remove(),this.form.find("#ecp_owner").is(":checked")||c.find(".sign1, .sign2").children().remove(),this.form.find("#service_info").is(":checked")||0===c.find(".serv-info-table")||c.find(".serv-info-table").remove(),b.contains(["ua_payment","ua_payment_request","bank_ua_payment_request"],this.documentType)&&(this.form.find("#two_copies").is(":checked")||0===c.find(".doc-div-copied")||c.find(".doc-div-copied").remove());var d=c.find(".for-img img").parent();return d.empty(),this.form.find("#bank_stamp").is(":checked")&&d.each(function(){var b=a(this);b.append("<"+b.attr("data-stamp-name")+"/>")}),c},e}),define("text!apps/ua_intrabank_currency_payment/templates/ua_intrabank_currency_payment_print.tmpl",[],function(){return'<div class="main">\n    <div class="onright font10">Примірник N</div>\n\n    <table>\n        <tbody>\n        <tr>\n            <td class="number"></td>\n            <td class="centered w78 font10">\n                Платіжне доручення в іноземній валюті N <%- NUM_DOC %>\n            </td>\n            <td class="number border font10">\n                0410001\n            </td>\n        </tr>\n        <tr>\n            <td colspan="3" class="centered font10">\n                від <%- DATE_DOC %> року\n            </td>\n        </tr>\n        </tbody>\n    </table>\n\n    <div class="table">\n        <table>\n            <tbody>\n            <tr>\n                <td class="verticalB" rowspan="2" width="24%">\n                    <span class="font10">52. Банк Платника:<br/><br/></span>\n\n                    <div class="font7 verticalB">Назва</div>\n                </td>\n                <td rowspan="2" class="font7 verticalB" width="29%"><%- CLN_BNK_NAME %></td>\n                <td class="font8 verticalT" colspan="4">Рахунок в <%- CLN_BNK_NAME %></td>\n            </tr>\n            <tr>\n                <td class="font7" colspan="4"><%- CLN_ACCOUNT %></td>\n            </tr>\n            <tr>\n                <td class="font7">МФО</td>\n                <td class="font7"><%- CLN_BANK_MFO %></td>\n                <td class="verticalT font7" width="11%" rowspan="2">Код операції</td>\n                <td width="11%" rowspan="2"></td>\n                <td class="verticalT font7" width="11%" rowspan="2">Код країна бенефіціара</td>\n                <td width="9%" rowspan="2"><%- RCPT_COUNTRY_CODE %></td>\n            </tr>\n            <tr>\n                <td class="font7">Адреса</td>\n                <td class="font7"><%- CLN_BNK_ADDR %></td>\n            </tr>\n            </tbody>\n        </table>\n        <div class="padB4"></div>\n        <table>\n            <tbody>\n            <tr>\n                <td class="font7 padL30" width="18%">Сума цифрами</td>\n                <td class="font7 padL30" width="35%">Сума прописом</td>\n                <td class="font7 verticalT" width="8%" rowspan="2">Цифр. код валюти</td>\n                <td id="currency-code" class="font7 verticalT" width="6%" rowspan="2"></td>\n                <td class="font7 verticalT" width="7%" rowspan="2">Валюта платежу</td>\n                <td class="font7 verticalT" width="6%" rowspan="2"><%- AMOUNT_CURRENCY %></td>\n                <td class="font7 verticalT" width="10%" rowspan="2">Дата валютування</td>\n                <td class="font7 verticalT" width="10%" rowspan="2"><%- CURRENCY_DATE %></td>\n            </tr>\n            <tr>\n                <td id="amount" class="font7 centered"></td>\n                <td class="font7" id="words-amount"></td>\n            </tr>\n            </tbody>\n        </table>\n        <div class="padB4"></div>\n        <table>\n            <tbody>\n            <tr>\n                <td class="font10" width="28%">50: Платник:</td>\n                <td class="font7 padL10" rowspan="2" width="24%"><%- CLN_NAME %></td>\n                <td width="48%" rowspan="3" colspan="2"></td>\n            </tr>\n            <tr>\n                <td class="font7">Назва (для юридичних осіб)</td>\n            </tr>\n            <tr>\n                <td class="font7">Резидентність</td>\n                <td class="font7 padL10" id="cln_resident"></td>\n            </tr>\n            <tr>\n                <td class="font7" width="28%">Код ЄДРПОУ (для фізичних осіб - ідентифікаційний номер платника\n                    податків)\n                </td>\n                <td class="font7 padL10"><%- CLN_OKPO %></td>\n                <td class="font7" width="26%">П.І.Б працівника, уповноваженого вирішувати питання за угодою</td>\n                <td width="22%"></td>\n            </tr>\n            <tr>\n                <td class="font7">Адреса платника (країна, місто)</td>\n                <td class="font7 padL10 wb"><%- CLN_COUNTRY ? CLN_COUNTRY + \',\' : \'\' %> <br> <%- CLN_ADDR %></td>\n                <td class="font7" width="26%">Телефон</td>\n                <td width="22%"></td>\n            </tr>\n            </tbody>\n        </table>\n        <div class="padB4"></div>\n        <table>\n            <tbody>\n            <tr>\n                <td width="28%" class="font10 padB0 borderR0 borderB0" valign="top">\n                    <div>56: Банк Посередник:<br/></div>\n                </td>\n                <td width="72%" class="inner-table" style="height: 10px; padding: 0px !important;">\n                    <table class="borderT0" style="height: 100%;">\n                        <tbody>\n                        <tr>\n                            <td width="17%" class="font7 padL10 borderB0">\n                                SWIFT (BIC)\n                            </td>\n                            <td width="16%" class="borderB0"></td>\n                            <td width="25%" class="font7 verticalT borderB0">\n                                Тип клірингового коду<br/>(FW, BL, SC, AT)\n                            </td>\n                            <td width="7%" class="borderB0"></td>\n                            <td width="18%" class="font7 verticalT borderB0">Кліринговий код</td>\n                            <td width="17%" class="borderB0 borderR0"></td>\n                        </tr>\n                        </tbody>\n                    </table>\n                </td>\n            </tr>\n            <tr>\n                <td class="borderR0">\n                    <div class="font7 padT5">\n                        (Це поле заповнюється за умови<br/> наявності інформації про банк<br/> посередник)<br/>\n                    </div>\n                    <div class="font7 padT5">\n                        (Вказується назва та адреса банку посередника)\n                    </div>\n                </td>\n                <td width="72%"></td>\n            </tr>\n            </tbody>\n        </table>\n\n        <div class="padB4"></div>\n\n        <table>\n            <tbody>\n            <tr>\n                <td width="28%" rowspan="3" class="font10" style="vertical-align: bottom;">\n                    <div>57: Банк Бенефіціара:<br/></div>\n                    <div class="font7 centered"><br/>(отримувача)</div>\n                    <div class="font7"><br/>(Вказується назва та адреса банку<br/> отримувача)<br/>(країна, місто)</div>\n                </td>\n                <td width="24%" colspan="2" class="font7 padL10">\n                    Рахунок банка отримувача у <br/> банку кореспонденті\n                </td>\n                <td width="48%" colspan="4"></td>\n            </tr>\n            <tr>\n                <td width="12%" class="font7 padL10">МФО</td>\n                <td width="12%" class="font7"><%- RCPT_BANK_MFO %></td>\n                <td width="15%" class="font7">Тип клірингового коду<br/>(FW, BL, SC, AT)</td>\n                <td width="7%"></td>\n                <td width="13%" class="font7">Кліринговий код</td>\n                <td width="13%"></td>\n            </tr>\n            <tr>\n                <td width="72%" colspan="6" class="font7"><%- RCPT_BNK_NAME %><br><%- RCPT_BNK_ADDR %></td>\n            </tr>\n            </tbody>\n        </table>\n\n        <div class="padB4"></div>\n\n        <table>\n            <tbody>\n            <tr>\n                <td width="28%" rowspan="3" class="font10" valign="top">\n                    <div>59: Бенефіціар:</div>\n                    <div class="font7 centered"><br/>(отримувач)</div>\n                </td>\n                <td width="24%" class="font7 padL10">\n                    Рахунок отримувача в банку отримувача\n                </td>\n                <td width="48%" class="font7" colspan="3"><%- RCPT_ACCOUNT %></td>\n            </tr>\n            <tr>\n                <td width="24%" class="font7 padL10">IBAN</td>\n                <td width="18%" class="font7"></td>\n                <td width="18%" class="font7">Резидентність</td>\n                <td width="12%" class="font7" id="rcpt_resident"></td>\n            </tr>\n            <tr>\n                <td width="24%" class="font7 padL10">ІПН <br/>(Ідентифікаційний податковий номер)</td>\n                <td width="18%" class="font7"><%- RCPT_OKPO %></td>\n                <td width="18%" class="font7">КПП <br/> (Код причини постановки на облік)</td>\n                <td width="12%" class="font7"></td>\n            </tr>\n            <tr>\n                <td width="28%">\n                    <div class="font7">(Вказується назва та адреса банку<br/> отримувача)<br/>(країна, місто)</div>\n                </td>\n                <td colspan="4" class="font7"><%- RCPT_NAME %></td>\n            </tr>\n            <tr>\n                <td width="28%" class="font7">\n                    Код ЄДРПОУ (для фізичних осіб - ідентифікаційний номер платника податків)\n                </td>\n                <td colspan="4"></td>\n            </tr>\n            </tbody>\n        </table>\n\n        <div class="padB4"></div>\n\n        <table class="details">\n            <tbody>\n            <tr>\n                <td class="font10 borderR0 borderB0" valign="top" width="28%">\n                    70. Призначення платежу*:\n                </td>\n                <td colspan="2" class="borderB0" width="72%">\n                    <div class="padL10 font7"><%- PAYMENT_DETAILS %></div>\n                </td>\n            </tr>\n            <tr>\n                <td colspan="2" class="borderR0">\n                    <div class="font7">\n                        (Вказується документ, на основі<br/>\n                        якого здійснюється платіж)<br/><br/>\n                        Для фізичних осіб, які не є суб\'єктами підприємницької діяльності:<br/>\n                        "Операція не пов\'язана із здійсненням підприємницької діяльності"\n                    </div>\n                </td>\n                <td style="vertical-align: bottom">\n                    <div class="font7">\n                        Підпис платника ___________\n                    </div>\n                </td>\n            </tr>\n            </tbody>\n        </table>\n\n        <div class="padB4"></div>\n\n        <table>\n            <tbody>\n            <tr>\n                <td class="font10" valign="top" rowspan="2" width="15%">\n                    71. Комісії:\n                </td>\n                <td class="font10 borderR0" width="35%">За рахунок платника(OUR)</td>\n                <td width="55%"></td>\n            </tr>\n            <tr>\n                <td class="font7 borderR0">рахунок <%- COMISSION_ACCOUNT %></td>\n                <td class="font7">МФО <%- CLN_BANK_MFO %></td>\n            </tr>\n            </tbody>\n        </table>\n\n        <div class="padB4"></div>\n\n        <table>\n            <tbody>\n            <tr>\n                <td class="font10" width="35%">\n                    72. Додаткова інформація (інше):\n                </td>\n                <td width="65%"></td>\n            </tr>\n            </tbody>\n        </table>\n\n        <div class="padB4"></div>\n\n        <table>\n            <tbody>\n            <tr>\n                <td class="font10 borderR0 centered" width="15%" style="vertical-align: middle">\n                    М.П.\n                </td>\n                <td class="font7" width="85%">\n                    Контактний телефон платника<br/><br/>\n                    Директор &nbsp;&nbsp;<span class="sign1"></span><br/>\n                    Головний бухгалтер &nbsp;&nbsp;<span class="sign2"></span><br/>\n                    Підпис платника для фізичних осіб\n                </td>\n            </tr>\n            </tbody>\n        </table>\n\n        <div class="padB4"></div>\n\n        <table>\n            <tbody>\n            <tr>\n                <td class="font10 centered">\n                    <div class="padB15">Відмітки банку</div>\n                </td>\n            </tr>\n            </tbody>\n        </table>\n        <div class="font7">\n            *В призначенні платежу обов\'язково вказувати : для торгівельних операцій - вид товарів чи <br/>\n            послуг, для решти платежів - чітко визначити їх призначення\n        </div>\n\n        <div class="for-service-info" style="float: left"></div>\n    </div>\n</div>\n<div class="for-img" style="float: right"></div>'}),define("text!apps/ua_intrabank_currency_payment/templates/ua_intrabank_currency_payment_print_pdf.tmpl",[],function(){return"<html>\n<head>\n    <style>\n        .ua_intrabank_currency_payment {\n            font-family: 'Times Roman', 'Times New Roman', Georgia, serif;\n        }\n\n        div.doc-div {\n            page-break-after: always;\n        }\n\n        .serv-info-table {\n            width: 65%;\n            font-size: 8pt !important;\n            font-weight: 600;\n            padding: 5px;\n        }\n\n        .serv-info-table td {\n            padding: 5px;\n        }\n\n        td {\n            line-height: 1;\n        }\n\n        table {\n            width: 100%;\n            border-spacing: 0;\n        }\n\n        div.main {\n            height: 1000px;\n        }\n\n        table td.inner-table {\n            vertical-align: text-top;\n            height: 10mm;\n        }\n\n        .table table, .serv-info-table {\n            border-collapse: collapse;\n            border-spacing: 0;\n            border-top: 1px solid black;\n            border-left: 1px solid black;\n        }\n\n        .table td, .serv-info-table td {\n            border-collapse: collapse;\n            border-spacing: 0;\n            border-right: 1px solid black;\n            border-bottom: 1px solid black;\n        }\n\n        .table td {\n            padding: 3px;\n        }\n\n        div.ua_intrabank_currency_payment .font8 {\n            font-size: 8pt;\n        }\n\n        div.ua_intrabank_currency_payment .font10 {\n            font-size: 10pt;\n        }\n\n        div.ua_intrabank_currency_payment .font7,\n        div.ua_intrabank_currency_payment .sign-subj-name {\n            font-size: 7pt;\n        }\n\n        div.ua_intrabank_currency_payment .borderR0 {\n            border-right-width: 0;\n        }\n\n        div.ua_intrabank_currency_payment .borderB0 {\n            border-bottom-width: 0;\n        }\n\n        div.ua_intrabank_currency_payment .borderT0 {\n            border-top-width: 0;\n        }\n\n        .table .padL30 {\n            padding-left: 30px;\n        }\n\n        .table .padL10 {\n            padding-left: 10px;\n        }\n\n        .padB4 {\n            padding-bottom: 4px;\n        }\n\n        .padB15 {\n            padding-bottom: 15px;\n        }\n\n        .padT5 {\n            padding-top: 5px;\n        }\n\n        .verticalB {\n            vertical-align: text-bottom;\n        }\n\n        .verticalT {\n            vertical-align: text-top;\n        }\n\n        .wb {\n            word-break: break-all;\n        }\n\n        .w78 {\n            width: 78%;\n        }\n\n        .number {\n            text-align: center;\n            padding-top: 5px;\n            padding-bottom: 5px;\n            width: 11%;\n        }\n\n        .onright {\n            text-align: right;\n        }\n\n        .centered {\n            text-align: center;\n        }\n\n        .border {\n            border: solid 1px #000000;\n        }\n    </style>\n</head>\n<body>\n    <%= content_for_pdf %>\n</body>\n</html>\n\n"}),define("text!apps/ua_intrabank_currency_payment/css/ua_intrabank_currency_payment_print.css",[],function(){return".table table,.serv-info-table{\nborder-collapse:collapse;\nborder-spacing:0;\nborder-top:1px solid black;\nborder-left:1px solid black;\n}\n.table td,.serv-info-table td{\nborder-collapse:collapse;\nborder-spacing:0;\nborder-right:1px solid black;\nborder-bottom:1px solid black;\n}\n.table td{\npadding:3px !important;\n}\nsection.doc-print div.ua_intrabank_currency_payment div.for-img{\nmargin-top:145px;\n}\nsection.doc-print div.doc-div.ua_intrabank_currency_payment{\npadding:5mm 10mm 5mm 10mm;\n}\ndiv.ua_intrabank_currency_payment .font8{\nfont-size:8pt;\n}\ndiv.ua_intrabank_currency_payment .font10{\nfont-size:10pt;\n}\ndiv.ua_intrabank_currency_payment .font7{\nfont-size:7pt;\n}\ndiv.ua_intrabank_currency_payment .sign-subj-name{\nfont-size:7pt;\n}\ndiv.ua_intrabank_currency_payment .borderR0{\nborder-right-width:0px;\n}\ndiv.ua_intrabank_currency_payment .borderB0{\nborder-bottom-width:0px;\n}\ndiv.ua_intrabank_currency_payment .borderT0{\nborder-top-width:0px;\n}\n.table .padL30{\npadding-left:30px !important;\n}\n.table .padL10{\npadding-left:10px !important;\n}\n.padB4{\npadding-bottom:4px !important;\n}\n.padB15{\npadding-bottom:15px !important;\n}\n.padB0{\npadding-bottom:0px !important;\n}\n.wb{\nword-break:break-all;\n}\n.padT5{\npadding-top:5px !important;\n}\n.number{\ntext-align:center;\npadding-top:5px !important;\npadding-bottom:5px !important;\nwidth:11%;\n}\n.onright{\ntext-align:right;\n}\n.centered{\ntext-align:center;\n}\n.verticalB{\nvertical-align:text-bottom;\n}\n.verticalT{\nvertical-align:text-top;\n}\ntd.inner-table{\nvertical-align:top;\n}\ntable{\nwidth:100%;\nborder-collapse:collapse;\nborder-spacing:0;\n}\n.w78{\nwidth:78%;\n}\n.border{\nborder:solid 1px #000000;\n}\n"}),define("apps/ua_intrabank_currency_payment/ua_intrabank_currency_payment_print",["jquery","underscore","bifit","collections/thesaurus","printUtils","appsPieces","commons/base_object/document/document_print_processor","text!apps/ua_intrabank_currency_payment/templates/ua_intrabank_currency_payment_print.tmpl","text!apps/ua_intrabank_currency_payment/templates/ua_intrabank_currency_payment_print_pdf.tmpl","text!apps/ua_intrabank_currency_payment/css/ua_intrabank_currency_payment_print.css"],function(a,b,c,d,e,f,g,h,i,j){"use strict";function k(a,b){g.call(this,a,b,j,i)}return k.prototype=Object.create(g.prototype),k.prototype.constructor=k,k.prototype.renderDocument=function(a,d){d.append('<div id="doc-div-'+a.id+'" class="doc-div"></div>');var g=d[0].querySelector("#doc-div-"+a.id);g.className=g.className+" "+a.type,g.innerHTML=b.template(h)(a.toJSON());var i=a.toFormattedJSON().AMOUNT;g.querySelector("#amount").innerText=i.replace(".",","),g.querySelector("#cln_resident").innerText="1"===a.toFormattedJSON().CLN_RESIDENT?"Резидент":"Нерезидент",g.querySelector("#rcpt_resident").innerText="1"===a.toFormattedJSON().RCPT_RESIDENT?"Резидент":"Нерезидент";var j=f.getCurrencies().then(function(d){var f=b.findWhere(d,{currency:a.get("AMOUNT_CURRENCY")});f&&(g.querySelector("#currency-code").innerText=f.code_currency,g.querySelector("#words-amount").innerText=e.amountToWords(c.removeThousandSeparator(i),f))});this.printPromises.push(j),this.printPromises.push(e.addDocumentAdditionalInfo(g,a))},function(a){e.createPrintFormForPdf().then(function(b){var c=new k(b,a[0].type);c.run(a)})}}),define("apps/ua_intrabank_currency_payment/ua_intrabank_currency_payment_controller",["app","jquery","underscore","backbone","bifit","appsPieces","customConstants","collections/thesaurus","collections/editabled_thesaurus","thesaurusUtils","services/doc_permissions","commons/base_object/document/group_opers_document_controller","models/reference","apps/ua_intrabank_currency_payment/ua_intrabank_currency_payment_model","apps/ua_intrabank_currency_payment/ua_intrabank_currency_payment_filter_view","apps/ua_intrabank_currency_payment/ua_intrabank_currency_payment_list_view","apps/ua_intrabank_currency_payment/ua_intrabank_currency_payment_item_view","apps/ua_intrabank_currency_payment/ua_intrabank_currency_payment_item_edit","apps/ua_intrabank_currency_payment/ua_intrabank_currency_payment_print","text!apps/ua_intrabank_currency_payment/templates/ua_intrabank_currency_payment_list_item.tmpl","i18n!apps/ua_intrabank_currency_payment/nls/ua_intrabank_currency_payment"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){"use strict";function v(a){return"1"===a}function w(a){return a?"1":"0"}var x=function(){return h.getThesaurus("clients")},y=function(){var a=i.getThesaurus("ua_recipients"),e=[];return b.when(A()).then(function(b){c.each(b,function(a){e.push(a.bik)});var f="[3] IN ('"+e.join("', '")+"')",g={error:function(a){d.Validation.invalidField(null,"RCPT_NAME",a)},data:{query:f}};return a.loaded=!1,a.fetch(g)})},z=function(){var a={error:d.Validation.callbacks.showGlobalError};return h.getThesaurus("country").fetch(a)},A=function(){var a="[4] == NULL",b=h.getThesaurus("init_as");return b.fetch({data:{query:a}})},B=function(){var a=f.getAccounts(["1","10"]);return f.removeDepositAccountsWithoutLinks(c.flatten(a)).then(function(a){return c.groupBy(a,"currency")})},C=function(a,c){b.when(A(),f.getCurrencies()).then(function(){a.call(this,c)}.bind(this))};return l.extend({tabsStatuses:{work:"0,1,2,3,4,6",executed:"5",selectedTab:"work"},refFields:["rcpt_name","rcpt_account","rcpt_bnk_name","rcpt_bank_account","rcpt_bnk_addr"],ListView:p,Model:n,FilterView:o,View:q,Edit:r,docType:"ua_intrabank_currency_payment",nls:u,listItemTemplate:t,aliases:null,prepareContent:function(a){var d=l.prototype.prepareContent.call(this,a);return b.when(d,A()).then(function(a){var b=a.PAYMENT_DETAILS;if(b&&a.id&&(a.PAYMENT_DETAILS=this.getCorrectPaymentDetailsOld(b)),a.AMOUNT=a.AMOUNT?e.roundFloat(a.AMOUNT,4):"",a.CLN_BANK_MFO&&a.CLN_BANK_MFO.length>0){var d=c.findWhere(f.getBanks(),{bik:a.CLN_BANK_MFO});void 0!==d&&(a.CLN_BNK_NAME=d.name,a.CLN_BNK_ADDR=d.address)}var g=a.CURRENCY_DATE;return g&&e.str2date(g)<=e.str2date(a.DATE_DOC)&&(a.CURRENCY_DATE=""),a}.bind(this))},prepareContent4Create:function(a){var d=l.prototype.prepareContent4Create.call(this,a),g=b.Deferred();return d.then(function(a){g.resolve(a)}),b.when(f.getCurrencies(),g,z()).then(function(a,b,d){if(!b.CLN_NAME){var g=x().array[0];b.CLN_NAME=g.name_cln,b.CLN_ADDR=g.addr_cln,b.CLN_OKPO=g.okpo,b.CLN_COUNTRY_CODE=g.country_code,b.CLN_RESIDENT=g.resident_flag}var h=c.findWhere(d,{code:x().array[0].country_code});return b.CLN_COUNTRY=(h||{}).country||b.CLN_COUNTRY||"",b.RCPT_RESIDENT||(b.RCPT_RESIDENT="1"),B().then(function(d){var g=c.without(c.keys(d),"UAH"),h=b.AMOUNT_CURRENCY||e.getStorageDocData("ua_intrabank_currency_payment_amount_currency");h=c.contains(g,h)?h:g[0];var i=d[h],j=1===i.length?i[0]:c.findWhere(i,{account:b.CLN_ACCOUNT});if(j=j||c.findWhere(i,{account_id:e.getStorageDocData("ua_intrabank_currency_payment_cln_account")}),j=j||(i.length>0?i[0]:null),!b.CLN_ACCOUNT&&j){b.AMOUNT_CURRENCY=h,b.AMOUNT_CURRENCY_CODE=c.findWhere(a,{currency:b.AMOUNT_CURRENCY}).code_currency,b.CLN_ACCOUNT=j.account,b.CLN_BANK_MFO=j.mfo,b.AMOUNT_CURRENCY=j.currency;var k=c.findWhere(f.getBanks(),{bik:j.mfo});b.CLN_BNK_NAME=k.name,b.CLN_BNK_ADDR=k.address}return b})})},prepareContent4View:function(a){var c=b.Deferred();return A().then(function(){c.resolve(a)}.bind(this)),c},getWorkContent:function(a){var b=a.get("PAYMENT_DETAILS");b&&(a.attributes.PAYMENT_DETAILS=this.getCorrectPaymentDetailsOld(b));var c=l.prototype.getWorkContent.call(this,a);return c.ATT_CNT="0",c},viewDocumentOptions:function(){var a=l.prototype.viewDocumentOptions.call(this);return a.isRcptResidentEnabled=v,a},showDocumentEdit:function(a,b){h.getThesaurus("account_alias",!1).fetch().done(function(c){this.aliases=c,l.prototype.showDocumentEdit.call(this,a,b)}.bind(this))},editDocumentOptions:function(){var a=l.prototype.editDocumentOptions.call(this);return B().then(function(b){return f.setAccountComments(b).then(function(b){return a.accounts=b,a.banks=h.getThesaurus("init_as").array,a.clients=x(),a.currencies=f.getCurrencies(),a.recipientList=y(),a.refFields=this.refFields,a.getMfo=f.getMfo,a.isRcptResidentEnabled=v,a.getRcptResidentValue=w,a}.bind(this))}.bind(this))},reloadDocumentsList:function(b){a.mainLayout.actionBar.show(this.createActionBar(this.actionsList)),l.prototype.reloadDocumentsList.call(this,b)},beforeSaveModel:function(a){if(l.prototype.beforeSaveModel.call(this,a),b("input.add-rcpt").is(":checked")){var c=new m({refType:"ua_recipients"});c.set(this.getRecipientContent(a),{validate:!0}),i.getThesaurus("ua_recipients").create(c)}},getRecipientContent:function(a){return{name:a.get("RCPT_NAME"),inn:a.get("RCPT_OKPO"),requisites:[{id:"",note:"",rcpt_bank_name:a.get("RCPT_BNK_NAME"),comment:a.get("PAYMENT_DETAILS"),bill:a.get("RCPT_ACCOUNT"),bic:a.get("RCPT_BANK_MFO")}]}},getContentFromForm:function(){var a=l.prototype.getContentFromForm.call(this);a.AMOUNT=e.removeThousandSeparator(a.AMOUNT),a.AMOUNT=e.roundFloat(a.AMOUNT,4);var c=a.RCPT_ACCOUNT;return c&&c.match(/^[A-Za-z][A-Za-z]/)&&(a.RCPT_ACCOUNT=""),a.COMISSION_ACCOUNT=a.COMISSION_ACCOUNT.split(/\s+/)[0],a.CLN_ACCOUNT=(a.CLN_ACCOUNT||b("#CLN_ACCOUNT").val()).split(/\s+/)[0],a},PRINT:function(){this.printDocs([this.selectedModel])},printDocs:function(a){s(a)},RECALL:function(){C.call(this,l.prototype.RECALL)},parseFile4Import:function(a){var d=b.Deferred(),e=l.prototype.parseFile4Import.call(this,a);return e.done(function(a){var b=[];if(c.each(a,function(a){a.RCPT_BANK_MFO&&""!==a.RCPT_BANK_MFO&&b.push(a.RCPT_BANK_MFO)}),b.length>0){var e=c.unique(b),f="[0] IN ('"+e.join("', '")+"')",g={query:f,PAGE_NUMBER:0,PAGE_SIZE:e.length};this.getMfoBanksPromise=h.loadStdThesaurus("ua_swift",g)}d.resolve(a)}.bind(this)).fail(d.reject),d},prepareContent4Import:function(a){var d=b.Deferred();return b.when(a).then(function(a){a.RCPT_BANK_MFO&&""!==a.RCPT_BANK_MFO?b.when(z(),A(),this.getMfoBanksPromise).done(function(b,e,f){var g=x().array[0],h=c.findWhere(e,{bik:a.RCPT_BANK_MFO});a.RCPT_BNK_ADDR=h?h.address:"",h=c.findWhere(f,{code:a.RCPT_BANK_MFO}),a.RCPT_BNK_NAME=h?h.name:"",a.CLN_ADDR=g.addr_cln,a.CLN_RESIDENT=g.resident_flag;var i=c.findWhere(b,{
code:g.country_code});a.CLN_COUNTRY=(i||{}).country||a.CLN_COUNTRY||"",d.resolve(a)}.bind(this)):d.resolve(a)}.bind(this)).fail(d.reject),d},getCorrectPaymentDetailsOld:function(a){return a.length>g.PAYMENT_DETAILS_LENGTH?a.slice(0,g.PAYMENT_DETAILS_LENGTH):a},isAccountsForCreateAction:function(){var a=c.sortBy(h.getThesaurus("accs_info").array,"account");a=c.filter(a,function(a){return a.permissions>0&&"1"===a.type&&"2"===a.status});var b,d,e,f=c.groupBy(a,"mfo"),g=c.any(f,function(a){return b=c.groupBy(a,"currency"),d=b.UAH,e=c.without(c.keys(b),"UAH"),d&&d.length>0&&e&&e.length>0});return g},getNoAccErrorText:function(){return c.without(c.keys(f.getAccounts()),"UAH").length>0?u.no_uah_accs:u.no_cur_accs}})}),function(a){var b=document,c="appendChild",d="styleSheet",e=b.createElement("style");e.type="text/css",b.getElementsByTagName("head")[0][c](e),e[d]?e[d].cssText=a:e[c](b.createTextNode(a))}("#ext_filter .ua_intrabank_currency_payment #expanded-view{\nwidth:43em;\n}\ndiv.ua_intrabank_currency_payment form,div.ua_intrabank_currency_payment.doc-wrapper{\nwidth:33.4em;\nmax-width:33.4em;\noverflow:inherit;\nposition:relative;\n}\ndiv.ua_intrabank_currency_payment label{\nmargin-bottom:0.25em !important;\n}\ndiv.ua_intrabank_currency_payment div.datepicker-container{\nposition:relative;\nwidth:6.5em;\n}\ndiv.ua_intrabank_currency_payment .curr-date-label{\nfloat:right;\n}\nbody.en div.ua_intrabank_currency_payment .curr-date-label{\nwidth:8em;\n}\ndiv.ua_intrabank_currency_payment div.datepicker-container > span.datepicker{\ntop:0.313em;\n}\ndiv.ua_intrabank_currency_payment #status_desc{\nmargin-bottom:1em;\n}\ndiv.ua_intrabank_currency_payment div.currency-date{\nfloat:right;\n}\n.doc-wrapper.ua_intrabank_currency_payment h2 label{\ndisplay:inline;\npadding-left:1.5em;\nfont-size:0.722em;\nfont-weight:400;\n}\n.doc-wrapper.ua_intrabank_currency_payment h2 label span{\nmargin-top:0;\n}\ndiv.ua_intrabank_currency_payment div.acc{\nfloat:right;\n}\n.ua_intrabank_currency_payment textarea#PAYMENT_DETAILS{\nmax-height:6.5em;\n}\n.doc-wrapper.ua_intrabank_currency_payment .wide{\nwidth:100%;\n}\n.ua_intrabank_currency_payment label.add{\nmargin-top:0.3em;\n}\n.ua_intrabank_currency_payment label.resident{\nmargin-top:1.7em;\n}\n.ua_intrabank_currency_payment div.details label{\ndisplay:inline-block;\n}\ntable.list.ua_intrabank_currency_payment td.widescreen.rcpt.ellipsis{\nmax-width:12em;\n}\ntable.list.ua_intrabank_currency_payment td.mobile span.rcpt.ellipsis{\nwidth:auto;\nmax-width:200px;\n}\ntable.list.ua_intrabank_currency_payment td.mobile .status{\nwidth:auto;\nfloat:right;\n}\ntable.list.ua_intrabank_currency_payment .account.widescreen{\nwidth:15%;\n}\ntable.list.ua_intrabank_currency_payment .status{\nwidth:115px;\n}\n");